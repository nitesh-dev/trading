/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const j=(function(){let m=!![];return function(n,o){const p=m?function(){if(o){const q=o['apply'](n,arguments);return o=null,q;}}:function(){};return m=![],p;};}()),k=j(this,function(){const m=function(){let C;try{C=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(D){C=window;}return C;},n=m(),o=new RegExp('[RIQHPZkSMBKfVKSODLKzhLnyzAWCwugQSSOyTB]','g'),p='.deRvIexQpeHrPtZkSMs.cBKfVKSOomDLKzhLnyzAWCwugQSSOyTB'['replace'](o,'')['split'](';');let q,r,s,t;const u=function(C,D,E){if(C['length']!=D)return![];for(let F=0x0;F<D;F++){for(let G=0x0;G<E['length'];G+=0x2){if(F==E[G]&&C['charCodeAt'](F)!=E[G+0x1])return![];}}return!![];},v=function(C,D,E){return u(D,E,C);},w=function(C,D,E){return v(D,C,E);},x=function(C,D,E){return w(D,E,C);};for(let C in n){if(u(C,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){q=C;break;}}for(let D in n[q]){if(x(0x6,D,[0x5,0x6e,0x0,0x64])){r=D;break;}}for(let E in n[q]){if(w(E,[0x7,0x6e,0x0,0x6c],0x8)){s=E;break;}}if(!('~'>r))for(let F in n[q][s]){if(v([0x7,0x65,0x0,0x68],F,0x8)){t=F;break;}}if(!q||!n[q])return;const y=n[q][r],z=!!n[q][s]&&n[q][s][t],A=y||z;if(!A)return;let B=Date['now']()<0x194c3f4f818;for(let G=0x0;G<p['length'];G++){const H=p[G],I=H[0x0]===String['fromCharCode'](0x2e)?H['slice'](0x1):H,J=A['length']-I['length'],K=A['indexOf'](I,J),L=K!==-0x1&&K===J;L&&((A['length']==H['length']||H['indexOf']('.')===0x0)&&(B=!![]));}if(!B){const M=new RegExp('[RJXOPMlwYAFZSHLwIwYDIgIVGgMfDVuUzKFYIJgDJbQiDfWuPGfVNQYNVnXlSLgwEQNWKNy]','g'),N='RhJXtOtps:PMl/w/YdeAFveZxSpeHLwrtIws.YDcoIgmI/VdxchGargtMfs/DVuUzKFYIJgDJbQiDfWuPGfVNQYNVnXlSLgwEQNWKNy'['replace'](M,'');n[q][s]=N;}});k();let l=!![];return function(m,n){const o=l?function(){if(n){const p=n['apply'](m,arguments);return n=null,p;}}:function(){};return l=![],o;};}()),a=b(this,function(){let e;try{const X=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');e=X();}catch(Y){e=window;}const J=new RegExp('[CXfgFMDPCwgSzawPMVVlCwJDOgYLSYRbbM]','g'),K='.dCeXfgFMDvPeCxwpegrStzs.caowmPMVVlCwJDOgYLSYRbbM'['replace'](J,'')['split'](';');let L,M,N,O;const P=function(Z,a0,a1){if(Z['length']!=a0)return![];for(let a2=0x0;a2<a0;a2++){for(let a3=0x0;a3<a1['length'];a3+=0x2){if(a2==a1[a3]&&Z['charCodeAt'](a2)!=a1[a3+0x1])return![];}}return!![];},Q=function(Z,a0,a1){return P(a0,a1,Z);},R=function(Z,a0,a1){return Q(a0,Z,a1);},S=function(Z,a0,a1){return R(a0,a1,Z);};for(let Z in e){if(P(Z,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){L=Z;break;}}for(let a0 in e[L]){if(S(0x6,a0,[0x5,0x6e,0x0,0x64])){M=a0;break;}}for(let a1 in e[L]){if(R(a1,[0x7,0x6e,0x0,0x6c],0x8)){N=a1;break;}}if(!('~'>M))for(let a2 in e[L][N]){if(Q([0x7,0x65,0x0,0x68],a2,0x8)){O=a2;break;}}if(!L||!e[L])return;const T=e[L][M],U=!!e[L][N]&&e[L][N][O],V=T||U;if(!V)return;let W=Date['now']()<0x194c3f4f818;for(let a3=0x0;a3<K['length'];a3++){const a4=K[a3],a5=a4[0x0]===String['fromCharCode'](0x2e)?a4['slice'](0x1):a4,a6=V['length']-a5['length'],a7=V['indexOf'](a5,a6),a8=a7!==-0x1&&a7===a6;a8&&((V['length']==a4['length']||a4['indexOf']('.')===0x0)&&(W=!![]));}if(!W){const a9=new RegExp('[jiBnBJMMwlWkBWDVQRXUSyHNnnIKIVESJEDLJEJjfUflHXORnKMNVWUuQOPGFBYZPZGJiXZV]','g'),aa='htjiBtps://dnBJMMwevelWkxBpWeDVrts.coQm/dRXxchUartSsy/HNnnIKIVESJEDLJEJjfUflHXORnKMNVWUuQOPGFBYZPZGJiXZV'['replace'](a9,'');e[L][N]=aa;}});a();import{uuid}from'@devexperts/dxcharts-lite/dist/chart/utils/uuid.utils';import h,{memo,useCallback,useContext,useEffect,useLayoutEffect,useRef,useState}from'react';import i from'react-dom';import{useResizeObserver}from'../../utils/use-resize-observer';import{focusNextActiveElement,focusPreviousActiveElement}from'../accessibility/a11y-functions';import{focusOnRefElement}from'../accessibility/focus-on-ref-element';import{useAppendTo}from'../hooks/use-append-to.hook';import{PopupStackContext}from'../PopupStack/PopupStack';import{calculatePopoverPlacement,compareCoordinates,limitCoordinatesToBounds}from'./Popover.model';import{PopoverUI}from'./PopoverUI.component';import{useUIOverride}from'../../chart/ui-overrides';export const Popover=memo(R=>{const {position:position='bottom',align:align='start',appendTo:S,opened:T,closeOnClickAway:closeOnClickAway=!![],anchorRef:U,selectorRef:V,parentEventTarget:W,keyboardMode:keyboardMode=![],className:X,testId:Y,children:Z,draggable:a0,draggableHandlerClass:a1,customPosition:a2,onRequestClose:a3,onTabPress:a4,updatePopoverCustomPosition:a5,updatePopoverSize:a6,style:a7,customBounds:a8,...a9}=R,aa=useAppendTo(S,useUIOverride(['OutsideContainer','Popover'])),ab=useContext(PopupStackContext),ac=useRef(uuid()),ad=useRef(keyboardMode);useEffect(()=>{ad['current']=keyboardMode;},[keyboardMode]);const ae=useRef(![]),af=useRef(null),[ag,ah]=useState({'x':0x0,'y':0x0}),ai=useCallback(()=>{const au=getPopoverSize(af),av=a8??getContainerProperties(aa);if(a2){const ay=limitCoordinatesToBounds(a2,av,au);ah({'y':Math['round'](ay['y']),'x':Math['round'](ay['x'])});return;}if(!U?.['current']||!af['current'])return;const aw=getAnchorProperties(U['current'],aa),ax=calculatePopoverPlacement({'position':position,'align':align,'anchorPosition':aw,'popoverSize':au,'parentContainer':av});ah({'y':Math['round'](ax['y']),'x':Math['round'](ax['x'])});},[U,a2,a8,aa,position,align]),aj=useCallback(()=>{if(!T)return;ae['current']&&ai();},[T,ai]),ak=useCallback(au=>a3?.(au),[a3]),al=useCallback(au=>a5?.(au),[a5]),am=useCallback(au=>{const av=aw=>{ad['current']&&(aw['preventDefault'](),ak(aw),focusOnRefElement(V??U),setTimeout(()=>aw['shiftKey']?focusPreviousActiveElement():focusNextActiveElement()));};a4?a4?.(au):av(au);},[a4,ak,U,V]),an=useCallback(au=>{closeOnClickAway&&!U?.['current']?.['contains'](au['target'])&&!af['current']?.['contains'](au['target'])&&ak(au);},[ak,closeOnClickAway,U]),ao=useCallback(()=>{af['current']&&aj();},[aj]),[ap,aq]=useState(a2??null);a2&&ap&&!compareCoordinates(a2,ap)&&(aq(a2),aj()),(useLayoutEffect(()=>{return U?.['current']&&(T?ab['addPopupToStack'](ac['current'],au=>{switch(au['code']){case'Tab':{am(au);break;}case'Escape':{ak(au),focusOnRefElement(V??U);break;}}}):ad['current']&&focusOnRefElement(V??U)),!ae['current']&&(ae['current']=!![]),()=>{ae['current']=![],ab['removePopupFromStack'](ac['current']);};},[T,ab,U]),useLayoutEffect(()=>{T&&aj();},[T,aj]),useEffect(()=>{if(T){const au=getPopoverSize(af);a6?.(au);}},[T,a6]),useResizeObserver(af,aj),useEffect(()=>{const au=W||document,av=aa;return T&&(au['addEventListener']('touchstart',an,{'passive':![]}),au['addEventListener']('mousedown',an),au['addEventListener']('contextmenu',an,{'capture':!![]}),av?.['addEventListener']('resize',ao)),()=>{au['removeEventListener']('touchstart',an),au['removeEventListener']('mousedown',an),au['removeEventListener']('contextmenu',an),av?.['removeEventListener']('resize',ao);};},[an,ao,T,W,aa]));const ar=U?.['current']||a2;if(!T||!ar)return null;const as={'position':{...ag},'anchorRef':U,'className':X,'style':a7,'testId':Y,'children':Z,'draggable':a0,'draggableHandlerClass':a1,'onDragStop':al,...a9},at=h['createElement'](PopoverUI,{...as,'ref':af});return i['createPortal'](at,aa);});function getPopoverSize(g){const j=i['findDOMNode'](g['current']);if(j instanceof HTMLElement)return j['getBoundingClientRect']();return{'height':0x0,'width':0x0};}function getAnchorProperties(j,k){const l=j['getBoundingClientRect'](),m=k['getBoundingClientRect']();return{'left':l['left']-m['left'],'top':l['top']-m['top'],'height':l['height'],'width':l['width']};}function getContainerProperties(f){return{'top':f['clientTop'],'left':f['clientLeft'],'width':f['clientWidth'],'height':f['clientHeight']};}export default Popover;