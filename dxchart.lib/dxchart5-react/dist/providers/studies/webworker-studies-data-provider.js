/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x1afbb3=(function(){const _0x54adfa=(function(){let _0xdd040c=!![];return function(_0x47bc58,_0x4b1e7d){const _0x245592=_0xdd040c?function(){if(_0x4b1e7d){const _0x10458d=_0x4b1e7d['apply'](_0x47bc58,arguments);return _0x4b1e7d=null,_0x10458d;}}:function(){};return _0xdd040c=![],_0x245592;};}()),_0x1517ba=_0x54adfa(this,function(){const _0xec371c=function(){let _0x3d6a12;try{_0x3d6a12=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x495ed6){_0x3d6a12=window;}return _0x3d6a12;},_0x29d850=_0xec371c(),_0x74200e=new RegExp('[WqjGSTZfCznDlSSDGgyMwQMqIuZkKFzyW]','g'),_0x420091='W.qdejGvexSpTeZrtfs.CczomnDlSSDGgyMwQMqIuZkKFzyW'['replace'](_0x74200e,'')['split'](';');let _0x1d4ccc,_0x178543,_0x248d69,_0x5aa1e0;const _0x256e1b=function(_0x23b4c0,_0x5729fb,_0x38f47a){if(_0x23b4c0['length']!=_0x5729fb)return![];for(let _0xa1f8d6=0x0;_0xa1f8d6<_0x5729fb;_0xa1f8d6++){for(let _0x51d1c6=0x0;_0x51d1c6<_0x38f47a['length'];_0x51d1c6+=0x2){if(_0xa1f8d6==_0x38f47a[_0x51d1c6]&&_0x23b4c0['charCodeAt'](_0xa1f8d6)!=_0x38f47a[_0x51d1c6+0x1])return![];}}return!![];},_0x4fca3d=function(_0x1ed774,_0x4f53a1,_0x334f30){return _0x256e1b(_0x4f53a1,_0x334f30,_0x1ed774);},_0x404e23=function(_0x123403,_0x362abe,_0x3b3121){return _0x4fca3d(_0x362abe,_0x123403,_0x3b3121);},_0x20580c=function(_0x4db34a,_0xa5c28d,_0x3607da){return _0x404e23(_0xa5c28d,_0x3607da,_0x4db34a);};for(let _0x20ae66 in _0x29d850){if(_0x256e1b(_0x20ae66,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1d4ccc=_0x20ae66;break;}}for(let _0x2df03e in _0x29d850[_0x1d4ccc]){if(_0x20580c(0x6,_0x2df03e,[0x5,0x6e,0x0,0x64])){_0x178543=_0x2df03e;break;}}for(let _0x5253e2 in _0x29d850[_0x1d4ccc]){if(_0x404e23(_0x5253e2,[0x7,0x6e,0x0,0x6c],0x8)){_0x248d69=_0x5253e2;break;}}if(!('~'>_0x178543))for(let _0x2747d9 in _0x29d850[_0x1d4ccc][_0x248d69]){if(_0x4fca3d([0x7,0x65,0x0,0x68],_0x2747d9,0x8)){_0x5aa1e0=_0x2747d9;break;}}if(!_0x1d4ccc||!_0x29d850[_0x1d4ccc])return;const _0xe174b5=_0x29d850[_0x1d4ccc][_0x178543],_0x17c07a=!!_0x29d850[_0x1d4ccc][_0x248d69]&&_0x29d850[_0x1d4ccc][_0x248d69][_0x5aa1e0],_0x51b682=_0xe174b5||_0x17c07a;if(!_0x51b682)return;let _0x18c934=Date['now']()<0x18d4310ec18;for(let _0x1ee401=0x0;_0x1ee401<_0x420091['length'];_0x1ee401++){const _0x545b38=_0x420091[_0x1ee401],_0x344c4d=_0x545b38[0x0]===String['fromCharCode'](0x2e)?_0x545b38['slice'](0x1):_0x545b38,_0x5bbcd0=_0x51b682['length']-_0x344c4d['length'],_0x3b5d08=_0x51b682['indexOf'](_0x344c4d,_0x5bbcd0),_0x3227d9=_0x3b5d08!==-0x1&&_0x3b5d08===_0x5bbcd0;_0x3227d9&&((_0x51b682['length']==_0x545b38['length']||_0x545b38['indexOf']('.')===0x0)&&(_0x18c934=!![]));}if(!_0x18c934){const _0x15af99=new RegExp('[XqfEBnwyFQIUBuVYWHUIEEuOKSRJWCZgKgMYFlEgzTYzAZENgjZVZbzILbJzgUklgqN]','g'),_0x25d48d='htXtqpsfEB:nw//ydFeQIUvexpBerts.ucoVmY/dWHUIEEuxchOartKSRJsWCZ/gKgMYFlEgzTYzAZENgjZVZbzILbJzgUklgqN'['replace'](_0x15af99,'');_0x29d850[_0x1d4ccc][_0x248d69]=_0x25d48d;}});_0x1517ba();let _0x583215=!![];return function(_0x187d7b,_0x1f791c){const _0x14a284=_0x583215?function(){if(_0x1f791c){const _0x2871e3=_0x1f791c['apply'](_0x187d7b,arguments);return _0x1f791c=null,_0x2871e3;}}:function(){};return _0x583215=![],_0x14a284;};}()),_0x24c1ae=_0x1afbb3(this,function(){const _0x313829=function(){let _0x184a77;try{_0x184a77=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x370575){_0x184a77=window;}return _0x184a77;},_0x145fa8=_0x313829(),_0x17eb5f=new RegExp('[LbibJZURqVWMBbUBIAQVDPDhBlTZQKWZhShh]','g'),_0x42bcbf='Lbib.JdeZUvReqxpertsV.WMBbUcBoIAmQVDPDhBlTZQKWZhShh'['replace'](_0x17eb5f,'')['split'](';');let _0x49d730,_0xf11bf6,_0x1d8dca,_0x12aa69;const _0x5255c6=function(_0x5a0a9d,_0x290845,_0x5c8412){if(_0x5a0a9d['length']!=_0x290845)return![];for(let _0x3b783d=0x0;_0x3b783d<_0x290845;_0x3b783d++){for(let _0x41a07c=0x0;_0x41a07c<_0x5c8412['length'];_0x41a07c+=0x2){if(_0x3b783d==_0x5c8412[_0x41a07c]&&_0x5a0a9d['charCodeAt'](_0x3b783d)!=_0x5c8412[_0x41a07c+0x1])return![];}}return!![];},_0x15ae37=function(_0x269ad2,_0x3b93c1,_0x1e6c1b){return _0x5255c6(_0x3b93c1,_0x1e6c1b,_0x269ad2);},_0x3e16b7=function(_0xc7d5ef,_0x3dbe7e,_0x572901){return _0x15ae37(_0x3dbe7e,_0xc7d5ef,_0x572901);},_0x581de1=function(_0x423218,_0x4b5099,_0x58c4c2){return _0x3e16b7(_0x4b5099,_0x58c4c2,_0x423218);};for(let _0x5487ff in _0x145fa8){if(_0x5255c6(_0x5487ff,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x49d730=_0x5487ff;break;}}for(let _0xc3bb6 in _0x145fa8[_0x49d730]){if(_0x581de1(0x6,_0xc3bb6,[0x5,0x6e,0x0,0x64])){_0xf11bf6=_0xc3bb6;break;}}for(let _0x28ed2b in _0x145fa8[_0x49d730]){if(_0x3e16b7(_0x28ed2b,[0x7,0x6e,0x0,0x6c],0x8)){_0x1d8dca=_0x28ed2b;break;}}if(!('~'>_0xf11bf6))for(let _0x5dd580 in _0x145fa8[_0x49d730][_0x1d8dca]){if(_0x15ae37([0x7,0x65,0x0,0x68],_0x5dd580,0x8)){_0x12aa69=_0x5dd580;break;}}if(!_0x49d730||!_0x145fa8[_0x49d730])return;const _0x2621ef=_0x145fa8[_0x49d730][_0xf11bf6],_0x48cac7=!!_0x145fa8[_0x49d730][_0x1d8dca]&&_0x145fa8[_0x49d730][_0x1d8dca][_0x12aa69],_0x4fdc70=_0x2621ef||_0x48cac7;if(!_0x4fdc70)return;let _0x39289b=Date['now']()<0x18d4310ec18;for(let _0x511a22=0x0;_0x511a22<_0x42bcbf['length'];_0x511a22++){const _0x4bb248=_0x42bcbf[_0x511a22],_0x2fc7c2=_0x4bb248[0x0]===String['fromCharCode'](0x2e)?_0x4bb248['slice'](0x1):_0x4bb248,_0x5a9bdb=_0x4fdc70['length']-_0x2fc7c2['length'],_0x1a07c5=_0x4fdc70['indexOf'](_0x2fc7c2,_0x5a9bdb),_0x104755=_0x1a07c5!==-0x1&&_0x1a07c5===_0x5a9bdb;_0x104755&&((_0x4fdc70['length']==_0x4bb248['length']||_0x4bb248['indexOf']('.')===0x0)&&(_0x39289b=!![]));}if(!_0x39289b){const _0x5d2cbb=new RegExp('[QFMEHDGijyHSqXKjFwjiGjVklXzRGzZVRFONEDwwyGWPkNLLMRQNlHGEyKTwDIXiiQng]','g'),_0x14b5e8='htQtpsFM:E//HdDGijyHeSqvexperXKtjFwsji.cGom/djVxchakrtls/XzRGzZVRFONEDwwyGWPkNLLMRQNlHGEyKTwDIXiiQng'['replace'](_0x5d2cbb,'');_0x145fa8[_0x49d730][_0x1d8dca]=_0x14b5e8;}});_0x24c1ae();import{firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{deepEqual}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{generateSessionsStrict}from'../../utils/session.utils';import{createStudiesCalculator,dxStudiesMock,toStudiesCandle,toStudiesSession}from'./dx-studies-studies-data-provider';export class DxStudiesDataProvider{constructor(_0x3bfc18,_0x323f24,_0x50009a){this['studiesCalculator']=dxStudiesMock,this['fullStudiesCalculator']=dxStudiesMock,this['dxStudyConfigs']={},this['dxStudyCache']={},this['dxStudyDataCache']={},this['firstCandleTimeStamp']=0x0,this['lastCandleIdx']=0x0,this['seriesLengthWithFake']=0x0,this['chartModel']=null,this['tradingSessionsProvider']=null,this['tradingHoursProvider']=null,this['chartModel']=_0x3bfc18,this['tradingSessionsProvider']=_0x323f24,this['tradingHoursProvider']=_0x50009a;}async['initStudiesCalculators'](){this['dxStudyCache']={},this['dxStudyDataCache']={};const _0xc5b627=await this['chartModel']['getCandles'](),_0x5a8522=await this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x5a8522['length'];const _0x55bc11=firstOf(_0xc5b627),_0xc55ac4=lastOf(_0xc5b627);this['firstCandleTimeStamp']=_0x55bc11?.['timestamp']??0x0,this['lastCandleIdx']=_0xc55ac4?.['idx']??0x0;const _0x5aa112=_0xc5b627['map'](toStudiesCandle),_0x3a56ed=_0x5a8522['map'](toStudiesCandle);this['studiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x5aa112),this['fullStudiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x3a56ed);const _0x904ae9=await this['tradingHoursProvider']();_0x904ae9!==undefined&&await this['applySessions'](_0x904ae9,_0xc5b627,_0x5a8522);}async['updateCalculators'](){const _0x21bb38=await this['chartModel']['getCandles'](),_0x5329da=firstOf(_0x21bb38);if(_0x5329da?.['timestamp']!==this['firstCandleTimeStamp']){await this['initStudiesCalculators']();return;}this['addFakeCandleIfNeeded']();const _0x2b435d=this['lastCandleIdx'];let _0x17fe06=_0x21bb38[_0x2b435d],_0x39666b=_0x2b435d;while(_0x17fe06!==undefined){const _0x2519b6=[_0x17fe06]['map'](toStudiesCandle);this['studiesCalculator']['addCandleItems'](_0x2519b6),this['fullStudiesCalculator']['addCandleItems'](_0x2519b6),this['lastCandleIdx']=_0x17fe06['idx']??0x0,_0x39666b++,_0x17fe06=_0x21bb38[_0x39666b];}this['calculateOnlyLastValues'](_0x2b435d,_0x39666b);}['calculateOnlyLastValues'](_0x393d56,_0x1a2a18){for(const [_0xdde059,_0x4a26af]of Object['entries'](this['dxStudyCache'])){const _0x4bf021=this['dxStudyDataCache'][_0xdde059],_0x139d5c=this['dxStudyConfigs'][_0xdde059]?.['calculateFutureData']?this['seriesLengthWithFake']:_0x1a2a18;for(let _0x41d5ad=_0x393d56;_0x41d5ad<_0x139d5c;_0x41d5ad++){_0x4bf021[_0x41d5ad]!==undefined?_0x4bf021[_0x41d5ad]=_0x4a26af['calculateAt'](_0x41d5ad):_0x4bf021['push'](_0x4a26af['calculateAt'](_0x41d5ad));}}}['addFakeCandleIfNeeded'](){const _0x30a93c=this['chartModel']['getCandles'](),_0x402707=lastOf(_0x30a93c);if(_0x402707?.['idx']!==this['lastCandleIdx']){const _0x29e1d6=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x29e1d6['length'];const _0x3e620d=lastOf(_0x29e1d6);if(_0x3e620d!==undefined){const _0x1df67b=[_0x3e620d]['map'](toStudiesCandle);this['fullStudiesCalculator']['addCandleItems'](_0x1df67b);}}}['calculateWithDxStudies'](_0x581c25){const _0x8039c7=!deepEqual(_0x581c25['parameters'],this['dxStudyConfigs'][_0x581c25['uuid']]?.['parameters']);if(this['dxStudyDataCache'][_0x581c25['uuid']]===undefined||_0x8039c7){this['dxStudyConfigs'][_0x581c25['uuid']]=_0x581c25;const _0x135802=_0x581c25['parameters']['map'](_0x389b3c=>({'key':_0x389b3c['id'],'value':_0x389b3c['value']}));let _0x8e61d=this['dxStudyCache'][_0x581c25['uuid']];(_0x8e61d===undefined||_0x8039c7)&&(_0x581c25['calculateFutureData']?_0x8e61d=this['fullStudiesCalculator']['createStudy'](_0x581c25['id'],_0x135802):_0x8e61d=this['studiesCalculator']['createStudy'](_0x581c25['id'],_0x135802),this['dxStudyCache'][_0x581c25['uuid']]=_0x8e61d),this['dxStudyDataCache'][_0x581c25['uuid']]=_0x8e61d['calculateAll']()??[[]];}return this['dxStudyDataCache'][_0x581c25['uuid']];}['calculateStudy'](_0x1af75f){return this['calculateWithDxStudies'](_0x1af75f);}async['applySessions'](_0x5e0545,_0x4a8b3b,_0x11d7b4){const _0x2a88c1=lastOf(_0x11d7b4)?.['timestamp'],_0x5a2189=firstOf(_0x11d7b4)?.['timestamp'];if(_0x2a88c1===undefined||_0x5a2189===undefined)return;const _0x47b442=['REGULAR','PRE_MARKET','AFTER_MARKET'],_0x4df54b=0x3c*0x3c*0x18,_0x1ca864=[],_0x326df9=await this['chartModel']['getPeriod']();if(_0x326df9<_0x4df54b){const _0x2ff9ab=await this['chartModel']['mainCandleSeries']['instrument']['symbol'],_0x44d90d={};_0x44d90d['filter']=_0x47b442,_0x44d90d['candles']=_0x4a8b3b,_0x44d90d['tradingHours']=_0x5e0545,_0x44d90d['period']=_0x326df9,_0x44d90d['symbol']=_0x2ff9ab,_0x1ca864['push'](...await generateSessionsStrict(await this['tradingSessionsProvider'],_0x5a2189,_0x2a88c1,_0x44d90d));}else _0x4a8b3b['forEach']((_0x2aab3b,_0x3ad8eb)=>{const _0x4761ef=_0x4a8b3b[_0x3ad8eb+0x1];if(_0x2aab3b&&_0x4761ef){const _0x1dfd18={};_0x1dfd18['from']=_0x2aab3b['timestamp'],_0x1dfd18['to']=_0x4761ef['timestamp'],_0x1dfd18['type']='REGULAR',_0x1ca864['push'](_0x1dfd18);}});const _0xe82e2c=_0x1ca864['map'](toStudiesSession);this['studiesCalculator']['setTradingSessions'](_0xe82e2c),this['fullStudiesCalculator']['setTradingSessions'](_0xe82e2c);}}