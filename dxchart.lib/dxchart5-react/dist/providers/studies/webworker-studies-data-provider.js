/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x51b995=(function(){const _0x5b8e1f=(function(){let _0x4f0744=!![];return function(_0x4905bb,_0x5ea165){const _0x5739ee=_0x4f0744?function(){if(_0x5ea165){const _0x401368=_0x5ea165['apply'](_0x4905bb,arguments);return _0x5ea165=null,_0x401368;}}:function(){};return _0x4f0744=![],_0x5739ee;};}()),_0xbe0e07=_0x5b8e1f(this,function(){const _0x5e66a6=function(){let _0x282489;try{_0x282489=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x314ac0){_0x282489=window;}return _0x282489;},_0x28f129=_0x5e66a6(),_0x516184=new RegExp('[CPPZNyHZnNzWQFABUPAjAUkGbWSLRIwflRylZh]','g'),_0x46b034='.CdevPPeZNxyHpeZnrts.cNzomWQFABUPAjAUkGbWSLRIwflRylZh'['replace'](_0x516184,'')['split'](';');let _0x13c813,_0x5db6b2,_0x4c4897,_0x8f7cc9;const _0x36a907=function(_0x2f543d,_0x2ef0e9,_0x43b653){if(_0x2f543d['length']!=_0x2ef0e9)return![];for(let _0x547c39=0x0;_0x547c39<_0x2ef0e9;_0x547c39++){for(let _0x4f9d4a=0x0;_0x4f9d4a<_0x43b653['length'];_0x4f9d4a+=0x2){if(_0x547c39==_0x43b653[_0x4f9d4a]&&_0x2f543d['charCodeAt'](_0x547c39)!=_0x43b653[_0x4f9d4a+0x1])return![];}}return!![];},_0x22d7c6=function(_0x59fc4d,_0x2f3482,_0x24bd95){return _0x36a907(_0x2f3482,_0x24bd95,_0x59fc4d);},_0x3adbb6=function(_0x5ec588,_0x2f31a4,_0x77ebbb){return _0x22d7c6(_0x2f31a4,_0x5ec588,_0x77ebbb);},_0x56725f=function(_0x353dbd,_0xa02e6f,_0x472bd4){return _0x3adbb6(_0xa02e6f,_0x472bd4,_0x353dbd);};for(let _0x52d509 in _0x28f129){if(_0x36a907(_0x52d509,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x13c813=_0x52d509;break;}}for(let _0x4042b8 in _0x28f129[_0x13c813]){if(_0x56725f(0x6,_0x4042b8,[0x5,0x6e,0x0,0x64])){_0x5db6b2=_0x4042b8;break;}}for(let _0x4d976a in _0x28f129[_0x13c813]){if(_0x3adbb6(_0x4d976a,[0x7,0x6e,0x0,0x6c],0x8)){_0x4c4897=_0x4d976a;break;}}if(!('~'>_0x5db6b2))for(let _0x4d1766 in _0x28f129[_0x13c813][_0x4c4897]){if(_0x22d7c6([0x7,0x65,0x0,0x68],_0x4d1766,0x8)){_0x8f7cc9=_0x4d1766;break;}}if(!_0x13c813||!_0x28f129[_0x13c813])return;const _0x3bebb8=_0x28f129[_0x13c813][_0x5db6b2],_0x3ed277=!!_0x28f129[_0x13c813][_0x4c4897]&&_0x28f129[_0x13c813][_0x4c4897][_0x8f7cc9],_0x4c9b9e=_0x3bebb8||_0x3ed277;if(!_0x4c9b9e)return;let _0x123165=Date['now']()<0x18cfaf7e418;for(let _0x483a26=0x0;_0x483a26<_0x46b034['length'];_0x483a26++){const _0x5acb19=_0x46b034[_0x483a26],_0x5c6e65=_0x5acb19[0x0]===String['fromCharCode'](0x2e)?_0x5acb19['slice'](0x1):_0x5acb19,_0x1ccd2a=_0x4c9b9e['length']-_0x5c6e65['length'],_0x53e480=_0x4c9b9e['indexOf'](_0x5c6e65,_0x1ccd2a),_0x3bb814=_0x53e480!==-0x1&&_0x53e480===_0x1ccd2a;_0x3bb814&&((_0x4c9b9e['length']==_0x5acb19['length']||_0x5acb19['indexOf']('.')===0x0)&&(_0x123165=!![]));}if(!_0x123165){const _0x22c742=new RegExp('[MfVnBXGCwDBIJwHlzjARPPDSTqbyAbOYFHWUEHGzAibXkggUPNHnZMMjZLJXCiZwSPjjIuXuJNG]','g'),_0x4535bf='MhftVtnpsB:/X/deGCwvexpeDBIrJwHtslzjAR.PPcoDm/dSxcThqbyaArbOYtFHs/WUEHGzAibXkggUPNHnZMMjZLJXCiZwSPjjIuXuJNG'['replace'](_0x22c742,'');_0x28f129[_0x13c813][_0x4c4897]=_0x4535bf;}});_0xbe0e07();let _0x220eaa=!![];return function(_0x8acad8,_0x553237){const _0xe3e47a=_0x220eaa?function(){if(_0x553237){const _0x17264e=_0x553237['apply'](_0x8acad8,arguments);return _0x553237=null,_0x17264e;}}:function(){};return _0x220eaa=![],_0xe3e47a;};}()),_0x2eea2e=_0x51b995(this,function(){let _0x3dddf1;try{const _0x146a41=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3dddf1=_0x146a41();}catch(_0x4f6dcb){_0x3dddf1=window;}const _0x54e562=new RegExp('[qMhyykhuwuAhuwSSEGGTTYBAkKaGaWDA]','g'),_0x16e50a='q.dMevehyykxhupewrutAhsu.wcSoSEGGTTmYBAkKaGaWDA'['replace'](_0x54e562,'')['split'](';');let _0x4ad679,_0x52ed77,_0x2f8196,_0x71e716;const _0x462567=function(_0x3914b7,_0x3179f7,_0x2c1f86){if(_0x3914b7['length']!=_0x3179f7)return![];for(let _0x732934=0x0;_0x732934<_0x3179f7;_0x732934++){for(let _0x51ea82=0x0;_0x51ea82<_0x2c1f86['length'];_0x51ea82+=0x2){if(_0x732934==_0x2c1f86[_0x51ea82]&&_0x3914b7['charCodeAt'](_0x732934)!=_0x2c1f86[_0x51ea82+0x1])return![];}}return!![];},_0x36fdcc=function(_0x1b547b,_0xadb986,_0x3e416f){return _0x462567(_0xadb986,_0x3e416f,_0x1b547b);},_0x16d467=function(_0x3b2332,_0x4f8aad,_0x29d922){return _0x36fdcc(_0x4f8aad,_0x3b2332,_0x29d922);},_0x343347=function(_0x285a24,_0x334712,_0x11c214){return _0x16d467(_0x334712,_0x11c214,_0x285a24);};for(let _0x23c515 in _0x3dddf1){if(_0x462567(_0x23c515,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4ad679=_0x23c515;break;}}for(let _0x54ff95 in _0x3dddf1[_0x4ad679]){if(_0x343347(0x6,_0x54ff95,[0x5,0x6e,0x0,0x64])){_0x52ed77=_0x54ff95;break;}}for(let _0x182910 in _0x3dddf1[_0x4ad679]){if(_0x16d467(_0x182910,[0x7,0x6e,0x0,0x6c],0x8)){_0x2f8196=_0x182910;break;}}if(!('~'>_0x52ed77))for(let _0x3641a1 in _0x3dddf1[_0x4ad679][_0x2f8196]){if(_0x36fdcc([0x7,0x65,0x0,0x68],_0x3641a1,0x8)){_0x71e716=_0x3641a1;break;}}if(!_0x4ad679||!_0x3dddf1[_0x4ad679])return;const _0x4b0d2b=_0x3dddf1[_0x4ad679][_0x52ed77],_0x4ab43d=!!_0x3dddf1[_0x4ad679][_0x2f8196]&&_0x3dddf1[_0x4ad679][_0x2f8196][_0x71e716],_0x4b1ded=_0x4b0d2b||_0x4ab43d;if(!_0x4b1ded)return;let _0x18c4d3=Date['now']()<0x18cfaf7e418;for(let _0x5bcd05=0x0;_0x5bcd05<_0x16e50a['length'];_0x5bcd05++){const _0x422186=_0x16e50a[_0x5bcd05],_0x48b165=_0x422186[0x0]===String['fromCharCode'](0x2e)?_0x422186['slice'](0x1):_0x422186,_0x34ced7=_0x4b1ded['length']-_0x48b165['length'],_0x37b84d=_0x4b1ded['indexOf'](_0x48b165,_0x34ced7),_0x326539=_0x37b84d!==-0x1&&_0x37b84d===_0x34ced7;_0x326539&&((_0x4b1ded['length']==_0x422186['length']||_0x422186['indexOf']('.')===0x0)&&(_0x18c4d3=!![]));}if(!_0x18c4d3){const _0x594061=new RegExp('[bRBSjRwjLyOjyIfyEwKKMDCZWLYDILAETNLLqEllSLBROgnzfOHKuWAiiAwEELjAMqlZgKWD]','g'),_0x9cac8e='htbtpsR:/B/SjRdevewjLyxpOjyIefyEwrtsK.KMcoDm/dCZWxchaLYDrItLAEsTN/LLqEllSLBROgnzfOHKuWAiiAwEELjAMqlZgKWD'['replace'](_0x594061,'');_0x3dddf1[_0x4ad679][_0x2f8196]=_0x9cac8e;}});_0x2eea2e();import{firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{deepEqual}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{generateSessionsStrict}from'../../utils/session.utils';import{createStudiesCalculator,dxStudiesMock,toStudiesCandle,toStudiesSession}from'./dx-studies-studies-data-provider';export class DxStudiesDataProvider{constructor(_0x245e8a,_0x4d070c,_0x5cec8a){this['studiesCalculator']=dxStudiesMock,this['fullStudiesCalculator']=dxStudiesMock,this['dxStudyConfigs']={},this['dxStudyCache']={},this['dxStudyDataCache']={},this['firstCandleTimeStamp']=0x0,this['lastCandleIdx']=0x0,this['seriesLengthWithFake']=0x0,this['chartModel']=null,this['tradingSessionsProvider']=null,this['tradingHoursProvider']=null,this['chartModel']=_0x245e8a,this['tradingSessionsProvider']=_0x4d070c,this['tradingHoursProvider']=_0x5cec8a;}async['initStudiesCalculators'](){this['dxStudyCache']={},this['dxStudyDataCache']={};const _0x1eb12e=await this['chartModel']['getCandles'](),_0x3859af=await this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x3859af['length'];const _0x3c278c=firstOf(_0x1eb12e),_0x18962f=lastOf(_0x1eb12e);this['firstCandleTimeStamp']=_0x3c278c?.['timestamp']??0x0,this['lastCandleIdx']=_0x18962f?.['idx']??0x0;const _0x2d5a99=_0x1eb12e['map'](toStudiesCandle),_0x241ca4=_0x3859af['map'](toStudiesCandle);this['studiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x2d5a99),this['fullStudiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x241ca4);const _0x40c4e6=await this['tradingHoursProvider']();_0x40c4e6!==undefined&&await this['applySessions'](_0x40c4e6,_0x1eb12e,_0x3859af);}async['updateCalculators'](){const _0x219cd3=await this['chartModel']['getCandles'](),_0x3bc2fb=firstOf(_0x219cd3);if(_0x3bc2fb?.['timestamp']!==this['firstCandleTimeStamp']){await this['initStudiesCalculators']();return;}this['addFakeCandleIfNeeded']();const _0x5001e7=this['lastCandleIdx'];let _0x7c0ff5=_0x219cd3[_0x5001e7],_0x45e6a2=_0x5001e7;while(_0x7c0ff5!==undefined){const _0x23a3af=[_0x7c0ff5]['map'](toStudiesCandle);this['studiesCalculator']['addCandleItems'](_0x23a3af),this['fullStudiesCalculator']['addCandleItems'](_0x23a3af),this['lastCandleIdx']=_0x7c0ff5['idx']??0x0,_0x45e6a2++,_0x7c0ff5=_0x219cd3[_0x45e6a2];}this['calculateOnlyLastValues'](_0x5001e7,_0x45e6a2);}['calculateOnlyLastValues'](_0x2c021c,_0x182bb6){for(const [_0x3705fb,_0x256e86]of Object['entries'](this['dxStudyCache'])){const _0x5bbef7=this['dxStudyDataCache'][_0x3705fb],_0x2fda25=this['dxStudyConfigs'][_0x3705fb]?.['calculateFutureData']?this['seriesLengthWithFake']:_0x182bb6;for(let _0x580b5a=_0x2c021c;_0x580b5a<_0x2fda25;_0x580b5a++){_0x5bbef7[_0x580b5a]!==undefined?_0x5bbef7[_0x580b5a]=_0x256e86['calculateAt'](_0x580b5a):_0x5bbef7['push'](_0x256e86['calculateAt'](_0x580b5a));}}}['addFakeCandleIfNeeded'](){const _0x38dba6=this['chartModel']['getCandles'](),_0x4f7d12=lastOf(_0x38dba6);if(_0x4f7d12?.['idx']!==this['lastCandleIdx']){const _0x57facc=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x57facc['length'];const _0xa1824e=lastOf(_0x57facc);if(_0xa1824e!==undefined){const _0x5e7ced=[_0xa1824e]['map'](toStudiesCandle);this['fullStudiesCalculator']['addCandleItems'](_0x5e7ced);}}}['calculateWithDxStudies'](_0xf696f6){const _0x50b231=!deepEqual(_0xf696f6['parameters'],this['dxStudyConfigs'][_0xf696f6['uuid']]?.['parameters']);if(this['dxStudyDataCache'][_0xf696f6['uuid']]===undefined||_0x50b231){this['dxStudyConfigs'][_0xf696f6['uuid']]=_0xf696f6;const _0x1ef34d=_0xf696f6['parameters']['map'](_0x507c71=>({'key':_0x507c71['id'],'value':_0x507c71['value']}));let _0x43187d=this['dxStudyCache'][_0xf696f6['uuid']];(_0x43187d===undefined||_0x50b231)&&(_0xf696f6['calculateFutureData']?_0x43187d=this['fullStudiesCalculator']['createStudy'](_0xf696f6['id'],_0x1ef34d):_0x43187d=this['studiesCalculator']['createStudy'](_0xf696f6['id'],_0x1ef34d),this['dxStudyCache'][_0xf696f6['uuid']]=_0x43187d),this['dxStudyDataCache'][_0xf696f6['uuid']]=_0x43187d['calculateAll']()??[[]];}return this['dxStudyDataCache'][_0xf696f6['uuid']];}['calculateStudy'](_0x1bd21d){return this['calculateWithDxStudies'](_0x1bd21d);}async['applySessions'](_0x5a64ed,_0x41035c,_0x317624){const _0x523f98=lastOf(_0x317624)?.['timestamp'],_0x483499=firstOf(_0x317624)?.['timestamp'];if(_0x523f98===undefined||_0x483499===undefined)return;const _0x5d199d=['REGULAR','PRE_MARKET','AFTER_MARKET'],_0x43b038=0x3c*0x3c*0x18,_0x21de05=[],_0x1a4416=await this['chartModel']['getPeriod']();if(_0x1a4416<_0x43b038){const _0x366223=await this['chartModel']['mainCandleSeries']['instrument']['symbol'],_0x22c3df={};_0x22c3df['filter']=_0x5d199d,_0x22c3df['candles']=_0x41035c,_0x22c3df['tradingHours']=_0x5a64ed,_0x22c3df['period']=_0x1a4416,_0x22c3df['symbol']=_0x366223,_0x21de05['push'](...await generateSessionsStrict(await this['tradingSessionsProvider'],_0x483499,_0x523f98,_0x22c3df));}else _0x41035c['forEach']((_0x4371a0,_0x56e241)=>{const _0x30a09c=_0x41035c[_0x56e241+0x1];if(_0x4371a0&&_0x30a09c){const _0x230121={};_0x230121['from']=_0x4371a0['timestamp'],_0x230121['to']=_0x30a09c['timestamp'],_0x230121['type']='REGULAR',_0x21de05['push'](_0x230121);}});const _0x1020e2=_0x21de05['map'](toStudiesSession);this['studiesCalculator']['setTradingSessions'](_0x1020e2),this['fullStudiesCalculator']['setTradingSessions'](_0x1020e2);}}