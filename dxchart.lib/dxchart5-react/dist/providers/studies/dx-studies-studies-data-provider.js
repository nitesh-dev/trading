/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x49bb2f=(function(){const _0x5caa0f=(function(){let _0x4424e6=!![];return function(_0x270d02,_0xfbdcc4){const _0x2582ec=_0x4424e6?function(){if(_0xfbdcc4){const _0xa19ef0=_0xfbdcc4['apply'](_0x270d02,arguments);return _0xfbdcc4=null,_0xa19ef0;}}:function(){};return _0x4424e6=![],_0x2582ec;};}()),_0x1d32de=_0x5caa0f(this,function(){const _0x1cda0b=function(){let _0x2a3b33;try{_0x2a3b33=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0xcf235c){_0x2a3b33=window;}return _0x2a3b33;},_0x3cc176=_0x1cda0b(),_0x7cd6bb=new RegExp('[XKbAfBYbEauVAUwWXQkaFKHGuOqQVjyJJCZwP]','g'),_0x5bdb89='X.KdbAfeBYvexpebrts.coEamuVAUwWXQkaFKHGuOqQVjyJJCZwP'['replace'](_0x7cd6bb,'')['split'](';');let _0x392f3b,_0x24aef1,_0xacedbf,_0x28557b;const _0x7d21c2=function(_0x3da4be,_0x4497aa,_0x58e3f1){if(_0x3da4be['length']!=_0x4497aa)return![];for(let _0x313f48=0x0;_0x313f48<_0x4497aa;_0x313f48++){for(let _0x5d39dd=0x0;_0x5d39dd<_0x58e3f1['length'];_0x5d39dd+=0x2){if(_0x313f48==_0x58e3f1[_0x5d39dd]&&_0x3da4be['charCodeAt'](_0x313f48)!=_0x58e3f1[_0x5d39dd+0x1])return![];}}return!![];},_0x3d43f7=function(_0x6c286c,_0x509faa,_0x495934){return _0x7d21c2(_0x509faa,_0x495934,_0x6c286c);},_0x3d695e=function(_0x1d4a54,_0x226156,_0x4f216e){return _0x3d43f7(_0x226156,_0x1d4a54,_0x4f216e);},_0x6abd1b=function(_0xb6a3bd,_0x5a649f,_0x4e1dd3){return _0x3d695e(_0x5a649f,_0x4e1dd3,_0xb6a3bd);};for(let _0x376bcc in _0x3cc176){if(_0x7d21c2(_0x376bcc,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x392f3b=_0x376bcc;break;}}for(let _0x112cae in _0x3cc176[_0x392f3b]){if(_0x6abd1b(0x6,_0x112cae,[0x5,0x6e,0x0,0x64])){_0x24aef1=_0x112cae;break;}}for(let _0x94e363 in _0x3cc176[_0x392f3b]){if(_0x3d695e(_0x94e363,[0x7,0x6e,0x0,0x6c],0x8)){_0xacedbf=_0x94e363;break;}}if(!('~'>_0x24aef1))for(let _0x1753b5 in _0x3cc176[_0x392f3b][_0xacedbf]){if(_0x3d43f7([0x7,0x65,0x0,0x68],_0x1753b5,0x8)){_0x28557b=_0x1753b5;break;}}if(!_0x392f3b||!_0x3cc176[_0x392f3b])return;const _0x5e2e28=_0x3cc176[_0x392f3b][_0x24aef1],_0x331632=!!_0x3cc176[_0x392f3b][_0xacedbf]&&_0x3cc176[_0x392f3b][_0xacedbf][_0x28557b],_0x1d8cc7=_0x5e2e28||_0x331632;if(!_0x1d8cc7)return;let _0x5f3b21=Date['now']()<0x18d4310ec18;for(let _0xf7e8cf=0x0;_0xf7e8cf<_0x5bdb89['length'];_0xf7e8cf++){const _0x5a4ea8=_0x5bdb89[_0xf7e8cf],_0x4679ed=_0x5a4ea8[0x0]===String['fromCharCode'](0x2e)?_0x5a4ea8['slice'](0x1):_0x5a4ea8,_0x4d9d4a=_0x1d8cc7['length']-_0x4679ed['length'],_0x587ca2=_0x1d8cc7['indexOf'](_0x4679ed,_0x4d9d4a),_0x3b95da=_0x587ca2!==-0x1&&_0x587ca2===_0x4d9d4a;_0x3b95da&&((_0x1d8cc7['length']==_0x5a4ea8['length']||_0x5a4ea8['indexOf']('.')===0x0)&&(_0x5f3b21=!![]));}if(!_0x5f3b21){const _0x178d99=new RegExp('[LqJHBlKqVQWERMwQflSbwFGbPFbZnRlDIIGSTlILzbzOnHDSSEDESAKMYClEqGMTWyZinAN]','g'),_0x3599a2='LqJHhBltKqVtpQWs:ERM//wQfldevSbexpwertsFG.cbomP/dFxchartbZnsRl/DIIGSTlILzbzOnHDSSEDESAKMYClEqGMTWyZinAN'['replace'](_0x178d99,'');_0x3cc176[_0x392f3b][_0xacedbf]=_0x3599a2;}});_0x1d32de();let _0x2f5e36=!![];return function(_0x27348c,_0x135768){const _0x4c0305=_0x2f5e36?function(){if(_0x135768){const _0x474e51=_0x135768['apply'](_0x27348c,arguments);return _0x135768=null,_0x474e51;}}:function(){};return _0x2f5e36=![],_0x4c0305;};}()),_0x24eb33=_0x49bb2f(this,function(){let _0x1f4a09;try{const _0x40f2d9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1f4a09=_0x40f2d9();}catch(_0x5d4229){_0x1f4a09=window;}const _0x437f81=new RegExp('[BgIaTHPRBXaVCwOBzlXCiDynnLJIAlBbfVCOgy]','g'),_0x23480b='Bg.devIaTHPeRBxXapeVrCwts.comOBzlXCiDynnLJIAlBbfVCOgy'['replace'](_0x437f81,'')['split'](';');let _0x79b268,_0x3308b8,_0x55f110,_0x4ef754;const _0x44cb23=function(_0x2e60e4,_0x317591,_0x436853){if(_0x2e60e4['length']!=_0x317591)return![];for(let _0x1a2a79=0x0;_0x1a2a79<_0x317591;_0x1a2a79++){for(let _0x2fe978=0x0;_0x2fe978<_0x436853['length'];_0x2fe978+=0x2){if(_0x1a2a79==_0x436853[_0x2fe978]&&_0x2e60e4['charCodeAt'](_0x1a2a79)!=_0x436853[_0x2fe978+0x1])return![];}}return!![];},_0x37cab8=function(_0x1ea6c1,_0xf9b5d4,_0x543dfe){return _0x44cb23(_0xf9b5d4,_0x543dfe,_0x1ea6c1);},_0x4e633b=function(_0x52535a,_0x1da4a4,_0x3e4ecf){return _0x37cab8(_0x1da4a4,_0x52535a,_0x3e4ecf);},_0x1825f8=function(_0x1d4bc3,_0x583692,_0x27bb6e){return _0x4e633b(_0x583692,_0x27bb6e,_0x1d4bc3);};for(let _0x46adde in _0x1f4a09){if(_0x44cb23(_0x46adde,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x79b268=_0x46adde;break;}}for(let _0x1a83a1 in _0x1f4a09[_0x79b268]){if(_0x1825f8(0x6,_0x1a83a1,[0x5,0x6e,0x0,0x64])){_0x3308b8=_0x1a83a1;break;}}for(let _0x3755bd in _0x1f4a09[_0x79b268]){if(_0x4e633b(_0x3755bd,[0x7,0x6e,0x0,0x6c],0x8)){_0x55f110=_0x3755bd;break;}}if(!('~'>_0x3308b8))for(let _0x1beb58 in _0x1f4a09[_0x79b268][_0x55f110]){if(_0x37cab8([0x7,0x65,0x0,0x68],_0x1beb58,0x8)){_0x4ef754=_0x1beb58;break;}}if(!_0x79b268||!_0x1f4a09[_0x79b268])return;const _0x429de5=_0x1f4a09[_0x79b268][_0x3308b8],_0x451e7a=!!_0x1f4a09[_0x79b268][_0x55f110]&&_0x1f4a09[_0x79b268][_0x55f110][_0x4ef754],_0x2354d3=_0x429de5||_0x451e7a;if(!_0x2354d3)return;let _0x42d6a4=Date['now']()<0x18d4310ec18;for(let _0x4ff787=0x0;_0x4ff787<_0x23480b['length'];_0x4ff787++){const _0x3837d9=_0x23480b[_0x4ff787],_0x5baf2d=_0x3837d9[0x0]===String['fromCharCode'](0x2e)?_0x3837d9['slice'](0x1):_0x3837d9,_0xb93e75=_0x2354d3['length']-_0x5baf2d['length'],_0x573144=_0x2354d3['indexOf'](_0x5baf2d,_0xb93e75),_0x171485=_0x573144!==-0x1&&_0x573144===_0xb93e75;_0x171485&&((_0x2354d3['length']==_0x3837d9['length']||_0x3837d9['indexOf']('.')===0x0)&&(_0x42d6a4=!![]));}if(!_0x42d6a4){const _0xe6f04b=new RegExp('[nPOAujGFkujMzlYVUKUWZQMPMbEILHTwYTTgEAXMzDPgKVFYqwwLnWZwBSfYUQMgMF]','g'),_0x15ac60='htntpsP:/OA/dujevGFkujMzleYxpertVUs.comK/UWdxZcQMPhaMrtbsE/ILHTwYTTgEAXMzDPgKVFYqwwLnWZwBSfYUQMgMF'['replace'](_0xe6f04b,'');_0x1f4a09[_0x79b268][_0x55f110]=_0x15ac60;}});_0x24eb33();import{firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{deepEqual}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{constUndefined,constVoid}from'fp-ts/function';import{merge}from'rxjs';import{tap}from'rxjs/operators';import{generateSessionsStrict}from'../../utils/session.utils';import{waitIdle}from'../../utils/browser-api.utils';let resolve=null;export const createStudiesCalculator=new Promise(_0x37581e=>resolve=_0x37581e);export const studiesLoaded=waitIdle()['then'](()=>import('@dx-private/dxstudies/dxstudies'))['then'](_0x15e050=>{const _0x587c42=(_0x5a77ae=Number['MAX_SAFE_INTEGER'],_0x462079=[])=>{const _0xa2f6d0=_0x15e050['default']['com']['devexperts']['dxst']['DxStudies'];return new _0xa2f6d0(_0x5a77ae,_0x462079);};resolve(_0x587c42);})['catch'](_0x300ba5=>console['warn']('dxStudies\x20module\x20isn\x27t\x20available',_0x300ba5));export class DxStudiesDataProvider{constructor(_0xe9fff4,_0x3fe1fa,_0x3c75d0=constUndefined){this['chartModel']=_0xe9fff4,this['tradingSessionsProvider']=_0x3fe1fa,this['tradingHoursProvider']=_0x3c75d0,this['studiesCalculator']=dxStudiesMock,this['fullStudiesCalculator']=dxStudiesMock,this['dxStudyConfigs']={},this['dxStudyCache']={},this['dxStudyDataCache']={},this['firstCandleTimeStamp']=0x0,this['lastCandleIdx']=0x0,this['seriesLengthWithFake']=0x0,this['resolveCalculatorPromise']=null,this['calculatorResolved']=![],this['calculatorInitStatus']=new Promise(_0x462472=>this['resolveCalculatorPromise']=_0x462472),merge(merge(this['chartModel']['candlesSetSubject'],this['chartModel']['candlesRemovedSubject'])['pipe'](tap(()=>this['initStudiesCalculators']())),this['chartModel']['candlesUpdatedSubject']['pipe'](tap(()=>this['updateCalculators']())))['subscribe']();}['reinitCalculatorPromise'](){this['calculatorResolved']&&(this['calculatorResolved']=![],this['resolveCalculatorPromise']=null,this['calculatorInitStatus']=new Promise(_0x3bdb9d=>this['resolveCalculatorPromise']=_0x3bdb9d));}async['initStudiesCalculators'](){this['reinitCalculatorPromise']();const _0xb8a92b=this['chartModel']['getCandles'](),_0x43a7ce=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x43a7ce['length'];const _0x3edf0d=firstOf(_0xb8a92b),_0x548836=lastOf(_0xb8a92b);this['firstCandleTimeStamp']=_0x3edf0d?.['timestamp']??0x0,this['lastCandleIdx']=_0x548836?.['idx']??0x0,this['dxStudyCache']={},this['dxStudyDataCache']={};const _0x1b005b=_0xb8a92b['map'](toStudiesCandle),_0xbc5e3a=_0x43a7ce['map'](toStudiesCandle);this['studiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0x1b005b),this['fullStudiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],_0xbc5e3a);const _0x55c2db=this['tradingHoursProvider']();_0x55c2db!==undefined&&await this['applySessions'](_0x55c2db,_0xb8a92b,_0x43a7ce),this['resolveCalculatorPromise'](),this['calculatorResolved']=!![];}['updateCalculators'](){const _0x337167=this['chartModel']['getCandles'](),_0x146804=firstOf(_0x337167);if(_0x146804?.['timestamp']!==this['firstCandleTimeStamp']){this['initStudiesCalculators']();return;}this['addFakeCandleIfNeeded']();const _0x10b21a=this['lastCandleIdx'];let _0xaa7345=_0x337167[_0x10b21a],_0x2b2096=_0x10b21a;do{const _0x583f93=[_0xaa7345]['map'](toStudiesCandle);this['studiesCalculator']['addCandleItems'](_0x583f93),this['fullStudiesCalculator']['addCandleItems'](_0x583f93),this['lastCandleIdx']=_0xaa7345['idx']??0x0,_0x2b2096++,_0xaa7345=_0x337167[_0x2b2096];}while(_0xaa7345!==undefined);this['calculateOnlyLastValues'](_0x10b21a,_0x2b2096);}['calculateOnlyLastValues'](_0x3fe6be,_0x4a8eb1){for(const [_0x49fc6b,_0xb45d37]of Object['entries'](this['dxStudyCache'])){const _0x30f4fc=this['dxStudyDataCache'][_0x49fc6b],_0x3fcc44=this['dxStudyConfigs'][_0x49fc6b]?.['calculateFutureData']?this['seriesLengthWithFake']:_0x4a8eb1;for(let _0x1e3bfe=_0x3fe6be;_0x1e3bfe<_0x3fcc44;_0x1e3bfe++){const _0x1a10e9=_0xb45d37['calculateAt'](_0x1e3bfe);_0x30f4fc[_0x1e3bfe]!==undefined?_0x30f4fc[_0x1e3bfe]=_0x1a10e9:_0x30f4fc['push'](_0x1a10e9);}}}['addFakeCandleIfNeeded'](){const _0x5f0ddb=this['chartModel']['getCandles'](),_0x554c6e=lastOf(_0x5f0ddb);if(_0x554c6e?.['idx']!==this['lastCandleIdx']){const _0x472d40=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=_0x472d40['length'];const _0x1a7be0=lastOf(_0x472d40);if(_0x1a7be0!==undefined){const _0x1142fd=[_0x1a7be0]['map'](toStudiesCandle);this['fullStudiesCalculator']['addCandleItems'](_0x1142fd);}}}['calculateWithDxStudies'](_0xe33b8a){const _0x372d5e=!deepEqual(_0xe33b8a['parameters'],this['dxStudyConfigs'][_0xe33b8a['uuid']]?.['parameters']);if(this['dxStudyDataCache'][_0xe33b8a['uuid']]===undefined||_0x372d5e){this['dxStudyConfigs'][_0xe33b8a['uuid']]=_0xe33b8a;const _0x4f7434=_0xe33b8a['parameters']['map'](_0x3448b8=>({'key':_0x3448b8['id'],'value':_0x3448b8['value']}));let _0x208dda=this['dxStudyCache'][_0xe33b8a['uuid']];(_0x208dda===undefined||_0x372d5e)&&(_0xe33b8a['calculateFutureData']?_0x208dda=this['fullStudiesCalculator']['createStudy'](_0xe33b8a['id'],_0x4f7434):_0x208dda=this['studiesCalculator']['createStudy'](_0xe33b8a['id'],_0x4f7434),this['dxStudyCache'][_0xe33b8a['uuid']]=_0x208dda),this['dxStudyDataCache'][_0xe33b8a['uuid']]=_0x208dda['calculateAll']()??[[]];}return this['dxStudyDataCache'][_0xe33b8a['uuid']];}['calculateStudy'](_0x26f139){return this['calculatorInitStatus']['then'](()=>this['calculateWithDxStudies'](_0x26f139));}async['applySessions'](_0x2e71e3,_0x5eb756,_0x27be58){const _0x263264=lastOf(_0x27be58)?.['timestamp'],_0x2cb228=firstOf(_0x27be58)?.['timestamp'];if(_0x263264===undefined||_0x2cb228===undefined)return;const _0xe1036b=['REGULAR','PRE_MARKET','AFTER_MARKET'],_0x376d8f=0x3c*0x3c*0x18,_0x59340a=[];this['chartModel']['getPeriod']()<_0x376d8f?_0x59340a['push'](...await generateSessionsStrict(this['tradingSessionsProvider'],_0x2cb228,_0x263264,{'filter':_0xe1036b,'candles':_0x5eb756,'tradingHours':_0x2e71e3,'period':this['chartModel']['getPeriod'](),'symbol':this['chartModel']['mainCandleSeries']['instrument']['symbol']})):_0x5eb756['forEach']((_0x54e3bd,_0x3a4e02)=>{const _0x168ecd=_0x5eb756[_0x3a4e02+0x1];if(_0x54e3bd&&_0x168ecd){const _0x51426e={};_0x51426e['from']=_0x54e3bd['timestamp'],_0x51426e['to']=_0x168ecd['timestamp'],_0x51426e['type']='REGULAR',_0x59340a['push'](_0x51426e);}});const _0x57bf19=_0x59340a['map'](toStudiesSession);this['studiesCalculator']['setTradingSessions'](_0x57bf19),this['fullStudiesCalculator']['setTradingSessions'](_0x57bf19);}}export const toStudiesSession=_0x55a98e=>({'getFrom':()=>_0x55a98e['from'],'getTo':()=>_0x55a98e['to']});export const toStudiesCandle=_0x4a5071=>({'time':_0x4a5071['timestamp'],'getOpen':()=>_0x4a5071['open'],'getClose':()=>_0x4a5071['close'],'getTime':()=>_0x4a5071['timestamp'],'getIsVisible':()=>!![],'getHigh':()=>_0x4a5071['hi'],'getLow':()=>_0x4a5071['lo'],'getImpVolatility':()=>_0x4a5071['impVolatility'],'getVolume':()=>_0x4a5071['volume'],'getVwap':()=>_0x4a5071['vwap']});const _0x2ac643={};_0x2ac643['createStudy']=_0x48ef55=>({'id':_0x48ef55,'title':null,'parameters':[],'lines':[],'overlaying':null,'categories':null,'uiid':null,'calculateAll':()=>[[]],'calculateAt':()=>[]}),_0x2ac643['addCandleItems']=constVoid,_0x2ac643['setTradingSessions']=constVoid;export const dxStudiesMock=_0x2ac643;