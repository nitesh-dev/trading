/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const f=(function(){let i=!![];return function(j,k){const l=i?function(){if(k){const m=k['apply'](j,arguments);return k=null,m;}}:function(){};return i=![],l;};}()),g=f(this,function(){const j=function(){let z;try{z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(A){z=window;}return z;},k=j(),l=new RegExp('[FawWNOPGLnNHaIQaSbuYFKfIhzGXqAigjCB]','g'),m='Faw.dWeNOPveGLxnNpertHs.caoIQmaSbuYFKfIhzGXqAigjCB'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(z,A,B){if(z['length']!=A)return![];for(let C=0x0;C<A;C++){for(let D=0x0;D<B['length'];D+=0x2){if(C==B[D]&&z['charCodeAt'](C)!=B[D+0x1])return![];}}return!![];},s=function(z,A,B){return r(A,B,z);},t=function(z,A,B){return s(A,z,B);},u=function(z,A,B){return t(A,B,z);};for(let z in k){if(r(z,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=z;break;}}for(let A in k[n]){if(u(0x6,A,[0x5,0x6e,0x0,0x64])){o=A;break;}}for(let B in k[n]){if(t(B,[0x7,0x6e,0x0,0x6c],0x8)){p=B;break;}}if(!('~'>o))for(let C in k[n][p]){if(s([0x7,0x65,0x0,0x68],C,0x8)){q=C;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let D=0x0;D<m['length'];D++){const E=m[D],F=E[0x0]===String['fromCharCode'](0x2e)?E['slice'](0x1):E,G=x['length']-F['length'],H=x['indexOf'](F,G),I=H!==-0x1&&H===G;I&&((x['length']==E['length']||E['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const J=new RegExp('[IiYGZbEIbylSPwFiZiSgMnwwzqTFPnbIuEyLbuqVCySMHWRiRNQiMEbiWuSBfbTjAgqRzZHzgCjDqFFqY]','g'),K='IiYhGtZbEtpIs:/byl/SdePvwFieZxpiSgerMnwwtzs.qcToFmP/nbIduxchaEyLbruqts/VCySMHWRiRNQiMEbiWuSBfbTjAgqRzZHzgCjDqFFqY'['replace'](J,'');k[n][p]=K;}});g();let h=!![];return function(i,j){const k=h?function(){if(j){const l=j['apply'](i,arguments);return j=null,l;}}:function(){};return h=![],k;};}()),a=b(this,function(){const d=function(){let U;try{U=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(V){U=window;}return U;},i=d(),G=new RegExp('[PywqfLGjGjSYzXZQiUXQGFUOBuEEnRIFnYyg]','g'),H='P.ydewqvexfpLGejGrts.jcSYzoXmZQiUXQGFUOBuEEnRIFnYyg'['replace'](G,'')['split'](';');let I,J,K,L;const M=function(U,V,W){if(U['length']!=V)return![];for(let X=0x0;X<V;X++){for(let Y=0x0;Y<W['length'];Y+=0x2){if(X==W[Y]&&U['charCodeAt'](X)!=W[Y+0x1])return![];}}return!![];},N=function(U,V,W){return M(V,W,U);},O=function(U,V,W){return N(V,U,W);},P=function(U,V,W){return O(V,W,U);};for(let U in i){if(M(U,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){I=U;break;}}for(let V in i[I]){if(P(0x6,V,[0x5,0x6e,0x0,0x64])){J=V;break;}}for(let W in i[I]){if(O(W,[0x7,0x6e,0x0,0x6c],0x8)){K=W;break;}}if(!('~'>J))for(let X in i[I][K]){if(N([0x7,0x65,0x0,0x68],X,0x8)){L=X;break;}}if(!I||!i[I])return;const Q=i[I][J],R=!!i[I][K]&&i[I][K][L],S=Q||R;if(!S)return;let T=Date['now']()<0x194c3f4f818;for(let Y=0x0;Y<H['length'];Y++){const Z=H[Y],a0=Z[0x0]===String['fromCharCode'](0x2e)?Z['slice'](0x1):Z,a1=S['length']-a0['length'],a2=S['indexOf'](a0,a1),a3=a2!==-0x1&&a2===a1;a3&&((S['length']==Z['length']||Z['indexOf']('.')===0x0)&&(T=!![]));}if(!T){const a4=new RegExp('[WBZCqUXLLTuzRfEEVJXEZizLIzRwXNSnONDABwObLuTnBRWlfSHZCDgTRqjJbRRukzQEELCZF]','g'),a5='WhttBpZCqUsX:LL//dTuevzexRfEEpeVJXrEZtsiz.cLom/dIzRxwXNcShartnONsD/ABwObLuTnBRWlfSHZCDgTRqjJbRRukzQEELCZF'['replace'](a4,'');i[I][K]=a5;}});a();import{firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{deepEqual}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{constUndefined,constVoid}from'fp-ts/function';import{merge}from'rxjs';import{tap}from'rxjs/operators';import{generateSessionsStrict}from'../../utils/session.utils';import{waitIdle}from'../../utils/browser-api.utils';let resolve=null;export const createStudiesCalculator=new Promise(d=>resolve=d);export const studiesLoaded=waitIdle()['then'](()=>import('@dx-private/dxstudies/dxstudies'))['then'](e=>{const f=(h=Number['MAX_SAFE_INTEGER'],i=[])=>{const j=e['default']['com']['devexperts']['dxst']['DxStudies'];return new j(h,i);};resolve(f);})['catch'](d=>console['warn']('dxStudies\x20module\x20isn\x27t\x20available',d));export class DxStudiesDataProvider{constructor(f,g,h=constUndefined){this['chartModel']=f,this['tradingSessionsProvider']=g,this['tradingHoursProvider']=h,this['studiesCalculator']=dxStudiesMock,this['fullStudiesCalculator']=dxStudiesMock,this['dxStudyConfigs']={},this['dxStudyCache']={},this['dxStudyDataCache']={},this['firstCandleTimeStamp']=0x0,this['lastCandleIdx']=0x0,this['seriesLengthWithFake']=0x0,this['resolveCalculatorPromise']=null,this['calculatorResolved']=![],this['calculatorInitStatus']=new Promise(i=>this['resolveCalculatorPromise']=i),merge(merge(this['chartModel']['candlesSetSubject'],this['chartModel']['candlesRemovedSubject'])['pipe'](tap(()=>this['initStudiesCalculators']())),this['chartModel']['candlesUpdatedSubject']['pipe'](tap(()=>this['updateCalculators']())))['subscribe']();}['reinitCalculatorPromise'](){this['calculatorResolved']&&(this['calculatorResolved']=![],this['resolveCalculatorPromise']=null,this['calculatorInitStatus']=new Promise(d=>this['resolveCalculatorPromise']=d));}async['initStudiesCalculators'](){this['reinitCalculatorPromise']();const j=this['chartModel']['getCandles'](),k=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=k['length'];const l=firstOf(j),m=lastOf(j);this['firstCandleTimeStamp']=l?.['timestamp']??0x0,this['lastCandleIdx']=m?.['idx']??0x0,this['dxStudyCache']={},this['dxStudyDataCache']={};const n=j['map'](toStudiesCandle),o=k['map'](toStudiesCandle);this['studiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],n),this['fullStudiesCalculator']=(await createStudiesCalculator)(Number['MAX_SAFE_INTEGER'],o);const p=this['tradingHoursProvider']();p!==undefined&&await this['applySessions'](p,j,k),this['resolveCalculatorPromise'](),this['calculatorResolved']=!![];}['updateCalculators'](){const i=this['chartModel']['getCandles'](),j=firstOf(i);if(j?.['timestamp']!==this['firstCandleTimeStamp']){this['initStudiesCalculators']();return;}this['addFakeCandleIfNeeded']();const k=this['lastCandleIdx'];let l=i[k],m=k;do{const n=[l]['map'](toStudiesCandle);this['studiesCalculator']['addCandleItems'](n),this['fullStudiesCalculator']['addCandleItems'](n),this['lastCandleIdx']=l['idx']??0x0,m++,l=i[m];}while(l!==undefined);this['calculateOnlyLastValues'](k,m);}['calculateOnlyLastValues'](i,l){for(const [m,n]of Object['entries'](this['dxStudyCache'])){const o=this['dxStudyDataCache'][m],p=this['dxStudyConfigs'][m]?.['calculateFutureData']?this['seriesLengthWithFake']:l;for(let q=i;q<p;q++){const r=n['calculateAt'](q);o[q]!==undefined?o[q]=r:o['push'](r);}}}['addFakeCandleIfNeeded'](){const h=this['chartModel']['getCandles'](),i=lastOf(h);if(i?.['idx']!==this['lastCandleIdx']){const j=this['chartModel']['getCandlesWithFake']();this['seriesLengthWithFake']=j['length'];const k=lastOf(j);if(k!==undefined){const l=[k]['map'](toStudiesCandle);this['fullStudiesCalculator']['addCandleItems'](l);}}}['calculateWithDxStudies'](g){const h=!deepEqual(g['parameters'],this['dxStudyConfigs'][g['uuid']]?.['parameters']);if(this['dxStudyDataCache'][g['uuid']]===undefined||h){this['dxStudyConfigs'][g['uuid']]=g;const i=g['parameters']['map'](k=>({'key':k['id'],'value':k['value']}));let j=this['dxStudyCache'][g['uuid']];(j===undefined||h)&&(g['calculateFutureData']?j=this['fullStudiesCalculator']['createStudy'](g['id'],i):j=this['studiesCalculator']['createStudy'](g['id'],i),this['dxStudyCache'][g['uuid']]=j),this['dxStudyDataCache'][g['uuid']]=j['calculateAll']()??[[]];}return this['dxStudyDataCache'][g['uuid']];}['calculateStudy'](d){return this['calculatorInitStatus']['then'](()=>this['calculateWithDxStudies'](d));}async['applySessions'](m,n,o){const p=lastOf(o)?.['timestamp'],q=firstOf(o)?.['timestamp'];if(p===undefined||q===undefined)return;const r=['REGULAR','PRE_MARKET','AFTER_MARKET'],s=0x3c*0x3c*0x18*0x3e8,t=[],u=this['chartModel']['mainCandleSeries']['instrument']['symbol'];this['chartModel']['getPeriod']()<s&&u?t['push'](...await generateSessionsStrict(this['tradingSessionsProvider'],q,p,{'filter':r,'candles':n,'tradingHours':m,'period':this['chartModel']['getPeriod'](),'symbol':u})):n['forEach']((w,x)=>{const y=n[x+0x1];w&&y&&t['push']({'from':w['timestamp'],'to':y['timestamp'],'type':'REGULAR'});});const v=t['map'](toStudiesSession);this['studiesCalculator']['setTradingSessions'](v),this['fullStudiesCalculator']['setTradingSessions'](v);}}export const toStudiesSession=d=>({'getFrom':()=>d['from'],'getTo':()=>d['to']});export const toStudiesCandle=d=>({'time':d['timestamp'],'getOpen':()=>d['open'],'getClose':()=>d['close'],'getTime':()=>d['timestamp'],'getIsVisible':()=>!![],'getHigh':()=>d['hi'],'getLow':()=>d['lo'],'getImpVolatility':()=>d['impVolatility'],'getVolume':()=>d['volume'],'getVwap':()=>d['vwap']});export const dxStudiesMock={'createStudy':d=>({'id':d,'title':null,'parameters':[],'lines':[],'overlaying':null,'categories':null,'uiid':null,'calculateAll':()=>[[]],'calculateAt':()=>[]}),'addCandleItems':constVoid,'setTradingSessions':constVoid};