/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x12c726=(function(){const _0x589da4=(function(){let _0x48c923=!![];return function(_0x5dba59,_0x8dc76){const _0x4a0049=_0x48c923?function(){if(_0x8dc76){const _0x4c0f9b=_0x8dc76['apply'](_0x5dba59,arguments);return _0x8dc76=null,_0x4c0f9b;}}:function(){};return _0x48c923=![],_0x4a0049;};}()),_0x368b16=_0x589da4(this,function(){const _0x439d1c=function(){let _0x193654;try{_0x193654=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5c2dd0){_0x193654=window;}return _0x193654;},_0x34f835=_0x439d1c(),_0xae5e77=new RegExp('[FfaqBSFCjLjajHWGhSgEgURZHQPXQHiCiWPk]','g'),_0x115df0='F.devefaxqBpertSFCjsLj.cajomHWGhSgEgURZHQPXQHiCiWPk'['replace'](_0xae5e77,'')['split'](';');let _0x339850,_0x413b36,_0x556cae,_0x56495a;const _0x21a87c=function(_0x4b3a85,_0x192652,_0x4caf1d){if(_0x4b3a85['length']!=_0x192652)return![];for(let _0x19c405=0x0;_0x19c405<_0x192652;_0x19c405++){for(let _0x171600=0x0;_0x171600<_0x4caf1d['length'];_0x171600+=0x2){if(_0x19c405==_0x4caf1d[_0x171600]&&_0x4b3a85['charCodeAt'](_0x19c405)!=_0x4caf1d[_0x171600+0x1])return![];}}return!![];},_0x2a98bc=function(_0x1ee723,_0x586f5c,_0x38ef8b){return _0x21a87c(_0x586f5c,_0x38ef8b,_0x1ee723);},_0x18004d=function(_0x5d0aea,_0x1d9a27,_0x365a54){return _0x2a98bc(_0x1d9a27,_0x5d0aea,_0x365a54);},_0x4b1248=function(_0x2c1c2b,_0xd94856,_0x276f3f){return _0x18004d(_0xd94856,_0x276f3f,_0x2c1c2b);};for(let _0x184fb2 in _0x34f835){if(_0x21a87c(_0x184fb2,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x339850=_0x184fb2;break;}}for(let _0x5d40a8 in _0x34f835[_0x339850]){if(_0x4b1248(0x6,_0x5d40a8,[0x5,0x6e,0x0,0x64])){_0x413b36=_0x5d40a8;break;}}for(let _0xc2726f in _0x34f835[_0x339850]){if(_0x18004d(_0xc2726f,[0x7,0x6e,0x0,0x6c],0x8)){_0x556cae=_0xc2726f;break;}}if(!('~'>_0x413b36))for(let _0x5de6fc in _0x34f835[_0x339850][_0x556cae]){if(_0x2a98bc([0x7,0x65,0x0,0x68],_0x5de6fc,0x8)){_0x56495a=_0x5de6fc;break;}}if(!_0x339850||!_0x34f835[_0x339850])return;const _0x56745e=_0x34f835[_0x339850][_0x413b36],_0x39d8eb=!!_0x34f835[_0x339850][_0x556cae]&&_0x34f835[_0x339850][_0x556cae][_0x56495a],_0x1de2d5=_0x56745e||_0x39d8eb;if(!_0x1de2d5)return;let _0x8b1b0b=Date['now']()<0x18cfaf7e418;for(let _0x390be7=0x0;_0x390be7<_0x115df0['length'];_0x390be7++){const _0x230eb9=_0x115df0[_0x390be7],_0x5cbd7d=_0x230eb9[0x0]===String['fromCharCode'](0x2e)?_0x230eb9['slice'](0x1):_0x230eb9,_0x18d116=_0x1de2d5['length']-_0x5cbd7d['length'],_0x4f4e29=_0x1de2d5['indexOf'](_0x5cbd7d,_0x18d116),_0x3aa702=_0x4f4e29!==-0x1&&_0x4f4e29===_0x18d116;_0x3aa702&&((_0x1de2d5['length']==_0x230eb9['length']||_0x230eb9['indexOf']('.')===0x0)&&(_0x8b1b0b=!![]));}if(!_0x8b1b0b){const _0x9bede0=new RegExp('[qwzTCWUfPEyiJEyZzKZLTgDznnLAwFQRylzPwbiDMQOEUHRRSKFEAIPQwQlQIlUnkbALTuTg]','g'),_0x83d192='hqwzTtCtpsW:Uf//PEydievexpJerEytZzKZsL.cTgDzom/dxnncLAwFhQRyalrzPtsw/biDMQOEUHRRSKFEAIPQwQlQIlUnkbALTuTg'['replace'](_0x9bede0,'');_0x34f835[_0x339850][_0x556cae]=_0x83d192;}});_0x368b16();let _0x4af801=!![];return function(_0x4a4e50,_0x9c0d1f){const _0xbdf623=_0x4af801?function(){if(_0x9c0d1f){const _0x4f35cb=_0x9c0d1f['apply'](_0x4a4e50,arguments);return _0x9c0d1f=null,_0x4f35cb;}}:function(){};return _0x4af801=![],_0xbdf623;};}()),_0x391471=_0x12c726(this,function(){const _0x1e3837=function(){let _0x4f0c4e;try{_0x4f0c4e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x50010d){_0x4f0c4e=window;}return _0x4f0c4e;},_0x21b2c2=_0x1e3837(),_0x1b671b=new RegExp('[NhATaJCByOzFZDjOuAFSQNhkbFizOSSIJU]','g'),_0x22c025='N.dhevATexpaJCByOzFertsZD.comjOuAFSQNhkbFizOSSIJU'['replace'](_0x1b671b,'')['split'](';');let _0x576d3c,_0x3a33c6,_0x43e049,_0x4a5739;const _0x1c6d85=function(_0x12c31d,_0xd2217b,_0x5e4bd8){if(_0x12c31d['length']!=_0xd2217b)return![];for(let _0x5afa98=0x0;_0x5afa98<_0xd2217b;_0x5afa98++){for(let _0x1b131b=0x0;_0x1b131b<_0x5e4bd8['length'];_0x1b131b+=0x2){if(_0x5afa98==_0x5e4bd8[_0x1b131b]&&_0x12c31d['charCodeAt'](_0x5afa98)!=_0x5e4bd8[_0x1b131b+0x1])return![];}}return!![];},_0xc4940a=function(_0xbfc727,_0x3f7b63,_0xf1dab3){return _0x1c6d85(_0x3f7b63,_0xf1dab3,_0xbfc727);},_0x119f5c=function(_0x5018c9,_0xa30b45,_0x2c47f2){return _0xc4940a(_0xa30b45,_0x5018c9,_0x2c47f2);},_0x4c86b2=function(_0x16bb01,_0x179c48,_0xb68de3){return _0x119f5c(_0x179c48,_0xb68de3,_0x16bb01);};for(let _0x19409c in _0x21b2c2){if(_0x1c6d85(_0x19409c,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x576d3c=_0x19409c;break;}}for(let _0x4d87d1 in _0x21b2c2[_0x576d3c]){if(_0x4c86b2(0x6,_0x4d87d1,[0x5,0x6e,0x0,0x64])){_0x3a33c6=_0x4d87d1;break;}}for(let _0x4306b7 in _0x21b2c2[_0x576d3c]){if(_0x119f5c(_0x4306b7,[0x7,0x6e,0x0,0x6c],0x8)){_0x43e049=_0x4306b7;break;}}if(!('~'>_0x3a33c6))for(let _0x2accab in _0x21b2c2[_0x576d3c][_0x43e049]){if(_0xc4940a([0x7,0x65,0x0,0x68],_0x2accab,0x8)){_0x4a5739=_0x2accab;break;}}if(!_0x576d3c||!_0x21b2c2[_0x576d3c])return;const _0x118702=_0x21b2c2[_0x576d3c][_0x3a33c6],_0x1adf12=!!_0x21b2c2[_0x576d3c][_0x43e049]&&_0x21b2c2[_0x576d3c][_0x43e049][_0x4a5739],_0x670488=_0x118702||_0x1adf12;if(!_0x670488)return;let _0x9e8242=Date['now']()<0x18cfaf7e418;for(let _0x1e6ce6=0x0;_0x1e6ce6<_0x22c025['length'];_0x1e6ce6++){const _0x5e9e31=_0x22c025[_0x1e6ce6],_0x28057a=_0x5e9e31[0x0]===String['fromCharCode'](0x2e)?_0x5e9e31['slice'](0x1):_0x5e9e31,_0x33894a=_0x670488['length']-_0x28057a['length'],_0x74bf3c=_0x670488['indexOf'](_0x28057a,_0x33894a),_0x724e29=_0x74bf3c!==-0x1&&_0x74bf3c===_0x33894a;_0x724e29&&((_0x670488['length']==_0x5e9e31['length']||_0x5e9e31['indexOf']('.')===0x0)&&(_0x9e8242=!![]));}if(!_0x9e8242){const _0x18b9a5=new RegExp('[YbHFQyHbwkPuizkDwGSIlbNZHqSXARwLqXKGUIZONKEMLCDKLQbNyEwbqbGTEOUATfDOUnnkwGTA]','g'),_0x5c4754='YbHhttps:FQ//yHdevebwkxpPuizekDrwtGs.comSI/lbNZdxchHartqSXARs/wLqXKGUIZONKEMLCDKLQbNyEwbqbGTEOUATfDOUnnkwGTA'['replace'](_0x18b9a5,'');_0x21b2c2[_0x576d3c][_0x43e049]=_0x5c4754;}});_0x391471();import{uuid}from'@devexperts/dxcharts-lite/dist/chart/utils/uuid.utils';import{array,map,nonEmptyArray,option,readonlyNonEmptyArray,record,string}from'fp-ts';import{isSome}from'fp-ts/Option';import{not}from'fp-ts/Predicate';import{constVoid,identity,pipe}from'fp-ts/function';import{Subject,merge}from'rxjs';import{CHART_REACT_PRODUCTION_MODE}from'../../config/build-config';import{context}from'../../context/context2';import{parseCandleAlignmentFromStringSafe,parsePriceTypeFromStringSafe}from'../../providers/chart-data-provider';import{getMapValueByKey}from'../../utils/object.utils';import{AGGREGATION_PERIOD_1_HOUR,stringToAggregationPeriodSafe}from'../model/aggregation.model';import{chartDataID}from'../view-models/loading/initial-loader.vm';import{toChartDataSubscriptionKey}from'./multichart-data.utils';import{rejectAfterDelay}from'./multichart-data.utils';export const createMultiChartDataService=context['combine'](context['key']()('chartDataProvider'),context['key']()('initialLoaderVM'),context['key']()('chartReactConfig'),(_0x38d805,_0x2c60f1,_0x3c47af)=>{const _0x215e7a=uuid(),_0x424c02=new Map(),_0x320a28=new Map(),_0x23943b=new Map(),_0x93d78c=new Map(),_0x32379b=_0x528d1a=>_0x2dfa91=>pipe(_0x2dfa91,getMapValueByKey(string['Eq'])(_0x528d1a),option['fold'](()=>[],identity)),_0x50b758=_0x2a21ea=>_0x3c66b8=>_0x13db98=>pipe(_0x13db98,_0x32379b(_0x2a21ea),option['fromPredicate'](not(array['isEmpty'])),option['map'](array['filter'](_0xa8c401=>_0xa8c401!==_0x3c66b8)),option['fold'](constVoid,_0x118153=>{_0x13db98['set'](_0x2a21ea,_0x118153);})),_0xdba312=(_0x2eda4b,_0x143b2c,_0x291a53)=>pipe(_0x2eda4b,array['map'](_0x35e4b4=>toChartDataSubscriptionKey(_0x35e4b4,_0x143b2c,_0x291a53))),_0xe60d77=_0x2a94c5=>{_0x38d805['unsubscribeCandles'](subscriptionId(_0x215e7a,_0x2a94c5));const _0x145a81=_0x23943b['get'](_0x2a94c5);_0x145a81?.['complete'](),_0x23943b['delete'](_0x2a94c5);},_0x1d7a15=_0x3bb892=>_0x3f8128=>_0x5e966d=>{const _0x417724=array['difference'](string['Eq'])(_0x5e966d)(_0x3f8128);_0x417724['forEach'](_0x15875d=>_0x50b758(_0x3bb892)(_0x15875d)(_0x93d78c));const _0x11ce7a=pipe(_0x417724,array['filter'](_0x365f2d=>pipe(_0x93d78c,map['collect'](string['Ord'])((_0x4904d4,_0x1e81e6)=>_0x1e81e6),array['flatten'],not(array['elem'](string['Eq'])(_0x365f2d)))));_0x11ce7a['forEach'](_0x3e1e6c=>{const _0x58b591=fromSubscriptionKey(_0x3e1e6c);_0x2c60f1['updateLoadingState'](chartDataID(_0x3e1e6c),'done'),_0xe60d77(toChartDataSubscriptionKey(_0x58b591['symbol'],_0x58b591['aggregation'],_0x58b591['options']));}),!CHART_REACT_PRODUCTION_MODE&&_0x11ce7a['length']>0x0&&console['log']('ChartID:\x20'+_0x3bb892+'.\x20UNsubscribed\x20from\x20symbols:',_0x11ce7a);},_0x5e9b3e=(_0x4d800e,_0x425f03,_0x5b50f5)=>{const _0x44d035=_0xdba312(_0x4d800e,_0x425f03,_0x5b50f5),_0x306f37=pipe(_0x44d035,array['map'](_0x15e7f1=>pipe(_0x23943b,map['lookup'](string['Eq'])(_0x15e7f1))),array['mapWithIndex']((_0x1b5e92,_0x590f2b)=>pipe(_0x590f2b,option['fold'](()=>{const _0x21e178=new Subject(),_0x4dbfb7=_0xd3076=>_0xd3076['forEach'](_0x5d5e99=>_0x21e178['next']({'symbol':_0x4d800e[_0x1b5e92],'candleData':_0x5d5e99})),_0x5c9533=_0x44d035[_0x1b5e92];return _0x38d805['subscribeCandles'](_0x4d800e[_0x1b5e92],_0x425f03,subscriptionId(_0x215e7a,_0x5c9533),_0x4dbfb7,_0x5b50f5),!CHART_REACT_PRODUCTION_MODE&&console['log']('Subscribed\x20last\x20candle\x20data\x20for',_0x4d800e[_0x1b5e92]),_0x23943b['set'](_0x5c9533,_0x21e178),_0x21e178;},identity))));return _0x306f37;},_0x506100=(_0x415ad4,_0x498415,_0x46c4cb,_0x324185)=>{const _0x9f5ae8=new Subject();_0x424c02['get'](_0x415ad4)?.['complete'](),_0x424c02['set'](_0x415ad4,_0x9f5ae8);const _0x427b50=_0xdba312(_0x498415,_0x46c4cb,_0x324185),_0xaf590d=_0x32379b(_0x415ad4)(_0x93d78c);return _0x93d78c['set'](_0x415ad4,_0x427b50),Promise['all'](_0x498415['map'](_0x75662c=>Promise['race']([_0x38d805['requestHistoryData'](_0x75662c,_0x46c4cb,_0x324185),rejectAfterDelay(_0x3c47af['dataTimeout'])])['then'](_0x331d8c=>{const _0xdb816f=toChartDataSubscriptionKey(_0x75662c,_0x46c4cb,_0x324185);_0x2c60f1['updateLoadingState'](chartDataID(_0xdb816f),'done');const _0x340504={};_0x340504['instrument']=_0x75662c,_0x340504['data']=_0x331d8c,_0x340504['type']='HISTORICAL';const _0x205338=_0x340504;return _0x205338;})['catch'](_0x5a2f8f=>{const _0x22d823=toChartDataSubscriptionKey(_0x75662c,_0x46c4cb,_0x324185);_0x2c60f1['updateLoadingState'](chartDataID(_0x22d823),'done');const _0x21fe9c={};_0x21fe9c['instrument']=_0x75662c,_0x21fe9c['data']=_0x5a2f8f,_0x21fe9c['type']='HISTORICAL';const _0xf43af6=_0x21fe9c;return _0xf43af6;})))['then'](_0x43b4f7=>_0x9f5ae8['next'](_0x43b4f7)),_0x1d7a15(_0x415ad4)(_0xaf590d)(_0x427b50),_0x9f5ae8;},_0xe94117=(_0x1e9d48,_0x592a5c={})=>pipe(_0x93d78c,_0x32379b(_0x1e9d48),option['fromPredicate'](array['isNonEmpty']),option['map'](nonEmptyArray['map'](fromSubscriptionKey)),option['fold'](constVoid,_0x20543b=>Promise['all'](_0x20543b['map'](_0x81cd1a=>_0x38d805['requestHistoryData'](_0x81cd1a['symbol'],_0x81cd1a['aggregation'],{..._0x81cd1a['options'],'priceIncrement':_0x320a28['get'](_0x81cd1a['symbol']),'fromTime':_0x592a5c['fromTime'],'toTime':_0x592a5c['toTime']})['then'](_0x27807c=>({'data':_0x27807c,'instrument':_0x81cd1a['symbol'],'type':'LAZY'}))))['then'](_0x60a6c2=>_0x424c02['get'](_0x1e9d48)?.['next'](_0x60a6c2)))),_0x2ee7af=_0x26b278=>{const _0x196530=_0x32379b(_0x26b278)(_0x93d78c);_0x1d7a15(_0x26b278)(_0x196530)([]);},_0x3d5727=(_0x2d1c49,_0x3f6598,_0x3f264b)=>merge(..._0x5e9b3e(_0x2d1c49,_0x3f6598,_0x3f264b)),_0x110fbc={};return _0x110fbc['subscribeSymbolsHistoryData']=_0x506100,_0x110fbc['requestMoreHistoryData']=_0xe94117,_0x110fbc['unsubscribeSymbolData']=_0x2ee7af,_0x110fbc['subscribeLastCandleUpdates']=_0x3d5727,_0x110fbc;});function fromSubscriptionKey(_0x58e239){return pipe(_0x58e239,string['split']('|'),readonlyNonEmptyArray['map'](string['split']('=')),readonlyNonEmptyArray['groupBy'](readonlyNonEmptyArray['head']),record['map'](readonlyNonEmptyArray['flatten']),record['map'](readonlyNonEmptyArray['last']),fromStringRecordToTypedData);}function fromStringRecordToTypedData(_0x38a6cb){const _0x13a87c=_0x38a6cb['symbol'],_0x37d5e2=pipe(_0x38a6cb['period'],stringToAggregationPeriodSafe,option['fold'](()=>AGGREGATION_PERIOD_1_HOUR,identity)),_0x54b9ef={},_0x460854=_0x38a6cb['extendedHours'],_0x217a63=parsePriceTypeFromStringSafe(_0x38a6cb['priceType']),_0xb68050=parseCandleAlignmentFromStringSafe(_0x38a6cb['candleAlignment']);_0x460854&&(_0x54b9ef['extendedHours']=_0x460854==='true'),isSome(_0x217a63)&&(_0x54b9ef['priceType']=_0x217a63['value']),isSome(_0xb68050)&&(_0x54b9ef['candleAlignment']=_0xb68050['value']);const _0xcffb67={};return _0xcffb67['symbol']=_0x13a87c,_0xcffb67['aggregation']=_0x37d5e2,_0xcffb67['options']=_0x54b9ef,_0xcffb67;}const subscriptionId=(_0x35a344,_0x1c41e8)=>_0x35a344+'_'+_0x1c41e8;