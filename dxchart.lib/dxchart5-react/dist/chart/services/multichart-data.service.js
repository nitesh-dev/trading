/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x1f3643=(function(){const _0x569b14=(function(){let _0x248583=!![];return function(_0x35dc07,_0x19d512){const _0x5f264c=_0x248583?function(){if(_0x19d512){const _0x3b95be=_0x19d512['apply'](_0x35dc07,arguments);return _0x19d512=null,_0x3b95be;}}:function(){};return _0x248583=![],_0x5f264c;};}()),_0x2825c9=_0x569b14(this,function(){const _0x5b0253=function(){let _0x5bbddd;try{_0x5bbddd=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x570124){_0x5bbddd=window;}return _0x5bbddd;},_0x5b51a6=_0x5b0253(),_0x137392=new RegExp('[bhwbzJuHNJgGfnXAfbqwHIuaWkIZTuXKYlDX]','g'),_0xe6dc0e='.devexbhwperts.bcomzJuHNJgGfnXAfbqwHIuaWkIZTuXKYlDX'['replace'](_0x137392,'')['split'](';');let _0x54c507,_0x2d575f,_0xa8a66b,_0x5d8fd5;const _0x27a318=function(_0x30ba59,_0x5efca1,_0x29202c){if(_0x30ba59['length']!=_0x5efca1)return![];for(let _0x18cbe3=0x0;_0x18cbe3<_0x5efca1;_0x18cbe3++){for(let _0x4f86b0=0x0;_0x4f86b0<_0x29202c['length'];_0x4f86b0+=0x2){if(_0x18cbe3==_0x29202c[_0x4f86b0]&&_0x30ba59['charCodeAt'](_0x18cbe3)!=_0x29202c[_0x4f86b0+0x1])return![];}}return!![];},_0x2ebd29=function(_0x1c05c4,_0x3e99af,_0x123cf1){return _0x27a318(_0x3e99af,_0x123cf1,_0x1c05c4);},_0x1264e4=function(_0x592018,_0x5ecee0,_0x1a69cd){return _0x2ebd29(_0x5ecee0,_0x592018,_0x1a69cd);},_0x1ac06a=function(_0x522c15,_0x4ed5b8,_0x252b4f){return _0x1264e4(_0x4ed5b8,_0x252b4f,_0x522c15);};for(let _0x503118 in _0x5b51a6){if(_0x27a318(_0x503118,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x54c507=_0x503118;break;}}for(let _0x5b2355 in _0x5b51a6[_0x54c507]){if(_0x1ac06a(0x6,_0x5b2355,[0x5,0x6e,0x0,0x64])){_0x2d575f=_0x5b2355;break;}}for(let _0x2bcd18 in _0x5b51a6[_0x54c507]){if(_0x1264e4(_0x2bcd18,[0x7,0x6e,0x0,0x6c],0x8)){_0xa8a66b=_0x2bcd18;break;}}if(!('~'>_0x2d575f))for(let _0x230cf5 in _0x5b51a6[_0x54c507][_0xa8a66b]){if(_0x2ebd29([0x7,0x65,0x0,0x68],_0x230cf5,0x8)){_0x5d8fd5=_0x230cf5;break;}}if(!_0x54c507||!_0x5b51a6[_0x54c507])return;const _0x4e6c91=_0x5b51a6[_0x54c507][_0x2d575f],_0x15d2f2=!!_0x5b51a6[_0x54c507][_0xa8a66b]&&_0x5b51a6[_0x54c507][_0xa8a66b][_0x5d8fd5],_0x446805=_0x4e6c91||_0x15d2f2;if(!_0x446805)return;let _0x8d8fb3=Date['now']()<0x18d4310ec18;for(let _0x5746b4=0x0;_0x5746b4<_0xe6dc0e['length'];_0x5746b4++){const _0x2552f2=_0xe6dc0e[_0x5746b4],_0xa2dfed=_0x2552f2[0x0]===String['fromCharCode'](0x2e)?_0x2552f2['slice'](0x1):_0x2552f2,_0x261da1=_0x446805['length']-_0xa2dfed['length'],_0x347653=_0x446805['indexOf'](_0xa2dfed,_0x261da1),_0x2234a5=_0x347653!==-0x1&&_0x347653===_0x261da1;_0x2234a5&&((_0x446805['length']==_0x2552f2['length']||_0x2552f2['indexOf']('.')===0x0)&&(_0x8d8fb3=!![]));}if(!_0x8d8fb3){const _0x6ae233=new RegExp('[QZUWUNFyKznDHSVDBgOUZNTCnQNDKlOXyPqQPlYfFnFKUQEiJnLzVVBkVqkkWiVWEFPQilzWqU]','g'),_0x8cca2e='httQZpsUW:/UNFy/KzdnDeHvSeVDxBgOpertUsZ.comN/TCdnxQNcharDKts/lOXyPqQPlYfFnFKUQEiJnLzVVBkVqkkWiVWEFPQilzWqU'['replace'](_0x6ae233,'');_0x5b51a6[_0x54c507][_0xa8a66b]=_0x8cca2e;}});_0x2825c9();let _0x5c9e36=!![];return function(_0x100f24,_0x1bcab0){const _0xecf8b5=_0x5c9e36?function(){if(_0x1bcab0){const _0x5102af=_0x1bcab0['apply'](_0x100f24,arguments);return _0x1bcab0=null,_0x5102af;}}:function(){};return _0x5c9e36=![],_0xecf8b5;};}()),_0x2fa1b5=_0x1f3643(this,function(){const _0xc9717a=function(){let _0x2b0ce8;try{_0x2b0ce8=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1ec089){_0x2b0ce8=window;}return _0x2b0ce8;},_0x5d82e7=_0xc9717a(),_0x3b2e9b=new RegExp('[GwuCAUwFIIaPVaGgFkbnakqNWkSYHUZ]','g'),_0xec14c0='Gw.duCevAexpeUwrtFIsIaPV.comaGgFkbnakqNWkSYHUZ'['replace'](_0x3b2e9b,'')['split'](';');let _0x17f63c,_0x1eec7d,_0x3d5752,_0x4d729d;const _0x1e7961=function(_0x17086a,_0x48dfe3,_0xd8c2a5){if(_0x17086a['length']!=_0x48dfe3)return![];for(let _0x2af3a1=0x0;_0x2af3a1<_0x48dfe3;_0x2af3a1++){for(let _0x3e6f2f=0x0;_0x3e6f2f<_0xd8c2a5['length'];_0x3e6f2f+=0x2){if(_0x2af3a1==_0xd8c2a5[_0x3e6f2f]&&_0x17086a['charCodeAt'](_0x2af3a1)!=_0xd8c2a5[_0x3e6f2f+0x1])return![];}}return!![];},_0x745ec1=function(_0x36c8db,_0x138704,_0x2c8520){return _0x1e7961(_0x138704,_0x2c8520,_0x36c8db);},_0x2652b5=function(_0x1ac40b,_0x334c91,_0x262812){return _0x745ec1(_0x334c91,_0x1ac40b,_0x262812);},_0x3cd5b8=function(_0x34143a,_0x24f2ad,_0x121bdf){return _0x2652b5(_0x24f2ad,_0x121bdf,_0x34143a);};for(let _0x1fad4e in _0x5d82e7){if(_0x1e7961(_0x1fad4e,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x17f63c=_0x1fad4e;break;}}for(let _0x206ada in _0x5d82e7[_0x17f63c]){if(_0x3cd5b8(0x6,_0x206ada,[0x5,0x6e,0x0,0x64])){_0x1eec7d=_0x206ada;break;}}for(let _0xa4d116 in _0x5d82e7[_0x17f63c]){if(_0x2652b5(_0xa4d116,[0x7,0x6e,0x0,0x6c],0x8)){_0x3d5752=_0xa4d116;break;}}if(!('~'>_0x1eec7d))for(let _0x1b33f1 in _0x5d82e7[_0x17f63c][_0x3d5752]){if(_0x745ec1([0x7,0x65,0x0,0x68],_0x1b33f1,0x8)){_0x4d729d=_0x1b33f1;break;}}if(!_0x17f63c||!_0x5d82e7[_0x17f63c])return;const _0x2c537a=_0x5d82e7[_0x17f63c][_0x1eec7d],_0x379935=!!_0x5d82e7[_0x17f63c][_0x3d5752]&&_0x5d82e7[_0x17f63c][_0x3d5752][_0x4d729d],_0xb2d452=_0x2c537a||_0x379935;if(!_0xb2d452)return;let _0x16d98d=Date['now']()<0x18d4310ec18;for(let _0x178db7=0x0;_0x178db7<_0xec14c0['length'];_0x178db7++){const _0x31e8a2=_0xec14c0[_0x178db7],_0x13b1f6=_0x31e8a2[0x0]===String['fromCharCode'](0x2e)?_0x31e8a2['slice'](0x1):_0x31e8a2,_0x2ee0e4=_0xb2d452['length']-_0x13b1f6['length'],_0x3015f3=_0xb2d452['indexOf'](_0x13b1f6,_0x2ee0e4),_0x3e7dee=_0x3015f3!==-0x1&&_0x3015f3===_0x2ee0e4;_0x3e7dee&&((_0xb2d452['length']==_0x31e8a2['length']||_0x31e8a2['indexOf']('.')===0x0)&&(_0x16d98d=!![]));}if(!_0x16d98d){const _0x1b3782=new RegExp('[MUKGubYUIDqfQDTJOHyCgTQIlQqBiyCORRCqfKgyPPObFLYbOCkSUqjzjfQFLZfbERWqEQC]','g'),_0x23014c='MhttUKGpsubYU:ID//devqfQeDxTpJertOHs.com/dyCxgTQcIlQqBhiayCORRrts/CqfKgyPPObFLYbOCkSUqjzjfQFLZfbERWqEQC'['replace'](_0x1b3782,'');_0x5d82e7[_0x17f63c][_0x3d5752]=_0x23014c;}});_0x2fa1b5();import{uuid}from'@devexperts/dxcharts-lite/dist/chart/utils/uuid.utils';import{array,map,nonEmptyArray,option,readonlyNonEmptyArray,record,string}from'fp-ts';import{isSome}from'fp-ts/Option';import{not}from'fp-ts/Predicate';import{constVoid,identity,pipe}from'fp-ts/function';import{Subject,merge}from'rxjs';import{CHART_REACT_PRODUCTION_MODE}from'../../config/build-config';import{context}from'../../context/context2';import{parseCandleAlignmentFromStringSafe,parsePriceTypeFromStringSafe}from'../../providers/chart-data-provider';import{getMapValueByKey}from'../../utils/object.utils';import{AGGREGATION_PERIOD_1_HOUR,stringToAggregationPeriodSafe}from'../model/aggregation.model';import{chartDataID}from'../view-models/loading/initial-loader.vm';import{toChartDataSubscriptionKey}from'./multichart-data.utils';import{rejectAfterDelay}from'./multichart-data.utils';export const createMultiChartDataService=context['combine'](context['key']()('chartDataProvider'),context['key']()('initialLoaderVM'),context['key']()('chartReactConfig'),(_0x566a4b,_0x45f1dc,_0x1b964f)=>{const _0x3b6a11=uuid(),_0x2fbfb3=new Map(),_0xe87cdc=new Map(),_0x4b11c2=new Map(),_0x39bb65=new Map(),_0x59dd76=_0x51ce16=>_0x5cc705=>pipe(_0x5cc705,getMapValueByKey(string['Eq'])(_0x51ce16),option['fold'](()=>[],identity)),_0x11aa8d=_0x4c9cb8=>_0x3f7559=>_0x945470=>pipe(_0x945470,_0x59dd76(_0x4c9cb8),option['fromPredicate'](not(array['isEmpty'])),option['map'](array['filter'](_0x3e2edf=>_0x3e2edf!==_0x3f7559)),option['fold'](constVoid,_0x2e3ba2=>{_0x945470['set'](_0x4c9cb8,_0x2e3ba2);})),_0x288030=(_0x1fa176,_0xeaacba,_0x381285)=>pipe(_0x1fa176,array['map'](_0x52dd25=>toChartDataSubscriptionKey(_0x52dd25,_0xeaacba,_0x381285))),_0x2877ca=_0x5399bc=>{_0x566a4b['unsubscribeCandles'](subscriptionId(_0x3b6a11,_0x5399bc));const _0x5e0649=_0x4b11c2['get'](_0x5399bc);_0x5e0649?.['complete'](),_0x4b11c2['delete'](_0x5399bc);},_0x2f2eb3=_0x5bbc58=>_0x1d926e=>_0x9c5614=>{const _0x38a9c0=array['difference'](string['Eq'])(_0x9c5614)(_0x1d926e);_0x38a9c0['forEach'](_0x562c40=>_0x11aa8d(_0x5bbc58)(_0x562c40)(_0x39bb65));const _0x13e44a=pipe(_0x38a9c0,array['filter'](_0x285db6=>pipe(_0x39bb65,map['collect'](string['Ord'])((_0x47fa96,_0x208d77)=>_0x208d77),array['flatten'],not(array['elem'](string['Eq'])(_0x285db6)))));_0x13e44a['forEach'](_0x376f4b=>{const _0xba62de=fromSubscriptionKey(_0x376f4b);_0x45f1dc['updateLoadingState'](chartDataID(_0x376f4b),'done'),_0x2877ca(toChartDataSubscriptionKey(_0xba62de['symbol'],_0xba62de['aggregation'],_0xba62de['options']));}),!CHART_REACT_PRODUCTION_MODE&&_0x13e44a['length']>0x0&&console['log']('ChartID:\x20'+_0x5bbc58+'.\x20UNsubscribed\x20from\x20symbols:',_0x13e44a);},_0x6bcca5=(_0x26ff48,_0x3a3a8c,_0x9ed310)=>{const _0xd399be=_0x288030(_0x26ff48,_0x3a3a8c,_0x9ed310),_0x49e06a=pipe(_0xd399be,array['map'](_0x2aab1e=>pipe(_0x4b11c2,map['lookup'](string['Eq'])(_0x2aab1e))),array['mapWithIndex']((_0x5c9435,_0x4b333b)=>pipe(_0x4b333b,option['fold'](()=>{const _0x1ed064=new Subject(),_0x2518c1=_0x1822c3=>_0x1822c3['forEach'](_0x1bffab=>_0x1ed064['next']({'symbol':_0x26ff48[_0x5c9435],'candleData':_0x1bffab})),_0x48eeae=_0xd399be[_0x5c9435];return _0x566a4b['subscribeCandles'](_0x26ff48[_0x5c9435],_0x3a3a8c,subscriptionId(_0x3b6a11,_0x48eeae),_0x2518c1,_0x9ed310),!CHART_REACT_PRODUCTION_MODE&&console['log']('Subscribed\x20last\x20candle\x20data\x20for',_0x26ff48[_0x5c9435]),_0x4b11c2['set'](_0x48eeae,_0x1ed064),_0x1ed064;},identity))));return _0x49e06a;},_0x140225=(_0x2d6b5b,_0x4198e3,_0x113111,_0x167192)=>{const _0x413e3c=new Subject();_0x2fbfb3['get'](_0x2d6b5b)?.['complete'](),_0x2fbfb3['set'](_0x2d6b5b,_0x413e3c);const _0x2e8971=_0x288030(_0x4198e3,_0x113111,_0x167192),_0x49db82=_0x59dd76(_0x2d6b5b)(_0x39bb65);return _0x39bb65['set'](_0x2d6b5b,_0x2e8971),Promise['all'](_0x4198e3['map'](_0x4bb112=>Promise['race']([_0x566a4b['requestHistoryData'](_0x4bb112,_0x113111,_0x167192),rejectAfterDelay(_0x1b964f['dataTimeout'])])['then'](_0x2959b2=>{const _0x49fceb=toChartDataSubscriptionKey(_0x4bb112,_0x113111,_0x167192);_0x45f1dc['updateLoadingState'](chartDataID(_0x49fceb),'done');const _0x23933f={};_0x23933f['instrument']=_0x4bb112,_0x23933f['data']=_0x2959b2,_0x23933f['type']='HISTORICAL';const _0x523358=_0x23933f;return _0x523358;})['catch'](_0x20c2e8=>{const _0x2e8977=toChartDataSubscriptionKey(_0x4bb112,_0x113111,_0x167192);_0x45f1dc['updateLoadingState'](chartDataID(_0x2e8977),'done');const _0x67be86={};_0x67be86['instrument']=_0x4bb112,_0x67be86['data']=_0x20c2e8,_0x67be86['type']='HISTORICAL';const _0x11c61e=_0x67be86;return _0x11c61e;})))['then'](_0x397e8c=>_0x413e3c['next'](_0x397e8c)),_0x2f2eb3(_0x2d6b5b)(_0x49db82)(_0x2e8971),_0x413e3c;},_0x1fccc3=(_0x3d4bdf,_0x414ef3={})=>pipe(_0x39bb65,_0x59dd76(_0x3d4bdf),option['fromPredicate'](array['isNonEmpty']),option['map'](nonEmptyArray['map'](fromSubscriptionKey)),option['fold'](constVoid,_0x4cd163=>Promise['all'](_0x4cd163['map'](_0x19428d=>_0x566a4b['requestHistoryData'](_0x19428d['symbol'],_0x19428d['aggregation'],{..._0x19428d['options'],'priceIncrement':_0xe87cdc['get'](_0x19428d['symbol']),'fromTime':_0x414ef3['fromTime'],'toTime':_0x414ef3['toTime']})['then'](_0x5413b1=>({'data':_0x5413b1,'instrument':_0x19428d['symbol'],'type':'LAZY'}))))['then'](_0x7f1934=>_0x2fbfb3['get'](_0x3d4bdf)?.['next'](_0x7f1934)))),_0x2852fb=_0x274226=>{const _0x5c15c2=_0x59dd76(_0x274226)(_0x39bb65);_0x2f2eb3(_0x274226)(_0x5c15c2)([]);},_0x5c8e8d=(_0x4d9798,_0x4cbf3d,_0x284a10)=>merge(..._0x6bcca5(_0x4d9798,_0x4cbf3d,_0x284a10)),_0x31b046={};return _0x31b046['subscribeSymbolsHistoryData']=_0x140225,_0x31b046['requestMoreHistoryData']=_0x1fccc3,_0x31b046['unsubscribeSymbolData']=_0x2852fb,_0x31b046['subscribeLastCandleUpdates']=_0x5c8e8d,_0x31b046;});function fromSubscriptionKey(_0x1e4098){return pipe(_0x1e4098,string['split']('|'),readonlyNonEmptyArray['map'](string['split']('=')),readonlyNonEmptyArray['groupBy'](readonlyNonEmptyArray['head']),record['map'](readonlyNonEmptyArray['flatten']),record['map'](readonlyNonEmptyArray['last']),fromStringRecordToTypedData);}function fromStringRecordToTypedData(_0x418cd9){const _0x5a8d95=_0x418cd9['symbol'],_0x94d3a=pipe(_0x418cd9['period'],stringToAggregationPeriodSafe,option['fold'](()=>AGGREGATION_PERIOD_1_HOUR,identity)),_0x599c08={},_0x4b9716=_0x418cd9['extendedHours'],_0xb988ae=parsePriceTypeFromStringSafe(_0x418cd9['priceType']),_0x342d11=parseCandleAlignmentFromStringSafe(_0x418cd9['candleAlignment']);_0x4b9716&&(_0x599c08['extendedHours']=_0x4b9716==='true'),isSome(_0xb988ae)&&(_0x599c08['priceType']=_0xb988ae['value']),isSome(_0x342d11)&&(_0x599c08['candleAlignment']=_0x342d11['value']);const _0x54a4bf={};return _0x54a4bf['symbol']=_0x5a8d95,_0x54a4bf['aggregation']=_0x94d3a,_0x54a4bf['options']=_0x599c08,_0x54a4bf;}const subscriptionId=(_0x3cf9b5,_0x21349e)=>_0x3cf9b5+'_'+_0x21349e;