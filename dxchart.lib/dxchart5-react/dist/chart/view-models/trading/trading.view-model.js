/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const h=(function(){let k=!![];return function(l,m){const n=k?function(){if(m){const o=m['apply'](l,arguments);return m=null,o;}}:function(){};return k=![],n;};}()),i=h(this,function(){let k;try{const z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');k=z();}catch(A){k=window;}const l=new RegExp('[CGOWHgnfjQZQXSnTfGjykMXiMHVRJGZq]','g'),m='.dCGOevexWpeHrgtnfs.jcQZQXoSmnTfGjykMXiMHVRJGZq'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(B,C,D){if(B['length']!=C)return![];for(let E=0x0;E<C;E++){for(let F=0x0;F<D['length'];F+=0x2){if(E==D[F]&&B['charCodeAt'](E)!=D[F+0x1])return![];}}return!![];},s=function(B,C,D){return r(C,D,B);},t=function(B,C,D){return s(C,B,D);},u=function(B,C,D){return t(C,D,B);};for(let B in k){if(r(B,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=B;break;}}for(let C in k[n]){if(u(0x6,C,[0x5,0x6e,0x0,0x64])){o=C;break;}}for(let D in k[n]){if(t(D,[0x7,0x6e,0x0,0x6c],0x8)){p=D;break;}}if(!('~'>o))for(let E in k[n][p]){if(s([0x7,0x65,0x0,0x68],E,0x8)){q=E;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let F=0x0;F<m['length'];F++){const G=m[F],H=G[0x0]===String['fromCharCode'](0x2e)?G['slice'](0x1):G,I=x['length']-H['length'],J=x['indexOf'](H,I),K=J!==-0x1&&J===I;K&&((x['length']==G['length']||G['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const L=new RegExp('[iDbiFFUBKZQiEnlbJkkAwGOlCgbZuOPuFUuMGWDMXIuLHUgqHOPPCQGHAYLNjUFCWfuPiKYjfquKX]','g'),M='htiDtbiFpFUBs://KdeZvexperQiEtnlsb.Jckom/dkAxwGOlCgcbhZaruts/OPuFUuMGWDMXIuLHUgqHOPPCQGHAYLNjUFCWfuPiKYjfquKX'['replace'](L,'');k[n][p]=M;}});i();let j=!![];return function(k,l){const m=j?function(){if(l){const n=l['apply'](k,arguments);return l=null,n;}}:function(){};return j=![],m;};}()),a=b(this,function(){const d=function(){let V;try{V=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(W){V=window;}return V;},i=d(),H=new RegExp('[BjPFNTwYwVNXLLyQqHNnBDAuCgnAQkXZlUFXHABn]','g'),I='B.jPdFNevexTpewYrtws.VcNXomLLyQqHNnBDAuCgnAQkXZlUFXHABn'['replace'](H,'')['split'](';');let J,K,L,M;const N=function(V,W,X){if(V['length']!=W)return![];for(let Y=0x0;Y<W;Y++){for(let Z=0x0;Z<X['length'];Z+=0x2){if(Y==X[Z]&&V['charCodeAt'](Y)!=X[Z+0x1])return![];}}return!![];},O=function(V,W,X){return N(W,X,V);},P=function(V,W,X){return O(W,V,X);},Q=function(V,W,X){return P(W,X,V);};for(let V in i){if(N(V,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){J=V;break;}}for(let W in i[J]){if(Q(0x6,W,[0x5,0x6e,0x0,0x64])){K=W;break;}}for(let X in i[J]){if(P(X,[0x7,0x6e,0x0,0x6c],0x8)){L=X;break;}}if(!('~'>K))for(let Y in i[J][L]){if(O([0x7,0x65,0x0,0x68],Y,0x8)){M=Y;break;}}if(!J||!i[J])return;const R=i[J][K],S=!!i[J][L]&&i[J][L][M],T=R||S;if(!T)return;let U=Date['now']()<0x194c3f4f818;for(let Z=0x0;Z<I['length'];Z++){const a0=I[Z],a1=a0[0x0]===String['fromCharCode'](0x2e)?a0['slice'](0x1):a0,a2=T['length']-a1['length'],a3=T['indexOf'](a1,a2),a4=a3!==-0x1&&a3===a2;a4&&((T['length']==a0['length']||a0['indexOf']('.')===0x0)&&(U=!![]));}if(!U){const a5=new RegExp('[YibIgXbRDHXFHVFNkliyLYCXUSWGjTRKgXZzFWqzRZwLLWRMBnnfEWZNIlbGzi]','g'),a6='YhittbIgpsX://dbevReDHXFHxpVFeNklirytsLYCX.UScomWG/jTdxchRKgXaZzFrWqzRZwLLWtRMsBnnf/EWZNIlbGzi'['replace'](a5,'');i[J][L]=a6;}});a();import{CanvasElement,CHART_UUID}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{pixelsToUnits}from'@devexperts/dxcharts-lite/dist/chart/model/scaling/viewport.model';import{array,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,merge,Observable,animationFrameScheduler}from'rxjs';import g from'lodash.clonedeep';import{distinctUntilChanged,filter,map,switchMap,tap,pairwise,throttleTime}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{filterOption}from'../../../utils/monad-functions';import{convertToProperty,createPropertyAdapter}from'../../../utils/property.utils';import{chartSettingsLens}from'../chart-configurator.view-model';import{groupTradingItems}from'../utils/trading-items-grouping-algorithm';import{createOrdersAndPositionsHighLowProvider}from'./orders-and-positions-high-low-provider';import{createProtectionOrderFromOriginalItem,findAllRelatedItems,getItemById,linkProtectionOrderToOriginalItem,mapOrderToVisualOrder,mapPositionToVisualPosition,tradingItemVisibilityInHighLow,unLinkOrderFromOriginalOrder}from'./trading-functions';import{checkOrderIsOnUIOnly,getTradingItemPrice,isPosition,isProtection}from'../../model/trading/trading.model';export const TRADING_ITEM_HEIGHT=0x13;export const DEFAULT_RIGHT_OFFSET=0x64;const ORDER_VERTICAL_OFFSET=0x14;export const createTradingViewModel=context['combine'](context['key']()('chart'),context['key']()('orderProvider'),context['key']()('positionProvider'),context['key']()('chartDataViewModel'),context['key']()('chartReactConfig'),context['key']()('multiChartViewModel'),context['key']()('orderEntryViewModel'),context['key']()('tradingCoreViewModel'),context['key']()('yAxisConfiguratorViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('chartId'),(as,at,au,av,aw,ax,ay,az,aA,aB,aC)=>{const [aD,aE]=createPropertyAdapter({}),[aF,aG]=createPropertyAdapter({}),[aH,aI]=createPropertyAdapter({}),[aJ,aK]=createPropertyAdapter({}),[aL,aM]=createPropertyAdapter({}),[aN,aO]=createPropertyAdapter({'visible':ay['orderEntryEnabled']['getValue'](),'rightOffset':0x0,'canvasHeight':as['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']}),[aP,aQ]=createPropertyAdapter(TRADING_ITEM_HEIGHT),[aR,aS]=createPropertyAdapter({'top':0x0,'bottom':0x438}),[aT,aU]=createPropertyAdapter(![]),[,aV]=createPropertyAdapter(aw['trading']['showPriceAsLabels']),aW=new Set(),aX=new Set(),aY=(bH,bI)=>{const bJ=ay['orderEntry']['getValue'](),bK=ay['orderEntryPrice']['getValue']();aZ(bH,bI,bK,bJ['quantity']);},aZ=(bH,bI,bJ,bK)=>pipe(av['instrument']['getValue'](),option['fold'](()=>console['warn']('Instrument\x20is\x20not\x20presented'),bL=>{bK&&at['createOrder'](bL['symbol'],{'orderType':bH,'type':'original','side':bI,'limitPrice':bJ,'stopPrice':bJ,'quantity':bK});})),b0=bH=>{return aW['add'](bH),()=>aW['delete'](bH);},b1=bH=>{return aX['add'](bH),()=>aX['delete'](bH);},b2=bH=>{const bI=b4();pipe(bI,getItemById(bH),option['fold'](()=>console['warn']('Order\x20with\x20id='+bH+'\x20was\x20clicked\x20but\x20not\x20found\x20in\x20list\x20of\x20orders'),bJ=>{aW['forEach'](bK=>bK(aC,bJ));}));},b3=bH=>{const bI=b4();pipe(bI,getItemById(bH),option['fold'](()=>console['warn']('Order\x20with\x20id='+bH+'\x20was\x20dblclicked\x20but\x20not\x20found\x20in\x20list\x20of\x20orders'),bJ=>{aX['forEach'](bK=>bK(aC,bJ));}));},b4=()=>{return{...aI['getValue'](),...aE['getValue']()};},b5=()=>{return{...aK['getValue'](),...aG['getValue']()};},b6=bH=>as['chartModel']['mainCandleSeries']['view']['toAxisUnits'](bH),b7=(bH,bI,bJ)=>tradingItemVisibilityInHighLow(b6(getTradingItemPrice(bH,bJ)),bI),b8=(bH,bI)=>tradingItemVisibilityInHighLow(b6(bH['model']['price']),bI),b9=bH=>{const bI=b4(),bJ=b5(),bK={...bI,...bJ};pipe(bK,getItemById(bH),option['map'](bL=>({...findAllRelatedItems(bK,bL),[bL['model']['id']]:bL})),option['fold'](()=>console['warn']('Order\x20with\x20id='+bH+'\x20was\x20selected\x20but\x20not\x20found\x20in\x20list\x20of\x20orders'),bL=>{const bM=[{},{}],bN=pipe(bI,record['map'](bR=>updateVisualOrder(bR,{'selected':![],'disabled':!![]}))),bO=pipe(bJ,record['map'](bR=>updateVisualPosition(bR,{'selected':![],'disabled':!![]}))),[bP,bQ]=pipe(Object['values'](bL),array['reduce'](bM,([bR,bS],bT)=>{return isPosition(bT)?(bS[bT['model']['id']]=updateVisualPosition(bT,{'selected':!![],'disabled':![]}),bO[bT['model']['id']]&&delete bO[bT['model']['id']]):(bR[bT['model']['id']]=updateVisualOrder(bT,{'selected':!![],'disabled':![]}),bN[bT['model']['id']]&&delete bN[bT['model']['id']]),[bR,bS];}));aH(bN),aJ(bO),aD(bP),aF(bQ);})),aL(groupTradingItems({...aI['getValue'](),...aK['getValue']()},aQ['getValue'](),az['marketPrice']['getValue']()));},ba=bH=>{const bI=b4();pipe(bI,getItemById(bH),option['fold'](()=>{console['warn']('Order\x20with\x20id='+bH+'\x20was\x20selected\x20but\x20not\x20found\x20in\x20list\x20of\x20orders');},bJ=>{aT(!![]),delete bI[bJ['model']['id']],aH(bI),aD({[''+bJ['model']['id']]:bJ}),aL(groupTradingItems({...bI,...aK['getValue']()},aQ['getValue'](),az['marketPrice']['getValue']()));const bK=()=>{aT(![]),aD({}),pipe(av['instrument']['getValue'](),option['map'](bL=>at['updateOrder'](bL['symbol'],bJ['model'])),option['getOrElse'](()=>Promise['reject'](new Error('instrument\x20is\x20not\x20presented'))));};bi(bJ,bK);}));},bb=(bH,bI)=>{pipe(b4(),getItemById(bH),option['map'](be(bI)),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20to\x20update\x20price:\x20'+bH);},bJ=>{aD({...aE['getValue'](),[bH]:bJ});}));},bc=(bH,bI)=>pipe(bH,be(bI),bJ=>{aD({...aE['getValue'](),[bJ['model']['id']]:bJ});}),bd=(bH,bI)=>{pipe(b4(),getItemById(bH),option['map'](be(bI)),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20to\x20update\x20price:\x20'+bH);},bJ=>{aT(![]),pipe(av['instrument']['getValue'](),option['map'](async bK=>{try{!checkOrderIsOnUIOnly(bJ['model']['id'])&&await at['updateOrder'](bK['symbol'],bJ['model']);}finally{bk();}}),option['getOrElse'](()=>Promise['reject'](new Error('Instrument\x20is\x20not\x20presented'))));}));},be=bH=>bI=>{const bJ=Object['assign']({},bI),bK=az['clampY'](bH);switch(bJ['model']['orderType']){case'stop':bJ['model']['stopPrice']=az['yToPrice'](bK),bJ['y']=bK;return bJ;case'limit':bJ['model']['limitPrice']=az['yToPrice'](bK),bJ['y']=bK;return bJ;case'market':default:return bJ;}},bf=bH=>{pipe(b4(),getItemById(bH),option['fold'](()=>{console['warn']('No\x20order\x20found\x20to\x20delete\x20with\x20id\x20'+bH);},bI=>{pipe(av['instrument']['getValue'](),option['map'](async bJ=>{try{await at['deleteOrder'](bJ['symbol'],bI['model']);}finally{bk();}}),option['getOrElse'](()=>Promise['reject'](new Error('Instrument\x20is\x20not\x20presented'))));}));},bg=(bH,bI)=>az['yToPrice'](az['priceToY'](bH)+bI),bh=(bH,bI)=>{pipe({...aE['getValue'](),...aG['getValue']()},getItemById(bI),option['map'](bJ=>{const bK=createProtectionOrderFromOriginalItem(bJ,bH,bL=>bH==='tp'?bL-ORDER_VERTICAL_OFFSET:bL+ORDER_VERTICAL_OFFSET,bL=>bH==='tp'?bg(bL,-ORDER_VERTICAL_OFFSET):bg(bL,ORDER_VERTICAL_OFFSET),as);return isProtection(bK['model'])&&linkProtectionOrderToOriginalItem(bJ,bK['model']['id'],bK['model']['type']),[bJ,bK];}),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20in\x20editable\x20orders\x20by\x20id:\x20'+bI);},([bJ,bK])=>{aD({...aE['getValue'](),[bK['model']['id']]:bK});const bL=()=>{pipe(av['instrument']['getValue'](),option['map'](async bM=>{isProtection(bK['model'])&&unLinkOrderFromOriginalOrder(bJ,bK['model']['type']);const {id:bN,...bO}=bK['model'];try{await at['createOrder'](bM['symbol'],bO);}finally{bl();}}),option['getOrElse'](()=>Promise['reject'](new Error('Instrument\x20is\x20not\x20presented'))));};bi(bK,bL);}));},bi=(bH,bI=constVoid)=>{as['crosshair']['setVisible'](![]);const bJ=az['boundTradingPosition']['subscribe'](bL=>{bc(bH,bL['y']);}),bK=as['canvasInputListener']['observeMouseUpDocument']()['subscribe'](()=>{bJ['unsubscribe'](),bK['unsubscribe'](),bI(),as['crosshair']['setVisible'](!![]);});},bj=bH=>pipe(av['instrument']['getValue'](),option['fold'](constVoid,bI=>au['closePosition'](bI['symbol'],bH))),bk=()=>{const bH=pipe(aI['getValue'](),record['map'](bJ=>updateVisualOrder(bJ,{'selected':![],'disabled':![]}))),bI=pipe(aK['getValue'](),record['map'](bJ=>updateVisualPosition(bJ,{'selected':![],'disabled':![]})));aH(bH),aJ(bI);},bl=()=>{const bH=aE['getValue'](),bI=aG['getValue'](),bJ=pipe({...aI['getValue'](),...bH},record['map'](bL=>updateVisualOrder(bL,{'selected':![],'disabled':![]}))),bK=pipe({...aK['getValue'](),...bI},record['map'](bL=>updateVisualPosition(bL,{'selected':![],'disabled':![]})));aD({}),aF({}),aH(bJ),aJ(bK);},bm=b9,bn=()=>aT(!![]),bo=bH=>{aN({...aO['getValue'](),'rightOffset':bH});},bp=bH=>{aB['setSettingsByPath'](chartSettingsLens(['chartReact','trading','rightOffset']),as['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['width']-bH);},bq=()=>{aN({...aO['getValue'](),'canvasHeight':as['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});},br=()=>{const bH=pixelsToUnits(aQ['getValue']()/0x2,as['scale']['zoomY']),bI=az['marketPrice']['getValue'](),bJ={'high':as['scale']['yEnd']-bH,'low':as['scale']['yStart']+bH},bK=pipe(aI['getValue'](),record['map'](bS=>({...bS,'y':as['chartModel']['toY'](getTradingItemPrice(bS,bI))}))),[bL]=updateTradingItemsVisibility(bK,bS=>b7(bS,bJ,bI));aH(bL);const bM=pipe(aE['getValue'](),record['map'](bS=>({...bS,'y':as['chartModel']['toY'](getTradingItemPrice(bS,bI))}))),[bN]=updateTradingItemsVisibility(bM,bS=>b7(bS,bJ,bI));aD(bN);const bO=pipe(aG['getValue'](),record['map'](bS=>({...bS,'y':as['chartModel']['toY'](getTradingItemPrice(bS,bI))}))),[bP]=updateTradingItemsVisibility(bO,bS=>b8(bS,bJ));aF(bP);const bQ=pipe(aK['getValue'](),record['map'](bS=>({...bS,'y':as['chartModel']['toY'](getTradingItemPrice(bS,bI))}))),[bR]=updateTradingItemsVisibility(bQ,bS=>b8(bS,bJ));aJ(bR);},bs=pipe(as['scale']['yChanged'],tap(()=>br())),bt=pipe(merge(as['bounds']['panesOrderChangedSubject'],as['bounds']['barResizerChangedSubject'],as['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID))),tap(()=>br())),bu=pipe(ay['orderEntryEnabled'],distinctUntilChanged(),tap(bH=>{aN({...aO['getValue'](),'visible':bH});})),bv=pipe(aA['yAxisWidth'],distinctUntilChanged(),pairwise(),tap(([bH,bI])=>{const bJ=bI-bH;aN({...aO['getValue'](),'rightOffset':aO['getValue']()['rightOffset']-bJ,'canvasHeight':as['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});})),bw=pipe(as['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)))['pipe'](map(bH=>{aN({...aO['getValue'](),'rightOffset':bH['width']-aB['state']['getValue']()['settings']['chartReact']['trading']['rightOffset']});})),bx=av['instrument']['pipe'](filterOption(),switchMap(bH=>pipe(new Observable(bI=>at['observeOrders'](bH['symbol'],bJ=>bI['next'](bJ))),observable['map'](bI=>{const bJ=pixelsToUnits(aQ['getValue']()/0x2,as['scale']['zoomY']),bK={'high':as['scale']['yEnd']-bJ,'low':as['scale']['yStart']+bJ},bL=bI['reduce']((bM,bN)=>{return bM[bN['id']]=mapOrderToVisualOrder(bN,as,az['marketPrice']['getValue'](),bK),bM;},{});return aD({}),aH(bL),bI;})))),by=av['instrument']['pipe'](filterOption(),switchMap(bH=>pipe(new Observable(bI=>au['observePositions'](bH['symbol'],bJ=>bI['next'](bJ))),observable['map'](bI=>{const bJ=aG['getValue'](),bK=aK['getValue'](),bL={},bM={};return bI['forEach'](bN=>{const bO=bJ[bN['id']];if(bO)bM[bN['id']]=mapPositionToVisualPosition(g(bN),bP=>as['chartModel']['toY'](bP),as,bO);else{const bP=bK[bN['id']];bL[bN['id']]=mapPositionToVisualPosition(g(bN),bQ=>as['chartModel']['toY'](bQ),as,bP);}}),[bL,bM];}),observable['map'](([bI,bJ])=>{const bK=pixelsToUnits(aQ['getValue']()/0x2,as['scale']['zoomY']),bL={'high':as['scale']['yEnd']-bK,'low':as['scale']['yStart']+bK};return[bI,bJ]['map'](bM=>updateTradingItemsVisibility(bM,bN=>b8(bN,bL))[0x0]);}),tap(([bI,bJ])=>{aJ(bI),aF(bJ);})))),bz=az['marketPriceY']['pipe'](distinctUntilChanged(),tap(bH=>{aH(pipe(aI['getValue'](),record['map'](bI=>bI['model']['orderType']==='market'?{...bI,'y':bH}:bI)));})),bA=combineLatest([aI,aK,aQ,aG,aE])['pipe'](filter(()=>!aU['getValue']()),tap(([bH,bI,bJ])=>{aL(groupTradingItems({...bH,...bI},bJ,az['marketPrice']['getValue']()));})),bB=combineLatest([as['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)),as['scale']['yChanged']])['pipe'](throttleTime(0x14,animationFrameScheduler,{'trailing':!![],'leading':!![]}),map(([bH])=>{const bI=aB['state']['getValue']()['settings']['chartReact']['trading']['bounds'],bJ={'max':az['priceToY'](bI['min']),'min':az['priceToY'](bI['max'])},bK=bH['y']+bH['height']-aQ['getValue'](),bL=Math['min'](bK,bJ['max']),bM=Math['max'](bJ['min']-aQ['getValue'](),bH['y']);aR({'bottom':bL,'top':bM}),aN({...aO['getValue'](),'canvasHeight':as['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});})),bC=pipe(aB['state'],observable['map'](bH=>bH['settings']['chartReact']['scale']['fit']['orders']),distinctUntilChanged(),tap(()=>as['scale']['autoScale']())),bD=pipe(aB['state'],observable['map'](bH=>bH['settings']['chartReact']['scale']['fit']['positions']),distinctUntilChanged(),tap(()=>as['scale']['autoScale']())),bE=merge(bx,bA,by,bz,bB,bs,bt,bu,bv,bw,bC,bD),bF=callTracerProxy('tradingViewModel',{'orders':subtractGroupedItems(aI,aM),'editableOrders':aE,'positions':subtractGroupedItems(aK,aM),'editablePositions':aG,'createOrderFromOrderEntry':aY,'createOriginalOrder':aZ,'createProtectionOrder':bh,'removePosition':bj,'removeOrder':bf,'selectTradingItem':b9,'deselectTradingItems':bl,'updateOrderPosition':bd,'updateOrderPriceUI':bb,'onOrderDragStart':bn,'onOrderClick':b2,'onOrderDblClick':b3,'onOrderClickEventRegister':b0,'onOrderDblClickEventRegister':b1,'onGroupItemSelect':bm,'orderHeight':aQ,'groupedVisualTradingItems':aM,'setOrderHeight':aP,'resizer':aO,'setResizer':aN,'onResizerDrag':bo,'onResizerDragEnd':bp,'onResizerHover':bq,'showPriceAsLabels':aV,'ordersBounds':aS,'onDragStartFromGroup':ba,'isDragging':aU}),bG=createOrdersAndPositionsHighLowProvider(()=>ax['getSelectedChartInfo']()['chartSettings'],as['chartModel'],bF);return as['scale']['autoScaleModel']['setHighLowProvider']('orders_positions',bG),newSink(bF,bE);});const updateVisualOrder=(f,h)=>({...f,...h}),updateVisualPosition=(f,h)=>({...f,...h});function subtractGroupedItems(f,h){return convertToProperty(combineLatest([h,f])['pipe'](map(([k,l])=>{const m=g(l),n=Object['values'](k)['reduce']((o,p)=>{const q=Object['fromEntries'](p['items']['map'](r=>[r['model']['id'],r]));return{...o,...q};},{});for(const o in n){Object['hasOwn'](n,o)&&(n[o]&&delete m[o]);}return m;})),{});}function updateTradingItemsVisibility(h,i){let j=0x0;const k=pipe(h,record['map'](l=>pipe(l,option['fromPredicate'](i),option['fold'](()=>{if(l['visible']===![])return l;return j++,l['visible']=![],l;},()=>{if(l['visible'])return l;return j++,l['visible']=!![],l;}))));return[k,j];}