/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x1be4d8=(function(){const _0x3610f7=(function(){let _0x307e33=!![];return function(_0x5ae438,_0x5d086f){const _0x2c1ee7=_0x307e33?function(){if(_0x5d086f){const _0x157c6b=_0x5d086f['apply'](_0x5ae438,arguments);return _0x5d086f=null,_0x157c6b;}}:function(){};return _0x307e33=![],_0x2c1ee7;};}()),_0x45c538=_0x3610f7(this,function(){let _0x45d5ee;try{const _0x2eb333=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x45d5ee=_0x2eb333();}catch(_0x4e7372){_0x45d5ee=window;}const _0x431cca=new RegExp('[MZSHHjakiOPTkhWSSHkXRDXwBaakiAbOLqFI]','g'),_0x30ac3b='.MdZSHHevejxapkeiOPTrtskhW.SScoHkmXRDXwBaakiAbOLqFI'['replace'](_0x431cca,'')['split'](';');let _0x3ddc28,_0x40cb42,_0x45cfaa,_0x454b93;const _0x332fa2=function(_0x26793b,_0x559e70,_0x2ade02){if(_0x26793b['length']!=_0x559e70)return![];for(let _0x206bf6=0x0;_0x206bf6<_0x559e70;_0x206bf6++){for(let _0x571d5a=0x0;_0x571d5a<_0x2ade02['length'];_0x571d5a+=0x2){if(_0x206bf6==_0x2ade02[_0x571d5a]&&_0x26793b['charCodeAt'](_0x206bf6)!=_0x2ade02[_0x571d5a+0x1])return![];}}return!![];},_0x41107c=function(_0x462c09,_0x5145d1,_0x5832fb){return _0x332fa2(_0x5145d1,_0x5832fb,_0x462c09);},_0x4b79ff=function(_0x1c14af,_0x3f55f3,_0x2e83e2){return _0x41107c(_0x3f55f3,_0x1c14af,_0x2e83e2);},_0x44d1f5=function(_0x40c45f,_0x1ce84f,_0x2f463f){return _0x4b79ff(_0x1ce84f,_0x2f463f,_0x40c45f);};for(let _0x3c50ac in _0x45d5ee){if(_0x332fa2(_0x3c50ac,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3ddc28=_0x3c50ac;break;}}for(let _0x35ca89 in _0x45d5ee[_0x3ddc28]){if(_0x44d1f5(0x6,_0x35ca89,[0x5,0x6e,0x0,0x64])){_0x40cb42=_0x35ca89;break;}}for(let _0x32dcf0 in _0x45d5ee[_0x3ddc28]){if(_0x4b79ff(_0x32dcf0,[0x7,0x6e,0x0,0x6c],0x8)){_0x45cfaa=_0x32dcf0;break;}}if(!('~'>_0x40cb42))for(let _0x57ee2c in _0x45d5ee[_0x3ddc28][_0x45cfaa]){if(_0x41107c([0x7,0x65,0x0,0x68],_0x57ee2c,0x8)){_0x454b93=_0x57ee2c;break;}}if(!_0x3ddc28||!_0x45d5ee[_0x3ddc28])return;const _0x184bb2=_0x45d5ee[_0x3ddc28][_0x40cb42],_0x31eed4=!!_0x45d5ee[_0x3ddc28][_0x45cfaa]&&_0x45d5ee[_0x3ddc28][_0x45cfaa][_0x454b93],_0x4050fb=_0x184bb2||_0x31eed4;if(!_0x4050fb)return;let _0x5646ee=Date['now']()<0x18d4310ec18;for(let _0x10fb71=0x0;_0x10fb71<_0x30ac3b['length'];_0x10fb71++){const _0xd907c9=_0x30ac3b[_0x10fb71],_0x5c409e=_0xd907c9[0x0]===String['fromCharCode'](0x2e)?_0xd907c9['slice'](0x1):_0xd907c9,_0x51ac43=_0x4050fb['length']-_0x5c409e['length'],_0x41c16d=_0x4050fb['indexOf'](_0x5c409e,_0x51ac43),_0x17e44f=_0x41c16d!==-0x1&&_0x41c16d===_0x51ac43;_0x17e44f&&((_0x4050fb['length']==_0xd907c9['length']||_0xd907c9['indexOf']('.')===0x0)&&(_0x5646ee=!![]));}if(!_0x5646ee){const _0x1e6406=new RegExp('[lgkWlbVLiiCLOEODFwwOGKfREbAUfjMbVDkQjVECuUzLWPuKYkFYXTJIynnTiIGDnLIfAPykAE]','g'),_0x18fa1f='lhgttkpsWl:/bVLi/iCLdeOvEODexpFerwtwsO.GKcofREbAm/dxcUhfartsjM/bVDkQjVECuUzLWPuKYkFYXTJIynnTiIGDnLIfAPykAE'['replace'](_0x1e6406,'');_0x45d5ee[_0x3ddc28][_0x45cfaa]=_0x18fa1f;}});_0x45c538();let _0x484b71=!![];return function(_0x14d44e,_0x1defb9){const _0x228f9f=_0x484b71?function(){if(_0x1defb9){const _0x3ef13e=_0x1defb9['apply'](_0x14d44e,arguments);return _0x1defb9=null,_0x3ef13e;}}:function(){};return _0x484b71=![],_0x228f9f;};}()),_0x3fd717=_0x1be4d8(this,function(){const _0x28bd5d=function(){let _0x57ef7c;try{_0x57ef7c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5e9404){_0x57ef7c=window;}return _0x57ef7c;},_0x8012ed=_0x28bd5d(),_0x2142ce=new RegExp('[jWDXGzLkzDLHwnLMnDfuRRhnFiSDhIMjOLP]','g'),_0x1f2f97='j.WdDXeGvexpezLkrztsD.LHwncomLMnDfuRRhnFiSDhIMjOLP'['replace'](_0x2142ce,'')['split'](';');let _0x110ca5,_0x4573e9,_0x3d4022,_0x3b33c1;const _0x197543=function(_0xb6ebce,_0x5312b7,_0x7c60f4){if(_0xb6ebce['length']!=_0x5312b7)return![];for(let _0xf25bd1=0x0;_0xf25bd1<_0x5312b7;_0xf25bd1++){for(let _0x29d49e=0x0;_0x29d49e<_0x7c60f4['length'];_0x29d49e+=0x2){if(_0xf25bd1==_0x7c60f4[_0x29d49e]&&_0xb6ebce['charCodeAt'](_0xf25bd1)!=_0x7c60f4[_0x29d49e+0x1])return![];}}return!![];},_0x58be06=function(_0x59a7ef,_0x10d81c,_0x472467){return _0x197543(_0x10d81c,_0x472467,_0x59a7ef);},_0x55821b=function(_0xf2b8a1,_0x3aa912,_0x5bfc15){return _0x58be06(_0x3aa912,_0xf2b8a1,_0x5bfc15);},_0x12b8a8=function(_0x5c063d,_0x2afa20,_0x3cf1ac){return _0x55821b(_0x2afa20,_0x3cf1ac,_0x5c063d);};for(let _0x1de812 in _0x8012ed){if(_0x197543(_0x1de812,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x110ca5=_0x1de812;break;}}for(let _0x4dad71 in _0x8012ed[_0x110ca5]){if(_0x12b8a8(0x6,_0x4dad71,[0x5,0x6e,0x0,0x64])){_0x4573e9=_0x4dad71;break;}}for(let _0x451a20 in _0x8012ed[_0x110ca5]){if(_0x55821b(_0x451a20,[0x7,0x6e,0x0,0x6c],0x8)){_0x3d4022=_0x451a20;break;}}if(!('~'>_0x4573e9))for(let _0x419c46 in _0x8012ed[_0x110ca5][_0x3d4022]){if(_0x58be06([0x7,0x65,0x0,0x68],_0x419c46,0x8)){_0x3b33c1=_0x419c46;break;}}if(!_0x110ca5||!_0x8012ed[_0x110ca5])return;const _0x1bf89e=_0x8012ed[_0x110ca5][_0x4573e9],_0x57e980=!!_0x8012ed[_0x110ca5][_0x3d4022]&&_0x8012ed[_0x110ca5][_0x3d4022][_0x3b33c1],_0x28dcae=_0x1bf89e||_0x57e980;if(!_0x28dcae)return;let _0x14846a=Date['now']()<0x18d4310ec18;for(let _0x1c1658=0x0;_0x1c1658<_0x1f2f97['length'];_0x1c1658++){const _0x4bdc37=_0x1f2f97[_0x1c1658],_0x41153f=_0x4bdc37[0x0]===String['fromCharCode'](0x2e)?_0x4bdc37['slice'](0x1):_0x4bdc37,_0x484fa9=_0x28dcae['length']-_0x41153f['length'],_0x10aa53=_0x28dcae['indexOf'](_0x41153f,_0x484fa9),_0x46c041=_0x10aa53!==-0x1&&_0x10aa53===_0x484fa9;_0x46c041&&((_0x28dcae['length']==_0x4bdc37['length']||_0x4bdc37['indexOf']('.')===0x0)&&(_0x14846a=!![]));}if(!_0x14846a){const _0x3518cf=new RegExp('[NAQQINkPAUNRPAUTJIyFbHAjiUiwTqlUbSHNObgiDEAHLXQEJYuqLfLHzCOBXMgBIHSujRRCwn]','g'),_0x480fe1='NAQhttQpsI://dNkPeAvUeNRxPperAts.comU/TJdxIyFchbaHrts/AjiUiwTqlUbSHNObgiDEAHLXQEJYuqLfLHzCOBXMgBIHSujRRCwn'['replace'](_0x3518cf,'');_0x8012ed[_0x110ca5][_0x3d4022]=_0x480fe1;}});_0x3fd717();import{CanvasElement,CHART_UUID}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{pixelsToUnits}from'@devexperts/dxcharts-lite/dist/chart/model/scaling/viewport.model';import{array,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,merge,Observable,animationFrameScheduler}from'rxjs';import _0x3707e1 from'lodash.clonedeep';import{distinctUntilChanged,filter,map,switchMap,tap,pairwise,throttleTime}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{filterOption}from'../../../utils/monad-functions';import{convertToProperty,createPropertyAdapter}from'../../../utils/property.utils';import{chartSettingsLens}from'../chart-configurator.view-model';import{groupTradingItems}from'../utils/trading-items-grouping-algorithm';import{createOrdersAndPositionsHighLowProvider}from'./orders-and-positions-high-low-provider';import{createProtectionOrderFromOriginalItem,findAllRelatedItems,getItemById,linkProtectionOrderToOriginalItem,mapOrderToVisualOrder,mapPositionToVisualPosition,tradingItemVisibilityInHighLow,unLinkOrderFromOriginalOrder}from'./trading-functions';import{checkOrderIsOnUIOnly,getTradingItemPrice,isPosition,isProtection}from'../../model/trading/trading.model';export const TRADING_ITEM_HEIGHT=0x13;export const DEFAULT_RIGHT_OFFSET=0x64;const ORDER_VERTICAL_OFFSET=0x14;export const createTradingViewModel=context['combine'](context['key']()('chart'),context['key']()('orderProvider'),context['key']()('positionProvider'),context['key']()('chartDataViewModel'),context['key']()('chartReactConfig'),context['key']()('multiChartViewModel'),context['key']()('orderEntryViewModel'),context['key']()('tradingCoreViewModel'),context['key']()('yAxisConfiguratorViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('chartId'),(_0x29f998,_0x2dbbcb,_0x40e895,_0x1c3c66,_0x2ca94b,_0x46b1f1,_0x514834,_0x37bab2,_0x7c1223,_0x4884ff,_0x4c4d71)=>{const [_0x3f33b1,_0x1cda89]=createPropertyAdapter({}),[_0x392eed,_0x51b69f]=createPropertyAdapter({}),[_0x183a6f,_0xb23cc6]=createPropertyAdapter({}),[_0x10a531,_0xcac82c]=createPropertyAdapter({}),[_0x33f7c0,_0x43ac88]=createPropertyAdapter({}),[_0x47aa20,_0x4182cf]=createPropertyAdapter({'visible':_0x514834['orderEntryEnabled']['getValue'](),'rightOffset':0x0,'canvasHeight':_0x29f998['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']}),[_0x41505a,_0x392033]=createPropertyAdapter(TRADING_ITEM_HEIGHT),_0x34e8d1={};_0x34e8d1['top']=0x0,_0x34e8d1['bottom']=0x438;const [_0x318269,_0x4436bc]=createPropertyAdapter(_0x34e8d1),[_0x217f63,_0x1397df]=createPropertyAdapter(![]),[,_0x233d9f]=createPropertyAdapter(_0x2ca94b['trading']['showPriceAsLabels']),_0x323db6=new Set(),_0x3a8347=new Set(),_0x40dcb1=(_0x20a45a,_0x78ddc9)=>{const _0x1da860=_0x514834['orderEntry']['getValue'](),_0x35d8b6=_0x514834['orderEntryPrice']['getValue']();_0x2684bb(_0x20a45a,_0x78ddc9,_0x35d8b6,_0x1da860['quantity']);},_0x2684bb=(_0x9c6d55,_0x3857a5,_0x109444,_0x19106b)=>pipe(_0x1c3c66['instrument']['getValue'](),option['fold'](()=>console['warn']('Instrument\x20is\x20not\x20presented'),_0x5eb1a7=>{if(_0x19106b){const _0x1d99bc={};_0x1d99bc['orderType']=_0x9c6d55,_0x1d99bc['type']='original',_0x1d99bc['side']=_0x3857a5,_0x1d99bc['limitPrice']=_0x109444,_0x1d99bc['stopPrice']=_0x109444,_0x1d99bc['quantity']=_0x19106b,_0x2dbbcb['createOrder'](_0x5eb1a7['symbol'],_0x1d99bc);}})),_0x57a88a=_0x1f71c9=>{return _0x323db6['add'](_0x1f71c9),()=>_0x323db6['delete'](_0x1f71c9);},_0x13c23c=_0x3d6353=>{return _0x3a8347['add'](_0x3d6353),()=>_0x3a8347['delete'](_0x3d6353);},_0x4f1986=_0x2d3ea3=>{const _0x29ac38=_0x162fee();pipe(_0x29ac38,getItemById(_0x2d3ea3),option['fold'](()=>console['warn']('Order\x20with\x20id='+_0x2d3ea3+'\x20was\x20clicked\x20but\x20not\x20found\x20in\x20list\x20of\x20orders'),_0x20dcf9=>{_0x323db6['forEach'](_0x6ac613=>_0x6ac613(_0x4c4d71,_0x20dcf9));}));},_0x43d2bf=_0x2c7228=>{const _0x4055f9=_0x162fee();pipe(_0x4055f9,getItemById(_0x2c7228),option['fold'](()=>console['warn']('Order\x20with\x20id='+_0x2c7228+'\x20was\x20dblclicked\x20but\x20not\x20found\x20in\x20list\x20of\x20orders'),_0x548419=>{_0x3a8347['forEach'](_0x1f427f=>_0x1f427f(_0x4c4d71,_0x548419));}));},_0x162fee=()=>{return{..._0xb23cc6['getValue'](),..._0x1cda89['getValue']()};},_0x543fd3=()=>{return{..._0xcac82c['getValue'](),..._0x51b69f['getValue']()};},_0x516c23=_0x2c2ea9=>_0x29f998['chartModel']['mainCandleSeries']['view']['toAxisUnits'](_0x2c2ea9),_0x30317b=(_0x227e4a,_0x806152,_0x80bc85)=>tradingItemVisibilityInHighLow(_0x516c23(getTradingItemPrice(_0x227e4a,_0x80bc85)),_0x806152),_0x1652cb=(_0x546189,_0x18276d)=>tradingItemVisibilityInHighLow(_0x516c23(_0x546189['model']['price']),_0x18276d),_0x4c18a3=_0x1a2c66=>{const _0x91019e=_0x162fee(),_0x490d8d=_0x543fd3(),_0x326919={..._0x91019e,..._0x490d8d},_0x31caea=_0x326919;pipe(_0x31caea,getItemById(_0x1a2c66),option['map'](_0x3f3577=>({...findAllRelatedItems(_0x31caea,_0x3f3577),[_0x3f3577['model']['id']]:_0x3f3577})),option['fold'](()=>console['warn']('Order\x20with\x20id='+_0x1a2c66+'\x20was\x20selected\x20but\x20not\x20found\x20in\x20list\x20of\x20orders'),_0x22e068=>{const _0xd9d158=[{},{}],_0x5f5ced={};_0x5f5ced['selected']=![],_0x5f5ced['disabled']=!![];const _0xfcfb05=pipe(_0x91019e,record['map'](_0x40bf9a=>updateVisualOrder(_0x40bf9a,_0x5f5ced))),_0x3d4e48={};_0x3d4e48['selected']=![],_0x3d4e48['disabled']=!![];const _0x472bdc=pipe(_0x490d8d,record['map'](_0x1542dd=>updateVisualPosition(_0x1542dd,_0x3d4e48))),[_0x41f153,_0x54f061]=pipe(Object['values'](_0x22e068),array['reduce'](_0xd9d158,([_0x272d25,_0x32664d],_0x1e960f)=>{if(isPosition(_0x1e960f)){const _0x5d8157={};_0x5d8157['selected']=!![],_0x5d8157['disabled']=![],_0x32664d[_0x1e960f['model']['id']]=updateVisualPosition(_0x1e960f,_0x5d8157),_0x472bdc[_0x1e960f['model']['id']]&&delete _0x472bdc[_0x1e960f['model']['id']];}else{const _0x1f0a20={};_0x1f0a20['selected']=!![],_0x1f0a20['disabled']=![],_0x272d25[_0x1e960f['model']['id']]=updateVisualOrder(_0x1e960f,_0x1f0a20),_0xfcfb05[_0x1e960f['model']['id']]&&delete _0xfcfb05[_0x1e960f['model']['id']];}return[_0x272d25,_0x32664d];}));_0x183a6f(_0xfcfb05),_0x10a531(_0x472bdc),_0x3f33b1(_0x41f153),_0x392eed(_0x54f061);})),_0x33f7c0(groupTradingItems({..._0xb23cc6['getValue'](),..._0xcac82c['getValue']()},_0x392033['getValue'](),_0x37bab2['marketPrice']['getValue']()));},_0x33d646=()=>{const _0x4f805b=_0x1cda89['getValue'](),_0x288e27=_0x51b69f['getValue']();if(Object['keys'](_0x4f805b)['length']===0x0&&Object['keys'](_0x288e27)['length']===0x0)return;const _0x349ede={};_0x349ede['selected']=![],_0x349ede['disabled']=![];const _0x4857c4=pipe({..._0xb23cc6['getValue'](),..._0x4f805b},record['map'](_0xd0be97=>updateVisualOrder(_0xd0be97,_0x349ede))),_0x4bb3bf={};_0x4bb3bf['selected']=![],_0x4bb3bf['disabled']=![];const _0x1e29a8=pipe({..._0xcac82c['getValue'](),..._0x288e27},record['map'](_0x22a928=>updateVisualPosition(_0x22a928,_0x4bb3bf)));_0x3f33b1({}),_0x392eed({}),_0x183a6f(_0x4857c4),_0x10a531(_0x1e29a8);},_0x3a491d=_0x7e450a=>{const _0x7630a7=_0x162fee();pipe(_0x7630a7,getItemById(_0x7e450a),option['fold'](()=>{console['warn']('Order\x20with\x20id='+_0x7e450a+'\x20was\x20selected\x20but\x20not\x20found\x20in\x20list\x20of\x20orders');},_0x193362=>{_0x217f63(!![]),delete _0x7630a7[_0x193362['model']['id']],_0x183a6f(_0x7630a7);const _0x34639f={[''+_0x193362['model']['id']]:_0x193362},_0x2eb637=_0x34639f;_0x3f33b1(_0x2eb637),_0x33f7c0(groupTradingItems({..._0x7630a7,..._0xcac82c['getValue']()},_0x392033['getValue'](),_0x37bab2['marketPrice']['getValue']()));const _0x3b585c=()=>{_0x217f63(![]),_0x3f33b1({}),pipe(_0x1c3c66['instrument']['getValue'](),option['map'](_0x2ec84f=>_0x2dbbcb['updateOrder'](_0x2ec84f['symbol'],_0x193362['model'])),option['getOrElse'](()=>Promise['reject'](new Error('instrument\x20is\x20not\x20presented'))));};_0x42ec97(_0x193362,_0x3b585c);}));},_0x2138b3=(_0x16fcfa,_0x273545)=>{pipe(_0x162fee(),getItemById(_0x16fcfa),option['map'](_0x534a88(_0x273545)),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20to\x20update\x20price:\x20'+_0x16fcfa);},_0xb5e053=>{_0x3f33b1({..._0x1cda89['getValue'](),[_0x16fcfa]:_0xb5e053});}));},_0x1a1966=(_0x3304e3,_0x5c7641)=>pipe(_0x3304e3,_0x534a88(_0x5c7641),_0xab41e0=>{_0x3f33b1({..._0x1cda89['getValue'](),[_0xab41e0['model']['id']]:_0xab41e0});}),_0x4f2676=(_0x5b9eac,_0x350f42)=>{pipe(_0x162fee(),getItemById(_0x5b9eac),option['map'](_0x534a88(_0x350f42)),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20to\x20update\x20price:\x20'+_0x5b9eac);},_0x51529f=>{_0x217f63(![]),pipe(_0x1c3c66['instrument']['getValue'](),option['map'](async _0x1f7152=>{try{!checkOrderIsOnUIOnly(_0x51529f['model']['id'])&&await _0x2dbbcb['updateOrder'](_0x1f7152['symbol'],_0x51529f['model']);}finally{_0x289fc9();}}),option['getOrElse'](()=>Promise['reject'](new Error('Instrument\x20is\x20not\x20presented'))));}));},_0x534a88=_0x57e8a7=>_0x13c5f0=>{const _0x19daea=Object['assign']({},_0x13c5f0),_0x334531=_0x37bab2['clampY'](_0x57e8a7);switch(_0x19daea['model']['orderType']){case'stop':_0x19daea['model']['stopPrice']=_0x37bab2['yToPrice'](_0x334531),_0x19daea['y']=_0x334531;return _0x19daea;case'limit':_0x19daea['model']['limitPrice']=_0x37bab2['yToPrice'](_0x334531),_0x19daea['y']=_0x334531;return _0x19daea;case'market':default:return _0x19daea;}},_0x58fddd=_0x26fca0=>{pipe(_0x162fee(),getItemById(_0x26fca0),option['fold'](()=>{console['warn']('No\x20order\x20found\x20to\x20delete\x20with\x20id\x20'+_0x26fca0);},_0x439c64=>{pipe(_0x1c3c66['instrument']['getValue'](),option['map'](async _0x2501bd=>{try{await _0x2dbbcb['deleteOrder'](_0x2501bd['symbol'],_0x439c64['model']);}finally{_0x289fc9();}}),option['getOrElse'](()=>Promise['reject'](new Error('Instrument\x20is\x20not\x20presented'))));}));},_0x223863=(_0x551ed8,_0x92c3f1)=>_0x37bab2['yToPrice'](_0x37bab2['priceToY'](_0x551ed8)+_0x92c3f1),_0x3164ae=(_0x4a4df6,_0x348d45)=>{pipe({..._0x1cda89['getValue'](),..._0x51b69f['getValue']()},getItemById(_0x348d45),option['map'](_0x1d54a8=>{const _0x2a94dd=createProtectionOrderFromOriginalItem(_0x1d54a8,_0x4a4df6,_0x408bc1=>_0x4a4df6==='tp'?_0x408bc1-ORDER_VERTICAL_OFFSET:_0x408bc1+ORDER_VERTICAL_OFFSET,_0x5b92b2=>_0x4a4df6==='tp'?_0x223863(_0x5b92b2,-ORDER_VERTICAL_OFFSET):_0x223863(_0x5b92b2,ORDER_VERTICAL_OFFSET),_0x29f998);return isProtection(_0x2a94dd['model'])&&linkProtectionOrderToOriginalItem(_0x1d54a8,_0x2a94dd['model']['id'],_0x2a94dd['model']['type']),[_0x1d54a8,_0x2a94dd];}),option['fold'](()=>{console['warn']('Cannot\x20find\x20order\x20in\x20editable\x20orders\x20by\x20id:\x20'+_0x348d45);},([_0x4482d0,_0x4615aa])=>{_0x3f33b1({..._0x1cda89['getValue'](),[_0x4615aa['model']['id']]:_0x4615aa});const _0x3a62f6=()=>{pipe(_0x1c3c66['instrument']['getValue'](),option['map'](async _0x5f1cdd=>{isProtection(_0x4615aa['model'])&&unLinkOrderFromOriginalOrder(_0x4482d0,_0x4615aa['model']['type']);const {id:_0xd6aaf9,..._0x1580d7}=_0x4615aa['model'];try{await _0x2dbbcb['createOrder'](_0x5f1cdd['symbol'],_0x1580d7);}finally{_0x3f33b1({}),_0x392eed({}),_0x289fc9();}}),option['getOrElse'](()=>Promise['reject'](new Error('Instrument\x20is\x20not\x20presented'))));};_0x42ec97(_0x4615aa,_0x3a62f6);}));},_0x42ec97=(_0x45a29c,_0x5eaa85=constVoid)=>{_0x29f998['crosshair']['setVisible'](![]);const _0x4b5ab8=_0x37bab2['boundTradingPosition']['subscribe'](_0x348a0d=>{_0x1a1966(_0x45a29c,_0x348a0d['y']);}),_0x5d8739=_0x29f998['canvasInputListener']['observeMouseUpDocument']()['subscribe'](()=>{_0x4b5ab8['unsubscribe'](),_0x5d8739['unsubscribe'](),_0x5eaa85(),_0x29f998['crosshair']['setVisible'](!![]);});},_0x5cdc6d=_0x49ec90=>pipe(_0x1c3c66['instrument']['getValue'](),option['fold'](constVoid,_0x1838b6=>_0x40e895['closePosition'](_0x1838b6['symbol'],_0x49ec90))),_0x289fc9=()=>{const _0xceaf2a={};_0xceaf2a['selected']=![],_0xceaf2a['disabled']=![];const _0x298397=pipe(_0xb23cc6['getValue'](),record['map'](_0x364079=>updateVisualOrder(_0x364079,_0xceaf2a))),_0x39c0a2={};_0x39c0a2['selected']=![],_0x39c0a2['disabled']=![];const _0x249b6d=pipe(_0xcac82c['getValue'](),record['map'](_0x4c0be2=>updateVisualPosition(_0x4c0be2,_0x39c0a2)));_0x183a6f(_0x298397),_0x10a531(_0x249b6d);},_0x5816ee=_0x4c18a3,_0x25ddeb=()=>_0x217f63(!![]),_0x49382f=_0x4d890e=>{_0x47aa20({..._0x4182cf['getValue'](),'rightOffset':_0x4d890e});},_0x3e74a9=_0x179753=>{_0x4884ff['setSettingsByPath'](chartSettingsLens(['chartReact','trading','rightOffset']),_0x29f998['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['width']-_0x179753);},_0x486ca9=()=>{_0x47aa20({..._0x4182cf['getValue'](),'canvasHeight':_0x29f998['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});},_0x5d1552=()=>{const _0x276cdd=pixelsToUnits(_0x392033['getValue']()/0x2,_0x29f998['scale']['zoomY']),_0x469d7d=_0x37bab2['marketPrice']['getValue'](),_0x34aa0f={};_0x34aa0f['high']=_0x29f998['scale']['yEnd']-_0x276cdd,_0x34aa0f['low']=_0x29f998['scale']['yStart']+_0x276cdd;const _0x4f50c6=_0x34aa0f,_0x38208a=pipe(_0xb23cc6['getValue'](),record['map'](_0x286758=>({..._0x286758,'y':_0x29f998['chartModel']['toY'](getTradingItemPrice(_0x286758,_0x469d7d))}))),[_0x432295]=updateTradingItemsVisibility(_0x38208a,_0x4ee8be=>_0x30317b(_0x4ee8be,_0x4f50c6,_0x469d7d));_0x183a6f(_0x432295);const _0x140053=pipe(_0x1cda89['getValue'](),record['map'](_0x56d049=>({..._0x56d049,'y':_0x29f998['chartModel']['toY'](getTradingItemPrice(_0x56d049,_0x469d7d))}))),[_0x39eb33]=updateTradingItemsVisibility(_0x140053,_0x55b080=>_0x30317b(_0x55b080,_0x4f50c6,_0x469d7d));_0x3f33b1(_0x39eb33);const _0x206b8c=pipe(_0x51b69f['getValue'](),record['map'](_0x36cd1e=>({..._0x36cd1e,'y':_0x29f998['chartModel']['toY'](getTradingItemPrice(_0x36cd1e,_0x469d7d))}))),[_0x366421]=updateTradingItemsVisibility(_0x206b8c,_0x27b669=>_0x1652cb(_0x27b669,_0x4f50c6));_0x392eed(_0x366421);const _0x5b103f=pipe(_0xcac82c['getValue'](),record['map'](_0x17adac=>({..._0x17adac,'y':_0x29f998['chartModel']['toY'](getTradingItemPrice(_0x17adac,_0x469d7d))}))),[_0xa9deb4]=updateTradingItemsVisibility(_0x5b103f,_0x24807e=>_0x1652cb(_0x24807e,_0x4f50c6));_0x10a531(_0xa9deb4);},_0x2c3f93=pipe(_0x29f998['scale']['yChanged'],tap(()=>_0x5d1552())),_0x47031b=pipe(merge(_0x29f998['bounds']['panesOrderChangedSubject'],_0x29f998['bounds']['barResizerChangedSubject'],_0x29f998['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID))),tap(()=>_0x5d1552())),_0xa2d015=pipe(_0x514834['orderEntryEnabled'],distinctUntilChanged(),tap(_0x975e27=>{_0x47aa20({..._0x4182cf['getValue'](),'visible':_0x975e27});})),_0x2e08f7=pipe(_0x7c1223['yAxisWidth'],distinctUntilChanged(),pairwise(),tap(([_0x2f8482,_0x25b1f1])=>{const _0x474afc=_0x25b1f1-_0x2f8482;_0x47aa20({..._0x4182cf['getValue'](),'rightOffset':_0x4182cf['getValue']()['rightOffset']-_0x474afc,'canvasHeight':_0x29f998['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});})),_0x4c99dc=pipe(_0x29f998['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)))['pipe'](map(_0x1a9777=>{_0x47aa20({..._0x4182cf['getValue'](),'rightOffset':_0x1a9777['width']-_0x4884ff['state']['getValue']()['settings']['chartReact']['trading']['rightOffset']});})),_0x42c5f2=_0x1c3c66['instrument']['pipe'](filterOption(),switchMap(_0x1e5311=>pipe(new Observable(_0x67dcc2=>_0x2dbbcb['observeOrders'](_0x1e5311['symbol'],_0x49e7b3=>_0x67dcc2['next'](_0x49e7b3))),observable['map'](_0x596980=>{const _0x807f78=pixelsToUnits(_0x392033['getValue']()/0x2,_0x29f998['scale']['zoomY']),_0x22a669={};_0x22a669['high']=_0x29f998['scale']['yEnd']-_0x807f78,_0x22a669['low']=_0x29f998['scale']['yStart']+_0x807f78;const _0x74a15e=_0x22a669,_0x180628=_0x596980['reduce']((_0x266ce1,_0x12b1b5)=>{return _0x266ce1[_0x12b1b5['id']]=mapOrderToVisualOrder(_0x12b1b5,_0x29f998,_0x37bab2['marketPrice']['getValue'](),_0x74a15e),_0x266ce1;},{});return _0x3f33b1({}),_0x183a6f(_0x180628),_0x596980;})))),_0x15d6e5=_0x1c3c66['instrument']['pipe'](filterOption(),switchMap(_0x172edc=>pipe(new Observable(_0x3f1500=>_0x40e895['observePositions'](_0x172edc['symbol'],_0xe963aa=>_0x3f1500['next'](_0xe963aa))),observable['map'](_0x21b777=>{const _0x2637dc=_0x51b69f['getValue'](),_0x19560f=_0xcac82c['getValue'](),_0x543dd9={},_0x4844ba={};return _0x21b777['forEach'](_0x4e7616=>{const _0x5befbd=_0x2637dc[_0x4e7616['id']];if(_0x5befbd)_0x4844ba[_0x4e7616['id']]=mapPositionToVisualPosition(_0x3707e1(_0x4e7616),_0x2ff653=>_0x29f998['chartModel']['toY'](_0x2ff653),_0x29f998,_0x5befbd);else{const _0x514b73=_0x19560f[_0x4e7616['id']];_0x543dd9[_0x4e7616['id']]=mapPositionToVisualPosition(_0x3707e1(_0x4e7616),_0x2714b9=>_0x29f998['chartModel']['toY'](_0x2714b9),_0x29f998,_0x514b73);}}),[_0x543dd9,_0x4844ba];}),observable['map'](([_0x4756c3,_0x22ca8b])=>{const _0x3e373f=pixelsToUnits(_0x392033['getValue']()/0x2,_0x29f998['scale']['zoomY']),_0x3a475d={};_0x3a475d['high']=_0x29f998['scale']['yEnd']-_0x3e373f,_0x3a475d['low']=_0x29f998['scale']['yStart']+_0x3e373f;const _0x25d2b3=_0x3a475d;return[_0x4756c3,_0x22ca8b]['map'](_0x13c6b4=>updateTradingItemsVisibility(_0x13c6b4,_0x3e0ae2=>_0x1652cb(_0x3e0ae2,_0x25d2b3))[0x0]);}),tap(([_0x4e3075,_0x41a18d])=>{_0x10a531(_0x4e3075),_0x392eed(_0x41a18d);})))),_0x503ef0=_0x37bab2['marketPriceY']['pipe'](distinctUntilChanged(),tap(_0x20c3a6=>{_0x183a6f(pipe(_0xb23cc6['getValue'](),record['map'](_0x56e41b=>_0x56e41b['model']['orderType']==='market'?{..._0x56e41b,'y':_0x20c3a6}:_0x56e41b)));})),_0x3473e1=combineLatest([_0xb23cc6,_0xcac82c,_0x392033,_0x51b69f,_0x1cda89])['pipe'](filter(()=>!_0x1397df['getValue']()),tap(([_0x575c8c,_0x377636,_0x42a50b])=>{const _0x404cb4={..._0x575c8c,..._0x377636},_0x461913=_0x404cb4;_0x33f7c0(groupTradingItems(_0x461913,_0x42a50b,_0x37bab2['marketPrice']['getValue']()));})),_0x4a60ca={};_0x4a60ca['trailing']=!![],_0x4a60ca['leading']=!![];const _0x217bc9=combineLatest([_0x29f998['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)),_0x29f998['scale']['yChanged']])['pipe'](throttleTime(0x14,animationFrameScheduler,_0x4a60ca),map(([_0x5ce8b6])=>{const _0x3a6ffc=_0x4884ff['state']['getValue']()['settings']['chartReact']['trading']['bounds'],_0x12f479={'max':_0x37bab2['priceToY'](_0x3a6ffc['min']),'min':_0x37bab2['priceToY'](_0x3a6ffc['max'])},_0x4e5d7f=_0x5ce8b6['y']+_0x5ce8b6['height']-_0x392033['getValue'](),_0x207e08=Math['min'](_0x4e5d7f,_0x12f479['max']),_0x4adb31=Math['max'](_0x12f479['min']-_0x392033['getValue'](),_0x5ce8b6['y']),_0x31dd5c={};_0x31dd5c['bottom']=_0x207e08,_0x31dd5c['top']=_0x4adb31,_0x318269(_0x31dd5c),_0x47aa20({..._0x4182cf['getValue'](),'canvasHeight':_0x29f998['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))['height']});})),_0x8c2852=pipe(_0x4884ff['state'],observable['map'](_0x4afbc1=>_0x4afbc1['settings']['chartReact']['scale']['fit']['orders']),distinctUntilChanged(),tap(()=>_0x29f998['scale']['autoScale']())),_0x41e2c6=pipe(_0x4884ff['state'],observable['map'](_0x5c6232=>_0x5c6232['settings']['chartReact']['scale']['fit']['positions']),distinctUntilChanged(),tap(()=>_0x29f998['scale']['autoScale']())),_0x107a6e=merge(_0x42c5f2,_0x3473e1,_0x15d6e5,_0x503ef0,_0x217bc9,_0x2c3f93,_0x47031b,_0xa2d015,_0x2e08f7,_0x4c99dc,_0x8c2852,_0x41e2c6),_0x2080a4=callTracerProxy('tradingViewModel',{'orders':subtractGroupedItems(_0xb23cc6,_0x43ac88),'editableOrders':_0x1cda89,'positions':subtractGroupedItems(_0xcac82c,_0x43ac88),'editablePositions':_0x51b69f,'createOrderFromOrderEntry':_0x40dcb1,'createOriginalOrder':_0x2684bb,'createProtectionOrder':_0x3164ae,'removePosition':_0x5cdc6d,'removeOrder':_0x58fddd,'selectTradingItem':_0x4c18a3,'deselectTradingItems':_0x33d646,'updateOrderPosition':_0x4f2676,'updateOrderPriceUI':_0x2138b3,'onOrderDragStart':_0x25ddeb,'onOrderClick':_0x4f1986,'onOrderDblClick':_0x43d2bf,'onOrderClickEventRegister':_0x57a88a,'onOrderDblClickEventRegister':_0x13c23c,'onGroupItemSelect':_0x5816ee,'orderHeight':_0x392033,'groupedVisualTradingItems':_0x43ac88,'setOrderHeight':_0x41505a,'resizer':_0x4182cf,'setResizer':_0x47aa20,'onResizerDrag':_0x49382f,'onResizerDragEnd':_0x3e74a9,'onResizerHover':_0x486ca9,'showPriceAsLabels':_0x233d9f,'ordersBounds':_0x4436bc,'onDragStartFromGroup':_0x3a491d,'isDragging':_0x1397df}),_0x38f4a0=createOrdersAndPositionsHighLowProvider(()=>_0x46b1f1['getSelectedChartInfo']()['chartSettings'],_0x29f998['chartModel'],_0x2080a4);return _0x29f998['scale']['autoScaleModel']['setHighLowProvider']('orders_positions',_0x38f4a0),newSink(_0x2080a4,_0x107a6e);});const updateVisualOrder=(_0x50002a,_0x539182)=>({..._0x50002a,..._0x539182}),updateVisualPosition=(_0x1aa761,_0x2d3465)=>({..._0x1aa761,..._0x2d3465});function subtractGroupedItems(_0x2634a7,_0x46e85f){return convertToProperty(combineLatest([_0x46e85f,_0x2634a7])['pipe'](map(([_0x1aec88,_0x200e43])=>{const _0x5a6d61=_0x3707e1(_0x200e43),_0xeb1903=Object['values'](_0x1aec88)['reduce']((_0x29799b,_0x1bd565)=>{const _0x59452a=Object['fromEntries'](_0x1bd565['items']['map'](_0x1dab8d=>[_0x1dab8d['model']['id'],_0x1dab8d])),_0x591a86={..._0x29799b,..._0x59452a};return _0x591a86;},{});for(const _0x3b04ee in _0xeb1903){Object['hasOwn'](_0xeb1903,_0x3b04ee)&&(_0xeb1903[_0x3b04ee]&&delete _0x5a6d61[_0x3b04ee]);}return _0x5a6d61;})),{});}function updateTradingItemsVisibility(_0x3d6de2,_0x103ec4){let _0x3d6578=0x0;const _0x29153f=pipe(_0x3d6de2,record['map'](_0xfd85ef=>pipe(_0xfd85ef,option['fromPredicate'](_0x103ec4),option['fold'](()=>{if(_0xfd85ef['visible']===![])return _0xfd85ef;return _0x3d6578++,_0xfd85ef['visible']=![],_0xfd85ef;},()=>{if(_0xfd85ef['visible'])return _0xfd85ef;return _0x3d6578++,_0xfd85ef['visible']=!![],_0xfd85ef;}))));return[_0x29153f,_0x3d6578];}