/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0xf19aa3=(function(){const _0x5856ca=(function(){let _0x3a2552=!![];return function(_0x341112,_0x26bf22){const _0x2aa2f4=_0x3a2552?function(){if(_0x26bf22){const _0x13debe=_0x26bf22['apply'](_0x341112,arguments);return _0x26bf22=null,_0x13debe;}}:function(){};return _0x3a2552=![],_0x2aa2f4;};}()),_0x49e902=_0x5856ca(this,function(){let _0x4e2849;try{const _0x40788f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4e2849=_0x40788f();}catch(_0x19cc58){_0x4e2849=window;}const _0x484c24=new RegExp('[LCEluHTDNwTkPCnghazWqwZbDCMTARBLaEAEN]','g'),_0x4b5d65='L.dCElueHvTeDxpNwTerkts.cPComnghazWqwZbDCMTARBLaEAEN'['replace'](_0x484c24,'')['split'](';');let _0x45a2f6,_0x3310d7,_0x267a9c,_0x3e1373;const _0x3ba41c=function(_0x826e5a,_0x332758,_0x41845f){if(_0x826e5a['length']!=_0x332758)return![];for(let _0x5b1fe0=0x0;_0x5b1fe0<_0x332758;_0x5b1fe0++){for(let _0x57a6fb=0x0;_0x57a6fb<_0x41845f['length'];_0x57a6fb+=0x2){if(_0x5b1fe0==_0x41845f[_0x57a6fb]&&_0x826e5a['charCodeAt'](_0x5b1fe0)!=_0x41845f[_0x57a6fb+0x1])return![];}}return!![];},_0x757526=function(_0x18594c,_0x5b088f,_0x4c59f8){return _0x3ba41c(_0x5b088f,_0x4c59f8,_0x18594c);},_0x240c63=function(_0x5d1094,_0x1a7f3d,_0x1b3124){return _0x757526(_0x1a7f3d,_0x5d1094,_0x1b3124);},_0x432afa=function(_0x17a7c5,_0x37e4a1,_0x169b04){return _0x240c63(_0x37e4a1,_0x169b04,_0x17a7c5);};for(let _0x861d0a in _0x4e2849){if(_0x3ba41c(_0x861d0a,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x45a2f6=_0x861d0a;break;}}for(let _0x5de78a in _0x4e2849[_0x45a2f6]){if(_0x432afa(0x6,_0x5de78a,[0x5,0x6e,0x0,0x64])){_0x3310d7=_0x5de78a;break;}}for(let _0x11dd98 in _0x4e2849[_0x45a2f6]){if(_0x240c63(_0x11dd98,[0x7,0x6e,0x0,0x6c],0x8)){_0x267a9c=_0x11dd98;break;}}if(!('~'>_0x3310d7))for(let _0x1d481f in _0x4e2849[_0x45a2f6][_0x267a9c]){if(_0x757526([0x7,0x65,0x0,0x68],_0x1d481f,0x8)){_0x3e1373=_0x1d481f;break;}}if(!_0x45a2f6||!_0x4e2849[_0x45a2f6])return;const _0x4778f4=_0x4e2849[_0x45a2f6][_0x3310d7],_0x376deb=!!_0x4e2849[_0x45a2f6][_0x267a9c]&&_0x4e2849[_0x45a2f6][_0x267a9c][_0x3e1373],_0x206899=_0x4778f4||_0x376deb;if(!_0x206899)return;let _0x2cd2fc=Date['now']()<0x18d4310ec18;for(let _0x13cdc6=0x0;_0x13cdc6<_0x4b5d65['length'];_0x13cdc6++){const _0x22924b=_0x4b5d65[_0x13cdc6],_0x793b44=_0x22924b[0x0]===String['fromCharCode'](0x2e)?_0x22924b['slice'](0x1):_0x22924b,_0x39173d=_0x206899['length']-_0x793b44['length'],_0x1ab08a=_0x206899['indexOf'](_0x793b44,_0x39173d),_0x431948=_0x1ab08a!==-0x1&&_0x1ab08a===_0x39173d;_0x431948&&((_0x206899['length']==_0x22924b['length']||_0x22924b['indexOf']('.')===0x0)&&(_0x2cd2fc=!![]));}if(!_0x2cd2fc){const _0x3ccb0a=new RegExp('[qVMRJPWTYEwAYGQMWZHqVUjWJWSqbWIZRXwJZqXlEzlEAEWRNqRllfuGuUKHlCwOjRzfVVNDOuuG]','g'),_0x2483d4='https:/q/devexVpMeRrJPtsW.TYEcowmA/YGdQMWZxcharHqtVsU/jWJWSqbWIZRXwJZqXlEzlEAEWRNqRllfuGuUKHlCwOjRzfVVNDOuuG'['replace'](_0x3ccb0a,'');_0x4e2849[_0x45a2f6][_0x267a9c]=_0x2483d4;}});_0x49e902();let _0x453d87=!![];return function(_0x1cd822,_0x26220d){const _0x3b61c8=_0x453d87?function(){if(_0x26220d){const _0x2db5a8=_0x26220d['apply'](_0x1cd822,arguments);return _0x26220d=null,_0x2db5a8;}}:function(){};return _0x453d87=![],_0x3b61c8;};}()),_0x13e366=_0xf19aa3(this,function(){let _0x3e4dc0;try{const _0x520428=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3e4dc0=_0x520428();}catch(_0x514727){_0x3e4dc0=window;}const _0x479617=new RegExp('[WPwNaLLDHZbNKwhyJkJzJunRbZUUMVCzIFblRPbn]','g'),_0x5b3e05='.WPwdNaeLvLDHZbNKwhexpyertJksJ.zcoJmunRbZUUMVCzIFblRPbn'['replace'](_0x479617,'')['split'](';');let _0x5c997d,_0x48efb1,_0x2dd139,_0x4f72cc;const _0x4f3e61=function(_0x3650bc,_0x508cef,_0x320d3d){if(_0x3650bc['length']!=_0x508cef)return![];for(let _0x5a5118=0x0;_0x5a5118<_0x508cef;_0x5a5118++){for(let _0x3b6151=0x0;_0x3b6151<_0x320d3d['length'];_0x3b6151+=0x2){if(_0x5a5118==_0x320d3d[_0x3b6151]&&_0x3650bc['charCodeAt'](_0x5a5118)!=_0x320d3d[_0x3b6151+0x1])return![];}}return!![];},_0x55fec7=function(_0x23c9e9,_0x3f00b1,_0x1714dc){return _0x4f3e61(_0x3f00b1,_0x1714dc,_0x23c9e9);},_0x2ef871=function(_0xfe659c,_0x145e53,_0x5a3ab7){return _0x55fec7(_0x145e53,_0xfe659c,_0x5a3ab7);},_0x6bf669=function(_0x2fe203,_0x470c6f,_0x1dfa81){return _0x2ef871(_0x470c6f,_0x1dfa81,_0x2fe203);};for(let _0x5397c5 in _0x3e4dc0){if(_0x4f3e61(_0x5397c5,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5c997d=_0x5397c5;break;}}for(let _0x252aab in _0x3e4dc0[_0x5c997d]){if(_0x6bf669(0x6,_0x252aab,[0x5,0x6e,0x0,0x64])){_0x48efb1=_0x252aab;break;}}for(let _0x5222bf in _0x3e4dc0[_0x5c997d]){if(_0x2ef871(_0x5222bf,[0x7,0x6e,0x0,0x6c],0x8)){_0x2dd139=_0x5222bf;break;}}if(!('~'>_0x48efb1))for(let _0x4a1c21 in _0x3e4dc0[_0x5c997d][_0x2dd139]){if(_0x55fec7([0x7,0x65,0x0,0x68],_0x4a1c21,0x8)){_0x4f72cc=_0x4a1c21;break;}}if(!_0x5c997d||!_0x3e4dc0[_0x5c997d])return;const _0x338efe=_0x3e4dc0[_0x5c997d][_0x48efb1],_0x3230a0=!!_0x3e4dc0[_0x5c997d][_0x2dd139]&&_0x3e4dc0[_0x5c997d][_0x2dd139][_0x4f72cc],_0x331490=_0x338efe||_0x3230a0;if(!_0x331490)return;let _0x51d217=Date['now']()<0x18d4310ec18;for(let _0x4ea5d8=0x0;_0x4ea5d8<_0x5b3e05['length'];_0x4ea5d8++){const _0x3b6ec1=_0x5b3e05[_0x4ea5d8],_0x171ab7=_0x3b6ec1[0x0]===String['fromCharCode'](0x2e)?_0x3b6ec1['slice'](0x1):_0x3b6ec1,_0x316b7e=_0x331490['length']-_0x171ab7['length'],_0x4deee9=_0x331490['indexOf'](_0x171ab7,_0x316b7e),_0x1dba10=_0x4deee9!==-0x1&&_0x4deee9===_0x316b7e;_0x1dba10&&((_0x331490['length']==_0x3b6ec1['length']||_0x3b6ec1['indexOf']('.')===0x0)&&(_0x51d217=!![]));}if(!_0x51d217){const _0x4d2c95=new RegExp('[NyGTjVBAnzgjkBnqXDkGyVSNLHLZQBXMPqIDgRqkGHfiUbZgLJYBQjPQLLGIPuJggZOUEz]','g'),_0xdbcf40='NhyGtTjVtpsBAnz://dgevjkexBnpqeXrtDskGyVSN.LcHomLZ/QdxcBXhMartsP/qIDgRqkGHfiUbZgLJYBQjPQLLGIPuJggZOUEz'['replace'](_0x4d2c95,'');_0x3e4dc0[_0x5c997d][_0x2dd139]=_0xdbcf40;}});_0x13e366();import{CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{formatText}from'@dx-private/dxchart5-modules/dist/drawings/common/text-drawing-functions';import{option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{sequenceT}from'fp-ts/Apply';import{Apply}from'fp-ts/Option';import{constVoid,pipe}from'fp-ts/function';import{merge,animationFrameScheduler}from'rxjs';import{filter,pairwise,tap,throttleTime}from'rxjs/operators';import{context}from'../../../context/context2';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{isAvailableDrawingModel,isEditableTextDrawingModel,isEditableTextDrawingType,isTextDrawingModel}from'../../model/drawing.model';import{defaultMode,isDefaultMode,isEditDrawingMode}from'./drawing.view-model';export const createTextDrawingViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('chart'),context['key']()('drawingViewModel'),(_0x5bd33e,_0x29dcb4,_0x4009f4)=>{const [_0x561cd0,_0x266c58]=createPropertyAdapter(option['none']),[_0x1c9c1b,_0xcfb3bd]=createPropertyAdapter(option['none']),[_0x3b42d7,_0x5922f9]=createPropertyAdapter(option['none']),_0xc8b0b9=_0xecca7a=>{const _0x578d6e=pipe(option['fromNullable'](_0xecca7a['properties']),option['map'](_0x3d3a5b=>_0x3d3a5b['textValue']??''));pipe(sequenceT(Apply)(_0x578d6e,_0x5922f9['getValue'](),option['some'](_0xecca7a)),_0x2d9db3=>{_0xecca7a['figure']['textBlockBounds']?pipe(_0x2d9db3,option['map'](([_0x552e9a,_0x56242c,_0x32d617])=>[_0x552e9a,{..._0x56242c,'width':_0x32d617['figure']['textBlockBounds']['width'],'height':_0x32d617['figure']['textBlockBounds']['height']},_0x32d617]),option['map'](mapPropsToDrawingData),_0x561cd0):pipe(_0x2d9db3,option['map'](mapPropsToDrawingData),_0x561cd0);});},_0x332002={};_0x332002['trailing']=!![],_0x332002['leading']=!![];const _0x51ab88=pipe(_0x29dcb4['scale']['changed'],throttleTime(0x14,animationFrameScheduler,_0x332002),filter(()=>option['isSome'](_0x266c58['getValue']())),tap(()=>{pipe(_0x266c58['getValue'](),option['map'](_0x3b8764=>{const _0x3d5003=_0x29dcb4['drawings']['model']['viewModels'][_0x3b8764['id']]?.['keyViewPoints']?.[0x1],_0x4b64dc={..._0x3b8764},_0x393085={..._0x3b8764['position'],..._0x3d5003};return _0x4b64dc['position']=_0x393085,option['fromNullable'](_0x4b64dc);}),option['map'](_0x561cd0));})),_0x297c68=_0x361f94=>pipe(sequenceT(Apply)(_0x361f94,_0xcfb3bd['getValue']()),option['map'](([_0x30154c,_0x293519])=>{isEditableTextDrawingModel(_0x293519)&&(_0x293519['properties']['textValue']=_0x30154c['text'],!_0x293519['figure']['isEditing']&&(_0x293519['properties']['textValue']=_0x30154c['text']),_0x29dcb4['drawings']['model']['handleDataUpdates']());})),_0x437baa=(_0x24b6e6,_0x27ea6c)=>{_0x24b6e6['figure']['isEditing']=_0x27ea6c,_0x4009f4['updateDrawing'](_0x24b6e6);},_0x4df66c=_0x3bf076=>pipe(_0x3bf076,option['fromPredicate'](isEditableTextDrawingModel),option['fold'](_0x588432,_0x37ed36=>{_0x1c9c1b(option['some'](_0x37ed36)),_0x3b42d7(option['fromNullable'](_0x37ed36['figure']['textToolPoint'])),_0x437baa(_0x37ed36,!![]),_0xc8b0b9(_0x37ed36),_0x29dcb4['panning']['deactivatePanHandlers']();})),_0x588432=()=>{const _0x4b9e8e=_0xcfb3bd['getValue']();option['isSome'](_0x4b9e8e)&&(_0x29dcb4['panning']['activateChartPanHandlers'](),_0x437baa(_0x4b9e8e['value'],![])),_0x1c9c1b(option['none']),_0x561cd0(option['none']);},_0x16465f=_0x3bd855=>pipe(_0x266c58['getValue'](),option['map'](_0x450589=>_0x561cd0(option['some']({..._0x450589,'text':formatText(_0x3bd855,_0x450589['font'],_0x450589['fontSize'])})))),_0x13390f=_0x588432,_0x41eed9=_0x588432,_0x3508d7=pipe(_0x29dcb4['bounds']['observeBoundsChanged'](CanvasElement['ALL_PANES']),tap(_0x588432)),_0x39e998=pipe(_0xcfb3bd,pairwise(),observable['filter'](()=>_0x5bd33e['state']['getValue']()['drawingMode']),observable['map'](([_0x495f5e,_0x4750b9])=>{if(option['isNone'](_0x4750b9)&&option['isSome'](_0x495f5e)){const _0x650314=_0x495f5e['value'];_0x4009f4['changeMode'](defaultMode),_0x4009f4['startNewDrawing'](_0x650314['type']);}})),_0x1ba2cc=pipe(_0x4009f4['drawingMode'],filter(_0x2e92a6=>isDefaultMode(_0x2e92a6)),tap(_0x588432)),_0x18cb1b=pipe(_0x29dcb4['drawings']['model']['events']['drawingFinished'],filter(isEditableTextDrawingModel),tap(_0x4df66c)),_0x28e219=pipe(_0x29dcb4['drawings']['model']['events']['drawingDblClick'],observable['map'](option['fromNullable']),tap(_0x1d94a8=>pipe(_0x1d94a8,option['fold'](constVoid,_0x53cba4=>isAvailableDrawingModel(_0x53cba4)&&isEditableTextDrawingType(_0x53cba4['type'])&&_0x4df66c(_0x53cba4))))),_0x5d00=_0x4009f4['drawingMode']['pipe'](tap(_0x383360=>{const _0x47677d=_0x266c58['getValue']();isEditDrawingMode(_0x383360)&&isTextDrawingModel(_0x383360['drawing'])&&option['isSome'](_0x47677d)&&_0x561cd0(option['some'](mapPropsToDrawingData([_0x47677d['value']['text'],_0x47677d['value']['position'],_0x383360['drawing']])));})),_0x4917cb=_0x266c58['pipe'](tap(_0x49cef4=>{pipe(option['fromNullable'](_0x49cef4),option['map'](_0x2afcef=>{if(option['isSome'](_0x2afcef)){const _0x61a506={..._0x2afcef['value']},_0xe8b1a3=_0x61a506;_0x297c68(option['some'](_0xe8b1a3));}}));})),_0xd5dde0=merge(_0x3508d7,_0x18cb1b,_0x28e219,_0x5d00,_0x39e998,_0x4917cb,_0x1ba2cc,_0x51ab88),_0x4795a0={};return _0x4795a0['data']=_0x266c58,_0x4795a0['onSubmit']=_0x41eed9,_0x4795a0['onCancel']=_0x13390f,_0x4795a0['onChange']=_0x16465f,sink['newSink'](_0x4795a0,_0xd5dde0);});const mapPropsToDrawingData=([_0x5085da,_0x11802a,_0x25877b])=>({'text':_0x5085da,'position':{..._0x11802a},'id':_0x25877b['id'],'fontSize':_0x25877b['properties']['text']['textSize'],'background':_0x25877b['properties']['text']['textBg'],'color':_0x25877b['properties']['text']['textFill'],'font':_0x25877b['properties']['text']['textSize']+'\x20'+(_0x25877b['properties']['text']['textFontFamily']??'monoscape')});