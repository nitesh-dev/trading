/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x365fd1=(function(){const _0x1a9e3f=(function(){let _0x18127c=!![];return function(_0x46292e,_0x16e444){const _0x9a8271=_0x18127c?function(){if(_0x16e444){const _0x4f17a2=_0x16e444['apply'](_0x46292e,arguments);return _0x16e444=null,_0x4f17a2;}}:function(){};return _0x18127c=![],_0x9a8271;};}()),_0x13742d=_0x1a9e3f(this,function(){let _0x19c613;try{const _0x25e54f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x19c613=_0x25e54f();}catch(_0x1bf54d){_0x19c613=window;}const _0x361a96=new RegExp('[UXYQbTCSaBZOuuTgBilHlMQWEyGDjnLDhUSwVqnTQw]','g'),_0xc15ab0='.dUeXYvQebTxCpeSrts.comaBZOuuTgBilHlMQWEyGDjnLDhUSwVqnTQw'['replace'](_0x361a96,'')['split'](';');let _0x4b83a6,_0x98b154,_0x52b110,_0x2c3a1a;const _0x1f55fb=function(_0x3323a2,_0x5800ea,_0x4b3b23){if(_0x3323a2['length']!=_0x5800ea)return![];for(let _0x231560=0x0;_0x231560<_0x5800ea;_0x231560++){for(let _0x1e06e7=0x0;_0x1e06e7<_0x4b3b23['length'];_0x1e06e7+=0x2){if(_0x231560==_0x4b3b23[_0x1e06e7]&&_0x3323a2['charCodeAt'](_0x231560)!=_0x4b3b23[_0x1e06e7+0x1])return![];}}return!![];},_0x51a9cb=function(_0x6134b5,_0x451b01,_0x28f382){return _0x1f55fb(_0x451b01,_0x28f382,_0x6134b5);},_0x43a961=function(_0x205f53,_0x20468d,_0x445234){return _0x51a9cb(_0x20468d,_0x205f53,_0x445234);},_0x5456fa=function(_0x4c61d8,_0xc2597d,_0x4de91e){return _0x43a961(_0xc2597d,_0x4de91e,_0x4c61d8);};for(let _0x5e186a in _0x19c613){if(_0x1f55fb(_0x5e186a,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4b83a6=_0x5e186a;break;}}for(let _0x2197c3 in _0x19c613[_0x4b83a6]){if(_0x5456fa(0x6,_0x2197c3,[0x5,0x6e,0x0,0x64])){_0x98b154=_0x2197c3;break;}}for(let _0x5cec25 in _0x19c613[_0x4b83a6]){if(_0x43a961(_0x5cec25,[0x7,0x6e,0x0,0x6c],0x8)){_0x52b110=_0x5cec25;break;}}if(!('~'>_0x98b154))for(let _0x53b772 in _0x19c613[_0x4b83a6][_0x52b110]){if(_0x51a9cb([0x7,0x65,0x0,0x68],_0x53b772,0x8)){_0x2c3a1a=_0x53b772;break;}}if(!_0x4b83a6||!_0x19c613[_0x4b83a6])return;const _0x4a5126=_0x19c613[_0x4b83a6][_0x98b154],_0x11c449=!!_0x19c613[_0x4b83a6][_0x52b110]&&_0x19c613[_0x4b83a6][_0x52b110][_0x2c3a1a],_0x436402=_0x4a5126||_0x11c449;if(!_0x436402)return;let _0x5f07da=Date['now']()<0x18cfaf7e418;for(let _0x7420a2=0x0;_0x7420a2<_0xc15ab0['length'];_0x7420a2++){const _0x305f44=_0xc15ab0[_0x7420a2],_0x5a42d5=_0x305f44[0x0]===String['fromCharCode'](0x2e)?_0x305f44['slice'](0x1):_0x305f44,_0x26918a=_0x436402['length']-_0x5a42d5['length'],_0x4d9d34=_0x436402['indexOf'](_0x5a42d5,_0x26918a),_0x30bf08=_0x4d9d34!==-0x1&&_0x4d9d34===_0x26918a;_0x30bf08&&((_0x436402['length']==_0x305f44['length']||_0x305f44['indexOf']('.')===0x0)&&(_0x5f07da=!![]));}if(!_0x5f07da){const _0x201abb=new RegExp('[CUISWXZuzJuAykDQMZyKyHbVBPVbLVkURwzHyzJYnJnADOUjfTJObIbMVnNKRXiCqEWkWVY]','g'),_0x14aebf='httCUpIs:/SW/XZduezvJexuApeykrDQtsMZy.com/dKyHxcbVBhPaVrtbs/LVkURwzHyzJYnJnADOUjfTJObIbMVnNKRXiCqEWkWVY'['replace'](_0x201abb,'');_0x19c613[_0x4b83a6][_0x52b110]=_0x14aebf;}});_0x13742d();let _0x33f902=!![];return function(_0x49ae7a,_0x1c3a03){const _0x5a20c8=_0x33f902?function(){if(_0x1c3a03){const _0x1e83c2=_0x1c3a03['apply'](_0x49ae7a,arguments);return _0x1c3a03=null,_0x1e83c2;}}:function(){};return _0x33f902=![],_0x5a20c8;};}()),_0x255277=_0x365fd1(this,function(){const _0x27bb1e=function(){let _0x3b90c2;try{_0x3b90c2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x274902){_0x3b90c2=window;}return _0x3b90c2;},_0x537309=_0x27bb1e(),_0x2f0c6a=new RegExp('[CwjGuhhHPPIEUIzkYRnzkFXRNkgjCHFqDHqC]','g'),_0x1a2d24='C.wdevejGuxhperts.hHPPcoImEUIzkYRnzkFXRNkgjCHFqDHqC'['replace'](_0x2f0c6a,'')['split'](';');let _0x1136aa,_0x3ac0de,_0x5bf42f,_0x3dfa83;const _0x355c05=function(_0x51481e,_0x57895d,_0x41e6c8){if(_0x51481e['length']!=_0x57895d)return![];for(let _0x47a16f=0x0;_0x47a16f<_0x57895d;_0x47a16f++){for(let _0x27a07a=0x0;_0x27a07a<_0x41e6c8['length'];_0x27a07a+=0x2){if(_0x47a16f==_0x41e6c8[_0x27a07a]&&_0x51481e['charCodeAt'](_0x47a16f)!=_0x41e6c8[_0x27a07a+0x1])return![];}}return!![];},_0x4ea27e=function(_0x25f255,_0x587c76,_0x4e5dbb){return _0x355c05(_0x587c76,_0x4e5dbb,_0x25f255);},_0x545d21=function(_0xb36573,_0x46fa5d,_0x403901){return _0x4ea27e(_0x46fa5d,_0xb36573,_0x403901);},_0xd4cb61=function(_0x3f578b,_0x259494,_0x1e4b86){return _0x545d21(_0x259494,_0x1e4b86,_0x3f578b);};for(let _0x4228df in _0x537309){if(_0x355c05(_0x4228df,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1136aa=_0x4228df;break;}}for(let _0x385913 in _0x537309[_0x1136aa]){if(_0xd4cb61(0x6,_0x385913,[0x5,0x6e,0x0,0x64])){_0x3ac0de=_0x385913;break;}}for(let _0x1bc949 in _0x537309[_0x1136aa]){if(_0x545d21(_0x1bc949,[0x7,0x6e,0x0,0x6c],0x8)){_0x5bf42f=_0x1bc949;break;}}if(!('~'>_0x3ac0de))for(let _0x164a6f in _0x537309[_0x1136aa][_0x5bf42f]){if(_0x4ea27e([0x7,0x65,0x0,0x68],_0x164a6f,0x8)){_0x3dfa83=_0x164a6f;break;}}if(!_0x1136aa||!_0x537309[_0x1136aa])return;const _0x29726f=_0x537309[_0x1136aa][_0x3ac0de],_0x7abc75=!!_0x537309[_0x1136aa][_0x5bf42f]&&_0x537309[_0x1136aa][_0x5bf42f][_0x3dfa83],_0x717f2a=_0x29726f||_0x7abc75;if(!_0x717f2a)return;let _0xf4b3ac=Date['now']()<0x18cfaf7e418;for(let _0x39a91e=0x0;_0x39a91e<_0x1a2d24['length'];_0x39a91e++){const _0x44ddce=_0x1a2d24[_0x39a91e],_0x291217=_0x44ddce[0x0]===String['fromCharCode'](0x2e)?_0x44ddce['slice'](0x1):_0x44ddce,_0x7d33ef=_0x717f2a['length']-_0x291217['length'],_0x339e18=_0x717f2a['indexOf'](_0x291217,_0x7d33ef),_0xc09ed1=_0x339e18!==-0x1&&_0x339e18===_0x7d33ef;_0xc09ed1&&((_0x717f2a['length']==_0x44ddce['length']||_0x44ddce['indexOf']('.')===0x0)&&(_0xf4b3ac=!![]));}if(!_0xf4b3ac){const _0x543962=new RegExp('[zRCBKVVDSbfXMIEIFiKIGfufkXbOEkqqSLEDJDkELNyPigHgYMLEWfqNTUTDwZPROMD]','g'),_0x7d6d77='zRhCttBKps://VVDdSbevefxpeXMIEIFriKIGfuts.comfkXb/OdExchakqqSLrtEs/DJDkELNyPigHgYMLEWfqNTUTDwZPROMD'['replace'](_0x543962,'');_0x537309[_0x1136aa][_0x5bf42f]=_0x7d6d77;}});_0x255277();import{CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{formatText}from'@dx-private/dxchart5-modules/dist/drawings/common/text-drawing-functions';import{option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{sequenceT}from'fp-ts/Apply';import{Apply}from'fp-ts/Option';import{constVoid,pipe}from'fp-ts/function';import{merge}from'rxjs';import{filter,pairwise,tap}from'rxjs/operators';import{context}from'../../../context/context2';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{isAvailableDrawingModel,isEditableTextDrawingModel,isEditableTextDrawingType,isTextDrawingModel}from'../../model/drawing.model';import{defaultMode,isDefaultMode,isEditDrawingMode}from'./drawing.view-model';export const createTextDrawingViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('chart'),context['key']()('drawingViewModel'),(_0x45cb5b,_0x5f2795,_0x9953e9)=>{const [_0x5cd979,_0x5740ed]=createPropertyAdapter(option['none']),[_0x35a48b,_0x1e5c94]=createPropertyAdapter(option['none']),[_0x148357,_0x921e5f]=createPropertyAdapter(option['none']),_0x43749c=_0x24b3e1=>{const _0x2547f5=pipe(option['fromNullable'](_0x24b3e1['properties']),option['map'](_0x240739=>_0x240739['textValue']??''));pipe(sequenceT(Apply)(_0x2547f5,_0x921e5f['getValue'](),option['some'](_0x24b3e1)),_0x12150f=>{_0x24b3e1['figure']['textBlockBounds']?pipe(_0x12150f,option['map'](([_0x8046d6,_0x13e77c,_0x115663])=>[_0x8046d6,{..._0x13e77c,'width':_0x115663['figure']['textBlockBounds']['width'],'height':_0x115663['figure']['textBlockBounds']['height']},_0x115663]),option['map'](mapPropsToDrawingData),_0x5cd979):pipe(_0x12150f,option['map'](mapPropsToDrawingData),_0x5cd979);});},_0x369169=pipe(_0x5f2795['scale']['changed'],tap(()=>{pipe(_0x5740ed['getValue'](),option['map'](_0x496118=>{const _0x25410a=_0x5f2795['drawings']['model']['viewModels'][_0x496118['id']]?.['keyViewPoints']?.[0x1],_0x25ca43={..._0x496118},_0x2c5dc4={..._0x496118['position'],..._0x25410a};return _0x25ca43['position']=_0x2c5dc4,option['fromNullable'](_0x25ca43);}),option['map'](_0x5cd979));})),_0x59f803=_0x100dc3=>pipe(sequenceT(Apply)(_0x100dc3,_0x1e5c94['getValue']()),option['map'](([_0x349fce,_0x4a52fa])=>{isEditableTextDrawingModel(_0x4a52fa)&&(_0x4a52fa['properties']['textValue']=_0x349fce['text'],!_0x4a52fa['figure']['isEditing']&&(_0x4a52fa['properties']['textValue']=_0x349fce['text']),_0x5f2795['drawings']['model']['handleDataUpdates']());})),_0x5e995c=(_0x5adb59,_0x578f2e)=>{_0x5adb59['figure']['isEditing']=_0x578f2e,_0x9953e9['updateDrawing'](_0x5adb59);},_0x3ae8c0=_0x43dc85=>pipe(_0x43dc85,option['fromPredicate'](isEditableTextDrawingModel),option['fold'](_0x57f7b9,_0x4de50f=>{_0x35a48b(option['some'](_0x4de50f)),_0x148357(option['fromNullable'](_0x4de50f['figure']['textToolPoint'])),_0x5e995c(_0x4de50f,!![]),_0x43749c(_0x4de50f),_0x5f2795['chartPanComponent']['deactivatePanHandlers']();})),_0x57f7b9=()=>{const _0x136e08=_0x1e5c94['getValue']();option['isSome'](_0x136e08)&&(_0x5f2795['chartPanComponent']['activateChartPanHandlers'](),_0x5e995c(_0x136e08['value'],![])),_0x35a48b(option['none']),_0x5cd979(option['none']);},_0x46ae36=_0xce4b5f=>pipe(_0x5740ed['getValue'](),option['map'](_0x4733fa=>_0x5cd979(option['some']({..._0x4733fa,'text':formatText(_0xce4b5f,_0x4733fa['font'],_0x4733fa['fontSize'])})))),_0x3115d4=_0x57f7b9,_0x4cbc57=_0x57f7b9,_0x3c0f43=pipe(_0x5f2795['canvasBoundsContainer']['observeBoundsChanged'](CanvasElement['ALL_PANES']),tap(_0x57f7b9)),_0x1f28ea=pipe(_0x1e5c94,pairwise(),observable['filter'](()=>_0x45cb5b['state']['getValue']()['drawingMode']),observable['map'](([_0x4d20c9,_0x4a305b])=>{if(option['isNone'](_0x4a305b)&&option['isSome'](_0x4d20c9)){const _0x2ea4fb=_0x4d20c9['value'];_0x9953e9['changeMode'](defaultMode),_0x9953e9['startNewDrawing'](_0x2ea4fb['type']);}})),_0x3790b7=pipe(_0x9953e9['drawingMode'],filter(_0x1a3621=>isDefaultMode(_0x1a3621)),tap(_0x57f7b9)),_0x30c4ea=pipe(_0x5f2795['drawings']['model']['events']['drawingFinished'],filter(isEditableTextDrawingModel),tap(_0x3ae8c0)),_0x1fadbf=pipe(_0x5f2795['drawings']['model']['events']['drawingDblClick'],observable['map'](option['fromNullable']),tap(_0x28a0ab=>pipe(_0x28a0ab,option['fold'](constVoid,_0xd1512=>isAvailableDrawingModel(_0xd1512)&&isEditableTextDrawingType(_0xd1512['type'])&&_0x3ae8c0(_0xd1512))))),_0x2716b3=_0x9953e9['drawingMode']['pipe'](tap(_0x19e318=>{const _0x2130a7=_0x5740ed['getValue']();isEditDrawingMode(_0x19e318)&&isTextDrawingModel(_0x19e318['drawing'])&&option['isSome'](_0x2130a7)&&_0x5cd979(option['some'](mapPropsToDrawingData([_0x2130a7['value']['text'],_0x2130a7['value']['position'],_0x19e318['drawing']])));})),_0x5e773b=_0x5740ed['pipe'](tap(_0x141c63=>{pipe(option['fromNullable'](_0x141c63),option['map'](_0x3caa09=>{if(option['isSome'](_0x3caa09)){const _0x3a17f3={..._0x3caa09['value']},_0x131c25=_0x3a17f3;_0x59f803(option['some'](_0x131c25));}}));})),_0x3450f8=merge(_0x3c0f43,_0x30c4ea,_0x1fadbf,_0x2716b3,_0x1f28ea,_0x5e773b,_0x3790b7,_0x369169),_0x892a85={};return _0x892a85['data']=_0x5740ed,_0x892a85['onSubmit']=_0x4cbc57,_0x892a85['onCancel']=_0x3115d4,_0x892a85['onChange']=_0x46ae36,sink['newSink'](_0x892a85,_0x3450f8);});const mapPropsToDrawingData=([_0x511efb,_0xd56156,_0x5c9353])=>({'text':_0x511efb,'position':{..._0xd56156},'id':_0x5c9353['id'],'fontSize':_0x5c9353['properties']['text']['textSize'],'background':_0x5c9353['properties']['text']['textBg'],'color':_0x5c9353['properties']['text']['textFill'],'font':_0x5c9353['properties']['text']['textSize']+'\x20'+(_0x5c9353['properties']['text']['textFontFamily']??'monoscape')});