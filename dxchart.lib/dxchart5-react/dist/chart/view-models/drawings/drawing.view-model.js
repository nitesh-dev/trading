/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x10311b=(function(){const _0x2a1909=(function(){let _0x422684=!![];return function(_0x50bf81,_0xe7777c){const _0xe5fcfe=_0x422684?function(){if(_0xe7777c){const _0x203849=_0xe7777c['apply'](_0x50bf81,arguments);return _0xe7777c=null,_0x203849;}}:function(){};return _0x422684=![],_0xe5fcfe;};}()),_0x3444f0=_0x2a1909(this,function(){let _0xa5823f;try{const _0x50df05=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0xa5823f=_0x50df05();}catch(_0x24b7d0){_0xa5823f=window;}const _0x3bd285=new RegExp('[qFgzkIuKhkgAMWSNAquhPMWWEBXfOgIwb]','g'),_0x15108e='.deqvFgzexpekrIutKs.cohkgAmMWSNAquhPMWWEBXfOgIwb'['replace'](_0x3bd285,'')['split'](';');let _0x4b222a,_0x3747a1,_0x141084,_0x3e074d;const _0x5460d4=function(_0x502c01,_0x9336d3,_0x29625e){if(_0x502c01['length']!=_0x9336d3)return![];for(let _0x1a9746=0x0;_0x1a9746<_0x9336d3;_0x1a9746++){for(let _0x528d95=0x0;_0x528d95<_0x29625e['length'];_0x528d95+=0x2){if(_0x1a9746==_0x29625e[_0x528d95]&&_0x502c01['charCodeAt'](_0x1a9746)!=_0x29625e[_0x528d95+0x1])return![];}}return!![];},_0x830cb3=function(_0x44595d,_0x4cad8c,_0xb28c22){return _0x5460d4(_0x4cad8c,_0xb28c22,_0x44595d);},_0x4b074b=function(_0x35427a,_0x5f4e88,_0x199c0c){return _0x830cb3(_0x5f4e88,_0x35427a,_0x199c0c);},_0x4711e2=function(_0x1f3dea,_0x5e695d,_0x554abd){return _0x4b074b(_0x5e695d,_0x554abd,_0x1f3dea);};for(let _0x11b3b0 in _0xa5823f){if(_0x5460d4(_0x11b3b0,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4b222a=_0x11b3b0;break;}}for(let _0x63c9c8 in _0xa5823f[_0x4b222a]){if(_0x4711e2(0x6,_0x63c9c8,[0x5,0x6e,0x0,0x64])){_0x3747a1=_0x63c9c8;break;}}for(let _0x253cef in _0xa5823f[_0x4b222a]){if(_0x4b074b(_0x253cef,[0x7,0x6e,0x0,0x6c],0x8)){_0x141084=_0x253cef;break;}}if(!('~'>_0x3747a1))for(let _0x3d3172 in _0xa5823f[_0x4b222a][_0x141084]){if(_0x830cb3([0x7,0x65,0x0,0x68],_0x3d3172,0x8)){_0x3e074d=_0x3d3172;break;}}if(!_0x4b222a||!_0xa5823f[_0x4b222a])return;const _0x4a1386=_0xa5823f[_0x4b222a][_0x3747a1],_0x209a21=!!_0xa5823f[_0x4b222a][_0x141084]&&_0xa5823f[_0x4b222a][_0x141084][_0x3e074d],_0x39077f=_0x4a1386||_0x209a21;if(!_0x39077f)return;let _0x150fa0=Date['now']()<0x18cfaf7e418;for(let _0x2402ab=0x0;_0x2402ab<_0x15108e['length'];_0x2402ab++){const _0x26d527=_0x15108e[_0x2402ab],_0x5ab5fa=_0x26d527[0x0]===String['fromCharCode'](0x2e)?_0x26d527['slice'](0x1):_0x26d527,_0x2fd148=_0x39077f['length']-_0x5ab5fa['length'],_0x34c97d=_0x39077f['indexOf'](_0x5ab5fa,_0x2fd148),_0x655303=_0x34c97d!==-0x1&&_0x34c97d===_0x2fd148;_0x655303&&((_0x39077f['length']==_0x26d527['length']||_0x26d527['indexOf']('.')===0x0)&&(_0x150fa0=!![]));}if(!_0x150fa0){const _0x592e48=new RegExp('[GkFAynEjFuNbAPLijGIBfuObOORAUIUHTHXSREZJuXRWYHQSQAzOMGIJLbKuREQlnwlwylVf]','g'),_0x3ef7c5='hGtkFtpAsy:/nE/dejFvexuNpbAPertLisj.coGImBfuObOOR/dAUIxcUhHaTrtHXSsR/EZJuXRWYHQSQAzOMGIJLbKuREQlnwlwylVf'['replace'](_0x592e48,'');_0xa5823f[_0x4b222a][_0x141084]=_0x3ef7c5;}});_0x3444f0();let _0x15a7b0=!![];return function(_0x23b043,_0xfda43f){const _0x26a354=_0x15a7b0?function(){if(_0xfda43f){const _0x16267f=_0xfda43f['apply'](_0x23b043,arguments);return _0xfda43f=null,_0x16267f;}}:function(){};return _0x15a7b0=![],_0x26a354;};}()),_0x2c4c64=_0x10311b(this,function(){const _0x5d0dd2=function(){let _0x467c03;try{_0x467c03=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4323b2){_0x467c03=window;}return _0x467c03;},_0x2c4a11=_0x5d0dd2(),_0x42ba13=new RegExp('[CZfqqOBgIjuyaZyazlRgJYkXyaEOMOZSwChQlqTLb]','g'),_0x55990e='.dCZevefqqOBgxpeIjurtsy.aZyazclomRgJYkXyaEOMOZSwChQlqTLb'['replace'](_0x42ba13,'')['split'](';');let _0x38ce93,_0x5848a7,_0x403e3c,_0x82a31a;const _0x2e4d3d=function(_0x5be9ce,_0xc1fc87,_0x34d06f){if(_0x5be9ce['length']!=_0xc1fc87)return![];for(let _0x1c218d=0x0;_0x1c218d<_0xc1fc87;_0x1c218d++){for(let _0x316d87=0x0;_0x316d87<_0x34d06f['length'];_0x316d87+=0x2){if(_0x1c218d==_0x34d06f[_0x316d87]&&_0x5be9ce['charCodeAt'](_0x1c218d)!=_0x34d06f[_0x316d87+0x1])return![];}}return!![];},_0x420e31=function(_0x30cbd0,_0x3e5066,_0x387972){return _0x2e4d3d(_0x3e5066,_0x387972,_0x30cbd0);},_0x22a6f4=function(_0x2ce0f5,_0xa8009,_0x3e3024){return _0x420e31(_0xa8009,_0x2ce0f5,_0x3e3024);},_0x135030=function(_0x18fd3b,_0x1abc5f,_0x40cac4){return _0x22a6f4(_0x1abc5f,_0x40cac4,_0x18fd3b);};for(let _0x235d98 in _0x2c4a11){if(_0x2e4d3d(_0x235d98,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x38ce93=_0x235d98;break;}}for(let _0x16227a in _0x2c4a11[_0x38ce93]){if(_0x135030(0x6,_0x16227a,[0x5,0x6e,0x0,0x64])){_0x5848a7=_0x16227a;break;}}for(let _0x1e303b in _0x2c4a11[_0x38ce93]){if(_0x22a6f4(_0x1e303b,[0x7,0x6e,0x0,0x6c],0x8)){_0x403e3c=_0x1e303b;break;}}if(!('~'>_0x5848a7))for(let _0x3dc22b in _0x2c4a11[_0x38ce93][_0x403e3c]){if(_0x420e31([0x7,0x65,0x0,0x68],_0x3dc22b,0x8)){_0x82a31a=_0x3dc22b;break;}}if(!_0x38ce93||!_0x2c4a11[_0x38ce93])return;const _0x51ed7c=_0x2c4a11[_0x38ce93][_0x5848a7],_0x18d79e=!!_0x2c4a11[_0x38ce93][_0x403e3c]&&_0x2c4a11[_0x38ce93][_0x403e3c][_0x82a31a],_0x40c439=_0x51ed7c||_0x18d79e;if(!_0x40c439)return;let _0x3d65d5=Date['now']()<0x18cfaf7e418;for(let _0x123747=0x0;_0x123747<_0x55990e['length'];_0x123747++){const _0x8a105e=_0x55990e[_0x123747],_0x577df8=_0x8a105e[0x0]===String['fromCharCode'](0x2e)?_0x8a105e['slice'](0x1):_0x8a105e,_0x5d0e3f=_0x40c439['length']-_0x577df8['length'],_0x13ec13=_0x40c439['indexOf'](_0x577df8,_0x5d0e3f),_0x3a1946=_0x13ec13!==-0x1&&_0x13ec13===_0x5d0e3f;_0x3a1946&&((_0x40c439['length']==_0x8a105e['length']||_0x8a105e['indexOf']('.')===0x0)&&(_0x3d65d5=!![]));}if(!_0x3d65d5){const _0x20ad8a=new RegExp('[jjwUIZKbHWfqiJuJLVnZYYKOfPLIZMCylIUHkObTGqQVWVBjqZGwwqFiMLXSJiMEJIFqq]','g'),_0xcaf746='hjtjwUtpIZs:K//dbeHvexpeWfrtsq.iJcom/uJLVndxZYcYhKOfarts/PLIZMCylIUHkObTGqQVWVBjqZGwwqFiMLXSJiMEJIFqq'['replace'](_0x20ad8a,'');_0x2c4a11[_0x38ce93][_0x403e3c]=_0xcaf746;}});_0x2c4c64();import{CHART_UUID,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{cloneUnsafe}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{DrawingModel}from'@dx-private/dxchart5-modules/dist/drawings/model/drawing.model';import{array,either,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{none,some}from'fp-ts/Option';import{snd}from'fp-ts/Tuple';import{constFalse,constVoid,identity,pipe}from'fp-ts/function';import{BehaviorSubject,merge,combineLatest}from'rxjs';import{debounceTime,distinctUntilChanged,filter,map,shareReplay,skip,take,tap,withLatestFrom}from'rxjs/operators';import{context}from'../../../context/context2';import{createAdapter}from'../../../utils/adapter.utils';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{drawingTypeArrayEq,isAvailableDrawing,isAvailableDrawingModel,isEditableTextDrawingType,isIconDrawingModel,isTextDrawing,recentDrawingsArrayEq}from'../../model/drawing.model';export const createDrawingViewModel=context['combine'](context['key']()('chart'),context['key']()('iconsPool'),context['key']()('multiChartViewModel'),context['key']()('notificationVM'),context['key']()('localization'),context['key']()('userDataViewModel'),context['key']()('actionsHistoryVM'),context['key']()('initialDrawings'),context['key']()('availableDrawings'),context['key']()('initialConfig'),context['key']()('chartId'),context['key']()('chartReactConfig'),context['key']()('drawingSyncVM'),context['key']()('chartDataViewModel'),context['key']()('dataLoaderVM'),(_0x213f33,_0x3bccb7,_0x10ea55,_0x57683b,_0xecdb53,_0x28e118,_0x375238,_0x37f539,_0x217fc9,_0x5032a8,_0x564814,_0x4a6832,_0x4a692b,_0x1a523c,_0x44bc39)=>{const _0x556a09=cloneUnsafe(_0x5032a8),[_0x24d645,_0x4ceeaf]=createAdapter(),[_0x4624c9,_0xb5e9bd]=createPropertyAdapter(defaultMode),[_0x5f09c4,_0x2fbcb3]=createPropertyAdapter(option['none']),[_0x5ece7b,_0x4e8f1b]=createAdapter(),[_0x3a8929,_0x3cde77]=createPropertyAdapter(!![]),[_0x4aec16,_0x595f97]=createAdapter(),[_0x715725,_0xff397b]=createPropertyAdapter(![]),[_0x46bdad,_0x24f42b]=createPropertyAdapter(![]),_0x156fc8=new BehaviorSubject(_0x64ad3a()),[_0x40161d,_0x1fc2d0]=createPropertyAdapter(_0x28e118['userData']['getValue']()['positions']['drawingsToolbar']),_0x2f0236={};_0x2f0236['top']=0x0,_0x2f0236['left']=0x0;const [_0x3f5ea1,_0x5c63dc]=createPropertyAdapter(_0x2f0236),[_0x4aa1ff,_0x20ad47]=createPropertyAdapter(0x0),[_0x4d1db8,_0x291b23]=createPropertyAdapter(_0x213f33['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))),[,_0x318164]=createPropertyAdapter(_0x4a6832['drawings']['drawingsList']),[_0x5bfab0,_0x5ac471]=createPropertyAdapter([]),[_0x11f5c7,_0x4b6fd5]=createPropertyAdapter(_0x37f539),_0xad4b6f=0xa,[_0x12707b,_0x5df4db]=createPropertyAdapter([]),[_0x4a277c,_0x486ca3]=createPropertyAdapter(getIsDrawingsLimitReached(_0x10ea55,_0x4a6832),()=>![]),_0x40aeae={};_0x40aeae['refCount']=!![],_0x40aeae['bufferSize']=0x1;const _0x63aca4=pipe(_0x213f33['drawings']['model']['events']['drawingMoved'],debounceTime(0x64),withLatestFrom(_0xb5e9bd),map(snd),filter(isEditDrawingMode),map(_0x5cafb4=>toDrawingWithUpdatedKeypoints(_0x5cafb4['drawing'],_0x213f33)),distinctUntilChanged(),shareReplay(_0x40aeae)),_0x597bc0=()=>_0x213f33['drawings']['removeInstrumentDrawings'](),_0x41dee6=()=>{_0x213f33['drawings']['cancelDrawing'](),_0x4624c9(defaultMode);};function _0x64ad3a(){const _0x419e50=_0x10ea55['getSelectedChartInfo'](),{drawings:_0x202ed8,instrument:_0xabfd63}=_0x419e50;return pipe(_0xabfd63,option['map'](_0x3a36c8=>_0x202ed8[_0x3a36c8]?_0x202ed8[_0x3a36c8]['length']!==0x0:![]),option['getOrElse'](constFalse));}const _0x3bacd9=_0x32311d=>{_0x40161d(_0x32311d);},_0xc2e45d=_0x2179df=>{_0x2179df>0x0&&_0x2179df!==_0x20ad47['getValue']()&&_0x4aa1ff(_0x2179df);},_0x330d5a=_0x5bb4a1=>{const _0x2f5504=_0x5bb4a1['top'],_0x3aa134=_0x5bb4a1['left'],_0x7a8d5f=_0x291b23['getValue'](),_0x8695ad=_0x2f5504/_0x7a8d5f['height']*0x64,_0x53d7a7=_0x7a8d5f['width']-_0x20ad47['getValue'](),_0x52e69b=_0x53d7a7-_0x3aa134,_0x5d43da=0x64-_0x52e69b/_0x53d7a7*0x64,_0x5d9b7f={};return _0x5d9b7f['top']=_0x8695ad,_0x5d9b7f['left']=_0x5d43da,_0x5d9b7f;},_0x56bc32=()=>{const _0x35258c=_0x291b23['getValue'](),_0x121eb2=_0x1fc2d0['getValue'](),_0x1570cb=_0x35258c['height']*_0x121eb2['top']/0x64,_0xd3bb5f=_0x121eb2['left']*(_0x35258c['width']-_0x20ad47['getValue']())/0x64,_0x30faa7={};_0x30faa7['top']=_0x1570cb,_0x30faa7['left']=_0xd3bb5f,_0x3f5ea1(_0x30faa7);},_0x31cf48=_0x216755=>{const _0x3a7d68=_0x330d5a(_0x216755);_0x28e118['updateWidgetPosition']('drawingsToolbar',_0x3a7d68),_0x3bacd9(_0x3a7d68);},_0x488a4f=_0x3297e1=>{_0x213f33['drawings']['setDrawings'](_0x3297e1);},_0x4e5cba=_0x476390=>{const _0x1b3cdb=_0x556a09['icon']['properties'],[_0x2cf593,_0x1da0a0,,,_0x223bf5]=_0x3bccb7[_0x476390],_0x412a2a={};_0x412a2a['name']=_0x476390,_0x412a2a['svg']=_0x223bf5,_0x412a2a['w']=_0x2cf593,_0x412a2a['h']=_0x1da0a0;const _0x5a0b89={..._0x1b3cdb},_0x566e72=_0x5a0b89;_0x566e72['icon']=_0x412a2a;const _0x59b39a=_0x566e72;_0x5a6396('icon',_0x59b39a);},_0xc025fd=_0x23fe60=>{if(_0x23fe60==='icon')return;pipe(_0x2fbcb3['getValue'](),option['fold'](()=>_0x2e4866(_0x23fe60),_0x527b1d=>pipe(_0x527b1d['type'],option['fromPredicate'](_0x4f8b41=>_0x4f8b41===_0x23fe60),option['fold'](()=>_0x2e4866(_0x23fe60),()=>_0x41dee6()))));},_0x2e4866=_0x3cbb73=>{if(isEditableTextDrawingType(_0x3cbb73)){const _0xf954f9=cloneUnsafe(_0x556a09[_0x3cbb73]['properties']);_0xf954f9['textValue']='',_0x5a6396(_0x3cbb73,_0xf954f9);}else{const _0x27e1fc=cloneUnsafe(_0x556a09[_0x3cbb73]['properties']);_0x5a6396(_0x3cbb73,_0x27e1fc);}},_0x5a6396=(_0x41d6c5,_0x268970)=>{_0x41dee6(),_0xff397b['getValue']()&&_0x715725(![]);if(getIsDrawingsLimitReached(_0x10ea55,_0x4a6832)){_0x4a277c(!![]);return;}_0x4a277c(![]);const _0x3a3c16=_0x213f33['drawings']['startDrawing']({'type':_0x41d6c5,'properties':_0x268970,'synced':_0x4a692b['isDrawingSyncEnabled']['getValue']()}),_0x2808de=new DrawingModel(_0x3a3c16['id'],_0x213f33['drawings']['getDrawing'](_0x3a3c16['id'])?.['htId']??0x0,_0x41d6c5,_0x3a3c16['keyPoints']||[],_0x3a3c16['properties']);_0x24d645(some(copyDrawing(_0x2808de))),_0x4624c9(editDrawingMode(_0x2808de));},_0x1cf87d=_0x536382=>{isIconDrawingModel(_0x536382)?_0x4e5cba(_0x536382['properties']['icon']['name']):_0x2e4866(_0x536382['type']),pipe(_0x213f33['drawings']['_getDrawings'](),record['map'](_0x152741=>{const _0x51d303=_0x152741[_0x152741['length']-0x1];_0x51d303&&isAvailableDrawingModel(_0x51d303)&&!_0x486ca3['getValue']()&&(_0x41dee6(),_0x4624c9(editDrawingMode(_0x51d303)));}));},_0x13c745=_0x22a8ba=>{_0x213f33['drawings']['removeDrawing'](_0x22a8ba['id']),_0x41dee6();},_0x37a14a=_0x369aa9=>{_0x556a09[_0x369aa9['type']]['properties']=_0x369aa9['properties'],_0x213f33['drawings']['updateDrawing'](_0x369aa9),_0x26cfe8(_0x369aa9);},_0x26cfe8=_0x495c0a=>{if(isEditDrawingMode(_0xb5e9bd['getValue']())){const _0x4b948c=copyDrawing(_0x495c0a);_0x4624c9(editDrawingMode(_0x4b948c));}},_0x1268fc=(_0x7da41c,_0x4a863e)=>{_0x7da41c['visible']=_0x4a863e,_0x37a14a(_0x7da41c);},_0x36f944=(_0x5ad0bf,_0x131e1e)=>{_0x5ad0bf['locked']=_0x131e1e,_0x37a14a(_0x5ad0bf);},_0x29e438=_0x2022b7=>{const _0x2260c0=_0x5ac471['getValue']();_0x5bfab0([..._0x2260c0,_0x2022b7]);},_0x527ece=_0x160543=>pipe(_0x5ac471['getValue'](),array['filter'](_0x40a4f7=>_0x40a4f7!==_0x160543),_0x5bfab0),_0x46f325=_0xc5442e=>{_0x57683b['sendNotification'](!_0xc5442e?_0xecdb53['notifications']['notificationSidebarMagnetOn']:_0xecdb53['notifications']['notificationSidebarMagnetOff']);},_0x4c6833=_0x46f574=>{_0x57683b['sendNotification'](!_0x46f574?_0xecdb53['notifications']['notificationSidebarDrawingOn']:_0xecdb53['notifications']['notificationSidebarDrawingOff']);},_0x17e87d=()=>{_0x57683b['sendNotification'](_0xecdb53['notifications']['notificationSidebarDelete']);},_0x39f745=_0x4b23b1=>{const _0x287b76=_0x10ea55['getSelectedChartInfo']()['drawings'];let _0x43ef1e=!![];const _0x42cca5=_0x5b9a2e=>{!_0x43ef1e&&(_0x213f33['drawings']['clearDrawingsDynamicObjects'](),_0x488a4f(_0x5b9a2e)),_0x43ef1e=![];const _0x5aa0bf={};_0x5aa0bf['drawings']=_0x5b9a2e,_0x10ea55['updateLocalChartInfo'](_0x564814,_0x5aa0bf),_0x11f5c7(_0x5b9a2e);},_0x46b610=()=>_0x42cca5(_0x4b23b1),_0x21a41e=()=>_0x42cca5(_0x287b76),_0x245757={};_0x245757['redo']=_0x46b610,_0x245757['undo']=_0x21a41e,_0x245757['type']='drawings_update',_0x375238['pushAction'](_0x245757);},_0x3508e2=()=>pipe(_0x213f33['drawings']['getDrawings'](),record['map'](_0x23fdb5=>_0x23fdb5['filter'](isAvailableDrawing)['filter'](_0x3c1138=>!_0x3c1138['_internalDrawing']['isAdding']())['map'](_0x24034c=>({..._0x24034c,'keyPoints':_0x24034c['keyPoints']['map'](_0x419a15=>({..._0x419a15,'value':parseFloat(_0x213f33['data']['chartModel']['pane']['regularFormatter'](_0x419a15['value']))}))})))),_0xe00f74=_0x4b6fd5['pipe'](take(0x1),tap(()=>_0x488a4f(_0x37f539))),_0x43e9ad=_0x63aca4['pipe'](tap(_0x145b33=>{option['isSome'](_0x145b33)&&!_0xff397b['getValue']()&&_0x24d645(some(copyDrawing(_0x145b33['value'])));})),_0x1c6c42=pipe(_0x213f33['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)),filter(_0x1f7f03=>_0x1f7f03!==_0x291b23['getValue']()),tap(_0x4d1db8)),_0x46c4b5=pipe(_0x291b23,tap(_0x56bc32)),_0x2d9cac=pipe(_0x20ad47,tap(_0x56bc32)),_0x32660d=pipe(_0x10ea55['selectedChartId'],tap(_0x558370=>{const _0x2dc686=_0x28e118['userData']['getValue']()['positions']['drawingsToolbar'];_0x40161d(_0x2dc686),_0x10ea55['charts']['getValue']()['forEach'](_0xd4d0e9=>{_0xd4d0e9['id']!==_0x558370&&_0xd4d0e9['drawings']['cancelDrawing']();});})),_0x1c85c2=pipe(_0x1fc2d0,tap(_0x56bc32)),_0x1683b0=pipe(merge(pipe(_0xb5e9bd,observable['map'](_0x353f1c=>pipe(_0x353f1c,option['fromPredicate'](isEditDrawingMode),option['map'](_0x177859=>_0x177859['drawing'])))),_0x63aca4),tap(_0x5f09c4)),_0x3059f4=_0x595f97['pipe'](withLatestFrom(_0x4ceeaf),tap(([,_0x21cc38])=>{option['fold'](constVoid,_0xdf63b=>{const _0x321e83=new DrawingModel(_0xdf63b['id'],_0xdf63b['htId'],_0xdf63b['type'],_0xdf63b['keyPoints'],_0x5032a8[_0xdf63b['type']]['properties'],_0xdf63b['visible']);_0x321e83['figure']['data']=_0xdf63b['figure']['data'],_0x37a14a(_0x321e83);const _0x5d885d=_0x3508e2();_0x488a4f(_0x5d885d);})(_0x21cc38);})),_0x31db24=pipe(_0x213f33['drawings']['model']['events']['drawingFinished'],filter(isAvailableDrawingModel),tap(_0x5ede56=>pipe(_0x5df4db['getValue'](),option['fromPredicate'](_0xdbf5fd=>option['isNone'](pipe(_0xdbf5fd,array['findFirst'](_0x55c7e8=>isIconDrawingModel(_0x5ede56)?_0x55c7e8===_0x5ede56['properties']['icon']['name']:_0x55c7e8===_0x5ede56['type'])))),option['fold'](constVoid,_0x5e16e3=>pipe(_0x5e16e3,either['fromPredicate'](_0x2ee552=>array['size'](_0x2ee552)<_0xad4b6f,identity),either['fold'](array['dropLeft'](0x1),identity),array['append'](isIconDrawingModel(_0x5ede56)?_0x5ede56['properties']['icon']['name']:_0x5ede56['type']),_0x12707b))))),_0x2ae683=pipe(_0x213f33['drawings']['model']['events']['drawingFinished'],observable['filter'](isAvailableDrawingModel),observable['filter'](_0x30b504=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),tap(_0x1dd57b=>{_0x24d645(some(copyDrawing(_0x1dd57b))),_0x10ea55['state']['getValue']()['drawingMode']&&!isEditableTextDrawingType(_0x1dd57b['type'])&&_0x1cf87d(_0x1dd57b);})),_0x3d46b8=pipe(_0x213f33['drawings']['model']['events']['drawingSelected'],observable['filter'](_0x170701=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),map(option['fromNullable']),tap(_0x38de4f=>pipe(_0x38de4f,option['fold'](()=>_0x4624c9(defaultMode),_0x2c1202=>{isAvailableDrawingModel(_0x2c1202)&&(_0x24d645(some(copyDrawing(_0x2c1202))),_0x4624c9(editDrawingMode(_0x2c1202)));})))),_0x517eaf=pipe(_0x213f33['drawings']['model']['events']['drawingDblClick'],observable['filter'](_0x193926=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),map(option['fromNullable']),tap(_0x1b0701=>pipe(_0x1b0701,option['fold'](()=>_0x4624c9(defaultMode),_0x432211=>{isAvailableDrawingModel(_0x432211)&&(_0x4624c9(editDrawingMode(_0x432211)),!isTextDrawing(_0x432211['type'])&&(_0x24d645(some(copyDrawing(_0x432211))),_0x715725(!![])));})))),_0x43026c=pipe(_0x213f33['drawings']['model']['events']['drawingModified'],observable['filter'](_0x40419f=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),tap(_0x394460=>{isAvailableDrawingModel(_0x394460)&&_0x26cfe8(_0x394460);})),_0x2e1c70=pipe(_0x213f33['drawings']['observeDrawingsUpdated'](),observable['filter'](_0x5d94a4=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),tap(_0x2cd77b=>pipe(_0x2fbcb3['getValue'](),option['fold'](constVoid,_0xb66b2d=>pipe(_0x2cd77b,array['findFirst'](_0x11bbe3=>_0x11bbe3['id']===_0xb66b2d['id']),option['fold'](constVoid,_0x55236e=>{if(isAvailableDrawingModel(_0x55236e)){const _0x45b661=new DrawingModel(_0x55236e['id'],_0x55236e['htId'],_0x55236e['type'],_0x55236e['keyPoints'],_0x55236e['properties'],_0x55236e['visible'],_0x55236e['locked']);_0x4624c9(editDrawingMode(_0x45b661));}})))))),_0x502f91=pipe(_0x213f33['drawings']['observeDrawingsUpdated'](),tap(_0x3ab4ad=>{_0x156fc8['next'](_0x3ab4ad['length']!==0x0);})),_0x45ed90=pipe(_0x213f33['drawings']['observeDrawingRemoved'](),tap(()=>{_0x41dee6();})),_0x71c068=pipe(_0x4e8f1b,tap(_0x4a53c9=>_0x213f33['drawings']['setVisible'](_0x4a53c9))),_0x3a7b29=pipe(combineLatest([pipe(_0x44bc39['isLoading'],distinctUntilChanged()),pipe(_0x1a523c['historicalCandlesUpdated'],observable['map'](_0x16720f=>_0x16720f['length']===0x0),distinctUntilChanged())]),tap(([_0x356250,_0x45587e])=>_0x3a8929(_0x356250||_0x45587e))),_0x47834c=pipe(merge(_0x213f33['drawings']['observeDrawingsUpdated'](),_0x4a692b['saveDrawings']),observable['filter'](_0x521b6b=>_0x10ea55['selectedChartId']['getValue']()!==_0x564814),tap(()=>{const _0x59760d=_0x3508e2(),_0x29d7b1={};_0x29d7b1['drawings']=_0x59760d,_0x10ea55['updateLocalChartInfo'](_0x564814,_0x29d7b1);})),_0x172c57=pipe(merge(_0x213f33['drawings']['observeDrawingFinished'](),_0x213f33['drawings']['observeDrawingRemoved'](),_0x213f33['drawings']['observeDrawingModified']()),tap(_0x9ac439=>{const _0x1159e4=_0x3508e2();_0x39f745(_0x1159e4);})),_0x464e0b=pipe(_0x5ac471,skip(0x1),observable['filter'](_0x3c8b31=>!drawingTypeArrayEq['equals'](_0x3c8b31,_0x28e118['userData']['getValue']()['favoriteDrawings'])),tap(_0x28e118['updateFavoriteDrawings'])),_0x256abe=pipe(_0x28e118['userData'],observable['map'](_0x5d7612=>_0x5d7612['favoriteDrawings']),observable['filter'](_0x39c064=>_0x39c064['length']!==_0x5ac471['getValue']()['length']),observable['filter'](_0x4e44ea=>!drawingTypeArrayEq['equals'](_0x4e44ea,_0x5ac471['getValue']())),tap(_0x5bfab0)),_0x363292=pipe(_0x5df4db,skip(0x1),observable['filter'](_0xdc0068=>!recentDrawingsArrayEq['equals'](_0xdc0068,_0x28e118['userData']['getValue']()['recentDrawings'])),tap(_0x28e118['updateRecentDrawings'])),_0x2ae983=pipe(_0x28e118['userData'],observable['map'](_0x47c185=>_0x47c185['recentDrawings']),observable['filter'](_0x3bd634=>_0x3bd634['length']!==_0x5df4db['getValue']()['length']),observable['filter'](_0x421b0a=>!recentDrawingsArrayEq['equals'](_0x421b0a,_0x5df4db['getValue']())),tap(_0x12707b)),_0x25f199=pipe(merge(_0x213f33['drawings']['observeDrawingsUpdated'](),_0x213f33['drawings']['model']['events']['drawingFinished']),observable['filter'](_0xc43927=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),tap(_0xacccfe=>{_0x4a692b['saveDrawings']['next']();})),_0x3e0bb1=pipe(merge(_0x213f33['drawings']['model']['events']['drawingMoved'],_0x213f33['drawings']['model']['events']['drawingModified'],_0x213f33['drawings']['model']['events']['drawingSelected'],_0x213f33['drawings']['model']['events']['drawingFinished']),observable['filter'](_0x506183=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),tap(_0x3ee0d1=>{if(_0x3ee0d1===null)_0x4a692b['syncedDrawingUpdated']['next'](_0x3ee0d1);else isAvailableDrawingModel(_0x3ee0d1)&&_0x3ee0d1['paneId']===CHART_UUID&&_0x3ee0d1['synced']&&_0x4a692b['syncedDrawingUpdated']['next'](_0x3ee0d1);})),_0x135138=pipe(_0x213f33['drawings']['model']['events']['drawingRemoved'],observable['filter'](_0x232e43=>_0x10ea55['selectedChartId']['getValue']()===_0x564814),tap(_0x359de3=>{_0x359de3['forEach'](_0x29ee8b=>{isAvailableDrawingModel(_0x29ee8b)&&_0x29ee8b['paneId']===CHART_UUID&&_0x29ee8b['synced']&&_0x4a692b['syncedDrawingRemoved']['next'](_0x29ee8b);});})),_0x3e240c=pipe(_0x4a692b['syncedDrawingRemoved'],observable['filter'](_0x59e345=>_0x10ea55['selectedChartId']['getValue']()!==_0x564814),tap(_0x4e8a12=>{_0x213f33['drawings']['removeDrawing'](_0x4e8a12['id']);})),_0x56e64c=pipe(_0x4a692b['syncedDrawingUpdated'],observable['filter'](_0x4ad410=>_0x10ea55['selectedChartId']['getValue']()!==_0x564814),observable['map'](cloneUnsafe),tap(_0x45d366=>{pipe(_0x10ea55['getSelectedChartInfo']()['instrument'],option['fold'](constVoid,_0x2a0303=>{_0x213f33['drawings']['model']['instrumentCode']===_0x2a0303?_0x213f33['drawings']['setActiveDrawing'](_0x45d366):_0x45d366!==null&&_0x213f33['drawings']['setDrawing'](_0x2a0303,_0x45d366);}));})),_0x1e40d3=pipe(_0x213f33['paneManager']['paneRemovedSubject'],tap(_0x494daa=>{const _0x1c619f=_0x10ea55['getSelectedChartInfo'](),{drawings:_0x80af92,instrument:_0x5434d8}=_0x1c619f;pipe(_0x5434d8,option['chain'](_0x4c43ba=>pipe(_0x80af92,record['lookup'](_0x4c43ba))),option['fold'](constVoid,_0x3357a3=>{_0x3357a3['forEach'](_0xb106ab=>_0xb106ab['_internalDrawing']['paneId']===_0x494daa['uuid']&&_0x13c745(_0xb106ab['_internalDrawing'])),_0x39f745(_0x3508e2());}));})),_0x43265c=merge(_0x172c57,_0x47834c,_0x71c068,_0x3a7b29,_0x3059f4,_0x502f91,_0x45ed90,_0x43026c,_0x43e9ad,_0x3d46b8,_0x1c85c2,_0x1c6c42,_0x2d9cac,_0x46c4b5,_0x32660d,_0x464e0b,_0x256abe,_0x1683b0,_0x2ae683,_0x517eaf,_0x2e1c70,_0xe00f74,_0x3e0bb1,_0x135138,_0x56e64c,_0x3e240c,_0x25f199,_0x1e40d3,_0x31db24,_0x363292,_0x2ae983);return sink['newSink'](callTracerProxy('drawingViewModel',{'availableDrawings':_0x217fc9,'drawingMode':_0xb5e9bd,'drawings':_0x4b6fd5,'isVisible':_0x4e8f1b,'isDisabled':_0x3cde77,'currentEditableDrawing':_0x2fbcb3,'doesChartHaveDrawings':_0x156fc8['asObservable'](),'isSettingsPopupOpened':_0xff397b,'isPopoverOpened':_0x24f42b,'iconDrawingIcons':_0x3bccb7,'toolbarPositionPixels':_0x5c63dc,'chartBounds':_0x291b23,'toolbarWidth':_0x20ad47,'favoriteDrawings':_0x5ac471,'drawingGroups':_0x318164,'isDrawingsLimitReached':_0x486ca3,'recentDrawings':_0x5df4db,'clearDrawings':_0x597bc0,'setDrawings':_0x488a4f,'changeVisibility':_0x5ece7b,'cancelDrawing':_0x41dee6,'startNewDrawing':_0xc025fd,'startNewIconDrawing':_0x4e5cba,'updateDrawing':_0x37a14a,'removeDrawing':_0x13c745,'resetChanges':_0x4aec16,'toggleSettingsPopup':_0x715725,'togglePopover':_0x46bdad,'handleDrag':_0x31cf48,'updateToolbarWidth':_0xc2e45d,'sendMagnetModeNotification':_0x46f325,'sendDrawingModeNotification':_0x4c6833,'sendDeleteDrawingsNotification':_0x17e87d,'onFavorite':_0x29e438,'onUnFavorite':_0x527ece,'changeMode':_0x4624c9,'toggleDrawingVisibility':_0x1268fc,'toggleDrawingLocked':_0x36f944}),_0x43265c);});const getIsDrawingsLimitReached=(_0x5a3d2d,_0x333396)=>{const _0x19c8ee=_0x5a3d2d['getSelectedChartInfo'](),{drawings:_0x309e01,instrument:_0x2a2097}=_0x19c8ee,_0x2adf10=pipe(_0x2a2097,option['map'](_0xa88ee8=>_0x309e01[_0xa88ee8]?_0x309e01[_0xa88ee8]['length']:0x0),option['getOrElse'](()=>0x0));return _0x2adf10>=_0x333396['drawings']['limitOfDrawings'];};export const editDrawingMode=_0x17baca=>({'mode':'EditDrawing','drawing':_0x17baca});export const isEditDrawingMode=_0x2a01d0=>_0x2a01d0['mode']==='EditDrawing';const _0x3355d2={};_0x3355d2['mode']='Default';export const defaultMode=_0x3355d2;export const isDefaultMode=_0x24d5c3=>_0x24d5c3['mode']==='Default';export function copyDrawing(_0x28f300){const _0x3bf2e5=new DrawingModel(_0x28f300['id'],_0x28f300['htId'],_0x28f300['type'],_0x28f300['keyPoints'],_0x28f300['properties'],_0x28f300['visible'],_0x28f300['locked'],_0x28f300['synced'],_0x28f300['getPane']);return _0x3bf2e5['hidden']=_0x28f300['hidden'],_0x3bf2e5;}const toDrawingWithUpdatedKeypoints=(_0x580480,_0x331792)=>{if(!_0x331792['chartModel']['mainCandleSeries']['instrument']['symbol'])return none;const _0x2a1b4a=_0x331792['drawings']['getDrawings']()[_0x331792['chartModel']['mainCandleSeries']['instrument']['symbol']];return Array['isArray'](_0x2a1b4a)?pipe(_0x2a1b4a,array['findFirst'](_0x3262f7=>_0x3262f7['id']===_0x580480['id']),option['map'](_0x173a74=>{const _0x4d4aec=new DrawingModel(_0x580480['id'],_0x580480['htId'],_0x580480['type'],_0x173a74['keyPoints'],_0x580480['properties'],_0x580480['visible']);return _0x4d4aec['figure']['data']=_0x580480['figure']['data'],_0x4d4aec['hidden']=_0x580480['hidden'],_0x4d4aec;})):none;};