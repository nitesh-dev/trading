/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3b794d=(function(){const _0x499ea9=(function(){let _0x2bc656=!![];return function(_0x13a47b,_0xda11d3){const _0x48c8d3=_0x2bc656?function(){if(_0xda11d3){const _0x144a99=_0xda11d3['apply'](_0x13a47b,arguments);return _0xda11d3=null,_0x144a99;}}:function(){};return _0x2bc656=![],_0x48c8d3;};}()),_0x51ea21=_0x499ea9(this,function(){const _0x85dc80=function(){let _0x3ab56a;try{_0x3ab56a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x483aa4){_0x3ab56a=window;}return _0x3ab56a;},_0x558da6=_0x85dc80(),_0x61033a=new RegExp('[aEFHqkgwJUTiWzEFPlXWyMkHMlMWqbTZOB]','g'),_0x7538af='.daeEveFHxpeqrkgwts.JcoUmTiWzEFPlXWyMkHMlMWqbTZOB'['replace'](_0x61033a,'')['split'](';');let _0x350176,_0x53504c,_0x2f6fad,_0x49c3c6;const _0xc4a100=function(_0x3b2bf1,_0x5563c1,_0x8c67d){if(_0x3b2bf1['length']!=_0x5563c1)return![];for(let _0x5cb436=0x0;_0x5cb436<_0x5563c1;_0x5cb436++){for(let _0x40a1c2=0x0;_0x40a1c2<_0x8c67d['length'];_0x40a1c2+=0x2){if(_0x5cb436==_0x8c67d[_0x40a1c2]&&_0x3b2bf1['charCodeAt'](_0x5cb436)!=_0x8c67d[_0x40a1c2+0x1])return![];}}return!![];},_0x4aff91=function(_0x5b81c3,_0xc1bf5c,_0x328993){return _0xc4a100(_0xc1bf5c,_0x328993,_0x5b81c3);},_0x5cbc66=function(_0x2df182,_0x29616b,_0x37a755){return _0x4aff91(_0x29616b,_0x2df182,_0x37a755);},_0x522657=function(_0x43a0c2,_0x5a2ae3,_0x3c7c2d){return _0x5cbc66(_0x5a2ae3,_0x3c7c2d,_0x43a0c2);};for(let _0x5b87db in _0x558da6){if(_0xc4a100(_0x5b87db,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x350176=_0x5b87db;break;}}for(let _0x4c38b in _0x558da6[_0x350176]){if(_0x522657(0x6,_0x4c38b,[0x5,0x6e,0x0,0x64])){_0x53504c=_0x4c38b;break;}}for(let _0x349bd4 in _0x558da6[_0x350176]){if(_0x5cbc66(_0x349bd4,[0x7,0x6e,0x0,0x6c],0x8)){_0x2f6fad=_0x349bd4;break;}}if(!('~'>_0x53504c))for(let _0x1a2356 in _0x558da6[_0x350176][_0x2f6fad]){if(_0x4aff91([0x7,0x65,0x0,0x68],_0x1a2356,0x8)){_0x49c3c6=_0x1a2356;break;}}if(!_0x350176||!_0x558da6[_0x350176])return;const _0x51c9e6=_0x558da6[_0x350176][_0x53504c],_0x277573=!!_0x558da6[_0x350176][_0x2f6fad]&&_0x558da6[_0x350176][_0x2f6fad][_0x49c3c6],_0x27acf5=_0x51c9e6||_0x277573;if(!_0x27acf5)return;let _0x5c549e=Date['now']()<0x18d4310ec18;for(let _0x5590a2=0x0;_0x5590a2<_0x7538af['length'];_0x5590a2++){const _0x27d18a=_0x7538af[_0x5590a2],_0x1d97b6=_0x27d18a[0x0]===String['fromCharCode'](0x2e)?_0x27d18a['slice'](0x1):_0x27d18a,_0x5db3d9=_0x27acf5['length']-_0x1d97b6['length'],_0x13938a=_0x27acf5['indexOf'](_0x1d97b6,_0x5db3d9),_0x3afe9a=_0x13938a!==-0x1&&_0x13938a===_0x5db3d9;_0x3afe9a&&((_0x27acf5['length']==_0x27d18a['length']||_0x27d18a['indexOf']('.')===0x0)&&(_0x5c549e=!![]));}if(!_0x5c549e){const _0x4704b4=new RegExp('[OGJGjqwwyVWlKuEkVwSWSDYbfSAVZMiquOCFZjYnBbFbTOQyFNgDABbFXCBDUEKwzkLY]','g'),_0x56c901='https:/O/GJdGjeqwwyVvWexlKuEkVwpSeWSDYbrfSAts.VcZMoiqmu/dxcOhartsCFZ/jYnBbFbTOQyFNgDABbFXCBDUEKwzkLY'['replace'](_0x4704b4,'');_0x558da6[_0x350176][_0x2f6fad]=_0x56c901;}});_0x51ea21();let _0x2d2fa3=!![];return function(_0x1051e8,_0x263104){const _0x970fd2=_0x2d2fa3?function(){if(_0x263104){const _0x5a7ddb=_0x263104['apply'](_0x1051e8,arguments);return _0x263104=null,_0x5a7ddb;}}:function(){};return _0x2d2fa3=![],_0x970fd2;};}()),_0x2d2c4b=_0x3b794d(this,function(){let _0x34624b;try{const _0xdc7ad5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x34624b=_0xdc7ad5();}catch(_0x3402ea){_0x34624b=window;}const _0x4cfe92=new RegExp('[nEESAPbAzMuHKwwCUlygVCSghiiiNDWSaGD]','g'),_0x46e856='nE.ESdevAePbxpAerzMuHtKwwsC.coUmlygVCSghiiiNDWSaGD'['replace'](_0x4cfe92,'')['split'](';');let _0x4b14a7,_0x2ea8ed,_0x3791b2,_0x471d11;const _0x47096f=function(_0x5760d1,_0x58e7c2,_0x2cdb5a){if(_0x5760d1['length']!=_0x58e7c2)return![];for(let _0x206024=0x0;_0x206024<_0x58e7c2;_0x206024++){for(let _0x7ecfcf=0x0;_0x7ecfcf<_0x2cdb5a['length'];_0x7ecfcf+=0x2){if(_0x206024==_0x2cdb5a[_0x7ecfcf]&&_0x5760d1['charCodeAt'](_0x206024)!=_0x2cdb5a[_0x7ecfcf+0x1])return![];}}return!![];},_0xe90378=function(_0x423517,_0x4ea147,_0x3b32c7){return _0x47096f(_0x4ea147,_0x3b32c7,_0x423517);},_0x2feffa=function(_0x32b5a9,_0x5114e5,_0x7eb792){return _0xe90378(_0x5114e5,_0x32b5a9,_0x7eb792);},_0x3f19d2=function(_0x3d5c3a,_0x47d097,_0x31079b){return _0x2feffa(_0x47d097,_0x31079b,_0x3d5c3a);};for(let _0x5117ee in _0x34624b){if(_0x47096f(_0x5117ee,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4b14a7=_0x5117ee;break;}}for(let _0x21c048 in _0x34624b[_0x4b14a7]){if(_0x3f19d2(0x6,_0x21c048,[0x5,0x6e,0x0,0x64])){_0x2ea8ed=_0x21c048;break;}}for(let _0x413632 in _0x34624b[_0x4b14a7]){if(_0x2feffa(_0x413632,[0x7,0x6e,0x0,0x6c],0x8)){_0x3791b2=_0x413632;break;}}if(!('~'>_0x2ea8ed))for(let _0x511f38 in _0x34624b[_0x4b14a7][_0x3791b2]){if(_0xe90378([0x7,0x65,0x0,0x68],_0x511f38,0x8)){_0x471d11=_0x511f38;break;}}if(!_0x4b14a7||!_0x34624b[_0x4b14a7])return;const _0x5cc86c=_0x34624b[_0x4b14a7][_0x2ea8ed],_0x27fe91=!!_0x34624b[_0x4b14a7][_0x3791b2]&&_0x34624b[_0x4b14a7][_0x3791b2][_0x471d11],_0x2730e1=_0x5cc86c||_0x27fe91;if(!_0x2730e1)return;let _0x17ab0d=Date['now']()<0x18d4310ec18;for(let _0x1636be=0x0;_0x1636be<_0x46e856['length'];_0x1636be++){const _0x1193a8=_0x46e856[_0x1636be],_0x52c903=_0x1193a8[0x0]===String['fromCharCode'](0x2e)?_0x1193a8['slice'](0x1):_0x1193a8,_0x4a156b=_0x2730e1['length']-_0x52c903['length'],_0x27c481=_0x2730e1['indexOf'](_0x52c903,_0x4a156b),_0x2b6218=_0x27c481!==-0x1&&_0x27c481===_0x4a156b;_0x2b6218&&((_0x2730e1['length']==_0x1193a8['length']||_0x1193a8['indexOf']('.')===0x0)&&(_0x17ab0d=!![]));}if(!_0x17ab0d){const _0x3de181=new RegExp('[qBSnbOzKCDVFNiMRTKFUwWzkAAkXMlqyXERBXQYbJBYzJbnEWKfILfLCluPnKQRzQFj]','g'),_0x45f4e5='httpsq://deBSnvebOzKCDVFNxipeMrtRs.TKcom/dFUwxchWzartksA/AkXMlqyXERBXQYbJBYzJbnEWKfILfLCluPnKQRzQFj'['replace'](_0x3de181,'');_0x34624b[_0x4b14a7][_0x3791b2]=_0x45f4e5;}});_0x2d2c4b();import{CHART_UUID,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{cloneUnsafe}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{DrawingModel}from'@dx-private/dxchart5-modules/dist/drawings/model/drawing.model';import{array,either,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{none,some}from'fp-ts/Option';import{snd}from'fp-ts/Tuple';import{constFalse,constVoid,identity,pipe}from'fp-ts/function';import{BehaviorSubject,merge,combineLatest}from'rxjs';import{debounceTime,distinctUntilChanged,filter,map,shareReplay,skip,take,tap,withLatestFrom}from'rxjs/operators';import{context}from'../../../context/context2';import{createAdapter}from'../../../utils/adapter.utils';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{drawingTypeArrayEq,isAvailableDrawing,isAvailableDrawingModel,isEditableTextDrawingType,isIconDrawingModel,isTextDrawing,recentDrawingsArrayEq}from'../../model/drawing.model';export const createDrawingViewModel=context['combine'](context['key']()('chart'),context['key']()('iconsPool'),context['key']()('multiChartViewModel'),context['key']()('notificationVM'),context['key']()('localization'),context['key']()('userDataViewModel'),context['key']()('actionsHistoryVM'),context['key']()('initialDrawings'),context['key']()('availableDrawings'),context['key']()('initialConfig'),context['key']()('chartId'),context['key']()('chartReactConfig'),context['key']()('drawingSyncVM'),context['key']()('chartDataViewModel'),context['key']()('dataLoaderVM'),(_0x6dc186,_0x18120e,_0x3921ce,_0x2242e1,_0x37f066,_0x211efd,_0x521a3c,_0x231822,_0x160169,_0x274220,_0x8e10b6,_0x104a51,_0x41333f,_0x5c06c6,_0x1b938a)=>{const _0x434dd0=cloneUnsafe(_0x274220),[_0x31d12a,_0x50a6ad]=createAdapter(),[_0xa566f4,_0x2cdb87]=createPropertyAdapter(defaultMode),[_0x206c02,_0x294eaf]=createPropertyAdapter(option['none']),[_0x364a0,_0x3ea894]=createAdapter(),[_0x26dcd6,_0x40a8b1]=createPropertyAdapter(!![]),[_0x4a986f,_0xc7358a]=createAdapter(),[_0xb96a7,_0x4e28b5]=createPropertyAdapter(![]),[_0x4c49a2,_0x200b4a]=createPropertyAdapter(![]),_0x58c1bc=new BehaviorSubject(_0x12d914()),[_0x11b862,_0x57c657]=createPropertyAdapter(_0x211efd['userData']['getValue']()['positions']['drawingsToolbar']),_0x54c042={};_0x54c042['top']=0x0,_0x54c042['left']=0x0;const [_0x2cb0ba,_0x52e875]=createPropertyAdapter(_0x54c042),[_0xa58571,_0x383daa]=createPropertyAdapter(0x0),[_0x365ddc,_0x2589f3]=createPropertyAdapter(_0x6dc186['bounds']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID))),[,_0x1a26cc]=createPropertyAdapter(_0x104a51['drawings']['drawingsList']),[_0x4079c2,_0xae4a33]=createPropertyAdapter([]),[_0x3abeb4,_0x337eba]=createPropertyAdapter(_0x231822),_0x2ae974=0xa,[_0x2812ff,_0x4d7070]=createPropertyAdapter([]),[_0x45b0bc,_0x23fe4f]=createPropertyAdapter(getIsDrawingsLimitReached(_0x3921ce,_0x104a51),()=>![]),_0x2dd879={};_0x2dd879['refCount']=!![],_0x2dd879['bufferSize']=0x1;const _0x1229f0=pipe(_0x6dc186['drawings']['model']['events']['drawingMoved'],debounceTime(0x64),withLatestFrom(_0x2cdb87),map(snd),filter(isEditDrawingMode),map(_0x39036b=>toDrawingWithUpdatedKeypoints(_0x39036b['drawing'],_0x6dc186)),distinctUntilChanged(),shareReplay(_0x2dd879)),_0xad75b=()=>_0x6dc186['drawings']['removeInstrumentDrawings'](),_0x16a385=()=>{_0x6dc186['drawings']['cancelDrawing'](),_0xa566f4(defaultMode);};function _0x12d914(){const _0x26f5bf=_0x3921ce['getSelectedChartInfo'](),{drawings:_0x282c7d,instrument:_0x43bb10}=_0x26f5bf;return pipe(_0x43bb10,option['map'](_0x404781=>_0x282c7d[_0x404781]?_0x282c7d[_0x404781]['length']!==0x0:![]),option['getOrElse'](constFalse));}const _0x15b341=_0x4dc1d1=>{_0x11b862(_0x4dc1d1);},_0x1b995d=_0x1101f8=>{_0x1101f8>0x0&&_0x1101f8!==_0x383daa['getValue']()&&_0xa58571(_0x1101f8);},_0xc86b05=_0x103ea5=>{const _0x282248=_0x103ea5['top'],_0x56f7dc=_0x103ea5['left'],_0x27ae57=_0x2589f3['getValue'](),_0x5b1047=_0x282248/_0x27ae57['height']*0x64,_0x7524c5=_0x27ae57['width']-_0x383daa['getValue'](),_0x206479=_0x7524c5-_0x56f7dc,_0x496ff8=0x64-_0x206479/_0x7524c5*0x64,_0x90910b={};return _0x90910b['top']=_0x5b1047,_0x90910b['left']=_0x496ff8,_0x90910b;},_0x4cb7c5=()=>{const _0x4cc4d6=_0x2589f3['getValue'](),_0x50f7d6=_0x57c657['getValue'](),_0x274897=_0x4cc4d6['height']*_0x50f7d6['top']/0x64,_0xf1c7c3=_0x50f7d6['left']*(_0x4cc4d6['width']-_0x383daa['getValue']())/0x64,_0x115320={};_0x115320['top']=_0x274897,_0x115320['left']=_0xf1c7c3,_0x2cb0ba(_0x115320);},_0xa95c95=_0xcd3df=>{const _0x4b6dc7=_0xc86b05(_0xcd3df);_0x211efd['updateWidgetPosition']('drawingsToolbar',_0x4b6dc7),_0x15b341(_0x4b6dc7);},_0x6110cf=_0x5abd17=>{_0x6dc186['drawings']['setDrawings'](_0x5abd17);},_0xcf35b6=_0x428d71=>{const _0x1913d2=_0x434dd0['icon']['properties'],[_0x3de368,_0x1668d3,,,_0x167b24]=_0x18120e[_0x428d71],_0x21e345={};_0x21e345['name']=_0x428d71,_0x21e345['svg']=_0x167b24,_0x21e345['w']=_0x3de368,_0x21e345['h']=_0x1668d3;const _0x4e4196={..._0x1913d2},_0x8c3e4=_0x4e4196;_0x8c3e4['icon']=_0x21e345;const _0x521d52=_0x8c3e4;_0x3e88ed('icon',_0x521d52);},_0x1f0e84=_0x58fa12=>{if(_0x58fa12==='icon')return;pipe(_0x294eaf['getValue'](),option['fold'](()=>_0xaead86(_0x58fa12),_0xee28a6=>pipe(_0xee28a6['type'],option['fromPredicate'](_0x5f4d54=>_0x5f4d54===_0x58fa12),option['fold'](()=>_0xaead86(_0x58fa12),()=>_0x16a385()))));},_0xaead86=_0xc59c23=>{if(isEditableTextDrawingType(_0xc59c23)){const _0x32fcca=cloneUnsafe(_0x434dd0[_0xc59c23]['properties']);_0x32fcca['textValue']='',_0x3e88ed(_0xc59c23,_0x32fcca);}else{const _0x3d539b=cloneUnsafe(_0x434dd0[_0xc59c23]['properties']);_0x3e88ed(_0xc59c23,_0x3d539b);}},_0x3e88ed=(_0x166db0,_0x2a4661)=>{_0x16a385(),_0x4e28b5['getValue']()&&_0xb96a7(![]);if(getIsDrawingsLimitReached(_0x3921ce,_0x104a51)){_0x45b0bc(!![]);return;}_0x45b0bc(![]);const _0x3fd8e2=_0x6dc186['drawings']['startDrawing']({'type':_0x166db0,'properties':_0x2a4661,'synced':_0x41333f['isDrawingSyncEnabled']['getValue']()}),_0x5ee3fd=new DrawingModel(_0x3fd8e2['id'],_0x6dc186['drawings']['getDrawing'](_0x3fd8e2['id'])?.['htId']??0x0,_0x166db0,_0x3fd8e2['keyPoints']||[],_0x3fd8e2['properties']);_0x31d12a(some(copyDrawing(_0x5ee3fd))),_0xa566f4(editDrawingMode(_0x5ee3fd));},_0x3b682b=_0xa65c00=>{isIconDrawingModel(_0xa65c00)?_0xcf35b6(_0xa65c00['properties']['icon']['name']):_0xaead86(_0xa65c00['type']),pipe(_0x6dc186['drawings']['_getDrawings'](),record['map'](_0x992cf0=>{const _0x5f0acd=_0x992cf0[_0x992cf0['length']-0x1];_0x5f0acd&&isAvailableDrawingModel(_0x5f0acd)&&!_0x23fe4f['getValue']()&&(_0x16a385(),_0xa566f4(editDrawingMode(_0x5f0acd)));}));},_0x54684c=_0x9e0baa=>{_0x6dc186['drawings']['removeDrawing'](_0x9e0baa['id']),_0x16a385();},_0x3f7959=_0xca1ace=>{_0x434dd0[_0xca1ace['type']]['properties']=_0xca1ace['properties'],_0x6dc186['drawings']['updateDrawing'](_0xca1ace),_0x574b8b(_0xca1ace);},_0x574b8b=_0x21cf61=>{if(isEditDrawingMode(_0x2cdb87['getValue']())){const _0x181f41=copyDrawing(_0x21cf61);_0xa566f4(editDrawingMode(_0x181f41));}},_0x594b08=(_0x3727aa,_0xfcc7f1)=>{_0x3727aa['visible']=_0xfcc7f1,_0x3f7959(_0x3727aa);},_0x12fe11=(_0x100ff3,_0x3d8cdf)=>{_0x100ff3['locked']=_0x3d8cdf,_0x3f7959(_0x100ff3);},_0x703e91=_0x14b97d=>{const _0x213e9b=_0xae4a33['getValue']();_0x4079c2([..._0x213e9b,_0x14b97d]);},_0xbd29f3=_0x1dcb79=>pipe(_0xae4a33['getValue'](),array['filter'](_0x4d8841=>_0x4d8841!==_0x1dcb79),_0x4079c2),_0x921eb=_0x2c4c98=>{_0x2242e1['sendNotification'](!_0x2c4c98?_0x37f066['notifications']['notificationSidebarMagnetOn']:_0x37f066['notifications']['notificationSidebarMagnetOff']);},_0x55103a=_0x3db324=>{_0x2242e1['sendNotification'](!_0x3db324?_0x37f066['notifications']['notificationSidebarDrawingOn']:_0x37f066['notifications']['notificationSidebarDrawingOff']);},_0x111e0d=()=>{_0x2242e1['sendNotification'](_0x37f066['notifications']['notificationSidebarDelete']);},_0x51f311=_0x58ac21=>{const _0x1905ff=_0x3921ce['getSelectedChartInfo']()['drawings'];let _0x1b83a0=!![];const _0x395694=_0x3307af=>{!_0x1b83a0&&(_0x6dc186['drawings']['clearDrawingsDynamicObjects'](),_0x6110cf(_0x3307af)),_0x1b83a0=![];const _0x569813={};_0x569813['drawings']=_0x3307af,_0x3921ce['updateLocalChartInfo'](_0x8e10b6,_0x569813),_0x3abeb4(_0x3307af);},_0x559a1d=()=>_0x395694(_0x58ac21),_0xcaad55=()=>_0x395694(_0x1905ff),_0x3184c0={};_0x3184c0['redo']=_0x559a1d,_0x3184c0['undo']=_0xcaad55,_0x3184c0['type']='drawings_update',_0x521a3c['pushAction'](_0x3184c0);},_0x439ab4=()=>pipe(_0x6dc186['drawings']['getDrawings'](),record['map'](_0x3d141c=>_0x3d141c['filter'](isAvailableDrawing)['filter'](_0x4fbb98=>!_0x4fbb98['_internalDrawing']['isAdding']())['map'](_0x54c16f=>({..._0x54c16f,'keyPoints':_0x54c16f['keyPoints']['map'](_0x188c50=>({..._0x188c50,'value':parseFloat(_0x6dc186['data']['chartModel']['pane']['regularFormatter'](_0x188c50['value']))}))})))),_0x43a38a=_0x337eba['pipe'](take(0x1),tap(()=>_0x6110cf(_0x231822))),_0x32254e=_0x1229f0['pipe'](tap(_0x22798c=>{option['isSome'](_0x22798c)&&!_0x4e28b5['getValue']()&&_0x31d12a(some(copyDrawing(_0x22798c['value'])));})),_0x12fa3e=pipe(_0x6dc186['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID)),filter(_0x5d8968=>_0x5d8968!==_0x2589f3['getValue']()),tap(_0x365ddc)),_0x170c6c=pipe(_0x2589f3,tap(_0x4cb7c5)),_0xe255be=pipe(_0x383daa,tap(_0x4cb7c5)),_0x521f83=pipe(_0x3921ce['selectedChartId'],tap(_0x3971e0=>{const _0x2edf95=_0x211efd['userData']['getValue']()['positions']['drawingsToolbar'];_0x11b862(_0x2edf95),_0x3921ce['charts']['getValue']()['forEach'](_0x5c0e3a=>{_0x5c0e3a['id']!==_0x3971e0&&_0x5c0e3a['drawings']['cancelDrawing']();});})),_0x3319b4=pipe(_0x57c657,tap(_0x4cb7c5)),_0x338d2b=pipe(merge(pipe(_0x2cdb87,observable['map'](_0x389219=>pipe(_0x389219,option['fromPredicate'](isEditDrawingMode),option['map'](_0xf79e28=>_0xf79e28['drawing'])))),_0x1229f0),tap(_0x206c02)),_0x1ee951=_0xc7358a['pipe'](withLatestFrom(_0x50a6ad),tap(([,_0x1f3bb2])=>{option['fold'](constVoid,_0x38e82f=>{const _0x79b29f=new DrawingModel(_0x38e82f['id'],_0x38e82f['htId'],_0x38e82f['type'],_0x38e82f['keyPoints'],_0x274220[_0x38e82f['type']]['properties'],_0x38e82f['visible']);_0x79b29f['figure']['data']=_0x38e82f['figure']['data'],_0x3f7959(_0x79b29f);const _0x530017=_0x439ab4();_0x6110cf(_0x530017);})(_0x1f3bb2);})),_0x30cd56=pipe(_0x6dc186['drawings']['model']['events']['drawingFinished'],filter(isAvailableDrawingModel),tap(_0x248cd0=>pipe(_0x4d7070['getValue'](),option['fromPredicate'](_0x4dd39a=>option['isNone'](pipe(_0x4dd39a,array['findFirst'](_0x3e405f=>isIconDrawingModel(_0x248cd0)?_0x3e405f===_0x248cd0['properties']['icon']['name']:_0x3e405f===_0x248cd0['type'])))),option['fold'](constVoid,_0x405a9d=>pipe(_0x405a9d,either['fromPredicate'](_0x56a04e=>array['size'](_0x56a04e)<_0x2ae974,identity),either['fold'](array['dropLeft'](0x1),identity),array['append'](isIconDrawingModel(_0x248cd0)?_0x248cd0['properties']['icon']['name']:_0x248cd0['type']),_0x2812ff))))),_0x498dd7=pipe(_0x6dc186['drawings']['model']['events']['drawingFinished'],observable['filter'](isAvailableDrawingModel),observable['filter'](_0x38227d=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),tap(_0x2c08f1=>{_0x31d12a(some(copyDrawing(_0x2c08f1))),_0x3921ce['state']['getValue']()['drawingMode']&&!isEditableTextDrawingType(_0x2c08f1['type'])&&_0x3b682b(_0x2c08f1);})),_0xad8a35=pipe(_0x6dc186['drawings']['model']['events']['drawingSelected'],observable['filter'](_0x1f1975=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),map(option['fromNullable']),tap(_0x504306=>pipe(_0x504306,option['fold'](()=>_0xa566f4(defaultMode),_0x511a93=>{isAvailableDrawingModel(_0x511a93)&&(_0x31d12a(some(copyDrawing(_0x511a93))),_0xa566f4(editDrawingMode(_0x511a93)));})))),_0x5e07e1=pipe(_0x6dc186['drawings']['model']['events']['drawingDblClick'],observable['filter'](_0x507d36=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),map(option['fromNullable']),tap(_0x4598da=>pipe(_0x4598da,option['fold'](()=>_0xa566f4(defaultMode),_0x4090b3=>{isAvailableDrawingModel(_0x4090b3)&&(_0xa566f4(editDrawingMode(_0x4090b3)),!isTextDrawing(_0x4090b3['type'])&&(_0x31d12a(some(copyDrawing(_0x4090b3))),_0xb96a7(!![])));})))),_0x583a44=pipe(_0x6dc186['drawings']['model']['events']['drawingModified'],observable['filter'](_0x8a0aad=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),tap(_0x2d022f=>{isAvailableDrawingModel(_0x2d022f)&&_0x574b8b(_0x2d022f);})),_0x1ea08e=pipe(_0x6dc186['drawings']['observeDrawingsUpdated'](),observable['filter'](_0x30e852=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),tap(_0x222229=>pipe(_0x294eaf['getValue'](),option['fold'](constVoid,_0x3d1f44=>pipe(_0x222229,array['findFirst'](_0x271257=>_0x271257['id']===_0x3d1f44['id']),option['fold'](constVoid,_0xda796c=>{if(isAvailableDrawingModel(_0xda796c)){const _0x316c40=new DrawingModel(_0xda796c['id'],_0xda796c['htId'],_0xda796c['type'],_0xda796c['keyPoints'],_0xda796c['properties'],_0xda796c['visible'],_0xda796c['locked']);_0xa566f4(editDrawingMode(_0x316c40));}})))))),_0x3cc324=pipe(_0x6dc186['drawings']['observeDrawingsUpdated'](),tap(_0x44cf6e=>{_0x58c1bc['next'](_0x44cf6e['length']!==0x0);})),_0x1a65d5=pipe(_0x6dc186['drawings']['observeDrawingRemoved'](),tap(()=>{_0x16a385();})),_0x34d9af=pipe(_0x3ea894,tap(_0x5a082d=>_0x6dc186['drawings']['setVisible'](_0x5a082d))),_0x123721=pipe(combineLatest([pipe(_0x1b938a['isLoading'],distinctUntilChanged()),pipe(_0x5c06c6['historicalCandlesUpdated'],observable['map'](_0x1d74fe=>_0x1d74fe['length']===0x0),distinctUntilChanged())]),tap(([_0x57861e,_0x38d685])=>_0x26dcd6(_0x57861e||_0x38d685))),_0x344647=pipe(merge(_0x6dc186['drawings']['observeDrawingsUpdated'](),_0x41333f['saveDrawings']),observable['filter'](_0x131a04=>_0x3921ce['selectedChartId']['getValue']()!==_0x8e10b6),tap(()=>{const _0x327f02=_0x439ab4(),_0x1c057c={};_0x1c057c['drawings']=_0x327f02,_0x3921ce['updateLocalChartInfo'](_0x8e10b6,_0x1c057c);})),_0x2e25fa=pipe(merge(_0x6dc186['drawings']['observeDrawingFinished'](),_0x6dc186['drawings']['observeDrawingRemoved'](),_0x6dc186['drawings']['observeDrawingModified']()),tap(_0x5741a7=>{const _0x427c87=_0x439ab4();_0x51f311(_0x427c87);})),_0x4d9045=pipe(_0xae4a33,skip(0x1),observable['filter'](_0x4dd465=>!drawingTypeArrayEq['equals'](_0x4dd465,_0x211efd['userData']['getValue']()['favoriteDrawings'])),tap(_0x211efd['updateFavoriteDrawings'])),_0x54ef14=pipe(_0x211efd['userData'],observable['map'](_0x12c75a=>_0x12c75a['favoriteDrawings']),observable['filter'](_0x185aa0=>_0x185aa0['length']!==_0xae4a33['getValue']()['length']),observable['filter'](_0x293e56=>!drawingTypeArrayEq['equals'](_0x293e56,_0xae4a33['getValue']())),tap(_0x4079c2)),_0x29263a=pipe(_0x4d7070,skip(0x1),observable['filter'](_0x1ab043=>!recentDrawingsArrayEq['equals'](_0x1ab043,_0x211efd['userData']['getValue']()['recentDrawings'])),tap(_0x211efd['updateRecentDrawings'])),_0x4c38c1=pipe(_0x211efd['userData'],observable['map'](_0x3253e5=>_0x3253e5['recentDrawings']),observable['filter'](_0x292cd1=>_0x292cd1['length']!==_0x4d7070['getValue']()['length']),observable['filter'](_0x12dce1=>!recentDrawingsArrayEq['equals'](_0x12dce1,_0x4d7070['getValue']())),tap(_0x2812ff)),_0x4b48ae=pipe(merge(_0x6dc186['drawings']['observeDrawingsUpdated'](),_0x6dc186['drawings']['model']['events']['drawingFinished']),observable['filter'](_0x428b52=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),tap(_0x9659b1=>{_0x41333f['saveDrawings']['next']();})),_0xa307=pipe(merge(_0x6dc186['drawings']['model']['events']['drawingMoved'],_0x6dc186['drawings']['model']['events']['drawingModified'],_0x6dc186['drawings']['model']['events']['drawingSelected'],_0x6dc186['drawings']['model']['events']['drawingFinished']),observable['filter'](_0x4da752=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),tap(_0x2a97d9=>{if(_0x2a97d9===null)_0x41333f['syncedDrawingUpdated']['next'](_0x2a97d9);else isAvailableDrawingModel(_0x2a97d9)&&_0x2a97d9['paneId']===CHART_UUID&&_0x2a97d9['synced']&&_0x41333f['syncedDrawingUpdated']['next'](_0x2a97d9);})),_0x2234a1=pipe(_0x6dc186['drawings']['model']['events']['drawingRemoved'],observable['filter'](_0x2beec6=>_0x3921ce['selectedChartId']['getValue']()===_0x8e10b6),tap(_0x49c938=>{_0x49c938['forEach'](_0x37dd2e=>{isAvailableDrawingModel(_0x37dd2e)&&_0x37dd2e['paneId']===CHART_UUID&&_0x37dd2e['synced']&&_0x41333f['syncedDrawingRemoved']['next'](_0x37dd2e);});})),_0xbd6843=pipe(_0x41333f['syncedDrawingRemoved'],observable['filter'](_0x4528b9=>_0x3921ce['selectedChartId']['getValue']()!==_0x8e10b6),tap(_0x289206=>{_0x6dc186['drawings']['removeDrawing'](_0x289206['id']);})),_0x56d615=pipe(_0x41333f['syncedDrawingUpdated'],observable['filter'](_0x1b9f82=>_0x3921ce['selectedChartId']['getValue']()!==_0x8e10b6),observable['map'](cloneUnsafe),tap(_0x11fc66=>{pipe(_0x3921ce['getSelectedChartInfo']()['instrument'],option['fold'](constVoid,_0x30f059=>{_0x6dc186['drawings']['model']['instrumentCode']===_0x30f059?_0x6dc186['drawings']['setActiveDrawing'](_0x11fc66):_0x11fc66!==null&&_0x6dc186['drawings']['setDrawing'](_0x30f059,_0x11fc66);}));})),_0x5022a1=pipe(_0x6dc186['paneManager']['paneRemovedSubject'],tap(_0x2c22cc=>{const _0x3afd89=_0x3921ce['getSelectedChartInfo'](),{drawings:_0x381850,instrument:_0x5db5eb}=_0x3afd89;pipe(_0x5db5eb,option['chain'](_0x5859d9=>pipe(_0x381850,record['lookup'](_0x5859d9))),option['fold'](constVoid,_0x35953b=>{_0x35953b['forEach'](_0x405a5a=>_0x405a5a['_internalDrawing']['paneId']===_0x2c22cc['uuid']&&_0x54684c(_0x405a5a['_internalDrawing'])),_0x51f311(_0x439ab4());}));})),_0x29a5b5=merge(_0x2e25fa,_0x344647,_0x34d9af,_0x123721,_0x1ee951,_0x3cc324,_0x1a65d5,_0x583a44,_0x32254e,_0xad8a35,_0x3319b4,_0x12fa3e,_0xe255be,_0x170c6c,_0x521f83,_0x4d9045,_0x54ef14,_0x338d2b,_0x498dd7,_0x5e07e1,_0x1ea08e,_0x43a38a,_0xa307,_0x2234a1,_0x56d615,_0xbd6843,_0x4b48ae,_0x5022a1,_0x30cd56,_0x29263a,_0x4c38c1);return sink['newSink'](callTracerProxy('drawingViewModel',{'availableDrawings':_0x160169,'drawingMode':_0x2cdb87,'drawings':_0x337eba,'isVisible':_0x3ea894,'isDisabled':_0x40a8b1,'currentEditableDrawing':_0x294eaf,'doesChartHaveDrawings':_0x58c1bc['asObservable'](),'isSettingsPopupOpened':_0x4e28b5,'isPopoverOpened':_0x200b4a,'iconDrawingIcons':_0x18120e,'toolbarPositionPixels':_0x52e875,'chartBounds':_0x2589f3,'toolbarWidth':_0x383daa,'favoriteDrawings':_0xae4a33,'drawingGroups':_0x1a26cc,'isDrawingsLimitReached':_0x23fe4f,'recentDrawings':_0x4d7070,'clearDrawings':_0xad75b,'setDrawings':_0x6110cf,'changeVisibility':_0x364a0,'cancelDrawing':_0x16a385,'startNewDrawing':_0x1f0e84,'startNewIconDrawing':_0xcf35b6,'updateDrawing':_0x3f7959,'removeDrawing':_0x54684c,'resetChanges':_0x4a986f,'toggleSettingsPopup':_0xb96a7,'togglePopover':_0x4c49a2,'handleDrag':_0xa95c95,'updateToolbarWidth':_0x1b995d,'sendMagnetModeNotification':_0x921eb,'sendDrawingModeNotification':_0x55103a,'sendDeleteDrawingsNotification':_0x111e0d,'onFavorite':_0x703e91,'onUnFavorite':_0xbd29f3,'changeMode':_0xa566f4,'toggleDrawingVisibility':_0x594b08,'toggleDrawingLocked':_0x12fe11}),_0x29a5b5);});const getIsDrawingsLimitReached=(_0x4d47fc,_0x327ff2)=>{const _0x4cfea3=_0x4d47fc['getSelectedChartInfo'](),{drawings:_0x467a15,instrument:_0x3acddb}=_0x4cfea3,_0x509ab6=pipe(_0x3acddb,option['map'](_0x489f4e=>_0x467a15[_0x489f4e]?_0x467a15[_0x489f4e]['length']:0x0),option['getOrElse'](()=>0x0));return _0x509ab6>=_0x327ff2['drawings']['limitOfDrawings'];};export const editDrawingMode=_0x4ce2b4=>({'mode':'EditDrawing','drawing':_0x4ce2b4});export const isEditDrawingMode=_0x31b2a7=>_0x31b2a7['mode']==='EditDrawing';const _0x455691={};_0x455691['mode']='Default';export const defaultMode=_0x455691;export const isDefaultMode=_0x377b65=>_0x377b65['mode']==='Default';export function copyDrawing(_0x30db88){const _0x175ec7=new DrawingModel(_0x30db88['id'],_0x30db88['htId'],_0x30db88['type'],_0x30db88['keyPoints'],_0x30db88['properties'],_0x30db88['visible'],_0x30db88['locked'],_0x30db88['synced'],_0x30db88['getPane']);return _0x175ec7['hidden']=_0x30db88['hidden'],_0x175ec7;}const toDrawingWithUpdatedKeypoints=(_0x2029d6,_0x3d85be)=>{if(!_0x3d85be['chartModel']['mainCandleSeries']['instrument']['symbol'])return none;const _0x5484cf=_0x3d85be['drawings']['getDrawings']()[_0x3d85be['chartModel']['mainCandleSeries']['instrument']['symbol']];return Array['isArray'](_0x5484cf)?pipe(_0x5484cf,array['findFirst'](_0x56c6e4=>_0x56c6e4['id']===_0x2029d6['id']),option['map'](_0x10f08b=>{const _0x5e1bb8=new DrawingModel(_0x2029d6['id'],_0x2029d6['htId'],_0x2029d6['type'],_0x10f08b['keyPoints'],_0x2029d6['properties'],_0x2029d6['visible']);return _0x5e1bb8['figure']['data']=_0x2029d6['figure']['data'],_0x5e1bb8['hidden']=_0x2029d6['hidden'],_0x5e1bb8;})):none;};