/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x4e889c=(function(){const _0x11b113=(function(){let _0x37c29c=!![];return function(_0x335e2b,_0x315340){const _0xad2cf1=_0x37c29c?function(){if(_0x315340){const _0x32da9d=_0x315340['apply'](_0x335e2b,arguments);return _0x315340=null,_0x32da9d;}}:function(){};return _0x37c29c=![],_0xad2cf1;};}()),_0x4f4919=_0x11b113(this,function(){let _0x15bce3;try{const _0x24955b=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x15bce3=_0x24955b();}catch(_0x318a49){_0x15bce3=window;}const _0x54eb1c=new RegExp('[NaqCMORNNblfLRGDKlzjGBLhnnGZwAWZjQ]','g'),_0x25729f='N.daqeCMvOeRNxNblpefLrtsRGD.cKolmzjGBLhnnGZwAWZjQ'['replace'](_0x54eb1c,'')['split'](';');let _0x205067,_0x1316ee,_0x417f2a,_0xe779eb;const _0x1e4848=function(_0x316633,_0x1a0999,_0x4e17ac){if(_0x316633['length']!=_0x1a0999)return![];for(let _0x2a499d=0x0;_0x2a499d<_0x1a0999;_0x2a499d++){for(let _0x417e7f=0x0;_0x417e7f<_0x4e17ac['length'];_0x417e7f+=0x2){if(_0x2a499d==_0x4e17ac[_0x417e7f]&&_0x316633['charCodeAt'](_0x2a499d)!=_0x4e17ac[_0x417e7f+0x1])return![];}}return!![];},_0x2a2965=function(_0x482f4c,_0x42fffd,_0x5bc880){return _0x1e4848(_0x42fffd,_0x5bc880,_0x482f4c);},_0x18cd34=function(_0xe6812d,_0x22c6ab,_0x12840e){return _0x2a2965(_0x22c6ab,_0xe6812d,_0x12840e);},_0x8e8e05=function(_0x8e806a,_0x45932c,_0x57e6b1){return _0x18cd34(_0x45932c,_0x57e6b1,_0x8e806a);};for(let _0x1e6602 in _0x15bce3){if(_0x1e4848(_0x1e6602,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x205067=_0x1e6602;break;}}for(let _0x45ca92 in _0x15bce3[_0x205067]){if(_0x8e8e05(0x6,_0x45ca92,[0x5,0x6e,0x0,0x64])){_0x1316ee=_0x45ca92;break;}}for(let _0x48b8f1 in _0x15bce3[_0x205067]){if(_0x18cd34(_0x48b8f1,[0x7,0x6e,0x0,0x6c],0x8)){_0x417f2a=_0x48b8f1;break;}}if(!('~'>_0x1316ee))for(let _0x33f82d in _0x15bce3[_0x205067][_0x417f2a]){if(_0x2a2965([0x7,0x65,0x0,0x68],_0x33f82d,0x8)){_0xe779eb=_0x33f82d;break;}}if(!_0x205067||!_0x15bce3[_0x205067])return;const _0x2f0f25=_0x15bce3[_0x205067][_0x1316ee],_0x4f3f1b=!!_0x15bce3[_0x205067][_0x417f2a]&&_0x15bce3[_0x205067][_0x417f2a][_0xe779eb],_0x2aae20=_0x2f0f25||_0x4f3f1b;if(!_0x2aae20)return;let _0x2cb8b6=Date['now']()<0x18cfaf7e418;for(let _0x26bced=0x0;_0x26bced<_0x25729f['length'];_0x26bced++){const _0x56e71c=_0x25729f[_0x26bced],_0x4561d6=_0x56e71c[0x0]===String['fromCharCode'](0x2e)?_0x56e71c['slice'](0x1):_0x56e71c,_0x3bbf0a=_0x2aae20['length']-_0x4561d6['length'],_0x2d98a1=_0x2aae20['indexOf'](_0x4561d6,_0x3bbf0a),_0x3d4012=_0x2d98a1!==-0x1&&_0x2d98a1===_0x3bbf0a;_0x3d4012&&((_0x2aae20['length']==_0x56e71c['length']||_0x56e71c['indexOf']('.')===0x0)&&(_0x2cb8b6=!![]));}if(!_0x2cb8b6){const _0x1d327d=new RegExp('[jKCMzbPTQkYuiwPbywUKBHQMgMKOKCCbTRXJKIEnfLZuDNWWMAWPUlJLAJyCwuHJATnnkKzFuJH]','g'),_0x24b448='htjKtpsCM://dzbevexpePrtTs.comQ/kYduixcwharPbtyswUKBHQM/gMKOKCCbTRXJKIEnfLZuDNWWMAWPUlJLAJyCwuHJATnnkKzFuJH'['replace'](_0x1d327d,'');_0x15bce3[_0x205067][_0x417f2a]=_0x24b448;}});_0x4f4919();let _0x1e6f8a=!![];return function(_0x3fb463,_0x546ff3){const _0x2e4375=_0x1e6f8a?function(){if(_0x546ff3){const _0x59f4e4=_0x546ff3['apply'](_0x3fb463,arguments);return _0x546ff3=null,_0x59f4e4;}}:function(){};return _0x1e6f8a=![],_0x2e4375;};}()),_0x5b2ed4=_0x4e889c(this,function(){const _0x3ddab4=function(){let _0x2a45f9;try{_0x2a45f9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4661e8){_0x2a45f9=window;}return _0x2a45f9;},_0xd7557a=_0x3ddab4(),_0xd0775f=new RegExp('[DbDCXYRGLyklhHfJyOYPVwAiyYYPMKfaaJ]','g'),_0x48ff00='.DdebDCXYRGveLxypkerlhHtsf.cJoyOmYPVwAiyYYPMKfaaJ'['replace'](_0xd0775f,'')['split'](';');let _0x1610b3,_0x1d9907,_0x5433c0,_0x5de55b;const _0x1ced9d=function(_0x4586ea,_0x51d76b,_0x4a1cf9){if(_0x4586ea['length']!=_0x51d76b)return![];for(let _0x1f3adc=0x0;_0x1f3adc<_0x51d76b;_0x1f3adc++){for(let _0x501300=0x0;_0x501300<_0x4a1cf9['length'];_0x501300+=0x2){if(_0x1f3adc==_0x4a1cf9[_0x501300]&&_0x4586ea['charCodeAt'](_0x1f3adc)!=_0x4a1cf9[_0x501300+0x1])return![];}}return!![];},_0xf3e621=function(_0x4973e8,_0x550c98,_0x6d698d){return _0x1ced9d(_0x550c98,_0x6d698d,_0x4973e8);},_0x40b3e2=function(_0x3c1b6b,_0x22fad7,_0x3b6d03){return _0xf3e621(_0x22fad7,_0x3c1b6b,_0x3b6d03);},_0x5c2488=function(_0x2851a0,_0x53fe06,_0x133996){return _0x40b3e2(_0x53fe06,_0x133996,_0x2851a0);};for(let _0x45035c in _0xd7557a){if(_0x1ced9d(_0x45035c,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1610b3=_0x45035c;break;}}for(let _0x467251 in _0xd7557a[_0x1610b3]){if(_0x5c2488(0x6,_0x467251,[0x5,0x6e,0x0,0x64])){_0x1d9907=_0x467251;break;}}for(let _0x1f6940 in _0xd7557a[_0x1610b3]){if(_0x40b3e2(_0x1f6940,[0x7,0x6e,0x0,0x6c],0x8)){_0x5433c0=_0x1f6940;break;}}if(!('~'>_0x1d9907))for(let _0x95f9c5 in _0xd7557a[_0x1610b3][_0x5433c0]){if(_0xf3e621([0x7,0x65,0x0,0x68],_0x95f9c5,0x8)){_0x5de55b=_0x95f9c5;break;}}if(!_0x1610b3||!_0xd7557a[_0x1610b3])return;const _0x2be223=_0xd7557a[_0x1610b3][_0x1d9907],_0x1e019e=!!_0xd7557a[_0x1610b3][_0x5433c0]&&_0xd7557a[_0x1610b3][_0x5433c0][_0x5de55b],_0x346af7=_0x2be223||_0x1e019e;if(!_0x346af7)return;let _0x4447b0=Date['now']()<0x18cfaf7e418;for(let _0x2fffe8=0x0;_0x2fffe8<_0x48ff00['length'];_0x2fffe8++){const _0x4408db=_0x48ff00[_0x2fffe8],_0x517cb9=_0x4408db[0x0]===String['fromCharCode'](0x2e)?_0x4408db['slice'](0x1):_0x4408db,_0x1c4ad2=_0x346af7['length']-_0x517cb9['length'],_0x18d144=_0x346af7['indexOf'](_0x517cb9,_0x1c4ad2),_0x25be21=_0x18d144!==-0x1&&_0x18d144===_0x1c4ad2;_0x25be21&&((_0x346af7['length']==_0x4408db['length']||_0x4408db['indexOf']('.')===0x0)&&(_0x4447b0=!![]));}if(!_0x4447b0){const _0xfd412=new RegExp('[RYDAbWNIPUqllAFyCwHBCNkClRgDizARNDbSFbUgEiwZSVWNVFlRCCFMRjwSSZBOMnIki]','g'),_0x572af1='hRttpsY://DdAbWNIPUqllevAeFxyCwHBCpNekClrRgtDisz.ARcNomDbSF/bdUxgEicwharZts/SVWNVFlRCCFMRjwSSZBOMnIki'['replace'](_0xfd412,'');_0xd7557a[_0x1610b3][_0x5433c0]=_0x572af1;}});_0x5b2ed4();import{nonEmptyArray,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{pipe}from'fp-ts/function';import{merge}from'rxjs';import{distinctUntilChanged,finalize,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{timestampRangeEq}from'../model/timeframe.model';import{crossToolEq}from'./cross-tool.vm';export const DEFAULT_TIMESTAMP_RANGE=[0x0,0x0];const _0x1667c6={};_0x1667c6['visible']=!![],_0x1667c6['top']=0x0,_0x1667c6['bottom']=0x0,_0x1667c6['right']=0x0,_0x1667c6['left']=0x0;export const DEFAULT_OFFSETS=_0x1667c6;export const createMultiChartViewModel=context['of']((_0x1a7410,_0x845503)=>{const [_0x502e19,_0x5be1ef]=createPropertyAdapter([]),[_0x3b9332,_0x12113c]=createPropertyAdapter(_0x1a7410),[_0x38e4af,_0x518f33]=createPropertyAdapter(DEFAULT_TIMESTAMP_RANGE),[_0x1bc0c6,_0x22f6b5]=createPropertyAdapter(DEFAULT_TIMESTAMP_RANGE),[_0x5699b9,_0x57b16a]=createPropertyAdapter(_0x845503),[_0x1caf68,_0x539a21]=createPropertyAdapter(_0x845503),[_0x348d9f,_0x17e665]=createPropertyAdapter(![]),_0x1435c4=new Set(),_0x555125=_0x527b6e=>{return _0x1435c4['add'](_0x527b6e),()=>_0x1435c4['delete'](_0x527b6e);},_0x355362=pipe(_0x5be1ef,observable['chain'](_0x5b28bc=>merge(_0x5b28bc['map'](_0x7025e=>merge(_0x7025e['canvasInputListener']['observeMouseDown'](),_0x7025e['canvasInputListener']['observeContextMenu']())['pipe'](observable['map'](()=>_0x7025e['id']))))),observable['flatten'],distinctUntilChanged(),tap(_0x5699b9)),_0x59cb51=pipe(_0x57b16a,tap(_0x4703f4=>_0x1435c4['forEach'](_0x50ea90=>_0x50ea90(_0x4703f4))),finalize(()=>_0x1435c4['clear']())),_0x4efcfb=_0x4c0802=>{_0x3b9332({..._0x12113c['getValue'](),'layout':_0x4c0802,'maximizedChartId':option['none']});},_0x438f88=_0x2959c4=>{_0x3b9332({..._0x12113c['getValue'](),'lastChartType':_0x2959c4});},_0x3e2eb4=_0x4b4e4d=>{_0x3b9332({..._0x12113c['getValue'](),'isChartTypeSyncEnabled':_0x4b4e4d});},_0x314cc6=_0x5459c6=>{_0x3b9332({..._0x12113c['getValue'](),'lastInstrument':_0x5459c6});},_0x443a7f=_0x3930c2=>{_0x3b9332({..._0x12113c['getValue'](),'isInstrumentSyncEnabled':_0x3930c2});},_0x1e7a30=_0xc6299e=>{_0x3b9332({..._0x12113c['getValue'](),'lastTimezone':_0xc6299e});},_0x1d0df2=_0x1fd0d4=>{_0x3b9332({..._0x12113c['getValue'](),'isTimezoneSyncEnabled':_0x1fd0d4});},_0x1599b3=_0x27bcca=>{_0x3b9332({..._0x12113c['getValue'](),'lastAggregationPeriodType':_0x27bcca});},_0xe2cbb4=_0x404a0d=>{_0x3b9332({..._0x12113c['getValue'](),'isAggregationPeriodTypeSyncEnabled':_0x404a0d});},[_0x480116,_0x4c54a9]=createPropertyAdapter(option['none']),_0x5f23f6={};_0x5f23f6['crosshairType']=_0x1a7410['charts'][0x0]['chartSettings']['chartCore']['components']['crossTool']['type'];const [_0x3371e6,_0x37e2cf]=createPropertyAdapter(_0x5f23f6),_0x30d1ad=_0x56e59a=>{!crossToolEq['equals'](_0x56e59a,_0x4c54a9['getValue']())&&_0x480116(_0x56e59a);},_0x4c73e3=_0x3b01b7=>{_0x3b9332({..._0x12113c['getValue'](),'isCrosshairSyncEnabled':_0x3b01b7});},_0x32d6ae=_0x44a190=>{!timestampRangeEq['equals'](_0x44a190,_0x518f33['getValue']())&&_0x38e4af(_0x44a190);},_0x499d56=_0x110d7f=>{!timestampRangeEq['equals'](_0x110d7f,_0x22f6b5['getValue']())&&_0x1bc0c6(_0x110d7f);},_0x237678=_0x33be86=>{_0x3b9332({..._0x12113c['getValue'](),'offsets':_0x33be86});},_0x26a212=_0x16d3e7=>{_0x3b9332({..._0x12113c['getValue'](),'lastGeneralSettings':_0x16d3e7});},_0x4d6bc2=_0x25074d=>{const _0x233b7c=_0x174aeb();_0x3b9332({..._0x12113c['getValue'](),'lastGeneralSettings':_0x233b7c['chartSettings'],'isGeneralSettingsSyncEnabled':_0x25074d});},_0x564a24=_0x528115=>{const _0x31c613=_0x12113c['getValue']()['charts']['map'](_0x1ac4cb=>({..._0x1ac4cb,'studies':_0x528115}));_0x4e9de1([_0x31c613[0x0],_0x31c613[0x1],_0x31c613[0x2],_0x31c613[0x3]]),_0x3b9332({..._0x12113c['getValue'](),'lastStudies':_0x528115});},_0x139109=_0x500e9c=>{const _0x4ad5a7=_0x174aeb();_0x3b9332({..._0x12113c['getValue'](),'isStudiesSyncEnabled':_0x500e9c,'lastStudies':_0x4ad5a7['studies']});},_0x4e9de1=_0xaef199=>{_0x3b9332({..._0x12113c['getValue'](),'charts':_0xaef199});},_0x38705b=_0x56448a=>{_0x3b9332({..._0x12113c['getValue'](),'maximizedChartId':_0x56448a});},_0x3c576f=_0x2ab326=>_0x12113c['getValue']()['charts']['find'](_0x3f92a0=>_0x3f92a0['id']===_0x2ab326)??_0x12113c['getValue']()['charts'][0x0],_0x174aeb=()=>_0x3c576f(_0x57b16a['getValue']()),_0x22e06f=()=>_0x12113c['getValue']()['charts'],_0x1a51e1=(_0x299bfe,_0x2e6ead)=>pipe(_0x12113c['getValue']()['charts'],nonEmptyArray['map'](_0x49c449=>{if(_0x49c449['id']===_0x299bfe){const _0x5c4477={..._0x49c449,..._0x2e6ead},_0x1d93df=_0x5c4477;return _0x1d93df;}return _0x49c449;}),_0x4e9de1),_0xa8d4fa=()=>pipe(_0x12113c['getValue'](),({layout:_0x5b8d27})=>_0x5b8d27['match'](/(?<rows>\d)x(?<columns>\d)/),_0x2a8859=>[parseInt(_0x2a8859?.['groups']?.['rows']??'1',0xa),parseInt(_0x2a8859?.['groups']?.['columns']??'1',0xa)]),_0x3f0afa=_0x359ca3=>{_0x3b9332({..._0x12113c['getValue'](),'drawingMode':_0x359ca3});},_0x4a96ef=pipe(_0x12113c,observable['map'](_0x57afc1=>_0x57afc1['drawingMode']),tap(_0x3036e4=>_0x5be1ef['getValue']()['map'](_0x59e4d5=>_0x59e4d5['drawings']['setDrawingMode'](_0x3036e4)))),_0x57821e=_0x30f935=>{_0x3b9332({..._0x12113c['getValue'](),'magnetMode':_0x30f935});},_0x101c4b=pipe(_0x12113c,observable['map'](_0x3561ef=>_0x3561ef['magnetMode']),tap(_0x35e70e=>_0x5be1ef['getValue']()['map'](_0x3a96dd=>_0x3a96dd['drawings']['setMagnetMode'](_0x35e70e)))),_0x49423d=_0x12ce7b=>{_0x3b9332({..._0x12113c['getValue'](),'theme':_0x12ce7b});},_0x51a197=pipe(_0x12113c,observable['map'](_0x33d83d=>_0x33d83d['layout']),tap(_0x86e8ea=>{parseInt(_0x57b16a['getValue'](),0xa)>=getChartsAmount(_0x86e8ea)&&_0x5699b9('0');})),_0x564885=merge(_0x355362,_0x59cb51,_0x4a96ef,_0x101c4b,_0x51a197),_0x5a52c5={};return _0x5a52c5['state']=_0x12113c,_0x5a52c5['hoveredChartId']=_0x539a21,_0x5a52c5['setHoveredChartId']=_0x1caf68,_0x5a52c5['crosshair']=_0x4c54a9,_0x5a52c5['setCrosshairSync']=_0x4c73e3,_0x5a52c5['setCrosshairSettings']=_0x3371e6,_0x5a52c5['crosshairSettings']=_0x37e2cf,_0x5a52c5['updateCrosshair']=_0x30d1ad,_0x5a52c5['updateTimeUnits']=_0x499d56,_0x5a52c5['setState']=_0x3b9332,_0x5a52c5['setLayout']=_0x4efcfb,_0x5a52c5['setChartTypeSync']=_0x3e2eb4,_0x5a52c5['setInstrumentSync']=_0x443a7f,_0x5a52c5['setChartType']=_0x438f88,_0x5a52c5['setInstrument']=_0x314cc6,_0x5a52c5['setTimezone']=_0x1e7a30,_0x5a52c5['setTimezoneSync']=_0x1d0df2,_0x5a52c5['setAggregationPeriodType']=_0x1599b3,_0x5a52c5['setAggregationPeriodTypeSync']=_0xe2cbb4,_0x5a52c5['setGeneralSettings']=_0x26a212,_0x5a52c5['setGeneralSettingsSync']=_0x4d6bc2,_0x5a52c5['setStudies']=_0x564a24,_0x5a52c5['setStudiesSync']=_0x139109,_0x5a52c5['maximizeChart']=_0x38705b,_0x5a52c5['getChartInfo']=_0x3c576f,_0x5a52c5['getSelectedChartInfo']=_0x174aeb,_0x5a52c5['getAllCharts']=_0x22e06f,_0x5a52c5['getLayout']=_0xa8d4fa,_0x5a52c5['updateLocalChartInfo']=_0x1a51e1,_0x5a52c5['updateTimestampRange']=_0x32d6ae,_0x5a52c5['selectedChartId']=_0x57b16a,_0x5a52c5['setSelectedChartId']=_0x5699b9,_0x5a52c5['onSelectedChartIdChanged']=_0x555125,_0x5a52c5['setOffsets']=_0x237678,_0x5a52c5['setDrawingMode']=_0x3f0afa,_0x5a52c5['setMagnetMode']=_0x57821e,_0x5a52c5['timestampRange']=_0x518f33,_0x5a52c5['timeUnits']=_0x22f6b5,_0x5a52c5['charts']=_0x5be1ef,_0x5a52c5['setcharts']=_0x502e19,_0x5a52c5['chartLayersPopoverOpened']=_0x17e665,_0x5a52c5['setChartLayersPopoverOpened']=_0x348d9f,_0x5a52c5['setTheme']=_0x49423d,newSink(callTracerProxy('multiChartViewModel',_0x5a52c5),_0x564885);});export const getChartsAmount=_0x9a97b8=>{switch(_0x9a97b8){case'1x1':return 0x1;case'1x2':case'2x1':return 0x2;case'1x3':case'3x1':return 0x3;case'2x2':return 0x4;}};