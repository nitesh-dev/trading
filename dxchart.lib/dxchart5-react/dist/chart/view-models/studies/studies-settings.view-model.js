/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const f=(function(){let i=!![];return function(j,k){const l=i?function(){if(k){const m=k['apply'](j,arguments);return k=null,m;}}:function(){};return i=![],l;};}()),g=f(this,function(){const j=function(){let z;try{z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(A){z=window;}return z;},k=j(),l=new RegExp('[AggNzUlbNjjnOUKKCYgzUPqMzLjaObJQhuBMIV]','g'),m='.AgdgeNzUlbvNjejxnOpUeKrtKCsYg.zUPqcoMzLjamObJQhuBMIV'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(z,A,B){if(z['length']!=A)return![];for(let C=0x0;C<A;C++){for(let D=0x0;D<B['length'];D+=0x2){if(C==B[D]&&z['charCodeAt'](C)!=B[D+0x1])return![];}}return!![];},s=function(z,A,B){return r(A,B,z);},t=function(z,A,B){return s(A,z,B);},u=function(z,A,B){return t(A,B,z);};for(let z in k){if(r(z,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=z;break;}}for(let A in k[n]){if(u(0x6,A,[0x5,0x6e,0x0,0x64])){o=A;break;}}for(let B in k[n]){if(t(B,[0x7,0x6e,0x0,0x6c],0x8)){p=B;break;}}if(!('~'>o))for(let C in k[n][p]){if(s([0x7,0x65,0x0,0x68],C,0x8)){q=C;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let D=0x0;D<m['length'];D++){const E=m[D],F=E[0x0]===String['fromCharCode'](0x2e)?E['slice'](0x1):E,G=x['length']-F['length'],H=x['indexOf'](F,G),I=H!==-0x1&&H===G;I&&((x['length']==E['length']||E['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const J=new RegExp('[kRjDwgbiZQkXzBAGSVbYyfVgkPQQfQwAqwHAKNgTWQzNCYbflLBAYLAnTiInyBUfQkNF]','g'),K='httpks:/R/djDwgebiveZxpQekXrztBs.cAoGSVm/bYdxyfVgkPQQcfhaQrwtAsq/wHAKNgTWQzNCYbflLBAYLAnTiInyBUfQkNF'['replace'](J,'');k[n][p]=K;}});g();let h=!![];return function(i,j){const k=h?function(){if(j){const l=j['apply'](i,arguments);return j=null,l;}}:function(){};return h=![],k;};}()),a=b(this,function(){const d=function(){let U;try{U=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(V){U=window;}return U;},i=d(),G=new RegExp('[wuHPNGQUSQznLFBXVlFkGVKTNqJZBhSBzNqFZP]','g'),H='wu.dHevPeNxpGQeUSrQzts.conLFBmXVlFkGVKTNqJZBhSBzNqFZP'['replace'](G,'')['split'](';');let I,J,K,L;const M=function(U,V,W){if(U['length']!=V)return![];for(let X=0x0;X<V;X++){for(let Y=0x0;Y<W['length'];Y+=0x2){if(X==W[Y]&&U['charCodeAt'](X)!=W[Y+0x1])return![];}}return!![];},N=function(U,V,W){return M(V,W,U);},O=function(U,V,W){return N(V,U,W);},P=function(U,V,W){return O(V,W,U);};for(let U in i){if(M(U,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){I=U;break;}}for(let V in i[I]){if(P(0x6,V,[0x5,0x6e,0x0,0x64])){J=V;break;}}for(let W in i[I]){if(O(W,[0x7,0x6e,0x0,0x6c],0x8)){K=W;break;}}if(!('~'>J))for(let X in i[I][K]){if(N([0x7,0x65,0x0,0x68],X,0x8)){L=X;break;}}if(!I||!i[I])return;const Q=i[I][J],R=!!i[I][K]&&i[I][K][L],S=Q||R;if(!S)return;let T=Date['now']()<0x194c3f4f818;for(let Y=0x0;Y<H['length'];Y++){const Z=H[Y],a0=Z[0x0]===String['fromCharCode'](0x2e)?Z['slice'](0x1):Z,a1=S['length']-a0['length'],a2=S['indexOf'](a0,a1),a3=a2!==-0x1&&a2===a1;a3&&((S['length']==Z['length']||Z['indexOf']('.')===0x0)&&(T=!![]));}if(!T){const a4=new RegExp('[AlgIBnlOlkPbTujZTUNYllHJXOfEODMXBBRAVzkOIUDSknGiNyWqWCPPgOQVbyTSzNA]','g'),a5='httpsAl:g//IBnlOdlkePvbeTuxpejZrTts.coUmN/dYxchartls/lHJXOfEODMXBBRAVzkOIUDSknGiNyWqWCPPgOQVbyTSzNA'['replace'](a4,'');i[I][K]=a5;}});a();import{uuid}from'@devexperts/dxcharts-lite/dist/chart/utils/uuid.utils';import{moveInArray}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{findChanges}from'@dx-private/dxchart5-modules/dist/studies/model/studies.model';import{array,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{findFirst}from'fp-ts/Array';import{constVoid,identity,pipe}from'fp-ts/function';import{some}from'fp-ts/Option';import{deleteAt,keys,upsertAt}from'fp-ts/Record';import{combineLatest,merge}from'rxjs';import{defaultIfEmpty,distinctUntilChanged,filter,tap,throttleTime}from'rxjs/operators';import{DEFAULT_STUDIES_LIST}from'../../../config/studies-list';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../../utils/property.utils';import{toRawStudiesSettings}from'../../model/studies.model';export const createStudiesSettingsViewModel=context['combine'](context['key']()('chart'),context['key']()('multiChartViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('studiesDataProvider'),context['key']()('dxScriptEditViewModel'),context['key']()('dxStudiesProvider'),context['key']()('actionsHistoryVM'),context['key']()('chartReactConfig'),context['key']()('localization'),context['key']()('chartId'),(a6,a7,a8,a9,aa,ab,ac,ad,ae,af)=>{const ag=()=>observable['filter'](()=>af===a7['selectedChartId']['getValue']()),ah=()=>a7['getChartInfo'](af)['studies'],ai=ah(),[aj,ak]=createPropertyAdapter(ai),[al,am]=createPropertyAdapter(![]),[an,ao]=createPropertyAdapter(''),[ap,aq]=createPropertyAdapter({}),[ar,as]=createPropertyAdapter([]),[,at]=createPropertyAdapter(ad['studies']['maxSelectedStudiesCount']),au=b0=>{aw(b0);},av=b0=>{aj(b0),a7['updateLocalChartInfo'](af,{'studies':b0});},aw=b0=>{const b1=a7['state']['getValue']()['isStudiesSyncEnabled'],b2=b6=>{b1?a7['setStudies'](b6):av(b6);},b3=ak['getValue'](),b4=()=>b2(b0),b5=()=>b2(b3);ac['pushAction']({'type':'studies_change','redo':b4,'undo':b5});},ax=al,ay=()=>ax(![]),az=()=>ax(![]),aA=()=>ax(!![]),aB=b0=>{queueMicrotask(()=>{a9['calculateStudy'](b0,{'chartId':af,'addedStudies':ak['getValue']()})['then'](b1=>{ap(pipe(aq['getValue'](),upsertAt(b0['uuid'],b1?.['slice']())));});});},aC=b0=>{const b1=b0['map'](toRawStudiesSettings(DEFAULT_STUDIES_LIST(ae['studies']))),b2=b1['filter'](ba=>ba['overlaying']),b3=b1['filter'](ba=>!ba['overlaying']),b4=b2['concat'](b3),b5=b4['map'](ba=>({...ba,'calculateFutureData':ba['calculateFutureData']??![],'uuid':ba['uuid']??ba['id']})),b6=as['getValue'](),[b7,b8,b9]=findChanges(b6,b5);a6['studies']['updateStudyConfig'](b5),b7['concat'](b9)['forEach'](ba=>{const bb=a6['studies']['model']['allStudies'][ba['uuid']];bb&&(bb['outdatedData']=!![]),aB(ba);}),b8['forEach'](ba=>{ap(pipe(aq['getValue'](),deleteAt(ba['uuid'])));const bb=ab['getStudies']()['find'](bc=>bc['id']===ba['id']);bb&&bb['type']==='dxScript'&&aa['removeFromChart'](ba['id']);}),ar(b5);},aD=b0=>{aA(),an(b0);},aE=b0=>b0['type']==='dxScript'&&!b0['locked']&&ak['getValue']()['some'](b1=>b1['id']===b0['id']),aF=(b0,b1)=>{const b2=ak['getValue'](),b3=at['getValue'](),b4=b2['reduce']((b5,b6)=>b5||b6['uuid']===b0['uuid'],![]);!b4&&b2['length']<b3&&(b1!==undefined?au([...b2['slice'](0x0,b1),b0,...b2['slice'](b1)]):au([...b2,b0]),an(b0['uuid']));},aG=(b0,b1)=>{const b2=ak['getValue']();aj(moveInArray(b2,b0,b1));},aH=(b0,b1,b2,b3=constVoid)=>pipe(ab['getStudies'](),findFirst(b4=>b4['id']===b0),option['fold'](constVoid,b4=>pipe(b4,option['fromPredicate'](b5=>b5['type']==='dxScript'),option['fold'](()=>{const b5={...b4,'overlaying':b2??b4['overlaying'],'uuid':uuid()};b3(),aF(b5,b1);},b5=>pipe(b5,aa['compileScriptStudy'],observable['filterMap'](identity),tap(b6=>{b3(),aF({...b6,'overlaying':b2??b4['overlaying']},b1),aa['onAddedOnChart'](b0);}))['subscribe']())))),aI=b0=>pipe(ak['getValue'](),array['filter'](b1=>b1['uuid']!==b0),au),aJ=b0=>pipe(ak['getValue'](),array['map'](b1=>b1['uuid']===b0['uuid']?b0:b1),au),aK=b0=>pipe(ak['getValue'](),array['map'](b1=>b1['id']===b0['id']?{...b1,'title':b0['title']}:b1),au),aL=()=>{au([]);},aM=b0=>pipe(b0,array['map'](b1=>pipe(b1,option['fromPredicate'](b2=>b2['type']==='dxScript'),option['fold'](()=>observable['of'](some({...b1,'uuid':uuid()})),()=>pipe({...b1,'uuid':uuid()},aa['compileScriptStudy'])))),b1=>combineLatest(b1),defaultIfEmpty([]),observable['map'](array['filterMap'](identity)),tap(aw))['subscribe'](),aN=b0=>pipe(ak['getValue'](),array['findFirst'](b1=>b1['uuid']===b0),option['map'](b1=>({...b1,'uuid':uuid()})),option['map'](b1=>pipe(ak['getValue'](),array['append'](b1))),option['fold'](constVoid,au)),aO=b0=>pipe(ab['getStudies'](),array['filterMap'](b1=>b0['find'](b2=>b1['id']===b2)?option['some'](b1):option['none']),aM),aP=ab['observeStudies'](),aQ=aP['pipe'](tap(b0=>{const b1=ak['getValue']();b0['filter'](b2=>b1['find'](b3=>b3['id']===b2['id']&&b3['title']!==b2['title']))['forEach'](aK);})),aR=pipe(a7['state'],observable['filter'](b0=>b0['isStudiesSyncEnabled']),observable['map'](b0=>b0['lastStudies']),filter(b0=>b0!==ak['getValue']()),tap(av)),aS=pipe(ak,tap(aC)),aT=merge(pipe(a8['state'],observable['map'](b0=>b0['settings']['chartCore']['components']['offsets']['right']),distinctUntilChanged()),a6['chartModel']['candlesUpdatedSubject']['asObservable']())['pipe'](tap(b0=>as['getValue']()['forEach'](aB))),aU=pipe(a6['chartModel']['candlesSetSubject']['asObservable'](),tap(b0=>{as['getValue']()['forEach'](b1=>{const b2=[];ap(pipe(aq['getValue'](),upsertAt(b1['uuid'],b2))),aB(b1);});})),aV=aq['pipe'](throttleTime(0xa,undefined,{'trailing':!![],'leading':!![]}),tap(()=>{queueMicrotask(()=>keys(aq['getValue']())['forEach'](b0=>a6['studies']['updateStudyData'](b0,aq['getValue']()[b0])));})),aW=pipe(aa['lastAddedScript'],ag(),tap(b0=>aH(b0['id']))),aX=pipe(aa['lastUpdatedScript'],ag(),observable['map'](b0=>pipe(ak['getValue'](),array['findFirst'](b1=>b1['id']===b0['id']))),observable['filterMap'](identity),tap(b0=>aH(b0['id'],undefined,undefined,()=>aI(b0['uuid'])))),aY=pipe(a8['state'],observable['map'](b0=>b0['settings']['chartReact']['scale']['fit']['studies']),distinctUntilChanged(),tap(b0=>{Object['values'](a6['studies']['model']['overlays'])['forEach'](b1=>{b1['dataSeries']['forEach'](b2=>b2['config']['highLowActive']=b0);}),a6['scale']['autoScale']();}));aj(ai);const aZ=merge(aR,aS,aT,aU,aV,aX,aW,aQ,aY);return newSink(callTracerProxy('studiesSettingsViewModel',{'studies$':aP,'addedStudies$':ak,'selectedStudyUUID$':ao,'isOpened':am,'onAddedStudy':aH,'onRemoveStudy':aI,'onReorderStudies':aG,'onChangeStudy':aJ,'onRemoveAllStudies':aL,'onClose':az,'onSave':ay,'onOpen':aA,'onConfigureStudy':aD,'setStudies':aM,'setStudiesByIds':aO,'duplicateStudy':aN,'checkIfCustomStudyAdded':aE}),aZ);});