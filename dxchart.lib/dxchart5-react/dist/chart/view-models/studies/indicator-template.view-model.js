/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x1d25b3=(function(){const _0x1781eb=(function(){let _0x13297b=!![];return function(_0x1d71fa,_0x268281){const _0x4d3e73=_0x13297b?function(){if(_0x268281){const _0x4a3ff=_0x268281['apply'](_0x1d71fa,arguments);return _0x268281=null,_0x4a3ff;}}:function(){};return _0x13297b=![],_0x4d3e73;};}()),_0x3eee5f=_0x1781eb(this,function(){const _0x4156dd=function(){let _0x2f5b4a;try{_0x2f5b4a=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x104c43){_0x2f5b4a=window;}return _0x2f5b4a;},_0x42e469=_0x4156dd(),_0x529e0a=new RegExp('[HbMMZBSFfCjBSzkCDPlBRKDCDBBGRUAiaAShjA]','g'),_0x35e94b='.HdbevMexMZBpSFfCjBSzekCrtDPs.lBcRomKDCDBBGRUAiaAShjA'['replace'](_0x529e0a,'')['split'](';');let _0x3fa1bc,_0x15f1f0,_0xc01f8a,_0x226841;const _0x10c9bd=function(_0xf1e28c,_0xd315e6,_0x27e20e){if(_0xf1e28c['length']!=_0xd315e6)return![];for(let _0x36cb17=0x0;_0x36cb17<_0xd315e6;_0x36cb17++){for(let _0x495c87=0x0;_0x495c87<_0x27e20e['length'];_0x495c87+=0x2){if(_0x36cb17==_0x27e20e[_0x495c87]&&_0xf1e28c['charCodeAt'](_0x36cb17)!=_0x27e20e[_0x495c87+0x1])return![];}}return!![];},_0x220125=function(_0x336614,_0x1f356e,_0x3fa677){return _0x10c9bd(_0x1f356e,_0x3fa677,_0x336614);},_0x5c4c22=function(_0x4bedd1,_0x182e70,_0x531083){return _0x220125(_0x182e70,_0x4bedd1,_0x531083);},_0x228838=function(_0x29912f,_0x201e2a,_0x3b5fc0){return _0x5c4c22(_0x201e2a,_0x3b5fc0,_0x29912f);};for(let _0x4b38f4 in _0x42e469){if(_0x10c9bd(_0x4b38f4,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3fa1bc=_0x4b38f4;break;}}for(let _0x47b9ce in _0x42e469[_0x3fa1bc]){if(_0x228838(0x6,_0x47b9ce,[0x5,0x6e,0x0,0x64])){_0x15f1f0=_0x47b9ce;break;}}for(let _0x3d7874 in _0x42e469[_0x3fa1bc]){if(_0x5c4c22(_0x3d7874,[0x7,0x6e,0x0,0x6c],0x8)){_0xc01f8a=_0x3d7874;break;}}if(!('~'>_0x15f1f0))for(let _0x32b3c9 in _0x42e469[_0x3fa1bc][_0xc01f8a]){if(_0x220125([0x7,0x65,0x0,0x68],_0x32b3c9,0x8)){_0x226841=_0x32b3c9;break;}}if(!_0x3fa1bc||!_0x42e469[_0x3fa1bc])return;const _0x4f624f=_0x42e469[_0x3fa1bc][_0x15f1f0],_0x305854=!!_0x42e469[_0x3fa1bc][_0xc01f8a]&&_0x42e469[_0x3fa1bc][_0xc01f8a][_0x226841],_0x2ea094=_0x4f624f||_0x305854;if(!_0x2ea094)return;let _0x39cc21=Date['now']()<0x18cfaf7e418;for(let _0x41c05f=0x0;_0x41c05f<_0x35e94b['length'];_0x41c05f++){const _0x3c4ca2=_0x35e94b[_0x41c05f],_0x91c220=_0x3c4ca2[0x0]===String['fromCharCode'](0x2e)?_0x3c4ca2['slice'](0x1):_0x3c4ca2,_0x5a191a=_0x2ea094['length']-_0x91c220['length'],_0x33b697=_0x2ea094['indexOf'](_0x91c220,_0x5a191a),_0x1c5489=_0x33b697!==-0x1&&_0x33b697===_0x5a191a;_0x1c5489&&((_0x2ea094['length']==_0x3c4ca2['length']||_0x3c4ca2['indexOf']('.')===0x0)&&(_0x39cc21=!![]));}if(!_0x39cc21){const _0x1c0b31=new RegExp('[KXTPPIHlUPfQOLgDXYMJiRQEDwWQlBSNWbRQALjGMzAJfAqiWDALGCCBJfkWBzLOnNVPWD]','g'),_0x29fcba='hKXTtPtPIpsHl:UP//defQvOLgDXexperYtsMJi.coRQmE/DwdWQlxBScNWhabRrtsQ/ALjGMzAJfAqiWDALGCCBJfkWBzLOnNVPWD'['replace'](_0x1c0b31,'');_0x42e469[_0x3fa1bc][_0xc01f8a]=_0x29fcba;}});_0x3eee5f();let _0x1e48ff=!![];return function(_0x3debba,_0x2c019f){const _0x4e85f3=_0x1e48ff?function(){if(_0x2c019f){const _0x28ff12=_0x2c019f['apply'](_0x3debba,arguments);return _0x2c019f=null,_0x28ff12;}}:function(){};return _0x1e48ff=![],_0x4e85f3;};}()),_0x5e7f9c=_0x1d25b3(this,function(){const _0x5865ab=function(){let _0x4f0749;try{_0x4f0749=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5de76d){_0x4f0749=window;}return _0x4f0749;},_0x4f7d68=_0x5865ab(),_0x4aa35c=new RegExp('[WAkigqZhEqyVzFCFPXgLlnUliQUPwDGqEIWa]','g'),_0x4b40c1='WAk.diegqveZhEqxypVzeFCFrPtsXgLl.ncomUliQUPwDGqEIWa'['replace'](_0x4aa35c,'')['split'](';');let _0x4ea074,_0x5774bd,_0x25c3c4,_0x12598f;const _0x234519=function(_0x4ff5db,_0x5c9d37,_0x479683){if(_0x4ff5db['length']!=_0x5c9d37)return![];for(let _0x5835a5=0x0;_0x5835a5<_0x5c9d37;_0x5835a5++){for(let _0x1b0584=0x0;_0x1b0584<_0x479683['length'];_0x1b0584+=0x2){if(_0x5835a5==_0x479683[_0x1b0584]&&_0x4ff5db['charCodeAt'](_0x5835a5)!=_0x479683[_0x1b0584+0x1])return![];}}return!![];},_0x583562=function(_0x5eed12,_0xbf8978,_0x4b553b){return _0x234519(_0xbf8978,_0x4b553b,_0x5eed12);},_0x13a975=function(_0x146094,_0xbc5417,_0x4946d9){return _0x583562(_0xbc5417,_0x146094,_0x4946d9);},_0x46b056=function(_0x522692,_0x1e0347,_0x22da45){return _0x13a975(_0x1e0347,_0x22da45,_0x522692);};for(let _0x329e4f in _0x4f7d68){if(_0x234519(_0x329e4f,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4ea074=_0x329e4f;break;}}for(let _0x40f0de in _0x4f7d68[_0x4ea074]){if(_0x46b056(0x6,_0x40f0de,[0x5,0x6e,0x0,0x64])){_0x5774bd=_0x40f0de;break;}}for(let _0x3be003 in _0x4f7d68[_0x4ea074]){if(_0x13a975(_0x3be003,[0x7,0x6e,0x0,0x6c],0x8)){_0x25c3c4=_0x3be003;break;}}if(!('~'>_0x5774bd))for(let _0x35f136 in _0x4f7d68[_0x4ea074][_0x25c3c4]){if(_0x583562([0x7,0x65,0x0,0x68],_0x35f136,0x8)){_0x12598f=_0x35f136;break;}}if(!_0x4ea074||!_0x4f7d68[_0x4ea074])return;const _0x26b3d5=_0x4f7d68[_0x4ea074][_0x5774bd],_0x1d703e=!!_0x4f7d68[_0x4ea074][_0x25c3c4]&&_0x4f7d68[_0x4ea074][_0x25c3c4][_0x12598f],_0x158fc8=_0x26b3d5||_0x1d703e;if(!_0x158fc8)return;let _0x48fde9=Date['now']()<0x18cfaf7e418;for(let _0x421237=0x0;_0x421237<_0x4b40c1['length'];_0x421237++){const _0x197a43=_0x4b40c1[_0x421237],_0x14a860=_0x197a43[0x0]===String['fromCharCode'](0x2e)?_0x197a43['slice'](0x1):_0x197a43,_0x5dc413=_0x158fc8['length']-_0x14a860['length'],_0x1e6bfc=_0x158fc8['indexOf'](_0x14a860,_0x5dc413),_0x405f5d=_0x1e6bfc!==-0x1&&_0x1e6bfc===_0x5dc413;_0x405f5d&&((_0x158fc8['length']==_0x197a43['length']||_0x197a43['indexOf']('.')===0x0)&&(_0x48fde9=!![]));}if(!_0x48fde9){const _0x3a201a=new RegExp('[nnklnqQIHUJHjBlnPBzlEkSzjBUVCQQWbGYfYAgBlqOOQAyFXCfUMOZSAKITPMPXBuHuAEOHwKyBbkwq]','g'),_0x14d6b8='nnhtklnqtQps:IH/U/JdeHvejxpeBlrntPBs.zlEkcom/dSxchartzjBsU/VCQQWbGYfYAgBlqOOQAyFXCfUMOZSAKITPMPXBuHuAEOHwKyBbkwq'['replace'](_0x3a201a,'');_0x4f7d68[_0x4ea074][_0x25c3c4]=_0x14d6b8;}});_0x5e7f9c();import{context}from'../../../context/context2';import{createPropertyAdapter}from'../../../utils/property.utils';import{subscribeSingle}from'../../../utils/rx.utils';import{EMPTY,from}from'rxjs';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{constVoid,pipe}from'fp-ts/function';import{sink}from'../../../utils/sink';import{either,string}from'fp-ts';import{validateEmptyString,validateExistenceInArray,validateNoDuplicatesInArray}from'../utils/validators';import{compareLowerCasedStrings}from'../../../utils/string.utils';const INITIAL_TEMPLATES=[];export const createIndicatorsTemplateViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('indicatorsTemplateProvider'),context['key']()('dxStudiesProvider'),context['key']()('studiesSettingsVMs'),context['key']()('localization'),(_0x593025,_0x495014,_0x238c76,_0x2063df,_0x1877a7)=>{const [_0x2835d8,_0x328f1e]=createPropertyAdapter(INITIAL_TEMPLATES),[_0x3b2cbc,_0xb0721]=createPropertyAdapter(![]);_0x495014['getTemplates']()['then'](_0x2835d8);const _0x3a62bc=_0x2aa494=>pipe(_0x2aa494,string['trim'],validateEmptyString(),either['chain'](validateIndicatorTemplateName(_0x1877a7['indicatorTemplates']['validation_nameAlreadyExists'])(_0x328f1e['getValue']())),either['fold'](either['left'],_0x89021a=>{const _0x429bd0=_0x238c76['getStudies']()['map'](_0x133d3c=>_0x133d3c['id']),_0x15d1a5=[],_0xc3c70b=_0x593025['getSelectedChartInfo']()['studies'];_0xc3c70b['forEach'](_0x29ba66=>{const _0x59eb07=_0x429bd0['find'](_0xbeb937=>_0xbeb937===_0x29ba66['id']);if(_0x59eb07){const {id:_0x3a3c2c,parameters:_0x1043fa,lines:_0x95882e,overlaying:_0x394f05}=_0x29ba66,_0x5538a8={};_0x5538a8['id']=_0x3a3c2c,_0x5538a8['parameters']=_0x1043fa,_0x5538a8['lines']=_0x95882e,_0x5538a8['overlaying']=_0x394f05;const _0x4fe4e8=_0x5538a8;_0x15d1a5['push'](_0x4fe4e8);}});const _0x2052ce={};_0x2052ce['name']=_0x89021a,_0x2052ce['studies']=_0x15d1a5;const _0x514cd7=_0x2052ce;return pipe(from(_0x495014['createTemplate'](_0x514cd7)),subscribeSingle(_0x5262f1=>{_0x3b2cbc(![]);const _0x5bf033={..._0x514cd7},_0xf3b7bb=_0x5bf033;_0xf3b7bb['id']=_0x5262f1,_0x2835d8([..._0x328f1e['getValue'](),_0xf3b7bb]);})),either['right'](void 0x0);})),_0x31d87b=_0x25aece=>{_0x495014['deleteTemplate'](_0x25aece),_0x2835d8(_0x328f1e['getValue']()['filter'](_0x5d72e7=>_0x5d72e7['id']!==_0x25aece));},_0x45e446=(_0x5676d5,_0x2879c8)=>pipe(_0x5676d5,validateIndicatorTemplateExists(_0x1877a7['indicatorTemplates']['validation_cannotFindTemplateToUpdate'])(_0x328f1e['getValue']()),either['chain'](_0x51ef13=>pipe(_0x2879c8,string['trim'],validateEmptyString(),either['chain'](validateIndicatorTemplateNameWithId(_0x1877a7['indicatorTemplates']['validation_nameAlreadyExists'])(_0x51ef13,_0x328f1e['getValue']())),either['map'](_0x21e7f2=>[_0x51ef13,_0x21e7f2]))),either['fold'](either['left'],([_0x31a8ed,_0x2b7fa5])=>{const _0x53e849={..._0x31a8ed},_0x31768c=_0x53e849;_0x31768c['name']=_0x2b7fa5;const _0x5736ac=_0x31768c;return _0x495014['updateTemplate'](_0x5736ac),_0x2835d8(_0x328f1e['getValue']()['map'](_0x5aab16=>_0x5aab16['id']===_0x5676d5?_0x5736ac:_0x5aab16)),either['right'](void 0x0);})),_0x1d549a=_0x54a87b=>{const _0x438f2b=_0x328f1e['getValue']()['find'](_0x1b314e=>_0x1b314e['id']===_0x54a87b);if(_0x438f2b){const _0x3b7e73=_0x238c76['getStudies'](),_0x38aa18=[];_0x438f2b['studies']['forEach'](_0x157bc4=>{const _0x474cb5=_0x3b7e73['find'](_0x3cd55a=>_0x3cd55a['id']===_0x157bc4['id']);if(_0x474cb5){const _0x4dddb5=mergeTStudySettingsWithTemplateStudySettings(_0x474cb5,_0x157bc4);_0x38aa18['push'](_0x4dddb5);}});const _0x4d49dd=Number(_0x593025['getSelectedChartInfo']()['id']);_0x2063df[_0x4d49dd]['setStudies'](_0x38aa18),_0x3b2cbc(![]);}},_0x56d7fc={};return _0x56d7fc['templateData']=_0x328f1e,_0x56d7fc['isOpened']=_0xb0721,_0x56d7fc['addTemplate']=_0x3a62bc,_0x56d7fc['deleteTemplate']=_0x31d87b,_0x56d7fc['updateTemplate']=_0x45e446,_0x56d7fc['setPopupOpen']=_0x3b2cbc,_0x56d7fc['selectTemplate']=_0x1d549a,sink['newSink'](callTracerProxy('indicatorTemplateViewModel',_0x56d7fc),EMPTY);});const mergeTStudySettingsWithTemplateStudySettings=(_0x2ddc2e,_0x2aa982)=>({..._0x2ddc2e,..._0x2aa982}),validateIndicatorTemplateExists=_0xca72dd=>_0x39e878=>_0x5c7f7e=>validateExistenceInArray(_0xca72dd)(_0x39e878)(_0x4f0789=>_0x4f0789['id']===_0x5c7f7e),validateIndicatorTemplateName=_0x4796b7=>_0x21fbc2=>_0x306459=>validateNoDuplicatesInArray(_0x4796b7)(_0x21fbc2,_0x3ac1b1=>compareLowerCasedStrings(_0x3ac1b1['name'],_0x306459))(_0x306459),validateIndicatorTemplateNameWithId=_0x3f8d1a=>(_0x562cce,_0x2487fc)=>_0x53e9ce=>pipe(_0x53e9ce,either['fromPredicate'](_0x1ca4ad=>compareLowerCasedStrings(_0x1ca4ad,_0x562cce['name']),constVoid),either['fold'](()=>validateIndicatorTemplateName(_0x3f8d1a)(_0x2487fc)(_0x53e9ce),either['right']));