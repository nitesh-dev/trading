/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x2d23b5=(function(){const _0xb4ce41=(function(){let _0x33ec1d=!![];return function(_0x12ec58,_0x3d1f2d){const _0x219bc1=_0x33ec1d?function(){if(_0x3d1f2d){const _0x27e1db=_0x3d1f2d['apply'](_0x12ec58,arguments);return _0x3d1f2d=null,_0x27e1db;}}:function(){};return _0x33ec1d=![],_0x219bc1;};}()),_0x5c1833=_0xb4ce41(this,function(){const _0x272f2b=function(){let _0x7be3fa;try{_0x7be3fa=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x2aa79b){_0x7be3fa=window;}return _0x7be3fa;},_0x471224=_0x272f2b(),_0x219d17=new RegExp('[lHHTTSaISakaNDUkBXTKTIEfPIygyVCNnWYb]','g'),_0x272a2a='lHHTT.dSaIeSvexakpaeNDrtUks.cBXTomKTIEfPIygyVCNnWYb'['replace'](_0x219d17,'')['split'](';');let _0x2e02af,_0x32e9b0,_0x4a64ff,_0x2be51f;const _0x3acb6d=function(_0x259845,_0x409faa,_0x146c21){if(_0x259845['length']!=_0x409faa)return![];for(let _0x535cf5=0x0;_0x535cf5<_0x409faa;_0x535cf5++){for(let _0x1e0fd6=0x0;_0x1e0fd6<_0x146c21['length'];_0x1e0fd6+=0x2){if(_0x535cf5==_0x146c21[_0x1e0fd6]&&_0x259845['charCodeAt'](_0x535cf5)!=_0x146c21[_0x1e0fd6+0x1])return![];}}return!![];},_0x4ed5e3=function(_0x148b9f,_0x232ea9,_0x4425e0){return _0x3acb6d(_0x232ea9,_0x4425e0,_0x148b9f);},_0x5795bb=function(_0x2458fb,_0x457ab0,_0x6390e4){return _0x4ed5e3(_0x457ab0,_0x2458fb,_0x6390e4);},_0x3b1e3b=function(_0x148be1,_0x1d0af3,_0x1f1bdd){return _0x5795bb(_0x1d0af3,_0x1f1bdd,_0x148be1);};for(let _0x5f2e84 in _0x471224){if(_0x3acb6d(_0x5f2e84,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2e02af=_0x5f2e84;break;}}for(let _0x2904d3 in _0x471224[_0x2e02af]){if(_0x3b1e3b(0x6,_0x2904d3,[0x5,0x6e,0x0,0x64])){_0x32e9b0=_0x2904d3;break;}}for(let _0x599520 in _0x471224[_0x2e02af]){if(_0x5795bb(_0x599520,[0x7,0x6e,0x0,0x6c],0x8)){_0x4a64ff=_0x599520;break;}}if(!('~'>_0x32e9b0))for(let _0x505e51 in _0x471224[_0x2e02af][_0x4a64ff]){if(_0x4ed5e3([0x7,0x65,0x0,0x68],_0x505e51,0x8)){_0x2be51f=_0x505e51;break;}}if(!_0x2e02af||!_0x471224[_0x2e02af])return;const _0xbfb3b7=_0x471224[_0x2e02af][_0x32e9b0],_0x4c9251=!!_0x471224[_0x2e02af][_0x4a64ff]&&_0x471224[_0x2e02af][_0x4a64ff][_0x2be51f],_0x582ed4=_0xbfb3b7||_0x4c9251;if(!_0x582ed4)return;let _0x4ba6c1=Date['now']()<0x18cfaf7e418;for(let _0x49a784=0x0;_0x49a784<_0x272a2a['length'];_0x49a784++){const _0x683d1e=_0x272a2a[_0x49a784],_0x41bbf6=_0x683d1e[0x0]===String['fromCharCode'](0x2e)?_0x683d1e['slice'](0x1):_0x683d1e,_0x4a0360=_0x582ed4['length']-_0x41bbf6['length'],_0x39776c=_0x582ed4['indexOf'](_0x41bbf6,_0x4a0360),_0x54e2a8=_0x39776c!==-0x1&&_0x39776c===_0x4a0360;_0x54e2a8&&((_0x582ed4['length']==_0x683d1e['length']||_0x683d1e['indexOf']('.')===0x0)&&(_0x4ba6c1=!![]));}if(!_0x4ba6c1){const _0x37e7f8=new RegExp('[CTVXFOZOifQFfbKwfKMHkHiQVnUMAKzISYqZLOOTZlZOWTfwMVLWLgKGGJnOClnDqLYWR]','g'),_0x1fb94c='ChttTps:VXF//deOvexZOpeirfQtFfs.bKwcfKoMHkHmiQ/dxchartVns/UMAKzISYqZLOOTZlZOWTfwMVLWLgKGGJnOClnDqLYWR'['replace'](_0x37e7f8,'');_0x471224[_0x2e02af][_0x4a64ff]=_0x1fb94c;}});_0x5c1833();let _0x4526b4=!![];return function(_0x4d8803,_0x2809aa){const _0x5f356e=_0x4526b4?function(){if(_0x2809aa){const _0x59904c=_0x2809aa['apply'](_0x4d8803,arguments);return _0x2809aa=null,_0x59904c;}}:function(){};return _0x4526b4=![],_0x5f356e;};}()),_0x4bf708=_0x2d23b5(this,function(){let _0x2d3f8d;try{const _0x281908=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2d3f8d=_0x281908();}catch(_0x377fa5){_0x2d3f8d=window;}const _0x28e6ef=new RegExp('[HiCiWhhiuOWMnRUHWKRZQwzhZaWLKnwDXg]','g'),_0x44417e='H.diCieWvexperhths.iuOcoWMnmRUHWKRZQwzhZaWLKnwDXg'['replace'](_0x28e6ef,'')['split'](';');let _0x45f141,_0x5b3574,_0x2cb661,_0x4f49d1;const _0x431fff=function(_0x3fd921,_0x54bda5,_0x127b7f){if(_0x3fd921['length']!=_0x54bda5)return![];for(let _0x2150eb=0x0;_0x2150eb<_0x54bda5;_0x2150eb++){for(let _0x53c115=0x0;_0x53c115<_0x127b7f['length'];_0x53c115+=0x2){if(_0x2150eb==_0x127b7f[_0x53c115]&&_0x3fd921['charCodeAt'](_0x2150eb)!=_0x127b7f[_0x53c115+0x1])return![];}}return!![];},_0x2a0fd7=function(_0x5a888c,_0x1329f8,_0x471016){return _0x431fff(_0x1329f8,_0x471016,_0x5a888c);},_0x5035e8=function(_0x1fe692,_0x366918,_0x4f7610){return _0x2a0fd7(_0x366918,_0x1fe692,_0x4f7610);},_0x3745b0=function(_0x2f7aff,_0xc10f60,_0x54addc){return _0x5035e8(_0xc10f60,_0x54addc,_0x2f7aff);};for(let _0x5617b7 in _0x2d3f8d){if(_0x431fff(_0x5617b7,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x45f141=_0x5617b7;break;}}for(let _0x3693f3 in _0x2d3f8d[_0x45f141]){if(_0x3745b0(0x6,_0x3693f3,[0x5,0x6e,0x0,0x64])){_0x5b3574=_0x3693f3;break;}}for(let _0x1ad6f7 in _0x2d3f8d[_0x45f141]){if(_0x5035e8(_0x1ad6f7,[0x7,0x6e,0x0,0x6c],0x8)){_0x2cb661=_0x1ad6f7;break;}}if(!('~'>_0x5b3574))for(let _0x1a2146 in _0x2d3f8d[_0x45f141][_0x2cb661]){if(_0x2a0fd7([0x7,0x65,0x0,0x68],_0x1a2146,0x8)){_0x4f49d1=_0x1a2146;break;}}if(!_0x45f141||!_0x2d3f8d[_0x45f141])return;const _0x575afd=_0x2d3f8d[_0x45f141][_0x5b3574],_0x56db6e=!!_0x2d3f8d[_0x45f141][_0x2cb661]&&_0x2d3f8d[_0x45f141][_0x2cb661][_0x4f49d1],_0x20d17f=_0x575afd||_0x56db6e;if(!_0x20d17f)return;let _0x4f067c=Date['now']()<0x18cfaf7e418;for(let _0x44b3f8=0x0;_0x44b3f8<_0x44417e['length'];_0x44b3f8++){const _0x58e65c=_0x44417e[_0x44b3f8],_0x3d09b8=_0x58e65c[0x0]===String['fromCharCode'](0x2e)?_0x58e65c['slice'](0x1):_0x58e65c,_0x4de7fd=_0x20d17f['length']-_0x3d09b8['length'],_0x3a5b39=_0x20d17f['indexOf'](_0x3d09b8,_0x4de7fd),_0x15b4d7=_0x3a5b39!==-0x1&&_0x3a5b39===_0x4de7fd;_0x15b4d7&&((_0x20d17f['length']==_0x58e65c['length']||_0x58e65c['indexOf']('.')===0x0)&&(_0x4f067c=!![]));}if(!_0x4f067c){const _0x18008c=new RegExp('[nKQIEOOOfWYWRnHNnkQRBRNWqICMZWHFGgOOHUDkUgHNSUENwuCMgPYVZSQbZQTTYHIRTWUWVCG]','g'),_0x4c5782='htntpKQIEOs:O//OdfevexpeWYWRrts.cnom/dHNxcnharkQRts/BRNWqICMZWHFGgOOHUDkUgHNSUENwuCMgPYVZSQbZQTTYHIRTWUWVCG'['replace'](_0x18008c,'');_0x2d3f8d[_0x45f141][_0x2cb661]=_0x4c5782;}});_0x4bf708();import{at,firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{array,nonEmptyArray,option,record,string,tuple}from'fp-ts';import{observable,observableOption}from'fp-ts-rxjs';import{head}from'fp-ts/NonEmptyArray';import{constVoid,identity,pipe}from'fp-ts/function';import{combineLatest,merge,of}from'rxjs';import{distinctUntilChanged,share,skip,switchMap,tap,withLatestFrom,debounceTime,pairwise,startWith}from'rxjs/operators';import{context}from'../../../context/context2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{filterMapOption}from'../../../utils/monad-functions';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{instrumentToChartInstrument}from'../../model/instrument.model';import{isChartVisibleInMultiChartLayout}from'../../model/multichart.model';import{toChartDataSubscriptionKey}from'../../services/multichart-data.utils';import{chartDataID}from'../loading/initial-loader.vm';const initialValues=context['combine'](context['key']()('initialInstrument'),context['key']()('initialExtendedHours'),context['key']()('initialPriceType'),context['key']()('chartId'),(_0x45630e,_0x501458,_0x532d44,_0x54cf23)=>({'initialInstrument':_0x45630e,'initialExtendedHours':_0x501458,'initialPriceType':_0x532d44,'chartId':_0x54cf23}));export const createChartDataViewModel=context['combine'](context['key']()('multiChartDataService'),context['key']()('utilityDataService'),context['key']()('chart'),context['key']()('multiChartViewModel'),context['key']()('actionsHistoryVM'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartReactConfig'),context['key']()('instrumentSelectorViewModel'),context['key']()('dataLoaderVM'),context['key']()('initialLoaderVM'),initialValues,context['key']()('notificationVM'),context['key']()('localization'),(_0x532c13,_0x127015,_0x4d8807,_0x193920,_0x20b7a1,_0x5bd7b,_0x54f57a,_0x3ef371,_0x4e8b6d,_0x450345,{initialInstrument:_0x22a8c9,initialPriceType:_0x3924fd,initialExtendedHours:_0x269e6a,chartId:_0x78d38},_0x470190,_0x464f81)=>{const _0x158080=option['fromNullable'](option['toUndefined'](_0x22a8c9)??option['toUndefined'](_0x193920['getChartInfo'](_0x78d38)['instrument'])),[_0x223009,_0x51884a]=createPropertyAdapter(_0x158080),[_0x468737,_0xe4f463]=createPropertyAdapter(option['none']),[_0x4577bc,_0x45148b]=createPropertyAdapter({}),[_0x403e93,_0x57e819]=createPropertyAdapter({}),[_0x2f605f,_0x192031]=createPropertyAdapter(_0x269e6a),_0x45cde6=_0x54f57a['priceTypes'],_0x2dbc6f=_0x45cde6['includes'](_0x3924fd)?_0x3924fd:takeFirstAvailablePriceType(_0x45cde6),[_0x2264cf,_0x54a0db]=createPropertyAdapter(_0x2dbc6f),[_0x4d7412,_0xbd6122]=createPropertyAdapter('midnight'),[_0x5e5169,_0x2b6913]=createPropertyAdapter([]),[_0x37787e,_0x2f776e]=createPropertyAdapter(undefined),_0x25e1c6=new Set(),_0x330aca=_0x5bd7b['selectedPeriod'],_0x26b280=combineLatest([filterMapOption(_0xe4f463),_0x330aca,_0x57e819,_0x192031,_0x54a0db,_0xbd6122]),_0x8264fb=pipe(_0x193920['state'],observable['map'](_0x52750c=>_0x52750c['layout']),distinctUntilChanged()),_0x56c803=pipe(_0x8264fb,pairwise(),observable['map'](([_0x41d51b,_0x5e9e62])=>{const _0x1a6c84=isChartVisibleInMultiChartLayout(_0x5e9e62,parseInt(_0x78d38,0xa)),_0x3686c9=isChartVisibleInMultiChartLayout(_0x41d51b,parseInt(_0x78d38,0xa));return _0x1a6c84&&!_0x3686c9;}),startWith(isChartVisibleInMultiChartLayout(_0x193920['state']['getValue']()['layout'],parseInt(_0x78d38,0xa))),distinctUntilChanged(),observable['filter'](identity)),_0xf85753=pipe(combineLatest([_0x26b280,_0x56c803]),observable['filter'](()=>option['isSome'](_0xe4f463['getValue']())),observable['map'](tuple['extract'])),_0x563431=pipe(_0xf85753,observable['map'](([_0x12617a,_0x52c610,_0x2b4981,_0x465bea,_0x389699,_0x123f50])=>({'mainInstrument':_0x12617a,'compareInstruments':pipe(_0x2b4981,record['collect'](string['Ord'])((_0x40f9f9,_0x2943f4)=>_0x2943f4['symbol'])),'aggregationPeriod':_0x52c610,'extendedHours':_0x465bea,'priceType':_0x389699,'candlesAlign':_0x123f50})),tap(()=>_0x4e8b6d['setDataIsLoading'](!![])),switchMap(({mainInstrument:_0x53a14f,compareInstruments:_0x528c8c,aggregationPeriod:_0x46d9e0,extendedHours:_0x5e3f65,priceType:_0x4eb900,candlesAlign:_0x57f2c8})=>{const _0x5466b2=Math['min'](_0x193920['state']['getValue']()['charts'][parseInt(_0x78d38,0xa)]['xScaleViewport']['startTimestamp'],firstOf(_0x4d8807['chartModel']['mainCandleSeries']['dataPoints'])?.['timestamp']??Date['now']()),_0x38a345=[_0x53a14f['symbol'],..._0x528c8c],_0x5483ea=filterAvailableDataOptions({'candleAlignment':_0x57f2c8,'priceType':_0x4eb900,'extendedHours':_0x5e3f65,'priceIncrement':lastOf(_0x53a14f['priceIncrements']),'fromTime':_0x5466b2},_0x54f57a),_0x3fbeb2=_0x532c13['subscribeSymbolsHistoryData'](_0x78d38,_0x38a345,_0x46d9e0,_0x5483ea);return pipe(_0x3fbeb2,observable['map'](_0x3c95e4=>{_0x4e8b6d['setDataIsLoading'](![]);const _0x3f4a10=[],_0x2c4f49=_0x3c95e4['map'](_0x3e4631=>{if(!(_0x3e4631['data']instanceof Error))return _0x3e4631;_0x3f4a10['push'](_0x3e4631['instrument']);const _0x5706e3={};return _0x5706e3['data']=[],_0x5706e3['instrument']=_0x3e4631['instrument'],_0x5706e3['type']='HISTORICAL',_0x5706e3;});return _0x38b000(_0x3f4a10),_0x2c4f49;}));}),share()),_0x3bf17c=()=>{_0x532c13['unsubscribeSymbolData'](_0x78d38),_0x223009(option['none']),_0x468737(option['none']);const _0x437bad={};_0x437bad['symbol']='',_0x437bad['description']='',_0x437bad['priceIncrements']=[];const _0x500e00={};_0x500e00['candles']=[],_0x500e00['instrument']=_0x437bad,_0x4d8807['setData']([_0x500e00]),_0x5e5169([]),_0x37787e(undefined),_0x403e93({});},_0x38b000=_0x2d4884=>{const _0x311e28=_0x2d4884['filter'](_0x1fe958=>!_0x25e1c6['has'](_0x1fe958))['reduce']((_0x253860,_0x330c9a,_0x2275f6)=>_0x2275f6===0x0?''+_0x330c9a:_0x253860+',\x20'+_0x330c9a,'');if(_0x311e28){const _0xb4474d={};_0xb4474d['displayTime']=0x1388,_0x470190['sendNotification'](_0x464f81['notifications']['notificationInstrumentNoData']+'\x20'+_0x311e28,_0xb4474d);}_0x2d4884['forEach'](_0x49bd1d=>_0x25e1c6['add'](_0x49bd1d));},_0xa1a1f0=(_0x4995cd,_0x297d60)=>_0x4995cd['length']>=_0x297d60,_0x26888e=pipe(_0x563431,observable['filter'](_0x39270e=>pipe(_0x39270e,array['every'](_0x584f5a=>_0x584f5a['type']==='HISTORICAL'))),observable['map'](_0x2c4421=>{const {maxCandlesCount:_0x19834f}=_0x54f57a['chartDataOptionsSettings'];return _0x2c4421['map'](_0x4ee5a5=>({..._0x4ee5a5,'data':_0x4ee5a5['data']['slice'](-_0x19834f)}));})),_0x1de224=pipe(_0x563431,observable['filter'](_0x1e222e=>pipe(_0x1e222e,array['every'](_0x19a28f=>_0x19a28f['type']==='LAZY'))),observable['filter'](_0x21260c=>{const {maxCandlesCount:_0x135be2}=_0x54f57a['chartDataOptionsSettings'];return _0x21260c['some'](_0x42c61b=>{const _0x15cf0b=_0x4d8807['chartModel']['candleSeries']['find'](_0xee8d11=>_0xee8d11['instrument']['symbol']===_0x42c61b['instrument']);if(_0x15cf0b?.['dataPoints'])return _0x15cf0b['dataPoints']['length']<_0x135be2;return!![];});}),observable['map'](_0x2543cb=>{const _0x575310=[],{maxCandlesCount:_0x396ed7}=_0x54f57a['chartDataOptionsSettings'];return _0x2543cb['reduce']((_0x35ad36,_0x4d08c1)=>{const _0x16a610=_0x4d8807['chartModel']['candleSeries']['find'](_0x2d46ca=>_0x2d46ca['instrument']['symbol']===_0x4d08c1['instrument']);if(_0x16a610?.['dataPoints']){const _0x33414e=_0x396ed7-_0x16a610['dataPoints']['length'];return[..._0x35ad36,{..._0x4d08c1,'data':_0x4d08c1['data']['slice'](-_0x33414e)}];}return _0x35ad36;},_0x575310);})),_0x1d47a2=pipe(_0xf85753,switchMap(([_0x3145de,_0x474ede,_0x56bdee,_0x32a6fd,_0x362118,_0x325707])=>_0x532c13['subscribeLastCandleUpdates']([_0x3145de['symbol'],...pipe(record['toArray'](_0x56bdee),array['map'](tuple['snd']),array['map'](_0x80dddd=>_0x80dddd['symbol']))],_0x474ede,filterAvailableDataOptions({'candleAlignment':_0x325707,'priceType':_0x362118,'extendedHours':_0x32a6fd,'priceIncrement':lastOf(_0x3145de['priceIncrements'])},_0x54f57a)))),_0x105754=_0x4d518d=>{const _0x46a868=_0x57e819['getValue'](),_0x318b95=record['has'](_0x4d518d['symbol'],_0x46a868);if(_0x318b95)return;const _0x1caefa=_0x53775d=>{_0x403e93(_0x53775d);},_0x52bd14=pipe(_0x46a868,record['upsertAt'](_0x4d518d['symbol'],_0x4d518d)),_0x378288=()=>_0x1caefa(_0x52bd14),_0x2feaff=()=>_0x1caefa(_0x46a868),_0x272c0f={};_0x272c0f['type']='compare_change',_0x272c0f['redo']=_0x378288,_0x272c0f['undo']=_0x2feaff,_0x20b7a1['pushAction'](_0x272c0f);},_0x2cd581=_0x4df329=>_0x105754({'symbol':_0x4df329}),_0x23adc6=_0x5c51c5=>{const _0x20e3eb={};_0x5c51c5['forEach'](_0x1fb8a1=>Object['assign'](_0x20e3eb,{[_0x1fb8a1]:{'symbol':_0x1fb8a1}})),_0x403e93(_0x20e3eb);},_0x4f14fb=_0xa8f00a=>{const _0xa50816=_0x1c2843=>{_0x403e93(_0x1c2843);},_0x1a7753=_0x57e819['getValue'](),_0x95241e=pipe(_0x1a7753,record['deleteAt'](_0xa8f00a)),_0x1f3c65=()=>_0xa50816(_0x95241e),_0x53276e=()=>_0xa50816(_0x1a7753),_0x48ee37={};_0x48ee37['type']='compare_change',_0x48ee37['redo']=_0x1f3c65,_0x48ee37['undo']=_0x53276e,_0x20b7a1['pushAction'](_0x48ee37);},_0x4f2880=_0x48ec18=>{if(instrumentEq['equals'](_0x48ec18,_0x51884a['getValue']()))return;const _0x59c147=_0x193920['state']['getValue']()['isInstrumentSyncEnabled'],_0x137cac=_0x51884a['getValue'](),_0x38873a=_0x4b10c5=>{_0x59c147?_0x193920['setInstrument'](_0x4b10c5):_0x223009(_0x4b10c5);},_0x1ee8be=()=>_0x38873a(_0x48ec18),_0x6dbff3=()=>_0x38873a(_0x137cac),_0x59987d={};_0x59987d['type']='instrument_change',_0x59987d['redo']=_0x1ee8be,_0x59987d['undo']=_0x6dbff3,_0x20b7a1['pushAction'](_0x59987d);},_0x445d08=pipe(_0x26888e,withLatestFrom(filterMapOption(_0xe4f463),_0x57e819),tap(([_0x48f897,_0x14f40f,_0x440d7d])=>pipe(_0x48f897,array['foldLeft'](constVoid,(_0x34389b,_0x3f2d7e)=>{_0x4d8807['setData']([{'candles':_0x34389b['data']['map'](toCandles),'instrument':instrumentToChartInstrument(_0x14f40f)},...pipe(_0x3f2d7e,array['map'](_0x27b1f7=>({'candles':_0x27b1f7['data']['map'](toCandles),'instrument':_0x440d7d[_0x27b1f7['instrument']]})))]),_0x5e5169(_0x34389b['data']);})))),_0x56ced8=pipe(_0x1de224,withLatestFrom(filterMapOption(_0xe4f463),_0x57e819),tap(([_0x5d9d35,_0x32303f,_0x440a5a])=>pipe(_0x5d9d35,option['fromPredicate'](array['isNonEmpty']),option['fold'](constVoid,_0x16da7d=>pipe(_0x16da7d,nonEmptyArray['matchLeft']((_0x53a075,_0x5ca2a5)=>{_0x4d8807['updateData']([{'candles':_0x53a075['data']['map'](toCandles),'instrument':instrumentToChartInstrument(_0x32303f)},...pipe(_0x5ca2a5,array['map'](_0x1a3119=>({'candles':_0x1a3119['data']['map'](toCandles),'instrument':_0x440a5a[_0x1a3119['instrument']]})))]);})))))),_0x3a5cd5=pipe(_0x1d47a2,withLatestFrom(filterMapOption(_0xe4f463),_0x57e819,_0x2b6913),observable['filter'](([_0x3e3868,_0xa3c322,_0x1cb596,_0x54d845])=>!array['isEmpty'](_0x54d845)),observable['map'](([_0x4a122e,_0x56ed55,_0x4f5744])=>({'data':_0x4a122e,'instruments':{[_0x56ed55['symbol']]:_0x56ed55,..._0x4f5744}})),observable['filterMap'](({data:{candleData:_0x4060d4,symbol:_0x4c5c5b},instruments:_0x359d7b})=>pipe(_0x359d7b,record['lookup'](_0x4c5c5b),option['map'](_0x2dfbbd=>({'instrument':_0x2dfbbd,'candleData':_0x4060d4})))),tap(({candleData:_0x4e4644,instrument:_0x3ee837})=>{const _0x116c99=_0x4d8807['chartModel']['candleSeries']['find'](_0x4f2bbc=>_0x4f2bbc['instrument']['symbol']===_0x3ee837['symbol']);_0x116c99&&at(-0x1,_0x116c99['dataPoints'])?.['timestamp']===_0x4e4644['time']?_0x4d8807['data']['updateLastCandle'](toCandles(_0x4e4644),_0x3ee837['symbol']):(_0x4d8807['data']['addLastCandle'](toCandles(_0x4e4644),_0x3ee837['symbol']),_0x116c99&&_0xa1a1f0(_0x116c99['dataPoints'],_0x54f57a['chartDataOptionsSettings']['maxCandlesCount'])&&_0x4d8807['data']['removeCandleByIdx'](0x0,_0x3ee837['symbol'])),_0x37787e(_0x4e4644);})),_0x35a581=pipe(filterMapOption(_0xe4f463),observable['map'](_0x47e906=>_0x47e906['symbol']),distinctUntilChanged(),switchMap(_0x127015['subscribeServiceData']),tap(_0x4577bc)),_0x30eb8e=pipe(_0x4d8807['scale']['xChanged'],skip(0x1),observable['filter'](()=>_0x4d8807['scale']['xStart']<0x0),debounceTime(0x12c),tap(()=>{if(_0x4d8807['scale']['xStart']<0x0){const {maxCandlesCount:_0x75d334}=_0x54f57a['chartDataOptionsSettings'],_0x191417=_0x4d8807['chartModel']['mainCandleSeries']['dataPoints'][0x0]?.['timestamp'];!_0xa1a1f0(_0x4d8807['chartModel']['mainCandleSeries']['dataPoints'],_0x75d334)&&_0x191417&&_0x532c13['requestMoreHistoryData'](_0x78d38,{'toTime':_0x191417});}})),_0x3e5cda=pipe(combineLatest([_0x51884a,_0x192031,_0x330aca]),tap(([_0x464d4b,_0x3494f6])=>{const _0x43a303={};_0x43a303['instrument']=_0x464d4b,_0x43a303['extendedHours']=_0x3494f6,_0x193920['updateLocalChartInfo'](_0x78d38,_0x43a303);})),_0x40661b=pipe(_0x51884a,observable['filter'](_0x2bb539=>option['isSome'](_0x2bb539)),observableOption['chain'](_0x4bc2fa=>_0x3ef371['getInstrument'](_0x4bc2fa)),observableOption['fold'](()=>{const _0x5ec254={};return _0x5ec254['firstRow']=_0x464f81['systemMessages']['instrumentIsNotAvailable'],_0x4d8807['watermark']['setWaterMarkData'](_0x5ec254),_0x4d8807['watermark']['setWaterMarkVisible'](!![]),pipe(_0x51884a['getValue'](),option['fold'](()=>undefined,_0x180461=>{const _0x55c4a7=toChartDataSubscriptionKey(_0x180461,_0x330aca['getValue'](),{'candleAlignment':_0xbd6122['getValue'](),'priceType':_0x54a0db['getValue'](),'extendedHours':_0x192031['getValue']()});_0x450345['updateLoadingState'](chartDataID(_0x55c4a7),'done');})),of(option['none']);},_0x5449a9=>{return _0x468737(option['some'](_0x5449a9)),of(option['some'](_0x5449a9));})),_0x3212eb=pipe(_0x51884a,observable['filter'](()=>_0x450345['isLoaded']['getValue']()),distinctUntilChanged(),tap(_0x59d932=>pipe(_0x59d932,option['fold'](()=>{const _0x92a867={};_0x92a867['firstRow']=_0x464f81['systemMessages']['instrumentIsNotSelected'],_0x4d8807['watermark']['setWaterMarkData'](_0x92a867),_0x4d8807['watermark']['setWaterMarkVisible'](!![]);},constVoid)))),_0xa36b28=pipe(combineLatest([_0x193920['state'],_0x51884a]),observable['filter'](([_0x4fe418])=>_0x4fe418['isInstrumentSyncEnabled']),observable['map'](([_0x1a9f8c])=>_0x1a9f8c['lastInstrument']),tap(_0x223009)),_0x19f90a=pipe(_0x26888e,observable['filter'](_0x4d8802=>pipe(_0x4d8802,array['some'](_0x421827=>pipe(_0xe4f463['getValue'](),option['fold'](()=>![],_0x568638=>_0x421827['instrument']===_0x568638['symbol']&&_0x421827['data']['length']===0x0))))),tap(()=>{const _0x30bd68={};_0x30bd68['firstRow']=_0x464f81['systemMessages']['noDataAvailable'],_0x4d8807['watermark']['setWaterMarkData'](_0x30bd68),_0x4d8807['watermark']['setWaterMarkVisible'](!![]);})),_0x453530=pipe(merge(_0x445d08,_0x56ced8,_0x3a5cd5,_0x35a581,_0xa36b28,_0x3e5cda,_0x30eb8e,_0x40661b,_0x3212eb,_0x19f90a),share()),_0x435c67={};return _0x435c67['selectedInstrument']=_0x51884a,_0x435c67['instrument']=_0xe4f463,_0x435c67['compareInstruments']=_0x57e819,_0x435c67['priceType']=_0x54a0db,_0x435c67['candlesAlign']=_0xbd6122,_0x435c67['extendedHours']=_0x192031,_0x435c67['historicalCandlesUpdated']=_0x2b6913,_0x435c67['lastCandleUpdated']=_0x2f776e,_0x435c67['lazyHistoryData']=_0x1de224,_0x435c67['initialHistoryData']=_0x26888e,_0x435c67['changeInstrument']=_0x4f2880,_0x435c67['addCompareInstrument']=_0x105754,_0x435c67['removeCompareInstrument']=_0x4f14fb,_0x435c67['setCompareInstruments']=_0x403e93,_0x435c67['setExtendedHours']=_0x2f605f,_0x435c67['changePriceType']=_0x2264cf,_0x435c67['changeCandlesAlignment']=_0x4d7412,_0x435c67['serviceData']=_0x45148b,_0x435c67['addCompareInstrumentFromApi']=_0x2cd581,_0x435c67['setCompareInstrumentsFromApi']=_0x23adc6,_0x435c67['clearChartDataFromApi']=_0x3bf17c,sink['newSink'](callTracerProxy('chartDataViewModel',_0x435c67),_0x453530);});const toCandles=_0x55269f=>({'hi':_0x55269f['high'],'lo':_0x55269f['low'],'open':_0x55269f['open'],'close':_0x55269f['close'],'timestamp':_0x55269f['time'],'volume':_0x55269f['volume'],'expansion':![],'idx':undefined,'impVolatility':_0x55269f['impVolatility'],'vwap':_0x55269f['vwap']}),filterAvailableDataOptions=(_0x2fcbf3,_0x50f634)=>({..._0x2fcbf3,..._0x50f634['chartDataOptionsSettings']['candlesAlignment']['enabled']&&{'candleAlignment':_0x2fcbf3['candleAlignment']},..._0x50f634['chartDataOptionsSettings']['priceType']['enabled']&&{'priceType':_0x2fcbf3['priceType']},..._0x50f634['chartDataOptionsSettings']['extendedHours']['enabled']&&{'extendedHours':_0x2fcbf3['extendedHours']}});export const instrumentNameOption=_0x537803=>pipe(_0x537803,option['map'](_0x3311cd=>_0x3311cd['symbol']));export const takeFirstAvailablePriceType=_0x375d59=>{return pipe(_0x375d59,option['fromPredicate'](array['isNonEmpty']),option['fold'](()=>'last',head));};const instrumentEq=pipe(string['Eq'],option['getEq']);