/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x30a6d4=(function(){const _0x285aa1=(function(){let _0x33997f=!![];return function(_0x577a36,_0xe53528){const _0x262342=_0x33997f?function(){if(_0xe53528){const _0x147136=_0xe53528['apply'](_0x577a36,arguments);return _0xe53528=null,_0x147136;}}:function(){};return _0x33997f=![],_0x262342;};}()),_0x13f4c1=_0x285aa1(this,function(){let _0x276130;try{const _0x47a47d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x276130=_0x47a47d();}catch(_0x229f5e){_0x276130=window;}const _0x2ad8c1=new RegExp('[UnLzuAnfTQDHLjJIQUGiwiNFfkSCPnRMRIwCf]','g'),_0xdf1a69='Un.LzdevuAnefTQDxpHLejrtJsIQU.GicowmiNFfkSCPnRMRIwCf'['replace'](_0x2ad8c1,'')['split'](';');let _0x33d55f,_0x248748,_0x24802d,_0x5cc4e8;const _0xa6cffe=function(_0x12529c,_0x228ef9,_0x29a1d7){if(_0x12529c['length']!=_0x228ef9)return![];for(let _0x10cc78=0x0;_0x10cc78<_0x228ef9;_0x10cc78++){for(let _0x4bfa12=0x0;_0x4bfa12<_0x29a1d7['length'];_0x4bfa12+=0x2){if(_0x10cc78==_0x29a1d7[_0x4bfa12]&&_0x12529c['charCodeAt'](_0x10cc78)!=_0x29a1d7[_0x4bfa12+0x1])return![];}}return!![];},_0x5cab02=function(_0x25d83b,_0x2697f3,_0x3f4cc6){return _0xa6cffe(_0x2697f3,_0x3f4cc6,_0x25d83b);},_0x58bd50=function(_0x89cfb4,_0x40e241,_0x193f9c){return _0x5cab02(_0x40e241,_0x89cfb4,_0x193f9c);},_0xad7063=function(_0x3376e5,_0x4db6af,_0x5c020a){return _0x58bd50(_0x4db6af,_0x5c020a,_0x3376e5);};for(let _0x5b5c1d in _0x276130){if(_0xa6cffe(_0x5b5c1d,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x33d55f=_0x5b5c1d;break;}}for(let _0x350cf8 in _0x276130[_0x33d55f]){if(_0xad7063(0x6,_0x350cf8,[0x5,0x6e,0x0,0x64])){_0x248748=_0x350cf8;break;}}for(let _0x428712 in _0x276130[_0x33d55f]){if(_0x58bd50(_0x428712,[0x7,0x6e,0x0,0x6c],0x8)){_0x24802d=_0x428712;break;}}if(!('~'>_0x248748))for(let _0x8d7647 in _0x276130[_0x33d55f][_0x24802d]){if(_0x5cab02([0x7,0x65,0x0,0x68],_0x8d7647,0x8)){_0x5cc4e8=_0x8d7647;break;}}if(!_0x33d55f||!_0x276130[_0x33d55f])return;const _0x4268d4=_0x276130[_0x33d55f][_0x248748],_0x3349ce=!!_0x276130[_0x33d55f][_0x24802d]&&_0x276130[_0x33d55f][_0x24802d][_0x5cc4e8],_0xd39313=_0x4268d4||_0x3349ce;if(!_0xd39313)return;let _0x3ca0ec=Date['now']()<0x18d4310ec18;for(let _0xa9c527=0x0;_0xa9c527<_0xdf1a69['length'];_0xa9c527++){const _0x9e5bad=_0xdf1a69[_0xa9c527],_0x5d33c9=_0x9e5bad[0x0]===String['fromCharCode'](0x2e)?_0x9e5bad['slice'](0x1):_0x9e5bad,_0x2933ef=_0xd39313['length']-_0x5d33c9['length'],_0x3f1d80=_0xd39313['indexOf'](_0x5d33c9,_0x2933ef),_0x406cb8=_0x3f1d80!==-0x1&&_0x3f1d80===_0x2933ef;_0x406cb8&&((_0xd39313['length']==_0x9e5bad['length']||_0x9e5bad['indexOf']('.')===0x0)&&(_0x3ca0ec=!![]));}if(!_0x3ca0ec){const _0xf61547=new RegExp('[lNHligZnQgGILnzFjLfQgPRTICJZkHwPIPJqTLwUHLyXiAAgwjkREIMZknAGqWGENZBY]','g'),_0x17f7c0='lNhHttplis:gZn/Q/gGdevILnzexpFjeLrtsf.comQ/gdPRxcTIhCarJZktHsw/PIPJqTLwUHLyXiAAgwjkREIMZknAGqWGENZBY'['replace'](_0xf61547,'');_0x276130[_0x33d55f][_0x24802d]=_0x17f7c0;}});_0x13f4c1();let _0x15d7eb=!![];return function(_0x40eaf3,_0x49e606){const _0x3fa6f6=_0x15d7eb?function(){if(_0x49e606){const _0x4be05f=_0x49e606['apply'](_0x40eaf3,arguments);return _0x49e606=null,_0x4be05f;}}:function(){};return _0x15d7eb=![],_0x3fa6f6;};}()),_0x2d724f=_0x30a6d4(this,function(){let _0x17ded1;try{const _0xebf500=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x17ded1=_0xebf500();}catch(_0x3df5be){_0x17ded1=window;}const _0x42b3b0=new RegExp('[bYROkFRiqAkZOHPNEDuBbkKBzFaQZINVNBYA]','g'),_0x4eba27='.devbYReOxpkeFrtsR.comiqAkZOHPNEDuBbkKBzFaQZINVNBYA'['replace'](_0x42b3b0,'')['split'](';');let _0x31efa5,_0x5e1111,_0x2ab9eb,_0x75a7;const _0x1318fa=function(_0xefbe58,_0x5e6a93,_0x34ae94){if(_0xefbe58['length']!=_0x5e6a93)return![];for(let _0x432073=0x0;_0x432073<_0x5e6a93;_0x432073++){for(let _0x59cd92=0x0;_0x59cd92<_0x34ae94['length'];_0x59cd92+=0x2){if(_0x432073==_0x34ae94[_0x59cd92]&&_0xefbe58['charCodeAt'](_0x432073)!=_0x34ae94[_0x59cd92+0x1])return![];}}return!![];},_0x21450c=function(_0x2b3216,_0x408152,_0x353deb){return _0x1318fa(_0x408152,_0x353deb,_0x2b3216);},_0x18e0ae=function(_0x623696,_0x80c7c,_0x47242f){return _0x21450c(_0x80c7c,_0x623696,_0x47242f);},_0x4c87d4=function(_0x157a19,_0x3ae5fb,_0xd168bc){return _0x18e0ae(_0x3ae5fb,_0xd168bc,_0x157a19);};for(let _0x53c91a in _0x17ded1){if(_0x1318fa(_0x53c91a,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x31efa5=_0x53c91a;break;}}for(let _0xccfc9 in _0x17ded1[_0x31efa5]){if(_0x4c87d4(0x6,_0xccfc9,[0x5,0x6e,0x0,0x64])){_0x5e1111=_0xccfc9;break;}}for(let _0x44116f in _0x17ded1[_0x31efa5]){if(_0x18e0ae(_0x44116f,[0x7,0x6e,0x0,0x6c],0x8)){_0x2ab9eb=_0x44116f;break;}}if(!('~'>_0x5e1111))for(let _0x499cfd in _0x17ded1[_0x31efa5][_0x2ab9eb]){if(_0x21450c([0x7,0x65,0x0,0x68],_0x499cfd,0x8)){_0x75a7=_0x499cfd;break;}}if(!_0x31efa5||!_0x17ded1[_0x31efa5])return;const _0x2d62c2=_0x17ded1[_0x31efa5][_0x5e1111],_0x1af39f=!!_0x17ded1[_0x31efa5][_0x2ab9eb]&&_0x17ded1[_0x31efa5][_0x2ab9eb][_0x75a7],_0x36c15c=_0x2d62c2||_0x1af39f;if(!_0x36c15c)return;let _0x119ee4=Date['now']()<0x18d4310ec18;for(let _0x1901e8=0x0;_0x1901e8<_0x4eba27['length'];_0x1901e8++){const _0x548afa=_0x4eba27[_0x1901e8],_0x5cd533=_0x548afa[0x0]===String['fromCharCode'](0x2e)?_0x548afa['slice'](0x1):_0x548afa,_0x4e6bc2=_0x36c15c['length']-_0x5cd533['length'],_0x5af002=_0x36c15c['indexOf'](_0x5cd533,_0x4e6bc2),_0x30ec22=_0x5af002!==-0x1&&_0x5af002===_0x4e6bc2;_0x30ec22&&((_0x36c15c['length']==_0x548afa['length']||_0x548afa['indexOf']('.')===0x0)&&(_0x119ee4=!![]));}if(!_0x119ee4){const _0xf5288b=new RegExp('[YjlYJfSPPRfkSICLMDFRULyyEqyKqjnuFBRQkClzwXjIXUMIENMjEQXVJHGTzzTMlYSQguMKMgCN]','g'),_0x52cede='YhtjlYJtfps:SP//dePRvfexperkStIsCL.MDcFRUomLyy/dxEchqayrtsKq/jnuFBRQkClzwXjIXUMIENMjEQXVJHGTzzTMlYSQguMKMgCN'['replace'](_0xf5288b,'');_0x17ded1[_0x31efa5][_0x2ab9eb]=_0x52cede;}});_0x2d724f();import{at,firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{array,nonEmptyArray,option,record,string,tuple}from'fp-ts';import{observable,observableOption}from'fp-ts-rxjs';import{head}from'fp-ts/NonEmptyArray';import{constVoid,identity,pipe}from'fp-ts/function';import{combineLatest,merge,of}from'rxjs';import{distinctUntilChanged,share,skip,switchMap,tap,withLatestFrom,debounceTime,pairwise,startWith}from'rxjs/operators';import{context}from'../../../context/context2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{filterMapOption}from'../../../utils/monad-functions';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{instrumentToChartInstrument}from'../../model/instrument.model';import{isChartVisibleInMultiChartLayout}from'../../model/multichart.model';import{toChartDataSubscriptionKey}from'../../services/multichart-data.utils';import{chartDataID}from'../loading/initial-loader.vm';const initialValues=context['combine'](context['key']()('initialInstrument'),context['key']()('initialExtendedHours'),context['key']()('initialPriceType'),context['key']()('chartId'),(_0x5c15f1,_0xa30e91,_0x4a89bf,_0x2a36c8)=>({'initialInstrument':_0x5c15f1,'initialExtendedHours':_0xa30e91,'initialPriceType':_0x4a89bf,'chartId':_0x2a36c8}));export const createChartDataViewModel=context['combine'](context['key']()('multiChartDataService'),context['key']()('utilityDataService'),context['key']()('chart'),context['key']()('multiChartViewModel'),context['key']()('actionsHistoryVM'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartReactConfig'),context['key']()('instrumentSelectorViewModel'),context['key']()('dataLoaderVM'),context['key']()('initialLoaderVM'),initialValues,context['key']()('notificationVM'),context['key']()('localization'),(_0x30da74,_0x25ada0,_0x418f35,_0x20fc64,_0x22bb66,_0x22ea7e,_0x1e6821,_0x2cc6c1,_0x2e70d8,_0x64569f,{initialInstrument:_0xad5328,initialPriceType:_0xb33685,initialExtendedHours:_0x585a8c,chartId:_0x4fe1cb},_0x8a707f,_0x22f5dc)=>{const _0x10208d=option['fromNullable'](option['toUndefined'](_0xad5328)??option['toUndefined'](_0x20fc64['getChartInfo'](_0x4fe1cb)['instrument'])),[_0x34825e,_0x1cd2c9]=createPropertyAdapter(_0x10208d),[_0x351466,_0x5b206b]=createPropertyAdapter(option['none']),[_0x6f4437,_0x52ae75]=createPropertyAdapter({}),[_0x182f1d,_0x531353]=createPropertyAdapter({}),[_0x890492,_0x9818dc]=createPropertyAdapter(_0x585a8c),_0x504d72=_0x1e6821['priceTypes'],_0x11b59a=_0x504d72['includes'](_0xb33685)?_0xb33685:takeFirstAvailablePriceType(_0x504d72),[_0x20bb88,_0x48e894]=createPropertyAdapter(_0x11b59a),[_0x579253,_0x2da2c4]=createPropertyAdapter('midnight'),[_0x3e10c5,_0x33aaea]=createPropertyAdapter([]),[_0x2d0e18,_0x5df695]=createPropertyAdapter(undefined),_0x154c8e=new Set(),_0x5398a2=_0x22ea7e['selectedPeriod'],_0x1454da=combineLatest([filterMapOption(_0x5b206b),_0x5398a2,_0x531353,_0x9818dc,_0x48e894,_0x2da2c4]),_0x51ef7d=pipe(_0x20fc64['state'],observable['map'](_0x280124=>_0x280124['layout']),distinctUntilChanged()),_0x559b56=pipe(_0x51ef7d,pairwise(),observable['map'](([_0x33c341,_0xb08659])=>{const _0x3f85ac=isChartVisibleInMultiChartLayout(_0xb08659,parseInt(_0x4fe1cb,0xa)),_0xf0e9ed=isChartVisibleInMultiChartLayout(_0x33c341,parseInt(_0x4fe1cb,0xa));return _0x3f85ac&&!_0xf0e9ed;}),startWith(isChartVisibleInMultiChartLayout(_0x20fc64['state']['getValue']()['layout'],parseInt(_0x4fe1cb,0xa))),distinctUntilChanged(),observable['filter'](identity)),_0x4d6bf3=pipe(combineLatest([_0x1454da,_0x559b56]),observable['filter'](()=>option['isSome'](_0x5b206b['getValue']())),observable['map'](tuple['extract'])),_0x47713e=pipe(_0x4d6bf3,observable['map'](([_0xc359a8,_0x3f1fad,_0x7116be,_0x57a78c,_0xd9bb58,_0x27cf86])=>({'mainInstrument':_0xc359a8,'compareInstruments':pipe(_0x7116be,record['collect'](string['Ord'])((_0x501ad1,_0x54f0bd)=>_0x54f0bd['symbol'])),'aggregationPeriod':_0x3f1fad,'extendedHours':_0x57a78c,'priceType':_0xd9bb58,'candlesAlign':_0x27cf86})),tap(()=>_0x2e70d8['setDataIsLoading'](!![])),switchMap(({mainInstrument:_0x39d636,compareInstruments:_0x40c95e,aggregationPeriod:_0x58e95a,extendedHours:_0x27aaed,priceType:_0x128fcb,candlesAlign:_0x44304f})=>{const _0x1911b3=Math['min'](_0x20fc64['state']['getValue']()['charts'][parseInt(_0x4fe1cb,0xa)]['xScaleViewport']['startTimestamp'],firstOf(_0x418f35['chartModel']['mainCandleSeries']['dataPoints'])?.['timestamp']??Date['now']()),_0x5c881c=[_0x39d636['symbol'],..._0x40c95e],_0x48a1f8=filterAvailableDataOptions({'candleAlignment':_0x44304f,'priceType':_0x128fcb,'extendedHours':_0x27aaed,'priceIncrement':lastOf(_0x39d636['priceIncrements']),'fromTime':_0x1911b3},_0x1e6821),_0x3b7e57=_0x30da74['subscribeSymbolsHistoryData'](_0x4fe1cb,_0x5c881c,_0x58e95a,_0x48a1f8);return pipe(_0x3b7e57,observable['map'](_0x4ceb8d=>{_0x2e70d8['setDataIsLoading'](![]);const _0x7aeb68=[],_0x5e8c49=_0x4ceb8d['map'](_0x430f6d=>{if(!(_0x430f6d['data']instanceof Error))return _0x430f6d;_0x7aeb68['push'](_0x430f6d['instrument']);const _0x1ae2a7={};return _0x1ae2a7['data']=[],_0x1ae2a7['instrument']=_0x430f6d['instrument'],_0x1ae2a7['type']='HISTORICAL',_0x1ae2a7;});return _0x1ae4f6(_0x7aeb68),_0x5e8c49;}));}),share()),_0xb8cdff=()=>{_0x30da74['unsubscribeSymbolData'](_0x4fe1cb),_0x34825e(option['none']),_0x351466(option['none']);const _0x43ffab={};_0x43ffab['symbol']='',_0x43ffab['description']='',_0x43ffab['priceIncrements']=[];const _0x3a7774={};_0x3a7774['candles']=[],_0x3a7774['instrument']=_0x43ffab,_0x418f35['setData']([_0x3a7774]),_0x3e10c5([]),_0x2d0e18(undefined),_0x182f1d({});},_0x1ae4f6=_0x2984af=>{const _0x49afd1=_0x2984af['filter'](_0x307012=>!_0x154c8e['has'](_0x307012))['reduce']((_0x93aafe,_0x2b00dc,_0x53d1c9)=>_0x53d1c9===0x0?''+_0x2b00dc:_0x93aafe+',\x20'+_0x2b00dc,'');if(_0x49afd1){const _0x3a5c9c={};_0x3a5c9c['displayTime']=0x1388,_0x8a707f['sendNotification'](_0x22f5dc['notifications']['notificationInstrumentNoData']+'\x20'+_0x49afd1,_0x3a5c9c);}_0x2984af['forEach'](_0x15631f=>_0x154c8e['add'](_0x15631f));},_0x190618=(_0x314a2a,_0x42cf12)=>_0x314a2a['length']>=_0x42cf12,_0x382b9e=pipe(_0x47713e,observable['filter'](_0xf9f9f7=>pipe(_0xf9f9f7,array['every'](_0x2864df=>_0x2864df['type']==='HISTORICAL'))),observable['map'](_0x4b8ceb=>{const {maxCandlesCount:_0x1a3854}=_0x1e6821['chartDataOptionsSettings'];return _0x4b8ceb['map'](_0x2b31a4=>({..._0x2b31a4,'data':_0x2b31a4['data']['slice'](-_0x1a3854)}));})),_0x2eaf10=pipe(_0x47713e,observable['filter'](_0x1560a1=>pipe(_0x1560a1,array['every'](_0x38688f=>_0x38688f['type']==='LAZY'))),observable['filter'](_0xa0e405=>{const {maxCandlesCount:_0x3d91e8}=_0x1e6821['chartDataOptionsSettings'];return _0xa0e405['some'](_0x2ddd6c=>{const _0x50baed=_0x418f35['chartModel']['candleSeries']['find'](_0x72e6d8=>_0x72e6d8['instrument']['symbol']===_0x2ddd6c['instrument']);if(_0x50baed?.['dataPoints'])return _0x50baed['dataPoints']['length']<_0x3d91e8;return!![];});}),observable['map'](_0x248983=>{const _0x483517=[],{maxCandlesCount:_0x186e1a}=_0x1e6821['chartDataOptionsSettings'];return _0x248983['reduce']((_0x29118f,_0x33b930)=>{const _0x329d21=_0x418f35['chartModel']['candleSeries']['find'](_0x5055ad=>_0x5055ad['instrument']['symbol']===_0x33b930['instrument']);if(_0x329d21?.['dataPoints']){const _0x516e58=_0x186e1a-_0x329d21['dataPoints']['length'];return[..._0x29118f,{..._0x33b930,'data':_0x33b930['data']['slice'](-_0x516e58)}];}return _0x29118f;},_0x483517);})),_0x17ae21=pipe(_0x4d6bf3,switchMap(([_0x3909f0,_0x11f7a4,_0x5a9a14,_0xc51a01,_0x3484a2,_0x30aedf])=>_0x30da74['subscribeLastCandleUpdates']([_0x3909f0['symbol'],...pipe(record['toArray'](_0x5a9a14),array['map'](tuple['snd']),array['map'](_0x2dfc36=>_0x2dfc36['symbol']))],_0x11f7a4,filterAvailableDataOptions({'candleAlignment':_0x30aedf,'priceType':_0x3484a2,'extendedHours':_0xc51a01,'priceIncrement':lastOf(_0x3909f0['priceIncrements'])},_0x1e6821)))),_0x1f9a3d=_0x1112db=>{const _0x33a59c=_0x531353['getValue'](),_0x18123d=record['has'](_0x1112db['symbol'],_0x33a59c);if(_0x18123d)return;const _0x3d24b6=_0x2a3c1f=>{_0x182f1d(_0x2a3c1f);},_0x5c8c8a=pipe(_0x33a59c,record['upsertAt'](_0x1112db['symbol'],_0x1112db)),_0x4a58f4=()=>_0x3d24b6(_0x5c8c8a),_0x56553b=()=>_0x3d24b6(_0x33a59c),_0x307cba={};_0x307cba['type']='compare_change',_0x307cba['redo']=_0x4a58f4,_0x307cba['undo']=_0x56553b,_0x22bb66['pushAction'](_0x307cba);},_0x2291cf=_0x3c2630=>_0x1f9a3d({'symbol':_0x3c2630}),_0x140087=_0x445036=>{const _0x25ee62={};_0x445036['forEach'](_0x5e4090=>Object['assign'](_0x25ee62,{[_0x5e4090]:{'symbol':_0x5e4090}})),_0x182f1d(_0x25ee62);},_0x534131=_0x2f0037=>{const _0x4ffb86=_0xfd373e=>{_0x182f1d(_0xfd373e);},_0x250146=_0x531353['getValue'](),_0x5a2c5f=pipe(_0x250146,record['deleteAt'](_0x2f0037)),_0x3aa066=()=>_0x4ffb86(_0x5a2c5f),_0x555a50=()=>_0x4ffb86(_0x250146),_0x31023b={};_0x31023b['type']='compare_change',_0x31023b['redo']=_0x3aa066,_0x31023b['undo']=_0x555a50,_0x22bb66['pushAction'](_0x31023b);},_0x580ec9=_0x22902b=>{if(instrumentEq['equals'](_0x22902b,_0x1cd2c9['getValue']()))return;const _0x1ff0fd=_0x20fc64['state']['getValue']()['isInstrumentSyncEnabled'],_0x46b99d=_0x1cd2c9['getValue'](),_0x59f6cd=_0x220afb=>{_0x1ff0fd?_0x20fc64['setInstrument'](_0x220afb):_0x34825e(_0x220afb);},_0x3413a1=()=>_0x59f6cd(_0x22902b),_0x31214d=()=>_0x59f6cd(_0x46b99d),_0x5e74b6={};_0x5e74b6['type']='instrument_change',_0x5e74b6['redo']=_0x3413a1,_0x5e74b6['undo']=_0x31214d,_0x22bb66['pushAction'](_0x5e74b6);},_0x1652cd=pipe(_0x382b9e,withLatestFrom(filterMapOption(_0x5b206b),_0x531353),tap(([_0x1a7ed6,_0x9734fb,_0x52bfeb])=>pipe(_0x1a7ed6,array['foldLeft'](constVoid,(_0x13ba2b,_0x308507)=>{_0x418f35['setData']([{'candles':_0x13ba2b['data']['map'](toCandles),'instrument':instrumentToChartInstrument(_0x9734fb)},...pipe(_0x308507,array['map'](_0x5998d4=>({'candles':_0x5998d4['data']['map'](toCandles),'instrument':_0x52bfeb[_0x5998d4['instrument']]})))]),_0x3e10c5(_0x13ba2b['data']);})))),_0x5bcdc7=pipe(_0x2eaf10,withLatestFrom(filterMapOption(_0x5b206b),_0x531353),tap(([_0xf47d61,_0x7f1e0c,_0x273728])=>pipe(_0xf47d61,option['fromPredicate'](array['isNonEmpty']),option['fold'](constVoid,_0x38b480=>pipe(_0x38b480,nonEmptyArray['matchLeft']((_0x4ebe88,_0x7f8445)=>{_0x418f35['updateData']([{'candles':_0x4ebe88['data']['map'](toCandles),'instrument':instrumentToChartInstrument(_0x7f1e0c)},...pipe(_0x7f8445,array['map'](_0x3b8102=>({'candles':_0x3b8102['data']['map'](toCandles),'instrument':_0x273728[_0x3b8102['instrument']]})))]);})))))),_0x41632c=pipe(_0x17ae21,withLatestFrom(filterMapOption(_0x5b206b),_0x531353,_0x33aaea),observable['filter'](([_0x44352f,_0x1d919f,_0x68a126,_0x41a9a3])=>!array['isEmpty'](_0x41a9a3)),observable['map'](([_0x420c6f,_0x3b41a7,_0x51f1a5])=>({'data':_0x420c6f,'instruments':{[_0x3b41a7['symbol']]:_0x3b41a7,..._0x51f1a5}})),observable['filterMap'](({data:{candleData:_0x4352c9,symbol:_0x203ae3},instruments:_0xd46796})=>pipe(_0xd46796,record['lookup'](_0x203ae3),option['map'](_0x535959=>({'instrument':_0x535959,'candleData':_0x4352c9})))),tap(({candleData:_0x4bb589,instrument:_0x206b57})=>{const _0x3f4ec6=_0x418f35['chartModel']['candleSeries']['find'](_0x358cbc=>_0x358cbc['instrument']['symbol']===_0x206b57['symbol']);_0x3f4ec6&&at(-0x1,_0x3f4ec6['dataPoints'])?.['timestamp']===_0x4bb589['time']?_0x418f35['data']['updateLastCandle'](toCandles(_0x4bb589),_0x206b57['symbol']):(_0x418f35['data']['addLastCandle'](toCandles(_0x4bb589),_0x206b57['symbol']),_0x3f4ec6&&_0x190618(_0x3f4ec6['dataPoints'],_0x1e6821['chartDataOptionsSettings']['maxCandlesCount'])&&_0x418f35['data']['removeCandleByIdx'](0x0,_0x206b57['symbol'])),_0x2d0e18(_0x4bb589);})),_0x45c5f1=pipe(filterMapOption(_0x5b206b),observable['map'](_0x30409f=>_0x30409f['symbol']),distinctUntilChanged(),switchMap(_0x25ada0['subscribeServiceData']),tap(_0x6f4437)),_0x37b692=pipe(_0x418f35['scale']['xChanged'],skip(0x1),observable['filter'](()=>_0x418f35['scale']['xStart']<0x0),debounceTime(0x12c),tap(()=>{if(_0x418f35['scale']['xStart']<0x0){const {maxCandlesCount:_0x48413c}=_0x1e6821['chartDataOptionsSettings'],_0x55f01d=_0x418f35['chartModel']['mainCandleSeries']['dataPoints'][0x0]?.['timestamp'];!_0x190618(_0x418f35['chartModel']['mainCandleSeries']['dataPoints'],_0x48413c)&&_0x55f01d&&_0x30da74['requestMoreHistoryData'](_0x4fe1cb,{'toTime':_0x55f01d});}})),_0x277918=pipe(combineLatest([_0x1cd2c9,_0x9818dc,_0x5398a2]),tap(([_0x3e9eb2,_0x4bf556])=>{const _0x2d9024={};_0x2d9024['instrument']=_0x3e9eb2,_0x2d9024['extendedHours']=_0x4bf556,_0x20fc64['updateLocalChartInfo'](_0x4fe1cb,_0x2d9024);})),_0x3aff10=pipe(_0x1cd2c9,observable['filter'](_0x1ab7ba=>option['isSome'](_0x1ab7ba)),observableOption['chain'](_0x4b56ad=>_0x2cc6c1['getInstrument'](_0x4b56ad)),observableOption['fold'](()=>{const _0x5e4a30={};return _0x5e4a30['firstRow']=_0x22f5dc['systemMessages']['instrumentIsNotAvailable'],_0x418f35['watermark']['setWaterMarkData'](_0x5e4a30),_0x418f35['watermark']['setWaterMarkVisible'](!![]),pipe(_0x1cd2c9['getValue'](),option['fold'](()=>undefined,_0x5d08c8=>{const _0x227ceb=toChartDataSubscriptionKey(_0x5d08c8,_0x5398a2['getValue'](),{'candleAlignment':_0x2da2c4['getValue'](),'priceType':_0x48e894['getValue'](),'extendedHours':_0x9818dc['getValue']()});_0x64569f['updateLoadingState'](chartDataID(_0x227ceb),'done');})),of(option['none']);},_0x4afac9=>{return _0x351466(option['some'](_0x4afac9)),of(option['some'](_0x4afac9));})),_0x3750a9=pipe(_0x1cd2c9,observable['filter'](()=>_0x64569f['isLoaded']['getValue']()),distinctUntilChanged(),tap(_0x30b5b7=>pipe(_0x30b5b7,option['fold'](()=>{const _0x3ccfd0={};_0x3ccfd0['firstRow']=_0x22f5dc['systemMessages']['instrumentIsNotSelected'],_0x418f35['watermark']['setWaterMarkData'](_0x3ccfd0),_0x418f35['watermark']['setWaterMarkVisible'](!![]);},constVoid)))),_0x19e974=pipe(combineLatest([_0x20fc64['state'],_0x1cd2c9]),observable['filter'](([_0x43ea4])=>_0x43ea4['isInstrumentSyncEnabled']),observable['map'](([_0x554f72])=>_0x554f72['lastInstrument']),distinctUntilChanged(),tap(_0x34825e)),_0x4c265e=pipe(_0x382b9e,observable['filter'](_0x438563=>pipe(_0x438563,array['some'](_0x2cbcc5=>pipe(_0x5b206b['getValue'](),option['fold'](()=>![],_0x52c361=>_0x2cbcc5['instrument']===_0x52c361['symbol']&&_0x2cbcc5['data']['length']===0x0))))),tap(()=>{const _0x1fa722={};_0x1fa722['firstRow']=_0x22f5dc['systemMessages']['noDataAvailable'],_0x418f35['watermark']['setWaterMarkData'](_0x1fa722),_0x418f35['watermark']['setWaterMarkVisible'](!![]);})),_0x435b0e=pipe(merge(_0x1652cd,_0x5bcdc7,_0x41632c,_0x45c5f1,_0x19e974,_0x277918,_0x37b692,_0x3aff10,_0x3750a9,_0x4c265e),share()),_0x4d9f76={};return _0x4d9f76['selectedInstrument']=_0x1cd2c9,_0x4d9f76['instrument']=_0x5b206b,_0x4d9f76['compareInstruments']=_0x531353,_0x4d9f76['priceType']=_0x48e894,_0x4d9f76['candlesAlign']=_0x2da2c4,_0x4d9f76['extendedHours']=_0x9818dc,_0x4d9f76['historicalCandlesUpdated']=_0x33aaea,_0x4d9f76['lastCandleUpdated']=_0x5df695,_0x4d9f76['lazyHistoryData']=_0x2eaf10,_0x4d9f76['initialHistoryData']=_0x382b9e,_0x4d9f76['changeInstrument']=_0x580ec9,_0x4d9f76['addCompareInstrument']=_0x1f9a3d,_0x4d9f76['removeCompareInstrument']=_0x534131,_0x4d9f76['setCompareInstruments']=_0x182f1d,_0x4d9f76['setExtendedHours']=_0x890492,_0x4d9f76['changePriceType']=_0x20bb88,_0x4d9f76['changeCandlesAlignment']=_0x579253,_0x4d9f76['serviceData']=_0x52ae75,_0x4d9f76['addCompareInstrumentFromApi']=_0x2291cf,_0x4d9f76['setCompareInstrumentsFromApi']=_0x140087,_0x4d9f76['clearChartDataFromApi']=_0xb8cdff,sink['newSink'](callTracerProxy('chartDataViewModel',_0x4d9f76),_0x435b0e);});const toCandles=_0x30a0d0=>({'hi':_0x30a0d0['high'],'lo':_0x30a0d0['low'],'open':_0x30a0d0['open'],'close':_0x30a0d0['close'],'timestamp':_0x30a0d0['time'],'volume':_0x30a0d0['volume'],'expansion':![],'idx':undefined,'impVolatility':_0x30a0d0['impVolatility'],'vwap':_0x30a0d0['vwap']}),filterAvailableDataOptions=(_0x22b42f,_0x4f2220)=>({..._0x22b42f,..._0x4f2220['chartDataOptionsSettings']['candlesAlignment']['enabled']&&{'candleAlignment':_0x22b42f['candleAlignment']},..._0x4f2220['chartDataOptionsSettings']['priceType']['enabled']&&{'priceType':_0x22b42f['priceType']},..._0x4f2220['chartDataOptionsSettings']['extendedHours']['enabled']&&{'extendedHours':_0x22b42f['extendedHours']}});export const instrumentNameOption=_0x1f3011=>pipe(_0x1f3011,option['map'](_0x47e313=>_0x47e313['symbol']));export const takeFirstAvailablePriceType=_0x27366f=>{return pipe(_0x27366f,option['fromPredicate'](array['isNonEmpty']),option['fold'](()=>'last',head));};const instrumentEq=pipe(string['Eq'],option['getEq']);