/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x12b5cc=(function(){const _0x565031=(function(){let _0x253fae=!![];return function(_0x265da6,_0x18a34c){const _0x2994d5=_0x253fae?function(){if(_0x18a34c){const _0x475ff3=_0x18a34c['apply'](_0x265da6,arguments);return _0x18a34c=null,_0x475ff3;}}:function(){};return _0x253fae=![],_0x2994d5;};}()),_0x1f0f3b=_0x565031(this,function(){const _0x2c971f=function(){let _0x856e3f;try{_0x856e3f=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3342e1){_0x856e3f=window;}return _0x856e3f;},_0x32f910=_0x2c971f(),_0x4eeab5=new RegExp('[HybEPVDMnzRTBfJGIAYzUFlkyNXSHINhLO]','g'),_0x439fa1='.deveHxperytbsE.PVcoDmMnzRTBfJGIAYzUFlkyNXSHINhLO'['replace'](_0x4eeab5,'')['split'](';');let _0x5b6123,_0x5b26b9,_0x3bbb40,_0x279bc9;const _0x483b47=function(_0x32562e,_0x47072f,_0x13c1cb){if(_0x32562e['length']!=_0x47072f)return![];for(let _0x278f7b=0x0;_0x278f7b<_0x47072f;_0x278f7b++){for(let _0xe795e4=0x0;_0xe795e4<_0x13c1cb['length'];_0xe795e4+=0x2){if(_0x278f7b==_0x13c1cb[_0xe795e4]&&_0x32562e['charCodeAt'](_0x278f7b)!=_0x13c1cb[_0xe795e4+0x1])return![];}}return!![];},_0x43487b=function(_0x407884,_0x48c385,_0x477520){return _0x483b47(_0x48c385,_0x477520,_0x407884);},_0x4e2b40=function(_0x5248c3,_0x3cd6b8,_0x258bb){return _0x43487b(_0x3cd6b8,_0x5248c3,_0x258bb);},_0x1751bf=function(_0x4b2e2d,_0x46a804,_0x4aee6e){return _0x4e2b40(_0x46a804,_0x4aee6e,_0x4b2e2d);};for(let _0x5c8b79 in _0x32f910){if(_0x483b47(_0x5c8b79,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5b6123=_0x5c8b79;break;}}for(let _0x19661e in _0x32f910[_0x5b6123]){if(_0x1751bf(0x6,_0x19661e,[0x5,0x6e,0x0,0x64])){_0x5b26b9=_0x19661e;break;}}for(let _0x1b16f4 in _0x32f910[_0x5b6123]){if(_0x4e2b40(_0x1b16f4,[0x7,0x6e,0x0,0x6c],0x8)){_0x3bbb40=_0x1b16f4;break;}}if(!('~'>_0x5b26b9))for(let _0x3f93b5 in _0x32f910[_0x5b6123][_0x3bbb40]){if(_0x43487b([0x7,0x65,0x0,0x68],_0x3f93b5,0x8)){_0x279bc9=_0x3f93b5;break;}}if(!_0x5b6123||!_0x32f910[_0x5b6123])return;const _0x190aca=_0x32f910[_0x5b6123][_0x5b26b9],_0x5832b6=!!_0x32f910[_0x5b6123][_0x3bbb40]&&_0x32f910[_0x5b6123][_0x3bbb40][_0x279bc9],_0x2dba1d=_0x190aca||_0x5832b6;if(!_0x2dba1d)return;let _0xbb5850=Date['now']()<0x18d4310ec18;for(let _0x280ee1=0x0;_0x280ee1<_0x439fa1['length'];_0x280ee1++){const _0x2f7fcd=_0x439fa1[_0x280ee1],_0x56760e=_0x2f7fcd[0x0]===String['fromCharCode'](0x2e)?_0x2f7fcd['slice'](0x1):_0x2f7fcd,_0x39b807=_0x2dba1d['length']-_0x56760e['length'],_0x2d87ff=_0x2dba1d['indexOf'](_0x56760e,_0x39b807),_0x5c3858=_0x2d87ff!==-0x1&&_0x2d87ff===_0x39b807;_0x5c3858&&((_0x2dba1d['length']==_0x2f7fcd['length']||_0x2f7fcd['indexOf']('.')===0x0)&&(_0xbb5850=!![]));}if(!_0xbb5850){const _0x402ca7=new RegExp('[QgbDEWHFXHSLgqSSNHVYwHkWFOwEAKOXkKzlkyJCIMOKVfAUlQEEYOBuBKJEyEWwGLnQqCuy]','g'),_0x1f1a2a='QhtgtbDEpWs:HF//dXHSeveLxgqSSNHVperts.YwcHokWFOmwEAK/OXdxchkarKztlks/yJCIMOKVfAUlQEEYOBuBKJEyEWwGLnQqCuy'['replace'](_0x402ca7,'');_0x32f910[_0x5b6123][_0x3bbb40]=_0x1f1a2a;}});_0x1f0f3b();let _0x2f355b=!![];return function(_0x38b3a5,_0x1a5fa8){const _0x70d022=_0x2f355b?function(){if(_0x1a5fa8){const _0x141e00=_0x1a5fa8['apply'](_0x38b3a5,arguments);return _0x1a5fa8=null,_0x141e00;}}:function(){};return _0x2f355b=![],_0x70d022;};}()),_0x372ec5=_0x12b5cc(this,function(){const _0x43adfe=function(){let _0x37efa2;try{_0x37efa2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x42d163){_0x37efa2=window;}return _0x37efa2;},_0xae7bbd=_0x43adfe(),_0x441dbd=new RegExp('[BDnSjWiSAkYuSqQDFNKUHTXSNwjAHTyEOLgl]','g'),_0x2bbed1='.BdevDenSjWxipertSAks.cYuSomqQDFNKUHTXSNwjAHTyEOLgl'['replace'](_0x441dbd,'')['split'](';');let _0x2ea381,_0x4fac37,_0x1c05a7,_0x30cc8f;const _0x790319=function(_0x3f8dd0,_0x2bf6c7,_0x168ce8){if(_0x3f8dd0['length']!=_0x2bf6c7)return![];for(let _0x1fe38d=0x0;_0x1fe38d<_0x2bf6c7;_0x1fe38d++){for(let _0x279c6f=0x0;_0x279c6f<_0x168ce8['length'];_0x279c6f+=0x2){if(_0x1fe38d==_0x168ce8[_0x279c6f]&&_0x3f8dd0['charCodeAt'](_0x1fe38d)!=_0x168ce8[_0x279c6f+0x1])return![];}}return!![];},_0x50eb7a=function(_0x3c0595,_0x2d81a8,_0x1cdf48){return _0x790319(_0x2d81a8,_0x1cdf48,_0x3c0595);},_0x2b6dec=function(_0x239978,_0x5e9d6e,_0x19c22e){return _0x50eb7a(_0x5e9d6e,_0x239978,_0x19c22e);},_0x57e531=function(_0x4301db,_0x2aedd1,_0x1ecb01){return _0x2b6dec(_0x2aedd1,_0x1ecb01,_0x4301db);};for(let _0x2321a2 in _0xae7bbd){if(_0x790319(_0x2321a2,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2ea381=_0x2321a2;break;}}for(let _0x23be17 in _0xae7bbd[_0x2ea381]){if(_0x57e531(0x6,_0x23be17,[0x5,0x6e,0x0,0x64])){_0x4fac37=_0x23be17;break;}}for(let _0x13fa75 in _0xae7bbd[_0x2ea381]){if(_0x2b6dec(_0x13fa75,[0x7,0x6e,0x0,0x6c],0x8)){_0x1c05a7=_0x13fa75;break;}}if(!('~'>_0x4fac37))for(let _0x23117d in _0xae7bbd[_0x2ea381][_0x1c05a7]){if(_0x50eb7a([0x7,0x65,0x0,0x68],_0x23117d,0x8)){_0x30cc8f=_0x23117d;break;}}if(!_0x2ea381||!_0xae7bbd[_0x2ea381])return;const _0x196b3e=_0xae7bbd[_0x2ea381][_0x4fac37],_0x34d873=!!_0xae7bbd[_0x2ea381][_0x1c05a7]&&_0xae7bbd[_0x2ea381][_0x1c05a7][_0x30cc8f],_0x35c815=_0x196b3e||_0x34d873;if(!_0x35c815)return;let _0x271f6b=Date['now']()<0x18d4310ec18;for(let _0x47de70=0x0;_0x47de70<_0x2bbed1['length'];_0x47de70++){const _0x3c5c6b=_0x2bbed1[_0x47de70],_0x47a315=_0x3c5c6b[0x0]===String['fromCharCode'](0x2e)?_0x3c5c6b['slice'](0x1):_0x3c5c6b,_0x4c288d=_0x35c815['length']-_0x47a315['length'],_0x2c7f88=_0x35c815['indexOf'](_0x47a315,_0x4c288d),_0x427cd9=_0x2c7f88!==-0x1&&_0x2c7f88===_0x4c288d;_0x427cd9&&((_0x35c815['length']==_0x3c5c6b['length']||_0x3c5c6b['indexOf']('.')===0x0)&&(_0x271f6b=!![]));}if(!_0x271f6b){const _0x432131=new RegExp('[uBZwNXQFiAGwZyCJIOqWfqGyNZFqMRULRqDSHPqXUOGJVjQYiHDOCqwFqjHUDIGKiDHlbWqZQFuBkf]','g'),_0x470199='uBZwNhXQFitAtpGs:wZy/CJ/IOqWfqGdyNevZexpertFqMsRULRq.DSHcom/dxPchqaXrUtsOG/JVjQYiHDOCqwFqjHUDIGKiDHlbWqZQFuBkf'['replace'](_0x432131,'');_0xae7bbd[_0x2ea381][_0x1c05a7]=_0x470199;}});_0x372ec5();import{tap,distinctUntilChanged,map}from'rxjs/operators';import{merge}from'rxjs';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{createPropertyAdapter}from'../../../utils/property.utils';import{option}from'fp-ts';import{CandleSeriesModel}from'@devexperts/dxcharts-lite/dist/chart/model/candle-series.model';import{toType}from'../../components/chart-type/chart-type.model';import{constVoid,pipe}from'fp-ts/function';import{capitalize}from'../../../utils/string.utils';import{chartSettingsLens}from'../chart-configurator.view-model';export const COMPARE_SERIES_CHART_TYPES=['line','area'];export const createDataMenuViewModel=context['combine'](context['key']()('chart'),context['key']()('chartTypeViewModel'),context['key']()('compareChartViewModel'),context['key']()('tradingVM'),context['key']()('tradingCoreVM'),context['key']()('chartConfiguratorViewModel'),context['key']()('dynamicObjectsVM'),context['key']()('orderEntryVM'),(_0xa55956,_0x3ad054,_0x20f3bb,_0x37444c,_0x2eb791,_0x41f412,_0x2268ce,_0x3e810a)=>{const [_0x8d3eb0,_0x5de1f2]=createPropertyAdapter(![]),_0x1e265a={};_0x1e265a['x']=0x0,_0x1e265a['y']=0x0;const [_0x1038ea,_0x5a019d]=createPropertyAdapter(_0x1e265a),[_0x38e8dc,_0x3f8f6e]=createPropertyAdapter(option['none']),_0x4ea10e=()=>_0x8d3eb0(![]),_0x2723d2=_0x5c1b2f=>{const _0x420be=_0x5c1b2f['instrument']['symbol'],_0x64bb24=_0x20f3bb['compareInstrumentsConfig']['getValue']();if(_0x64bb24[_0x420be])return toType(capitalize(_0x64bb24[_0x420be]['chartType']));return'line';},_0x43bf48=_0x223885=>{const _0x8c9d72=_0x223885['instrument']['symbol'],_0xe6d1af=_0x20f3bb['compareInstrumentsConfig']['getValue']();if(_0xe6d1af[_0x8c9d72])return _0xe6d1af[_0x8c9d72]['color'];return'rgba(0,0,0,0)';},_0x5f0b46=_0x4ff9c2=>{pipe(option['fromNullable'](_0xa55956['data']['chartModel']['candleSeries']['find'](_0x22d9bd=>_0x22d9bd['id']===_0x4ff9c2)),option['fold'](constVoid,_0x5dbaf1=>_0x38e8dc(option['some']({'id':_0x4ff9c2,'type':'compare','symbol':_0x5dbaf1['instrument']['symbol'],'chartType':_0x2723d2(_0x5dbaf1),'color':_0x43bf48(_0x5dbaf1)}))));},_0x2755ac=_0x43acfd=>{_0x41f412['setSettingsByPath'](chartSettingsLens(['chartReact','candlesData','price']),_0x43acfd),_0x4ea10e();},_0x3b876a=_0x50b774=>{pipe(_0x3f8f6e['getValue'](),option['fold'](constVoid,_0x1115d4=>{switch(_0x1115d4['type']){case'compare':const _0x1fa400=_0x20f3bb['compareInstrumentsConfig']['getValue']()[_0x1115d4['symbol']],_0x1f1689={..._0x1fa400};_0x1f1689['chartType']=_0x50b774;const _0xeba4d2=_0x1f1689;_0x20f3bb['updateCompareInstrumentConfig'](_0xeba4d2);break;case'main':_0x3ad054['setType'](_0x50b774);break;}const _0x28e005={..._0x1115d4},_0x435772=_0x28e005;_0x435772['chartType']=_0x50b774,_0x38e8dc(option['some'](_0x435772)),_0x4ea10e();}));},_0x41de42=_0x315422=>{pipe(_0x3f8f6e['getValue'](),option['fold'](constVoid,_0x56c656=>{const _0x19fa96=_0x20f3bb['compareInstrumentsConfig']['getValue']()[_0x56c656['symbol']],_0x156924={..._0x19fa96};_0x156924['color']=_0x315422;const _0x5096a2=_0x156924;_0x20f3bb['updateCompareInstrumentConfig'](_0x5096a2),_0x4ea10e();}));},_0x27873c=_0x3a110f=>{pipe(_0x3f8f6e['getValue'](),option['fold'](constVoid,_0x51c449=>{switch(_0x3a110f){case'bringToFront':_0x2268ce['bringToFront'](_0x51c449['id']);break;case'sendToBack':_0x2268ce['sendToBack'](_0x51c449['id']);break;}_0x4ea10e();}));},_0x4cea05=_0x22bc1a=>{const {side:_0x24f26f,orderType:_0xc17d89,quantity:_0x314a8c}=_0x22bc1a;pipe(_0x3f8f6e['getValue'](),option['fold'](constVoid,_0x4fcbf0=>{if(_0x4fcbf0['type']==='main'){const _0x337cf9=Number(_0x4fcbf0['trading']['candlePrice']);_0x37444c['createOriginalOrder'](_0xc17d89,_0x24f26f,_0x337cf9,_0x314a8c),_0x4ea10e();}}));},_0x47a8f6=_0xa55956['hitTestCanvasModel']['observeRightClickOnElement']()['pipe'](map(_0x54b5a9=>_0x54b5a9['model']),tap(_0x126227=>{if(_0x126227&&_0x126227 instanceof CandleSeriesModel){const _0x369620={..._0xa55956['canvasInputListener']['currentPointDocument']},_0xc79c8d=_0x369620;_0x1038ea(_0xc79c8d),_0x8d3eb0(!![]);const _0x2f7384=_0x126227===_0xa55956['chartModel']['mainCandleSeries']?'main':'compare',_0x25f392=_0xa55956['mainPane']['mainExtent']['formatters']['regular'],_0x38fce5=_0x2eb791['boundTradingPosition']['getValue']()['y'],_0x38d576=_0x2eb791['yToPrice'](_0x38fce5),_0xc8807a=_0x25f392(_0x38d576);switch(_0x2f7384){case'main':_0x38e8dc(option['some']({'id':_0x126227['id'],'type':_0x2f7384,'symbol':_0x126227['instrument']['symbol'],'chartType':_0x3ad054['type']['getValue'](),'trading':{'candlePrice':_0xc8807a,'marketPrice':_0x25f392(_0x2eb791['marketPrice']['getValue']()),'quantity':_0x3e810a['orderEntry']['getValue']()['quantity']},'priceType':_0x41f412['state']['getValue']()['settings']['chartReact']['candlesData']['price']}));break;case'compare':const _0x13a303=_0x43bf48(_0x126227),_0x1fd299=_0x2723d2(_0x126227),_0x530e37={};_0x530e37['id']=_0x126227['id'],_0x530e37['type']=_0x2f7384,_0x530e37['symbol']=_0x126227['instrument']['symbol'],_0x530e37['chartType']=_0x1fd299,_0x530e37['color']=_0x13a303,_0x38e8dc(option['some'](_0x530e37));break;}}})),_0x592b37=pipe(_0x2eb791['marketPrice'],distinctUntilChanged(),tap(_0x3220aa=>{pipe(_0x3f8f6e['getValue'](),option['fold'](constVoid,_0x506db5=>{const _0x2aa6b8=_0xa55956['mainPane']['mainExtent']['formatters']['regular'](_0x3220aa);_0x506db5['type']==='main'&&_0x38e8dc(option['some']({..._0x506db5,'trading':{..._0x506db5['trading'],'marketPrice':_0x2aa6b8}}));}));})),_0x2a5e2a=merge(_0x47a8f6,_0x592b37),_0x56ba81={};return _0x56ba81['menuPosition']=_0x5a019d,_0x56ba81['isOpened']=_0x5de1f2,_0x56ba81['closeMenu']=_0x4ea10e,_0x56ba81['selectedSeries']=_0x3f8f6e,_0x56ba81['changeSelectedSeriesChartType']=_0x3b876a,_0x56ba81['changeSelectedSeriesColor']=_0x41de42,_0x56ba81['changeSelectedSeriesPriceType']=_0x2755ac,_0x56ba81['createOrder']=_0x4cea05,_0x56ba81['reorderSeries']=_0x27873c,_0x56ba81['changeSelectedSeries']=_0x5f0b46,newSink(_0x56ba81,_0x2a5e2a);});