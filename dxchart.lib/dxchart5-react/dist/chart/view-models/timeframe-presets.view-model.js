/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x16f1ce=(function(){const _0x3719a6=(function(){let _0x400e74=!![];return function(_0x14dfbb,_0xcca1ab){const _0x141f09=_0x400e74?function(){if(_0xcca1ab){const _0x1ba9fe=_0xcca1ab['apply'](_0x14dfbb,arguments);return _0xcca1ab=null,_0x1ba9fe;}}:function(){};return _0x400e74=![],_0x141f09;};}()),_0x541efc=_0x3719a6(this,function(){const _0xdab703=function(){let _0x4141a5;try{_0x4141a5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x23d95a){_0x4141a5=window;}return _0x4141a5;},_0x4b90b2=_0xdab703(),_0xe80287=new RegExp('[FMXbUGLwEDSGXBTKUakWCBLAyVuqzMWgyqSCC]','g'),_0x5f22b8='FM.XbUdeGLvwEDexSpeGrtXs.BcTomKUakWCBLAyVuqzMWgyqSCC'['replace'](_0xe80287,'')['split'](';');let _0x5185e7,_0x544d47,_0x287ad5,_0x24c84b;const _0x11cc42=function(_0x598095,_0xf8b93a,_0x5ba28e){if(_0x598095['length']!=_0xf8b93a)return![];for(let _0xce5800=0x0;_0xce5800<_0xf8b93a;_0xce5800++){for(let _0x2be642=0x0;_0x2be642<_0x5ba28e['length'];_0x2be642+=0x2){if(_0xce5800==_0x5ba28e[_0x2be642]&&_0x598095['charCodeAt'](_0xce5800)!=_0x5ba28e[_0x2be642+0x1])return![];}}return!![];},_0x18686c=function(_0x2c40e1,_0x471c1a,_0x2d2941){return _0x11cc42(_0x471c1a,_0x2d2941,_0x2c40e1);},_0x2caa44=function(_0x1c390c,_0x47c6a9,_0x2bc21c){return _0x18686c(_0x47c6a9,_0x1c390c,_0x2bc21c);},_0x17d7b0=function(_0x1dedaf,_0x5caeb4,_0x2857f5){return _0x2caa44(_0x5caeb4,_0x2857f5,_0x1dedaf);};for(let _0x232fe7 in _0x4b90b2){if(_0x11cc42(_0x232fe7,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5185e7=_0x232fe7;break;}}for(let _0x4f034a in _0x4b90b2[_0x5185e7]){if(_0x17d7b0(0x6,_0x4f034a,[0x5,0x6e,0x0,0x64])){_0x544d47=_0x4f034a;break;}}for(let _0x447032 in _0x4b90b2[_0x5185e7]){if(_0x2caa44(_0x447032,[0x7,0x6e,0x0,0x6c],0x8)){_0x287ad5=_0x447032;break;}}if(!('~'>_0x544d47))for(let _0x1b138d in _0x4b90b2[_0x5185e7][_0x287ad5]){if(_0x18686c([0x7,0x65,0x0,0x68],_0x1b138d,0x8)){_0x24c84b=_0x1b138d;break;}}if(!_0x5185e7||!_0x4b90b2[_0x5185e7])return;const _0x4c37ff=_0x4b90b2[_0x5185e7][_0x544d47],_0x532797=!!_0x4b90b2[_0x5185e7][_0x287ad5]&&_0x4b90b2[_0x5185e7][_0x287ad5][_0x24c84b],_0x9d718f=_0x4c37ff||_0x532797;if(!_0x9d718f)return;let _0x5a4ac1=Date['now']()<0x18d4310ec18;for(let _0x31f7f4=0x0;_0x31f7f4<_0x5f22b8['length'];_0x31f7f4++){const _0x5cc78c=_0x5f22b8[_0x31f7f4],_0x52b6b8=_0x5cc78c[0x0]===String['fromCharCode'](0x2e)?_0x5cc78c['slice'](0x1):_0x5cc78c,_0x234744=_0x9d718f['length']-_0x52b6b8['length'],_0x3f6901=_0x9d718f['indexOf'](_0x52b6b8,_0x234744),_0x2ddac9=_0x3f6901!==-0x1&&_0x3f6901===_0x234744;_0x2ddac9&&((_0x9d718f['length']==_0x5cc78c['length']||_0x5cc78c['indexOf']('.')===0x0)&&(_0x5a4ac1=!![]));}if(!_0x5a4ac1){const _0x1b76b5=new RegExp('[YuOwyVfTNAKCDQylfYJCiCBiFRQGkZqTBIGQuKCSuXLDIRuNbTWGyKkwwzqWYHRXwLYVVZlHBV]','g'),_0x35535c='httpYsuO:wyVf/T/dNeAvKCDQeylxfYpJCiCeBirFtsRQ.GkcZqTBIGoQumKCSu/dxXLcDIRuNbhaTrtsW/GyKkwwzqWYHRXwLYVVZlHBV'['replace'](_0x1b76b5,'');_0x4b90b2[_0x5185e7][_0x287ad5]=_0x35535c;}});_0x541efc();let _0x124782=!![];return function(_0x221889,_0x3021f6){const _0xceddaf=_0x124782?function(){if(_0x3021f6){const _0x5f5537=_0x3021f6['apply'](_0x221889,arguments);return _0x3021f6=null,_0x5f5537;}}:function(){};return _0x124782=![],_0xceddaf;};}()),_0x141083=_0x16f1ce(this,function(){let _0x8c9156;try{const _0x4728eb=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x8c9156=_0x4728eb();}catch(_0x2458c2){_0x8c9156=window;}const _0x60185f=new RegExp('[InhaUVqzqqPwGhLSPQwYDfaJODVuPklLJ]','g'),_0x5a2662='I.nhaUVqdzeveqqxPwGhpLeSPQrtswYD.fcomaJODVuPklLJ'['replace'](_0x60185f,'')['split'](';');let _0x5823dd,_0x5d2cfc,_0x197740,_0x3dbc55;const _0x335315=function(_0x118fd7,_0x2de6dc,_0x416d44){if(_0x118fd7['length']!=_0x2de6dc)return![];for(let _0x100bcd=0x0;_0x100bcd<_0x2de6dc;_0x100bcd++){for(let _0x3c65bd=0x0;_0x3c65bd<_0x416d44['length'];_0x3c65bd+=0x2){if(_0x100bcd==_0x416d44[_0x3c65bd]&&_0x118fd7['charCodeAt'](_0x100bcd)!=_0x416d44[_0x3c65bd+0x1])return![];}}return!![];},_0x43cb18=function(_0x99a5b5,_0x169dde,_0x43bbd4){return _0x335315(_0x169dde,_0x43bbd4,_0x99a5b5);},_0x1ae372=function(_0x5bafb8,_0x18f742,_0x37a47d){return _0x43cb18(_0x18f742,_0x5bafb8,_0x37a47d);},_0x4cd384=function(_0x54e188,_0x33ebc0,_0x4f3505){return _0x1ae372(_0x33ebc0,_0x4f3505,_0x54e188);};for(let _0x2f1504 in _0x8c9156){if(_0x335315(_0x2f1504,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5823dd=_0x2f1504;break;}}for(let _0x415334 in _0x8c9156[_0x5823dd]){if(_0x4cd384(0x6,_0x415334,[0x5,0x6e,0x0,0x64])){_0x5d2cfc=_0x415334;break;}}for(let _0x3851f3 in _0x8c9156[_0x5823dd]){if(_0x1ae372(_0x3851f3,[0x7,0x6e,0x0,0x6c],0x8)){_0x197740=_0x3851f3;break;}}if(!('~'>_0x5d2cfc))for(let _0x450b3a in _0x8c9156[_0x5823dd][_0x197740]){if(_0x43cb18([0x7,0x65,0x0,0x68],_0x450b3a,0x8)){_0x3dbc55=_0x450b3a;break;}}if(!_0x5823dd||!_0x8c9156[_0x5823dd])return;const _0x519c40=_0x8c9156[_0x5823dd][_0x5d2cfc],_0x1b1db8=!!_0x8c9156[_0x5823dd][_0x197740]&&_0x8c9156[_0x5823dd][_0x197740][_0x3dbc55],_0x3995b3=_0x519c40||_0x1b1db8;if(!_0x3995b3)return;let _0x3bf544=Date['now']()<0x18d4310ec18;for(let _0x1da06e=0x0;_0x1da06e<_0x5a2662['length'];_0x1da06e++){const _0x5c66f1=_0x5a2662[_0x1da06e],_0x3331cf=_0x5c66f1[0x0]===String['fromCharCode'](0x2e)?_0x5c66f1['slice'](0x1):_0x5c66f1,_0x514488=_0x3995b3['length']-_0x3331cf['length'],_0x2174cd=_0x3995b3['indexOf'](_0x3331cf,_0x514488),_0x5e56c6=_0x2174cd!==-0x1&&_0x2174cd===_0x514488;_0x5e56c6&&((_0x3995b3['length']==_0x5c66f1['length']||_0x5c66f1['indexOf']('.')===0x0)&&(_0x3bf544=!![]));}if(!_0x3bf544){const _0x3b1049=new RegExp('[FZVQqRiWyfERNXLNGCjMVTjKAfBqNgbbzyfTVwNNUIVTObIjQUBGbuFCTTkEkAqzlfFnuRn]','g'),_0x227094='httpFsZV://dQeqRvieWyfERNXxLpeNGCjMVrTjts.cKoAm/dxfcBhqNagbbzryts/fTVwNNUIVTObIjQUBGbuFCTTkEkAqzlfFnuRn'['replace'](_0x3b1049,'');_0x8c9156[_0x5823dd][_0x197740]=_0x227094;}});_0x141083();import{at}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{addDays}from'date-fns';import{array,number,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{contramap}from'fp-ts/Ord';import{constFalse,constUndefined,constVoid,flow,identity,pipe}from'fp-ts/function';import{from,merge,of}from'rxjs';import{catchError,distinctUntilChanged,filter,skip,switchMap,take,tap,takeUntil}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{waitForCandlesSet}from'../../utils/chart';import{convertToProperty,createPropertyAdapter}from'../../utils/property.utils';import{notEmpty}from'../../utils/typeGuards';import{aggregationPeriodEq,periodToMinutes}from'../model/aggregation.model';import{timeframePeriods as _0x5cd26d,MAX_PRESETS_NUMBER,applyLabelFormatting,getTimeframeBasedOnPeriod,getValueInDays,parseTimeframePresetFromString,serializeTimeframePreset,timeframePresetEq}from'../model/timeframe-presets.model';const SESSIONS_TAKE_THRESHOLD_DAYS=0xe;export const createTimeframePresetsViewModel=context['combine'](context['key']()('multiChartDataService'),context['key']()('chart'),context['key']()('aggregationPeriodViewModel'),context['key']()('initialTimeframePresets'),context['key']()('userDataViewModel'),context['key']()('chartId'),context['key']()('chartSessionsViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('multiChartViewModel'),(_0x31f973,_0x26b28,_0x13394f,_0x8957c4,_0x39d764,_0x30e5cc,_0x550738,_0x14626a,_0x1bf9fa)=>{const _0x2427a9=_0x1bf9fa['getChartInfo'](_0x30e5cc),[_0x523ec5,_0x237080]=createPropertyAdapter(_0x2427a9['timeframePreset']??null,constFalse),[_0x206903,_0x16eeba]=createPropertyAdapter(getInitialTimeframePresetList(_0x39d764,_0x8957c4)),_0x40009c=_0x12d300=>{pipe(_0x16eeba['getValue'](),array['findFirst'](_0x1a3a1b=>timeframePresetEq['equals'](_0x1a3a1b,_0x12d300)),option['fold'](constUndefined,_0x523ec5));},_0x46005f=_0x3d22cd=>pipe(_0x16eeba['getValue'](),array['append'](_0x3d22cd),_0x206903),_0x9f449a=_0x6f0571=>{const _0x2018cd=_0x16eeba['getValue']();pipe(_0x2018cd,checkForPresetAlreadyExist(_0x6f0571),_0x5c8e72=>_0x5c8e72||checkForPresetsIsOverflowMaxSize(_0x2018cd),option['fromPredicate'](identity),option['fold'](()=>_0x46005f(_0x6f0571),constVoid));},_0x44cfcd=_0x49d2aa=>pipe(_0x16eeba['getValue'](),array['filter'](_0x2098bb=>!timeframePresetEq['equals'](_0x2098bb,_0x49d2aa)),_0x206903),_0xc7a63d=(_0x119908,_0x2ca639)=>{_0x26b28['scale']['setXScale'](_0x119908,_0x2ca639),_0x26b28['scale']['doAutoScale'](!![]),Object['values'](_0x26b28['paneManager']['panes'])['forEach'](_0x5cbb5e=>_0x5cbb5e['scale']['doAutoScale'](!![]));},_0x43ec29=pipe(_0x237080,filter(notEmpty),switchMap(_0x5569e5=>{const _0x57f5b5=_0x14626a['state']['getValue']()['settings']['chartReact']['extendedHours']['visible']?['REGULAR','PRE_MARKET','AFTER_MARKET']:['REGULAR'];return from(_0x550738['generateSessions'](_0x57f5b5,addDays(Date['now'](),-SESSIONS_TAKE_THRESHOLD_DAYS*0x2)['getTime']())['then'](_0x256163=>[_0x5569e5,_0x256163['REGULAR']??[]]));}),switchMap(([_0x26c3f3,_0x4831e8])=>{const _0x53aa97=Date['now'](),_0x764b8e=(_0x4831e8&&at(-0x1,_0x4831e8)?.['to'])??_0x26b28['chartModel']['getLastCandle']()?.['timestamp']??_0x53aa97,_0x286af4=_0x764b8e>_0x53aa97?_0x53aa97:_0x764b8e,_0x5d4747=getValueInDays(_0x26c3f3);let _0x3298c1=addDays(Date['now'](),-_0x5d4747)['getTime']();_0x5d4747<=SESSIONS_TAKE_THRESHOLD_DAYS&&(_0x3298c1=getStartTimestamp(_0x5d4747,_0x286af4,_0x4831e8,_0x26c3f3));if(aggregationPeriodEq['equals'](_0x13394f['selectedPeriod']['getValue'](),_0x26c3f3['aggregation'])){const _0x1346c5=_0x26b28['chartModel']['mainCandleSeries']['dataPoints'][0x0]?.['timestamp'];return _0x1346c5&&_0x31f973['requestMoreHistoryData'](_0x30e5cc,{'fromTime':_0x3298c1,'toTime':_0x1346c5}),of(_0x3298c1);}else return _0x1bf9fa['updateLocalChartInfo'](_0x30e5cc,{'xScaleViewport':{'startTimestamp':_0x3298c1,'endTimestamp':_0x1bf9fa['getChartInfo'](_0x30e5cc)['xScaleViewport']['endTimestamp']}}),setTimeout(()=>{_0x13394f['changeAggregationPeriod'](_0x26c3f3['aggregation']);},0x0),pipe(waitForCandlesSet(_0x26b28),observable['map'](()=>_0x3298c1));}),tap(_0x468f5c=>{let _0x3670b0=_0x26b28['chartModel']['candleFromTimestamp'](_0x468f5c);const _0x584ac3=_0x26b28['chartModel']['getVisualCandle'](0x0);_0x237080['getValue']()?.['timeframe']['label']==='All'&&_0x584ac3&&(_0x3670b0=_0x584ac3);const _0x3036b8=_0x26b28['chartModel']['getLastVisualCandle'](),_0x2d44d4=_0x3670b0['startUnit']??0x0,_0x403872=pipe(option['fromNullable'](_0x3036b8),option['map'](_0x386cc6=>_0x386cc6['startUnit']+_0x386cc6['width']),option['getOrElse'](()=>0x0));_0xc7a63d(_0x2d44d4,_0x403872);}),catchError(_0x1a38e6=>{return console['error'](_0x1a38e6),of([]);})),_0x583b28=pipe(_0x43ec29,switchMap(()=>pipe(merge(_0x13394f['selectedPeriod']['pipe'](observable['filter'](_0x149f88=>{const _0x1234d2=_0x237080['getValue']()?.['aggregation'];return _0x1234d2!==undefined&&!aggregationPeriodEq['equals'](_0x149f88,_0x1234d2);})),_0x26b28['scale']['xChanged']),takeUntil(_0x237080['pipe'](skip(0x1))),take(0x1))),tap(()=>_0x523ec5(null))),[_0x264b48,_0x315123]=createPropertyAdapter(_0x5cd26d),[_0x45b90f,_0x1f7382]=createPropertyAdapter(_0x5cd26d[0x0]),[_0x80a5f,_0x415ae6]=createPropertyAdapter(getTimeframeBasedOnPeriod(_0x5cd26d[0x0])[0x0]),_0x4b685d=_0x103dd7=>{_0x45b90f(_0x103dd7);},_0xf88011=_0x8bdc18=>{_0x80a5f(_0x8bdc18);},_0x330183=(_0x484c2b,_0x3a49e7)=>{const _0x32793e=applyLabelFormatting(_0x3a49e7,_0x484c2b);return _0x9f449a(_0x32793e),_0x32793e;},_0xbe90d0=_0x22847d=>pipe(_0x5cd26d,array['filter'](_0x22847d),_0x264b48),_0x218a19=pipe(_0x16eeba,observable['map'](_0x4a533c=>pipe(_0x4a533c,array['sort'](contramap(_0x47e04c=>_0x47e04c['timeframe']['value']+periodToMinutes(_0x47e04c['aggregation']))(number['Ord']))))),_0x2da29d=pipe(_0x1f7382,observable['map'](getTimeframeBasedOnPeriod),distinctUntilChanged()),_0x2dbb3a=pipe(_0x237080,tap(_0x36a270=>{const _0x224889={};_0x224889['timeframePreset']=_0x36a270??undefined,_0x1bf9fa['updateLocalChartInfo'](_0x30e5cc,_0x224889);})),_0x5209dc=pipe(_0x16eeba,observable['map'](array['map'](serializeTimeframePreset)),tap(_0x39d764['updateTimeframePresetsList'])),_0x5d5efe=pipe(_0x39d764['userData'],skip(0x1),observable['map'](_0x5e0446=>_0x5e0446['timeframePresets']),observable['filter'](_0x3c9da3=>_0x3c9da3['length']!==_0x16eeba['getValue']()['length']),observable['map'](array['filterMap'](parseTimeframePresetFromString)),tap(_0x206903)),_0x246704=merge(_0x583b28,_0x5209dc,_0x5d5efe,_0x2dbb3a);return newSink({'presets':convertToProperty(_0x218a19,[]),'selectPreset':_0x40009c,'addPreset':_0x9f449a,'deletePreset':_0x44cfcd,'timeframePeriods':_0x315123,'customTimeframes':_0x2da29d,'selectedTimeframePeriod':_0x1f7382,'changeSelectedTimeframePeriod':_0x4b685d,'selectedCustomTimeframe':_0x415ae6,'changeSelectedCustomTimeframe':_0xf88011,'saveCustomPeriodTimeframe':_0x330183,'defaultTimeframePresetsList':_0x8957c4['presets'],'selectedTimeframePreset':_0x237080,'setSelectedTimeframePreset':_0x523ec5,'setAggregationRestrictionRule':_0xbe90d0},_0x246704);});export const checkForPresetAlreadyExist=_0x248f06=>_0x8d6aa6=>pipe(_0x8d6aa6,array['elem'](timeframePresetEq)(_0x248f06));export const checkForPresetsIsOverflowMaxSize=(_0x4ee691,_0x1054a7=MAX_PRESETS_NUMBER)=>_0x4ee691['length']>=_0x1054a7;const getInitialTimeframePresetList=(_0x3c476b,_0x38ab80)=>pipe(_0x3c476b['userData']['getValue']()['timeframePresets'],option['fromPredicate'](_0x20d802=>_0x20d802['length']!==0x0),option['fold'](()=>_0x38ab80['presets'],flow(array['filterMap'](parseTimeframePresetFromString)))),getStartTimestamp=(_0x416b05,_0x1acad8,_0x2a04b4,_0x19e2a5)=>{const _0x53dd91=_0x2a04b4['reverse']()[_0x416b05-0x1];return _0x53dd91?.['from']??_0x1acad8-_0x19e2a5['timeframe']['value']*0x3e8;};