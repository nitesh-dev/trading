/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x33fad1=(function(){const _0x15b4f4=(function(){let _0x517012=!![];return function(_0x3244e3,_0x221f12){const _0x4e24cd=_0x517012?function(){if(_0x221f12){const _0x35c38d=_0x221f12['apply'](_0x3244e3,arguments);return _0x221f12=null,_0x35c38d;}}:function(){};return _0x517012=![],_0x4e24cd;};}()),_0x4c6900=_0x15b4f4(this,function(){const _0x5bc9f2=function(){let _0x55db36;try{_0x55db36=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x37c974){_0x55db36=window;}return _0x55db36;},_0x3f2753=_0x5bc9f2(),_0x56db6e=new RegExp('[IBnHklKSWSDyzLIFXLXELVfNQMYTfnRnEKO]','g'),_0x429ea1='IB.ndeHklKvSeWSDyzxLpeIFXrLts.XELcVomfNQMYTfnRnEKO'['replace'](_0x56db6e,'')['split'](';');let _0xce6640,_0x332581,_0x1d2452,_0x114f71;const _0x2cc865=function(_0x368b15,_0x59aeb9,_0x5277d4){if(_0x368b15['length']!=_0x59aeb9)return![];for(let _0x12f95e=0x0;_0x12f95e<_0x59aeb9;_0x12f95e++){for(let _0x3dad96=0x0;_0x3dad96<_0x5277d4['length'];_0x3dad96+=0x2){if(_0x12f95e==_0x5277d4[_0x3dad96]&&_0x368b15['charCodeAt'](_0x12f95e)!=_0x5277d4[_0x3dad96+0x1])return![];}}return!![];},_0x9070bb=function(_0xa1bc24,_0x312bac,_0x5a00b8){return _0x2cc865(_0x312bac,_0x5a00b8,_0xa1bc24);},_0x3bd849=function(_0x24f116,_0x2ecfa0,_0xb4fe58){return _0x9070bb(_0x2ecfa0,_0x24f116,_0xb4fe58);},_0x233d17=function(_0x46d926,_0xd208b,_0xb5192c){return _0x3bd849(_0xd208b,_0xb5192c,_0x46d926);};for(let _0xa97fcf in _0x3f2753){if(_0x2cc865(_0xa97fcf,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0xce6640=_0xa97fcf;break;}}for(let _0x2e1b4b in _0x3f2753[_0xce6640]){if(_0x233d17(0x6,_0x2e1b4b,[0x5,0x6e,0x0,0x64])){_0x332581=_0x2e1b4b;break;}}for(let _0x5c13cb in _0x3f2753[_0xce6640]){if(_0x3bd849(_0x5c13cb,[0x7,0x6e,0x0,0x6c],0x8)){_0x1d2452=_0x5c13cb;break;}}if(!('~'>_0x332581))for(let _0x4905be in _0x3f2753[_0xce6640][_0x1d2452]){if(_0x9070bb([0x7,0x65,0x0,0x68],_0x4905be,0x8)){_0x114f71=_0x4905be;break;}}if(!_0xce6640||!_0x3f2753[_0xce6640])return;const _0x2c25a9=_0x3f2753[_0xce6640][_0x332581],_0x2ada4a=!!_0x3f2753[_0xce6640][_0x1d2452]&&_0x3f2753[_0xce6640][_0x1d2452][_0x114f71],_0x16fced=_0x2c25a9||_0x2ada4a;if(!_0x16fced)return;let _0x55d417=Date['now']()<0x18cfaf7e418;for(let _0x2be8bb=0x0;_0x2be8bb<_0x429ea1['length'];_0x2be8bb++){const _0x311450=_0x429ea1[_0x2be8bb],_0xc8198=_0x311450[0x0]===String['fromCharCode'](0x2e)?_0x311450['slice'](0x1):_0x311450,_0x40bb1a=_0x16fced['length']-_0xc8198['length'],_0x466ec8=_0x16fced['indexOf'](_0xc8198,_0x40bb1a),_0x1e81a5=_0x466ec8!==-0x1&&_0x466ec8===_0x40bb1a;_0x1e81a5&&((_0x16fced['length']==_0x311450['length']||_0x311450['indexOf']('.')===0x0)&&(_0x55d417=!![]));}if(!_0x55d417){const _0x578b81=new RegExp('[jFyVBNHJJRfVQbILzkOZIbLlGOlbNfCHHlfLQzqKXIlZiBXTACnlKyDyFlICiHqN]','g'),_0x5be363='jFyVhttps:/B/dNHeJveJRfxpVeQrtsb.cILozmkO/dZIbLxlcGhaOrtslb/NfCHHlfLQzqKXIlZiBXTACnlKyDyFlICiHqN'['replace'](_0x578b81,'');_0x3f2753[_0xce6640][_0x1d2452]=_0x5be363;}});_0x4c6900();let _0x211d9e=!![];return function(_0x35585a,_0x2e956a){const _0x47bd89=_0x211d9e?function(){if(_0x2e956a){const _0x13bb39=_0x2e956a['apply'](_0x35585a,arguments);return _0x2e956a=null,_0x13bb39;}}:function(){};return _0x211d9e=![],_0x47bd89;};}()),_0x3c7c0e=_0x33fad1(this,function(){let _0x14aaed;try{const _0x923791=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x14aaed=_0x923791();}catch(_0x519634){_0x14aaed=window;}const _0x257bb3=new RegExp('[QMqRWbXiYJgXbLaLklTOLRYuKIaTlzITGWJ]','g'),_0x422843='QM.devexqRWpbXeritYs.comJgXbLaLklTOLRYuKIaTlzITGWJ'['replace'](_0x257bb3,'')['split'](';');let _0x1c1e9f,_0x346696,_0x3b3695,_0x4d1782;const _0x3c52a5=function(_0x9cc2b8,_0x4744c4,_0x35bc38){if(_0x9cc2b8['length']!=_0x4744c4)return![];for(let _0x17436e=0x0;_0x17436e<_0x4744c4;_0x17436e++){for(let _0x4d515f=0x0;_0x4d515f<_0x35bc38['length'];_0x4d515f+=0x2){if(_0x17436e==_0x35bc38[_0x4d515f]&&_0x9cc2b8['charCodeAt'](_0x17436e)!=_0x35bc38[_0x4d515f+0x1])return![];}}return!![];},_0x53438d=function(_0x1e1455,_0x1ecdfd,_0x2df242){return _0x3c52a5(_0x1ecdfd,_0x2df242,_0x1e1455);},_0x47f4ad=function(_0x39ee24,_0x32d591,_0x3689b6){return _0x53438d(_0x32d591,_0x39ee24,_0x3689b6);},_0x453140=function(_0x5c4420,_0x287de3,_0x12b586){return _0x47f4ad(_0x287de3,_0x12b586,_0x5c4420);};for(let _0x30ed79 in _0x14aaed){if(_0x3c52a5(_0x30ed79,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1c1e9f=_0x30ed79;break;}}for(let _0x23aa6c in _0x14aaed[_0x1c1e9f]){if(_0x453140(0x6,_0x23aa6c,[0x5,0x6e,0x0,0x64])){_0x346696=_0x23aa6c;break;}}for(let _0xed5f58 in _0x14aaed[_0x1c1e9f]){if(_0x47f4ad(_0xed5f58,[0x7,0x6e,0x0,0x6c],0x8)){_0x3b3695=_0xed5f58;break;}}if(!('~'>_0x346696))for(let _0x23e680 in _0x14aaed[_0x1c1e9f][_0x3b3695]){if(_0x53438d([0x7,0x65,0x0,0x68],_0x23e680,0x8)){_0x4d1782=_0x23e680;break;}}if(!_0x1c1e9f||!_0x14aaed[_0x1c1e9f])return;const _0xb925ae=_0x14aaed[_0x1c1e9f][_0x346696],_0x2e69a1=!!_0x14aaed[_0x1c1e9f][_0x3b3695]&&_0x14aaed[_0x1c1e9f][_0x3b3695][_0x4d1782],_0x452a31=_0xb925ae||_0x2e69a1;if(!_0x452a31)return;let _0x26b442=Date['now']()<0x18cfaf7e418;for(let _0x3eeb97=0x0;_0x3eeb97<_0x422843['length'];_0x3eeb97++){const _0x72f574=_0x422843[_0x3eeb97],_0xa79e61=_0x72f574[0x0]===String['fromCharCode'](0x2e)?_0x72f574['slice'](0x1):_0x72f574,_0x54c20d=_0x452a31['length']-_0xa79e61['length'],_0x103d47=_0x452a31['indexOf'](_0xa79e61,_0x54c20d),_0x36026c=_0x103d47!==-0x1&&_0x103d47===_0x54c20d;_0x36026c&&((_0x452a31['length']==_0x72f574['length']||_0x72f574['indexOf']('.')===0x0)&&(_0x26b442=!![]));}if(!_0x26b442){const _0x425c09=new RegExp('[ABqYXRJFPNDTPMgqyUSbgOFVzSOgOTZjbXMiNIzKYjNwyFywMbZNJIgnVBHlAObGQXbbCKwbPl]','g'),_0x5e3e30='AhBtqYXRJtFpPNs:D//TdevePxpMgqerytUs.Sbcom/gOdxcFVhzarSts/OgOTZjbXMiNIzKYjNwyFywMbZNJIgnVBHlAObGQXbbCKwbPl'['replace'](_0x425c09,'');_0x14aaed[_0x1c1e9f][_0x3b3695]=_0x5e3e30;}});_0x3c7c0e();import{at}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{addDays}from'date-fns';import{array,number,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{contramap}from'fp-ts/Ord';import{constFalse,constUndefined,constVoid,flow,identity,pipe}from'fp-ts/function';import{from,merge,of}from'rxjs';import{catchError,distinctUntilChanged,filter,skip,switchMap,take,tap,takeUntil}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{waitForCandlesSet}from'../../utils/chart';import{convertToProperty,createPropertyAdapter}from'../../utils/property.utils';import{notEmpty}from'../../utils/typeGuards';import{aggregationPeriodEq,periodToMinutes}from'../model/aggregation.model';import{timeframePeriods as _0x424711,MAX_PRESETS_NUMBER,applyLabelFormatting,getTimeframeBasedOnPeriod,getValueInDays,parseTimeframePresetFromString,serializeTimeframePreset,timeframePresetEq}from'../model/timeframe-presets.model';const SESSIONS_TAKE_THRESHOLD_DAYS=0xe;export const createTimeframePresetsViewModel=context['combine'](context['key']()('multiChartDataService'),context['key']()('chart'),context['key']()('aggregationPeriodViewModel'),context['key']()('initialTimeframePresets'),context['key']()('userDataViewModel'),context['key']()('chartId'),context['key']()('chartSessionsViewModel'),context['key']()('chartConfiguratorViewModel'),context['key']()('multiChartViewModel'),(_0x2bb86a,_0x3a0a00,_0x2c31ec,_0x41fa38,_0x3f3c48,_0x5518ff,_0x57ceaf,_0x7fae2b,_0x42e497)=>{const _0x97a818=_0x42e497['getChartInfo'](_0x5518ff),[_0x3e75f7,_0x6c546b]=createPropertyAdapter(_0x97a818['timeframePreset']??null,constFalse),[_0x4ee066,_0x46fd92]=createPropertyAdapter(getInitialTimeframePresetList(_0x3f3c48,_0x41fa38)),_0x340d33=_0x347928=>{pipe(_0x46fd92['getValue'](),array['findFirst'](_0x8f2b8e=>timeframePresetEq['equals'](_0x8f2b8e,_0x347928)),option['fold'](constUndefined,_0x3e75f7));},_0x2388b6=_0x334653=>pipe(_0x46fd92['getValue'](),array['append'](_0x334653),_0x4ee066),_0x1cf9c3=_0x41e9d2=>{const _0x24e426=_0x46fd92['getValue']();pipe(_0x24e426,checkForPresetAlreadyExist(_0x41e9d2),_0x3d0e54=>_0x3d0e54||checkForPresetsIsOverflowMaxSize(_0x24e426),option['fromPredicate'](identity),option['fold'](()=>_0x2388b6(_0x41e9d2),constVoid));},_0x11902e=_0x28de6a=>pipe(_0x46fd92['getValue'](),array['filter'](_0x34ec3c=>!timeframePresetEq['equals'](_0x34ec3c,_0x28de6a)),_0x4ee066),_0x13014c=(_0x529755,_0x32fd5d)=>{_0x3a0a00['scale']['setXScale'](_0x529755,_0x32fd5d),_0x3a0a00['scale']['doAutoScale'](!![]),Object['values'](_0x3a0a00['paneManager']['panes'])['forEach'](_0x224738=>_0x224738['scale']['doAutoScale'](!![]));},_0x2024d2=pipe(_0x6c546b,filter(notEmpty),switchMap(_0x36031d=>{const _0x39c217=_0x7fae2b['state']['getValue']()['settings']['chartReact']['extendedHours']['visible']?['REGULAR','PRE_MARKET','AFTER_MARKET']:['REGULAR'];return from(_0x57ceaf['generateSessions'](_0x39c217,addDays(Date['now'](),-SESSIONS_TAKE_THRESHOLD_DAYS*0x2)['getTime']())['then'](_0xbd6a1b=>[_0x36031d,_0xbd6a1b['REGULAR']??[]]));}),switchMap(([_0x987e32,_0x5bdc6b])=>{const _0x216265=Date['now'](),_0x5cc43a=(_0x5bdc6b&&at(-0x1,_0x5bdc6b)?.['to'])??_0x3a0a00['chartModel']['getLastCandle']()?.['timestamp']??_0x216265,_0x18bf4b=_0x5cc43a>_0x216265?_0x216265:_0x5cc43a,_0xa9217a=getValueInDays(_0x987e32);let _0x146fd6=addDays(Date['now'](),-_0xa9217a)['getTime']();_0xa9217a<=SESSIONS_TAKE_THRESHOLD_DAYS&&(_0x146fd6=getStartTimestamp(_0xa9217a,_0x18bf4b,_0x5bdc6b,_0x987e32));if(aggregationPeriodEq['equals'](_0x2c31ec['selectedPeriod']['getValue'](),_0x987e32['aggregation'])){const _0x19ac55=_0x3a0a00['chartModel']['mainCandleSeries']['dataPoints'][0x0]?.['timestamp'];return _0x19ac55&&_0x2bb86a['requestMoreHistoryData'](_0x5518ff,{'fromTime':_0x146fd6,'toTime':_0x19ac55}),of(_0x146fd6);}else return _0x42e497['updateLocalChartInfo'](_0x5518ff,{'xScaleViewport':{'startTimestamp':_0x146fd6,'endTimestamp':_0x42e497['getChartInfo'](_0x5518ff)['xScaleViewport']['endTimestamp']}}),setTimeout(()=>{_0x2c31ec['changeAggregationPeriod'](_0x987e32['aggregation']);},0x0),pipe(waitForCandlesSet(_0x3a0a00),observable['map'](()=>_0x146fd6));}),tap(_0x53c411=>{let _0x378546=_0x3a0a00['chartModel']['candleFromTimestamp'](_0x53c411);const _0x5d71cb=_0x3a0a00['chartModel']['getVisualCandle'](0x0);_0x6c546b['getValue']()?.['timeframe']['label']==='All'&&_0x5d71cb&&(_0x378546=_0x5d71cb);const _0x17aebe=_0x3a0a00['chartModel']['getLastVisualCandle'](),_0x369151=_0x378546['startUnit']??0x0,_0x59ef2a=pipe(option['fromNullable'](_0x17aebe),option['map'](_0x419c01=>_0x419c01['startUnit']+_0x419c01['width']),option['getOrElse'](()=>0x0));_0x13014c(_0x369151,_0x59ef2a);}),catchError(_0x3343ae=>{return console['error'](_0x3343ae),of([]);})),_0xf038f7=pipe(_0x2024d2,switchMap(()=>pipe(merge(_0x2c31ec['selectedPeriod']['pipe'](observable['filter'](_0x4a91aa=>{const _0x4978d8=_0x6c546b['getValue']()?.['aggregation'];return _0x4978d8!==undefined&&!aggregationPeriodEq['equals'](_0x4a91aa,_0x4978d8);})),_0x3a0a00['scale']['xChanged']),takeUntil(_0x6c546b['pipe'](skip(0x1))),take(0x1))),tap(()=>_0x3e75f7(null))),[_0x1e6ada,_0xec5b07]=createPropertyAdapter(_0x424711),[_0x300e9b,_0xa38def]=createPropertyAdapter(_0x424711[0x0]),[_0x3c671c,_0x694383]=createPropertyAdapter(getTimeframeBasedOnPeriod(_0x424711[0x0])[0x0]),_0x2743ce=_0x5379a2=>{_0x300e9b(_0x5379a2);},_0x4b411c=_0x4887f1=>{_0x3c671c(_0x4887f1);},_0x4ba29c=(_0x271c17,_0x2c48ad)=>{const _0x56b0ac=applyLabelFormatting(_0x2c48ad,_0x271c17);return _0x1cf9c3(_0x56b0ac),_0x56b0ac;},_0x42af38=_0x2cb0e1=>pipe(_0x424711,array['filter'](_0x2cb0e1),_0x1e6ada),_0xebba43=pipe(_0x46fd92,observable['map'](_0x1364c8=>pipe(_0x1364c8,array['sort'](contramap(_0x18a0b9=>_0x18a0b9['timeframe']['value']+periodToMinutes(_0x18a0b9['aggregation']))(number['Ord']))))),_0x230ac2=pipe(_0xa38def,observable['map'](getTimeframeBasedOnPeriod),distinctUntilChanged()),_0xa97650=pipe(_0x6c546b,tap(_0x5b4cfe=>{const _0x58721c={};_0x58721c['timeframePreset']=_0x5b4cfe??undefined,_0x42e497['updateLocalChartInfo'](_0x5518ff,_0x58721c);})),_0x572587=pipe(_0x46fd92,observable['map'](array['map'](serializeTimeframePreset)),tap(_0x3f3c48['updateTimeframePresetsList'])),_0x21d526=pipe(_0x3f3c48['userData'],skip(0x1),observable['map'](_0x1dd725=>_0x1dd725['timeframePresets']),observable['filter'](_0x249c75=>_0x249c75['length']!==_0x46fd92['getValue']()['length']),observable['map'](array['filterMap'](parseTimeframePresetFromString)),tap(_0x4ee066)),_0x3db926=merge(_0xf038f7,_0x572587,_0x21d526,_0xa97650);return newSink({'presets':convertToProperty(_0xebba43,[]),'selectPreset':_0x340d33,'addPreset':_0x1cf9c3,'deletePreset':_0x11902e,'timeframePeriods':_0xec5b07,'customTimeframes':_0x230ac2,'selectedTimeframePeriod':_0xa38def,'changeSelectedTimeframePeriod':_0x2743ce,'selectedCustomTimeframe':_0x694383,'changeSelectedCustomTimeframe':_0x4b411c,'saveCustomPeriodTimeframe':_0x4ba29c,'defaultTimeframePresetsList':_0x41fa38['presets'],'selectedTimeframePreset':_0x6c546b,'setSelectedTimeframePreset':_0x3e75f7,'setAggregationRestrictionRule':_0x42af38},_0x3db926);});export const checkForPresetAlreadyExist=_0x1456ca=>_0x48789a=>pipe(_0x48789a,array['elem'](timeframePresetEq)(_0x1456ca));export const checkForPresetsIsOverflowMaxSize=(_0x33818a,_0x5044e4=MAX_PRESETS_NUMBER)=>_0x33818a['length']>=_0x5044e4;const getInitialTimeframePresetList=(_0x22a285,_0x31ae91)=>pipe(_0x22a285['userData']['getValue']()['timeframePresets'],option['fromPredicate'](_0x3e8050=>_0x3e8050['length']!==0x0),option['fold'](()=>_0x31ae91['presets'],flow(array['filterMap'](parseTimeframePresetFromString)))),getStartTimestamp=(_0x27443e,_0x129767,_0x35c40d,_0x32964d)=>{const _0x3ea053=_0x35c40d['reverse']()[_0x27443e-0x1];return _0x3ea053?.['from']??_0x129767-_0x32964d['timeframe']['value']*0x3e8;};