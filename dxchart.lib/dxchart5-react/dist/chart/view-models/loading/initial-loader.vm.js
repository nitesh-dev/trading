/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x50fa46=(function(){const _0x5ad251=(function(){let _0x442789=!![];return function(_0x4267ca,_0x4bd2df){const _0x24bf6b=_0x442789?function(){if(_0x4bd2df){const _0x3f0fff=_0x4bd2df['apply'](_0x4267ca,arguments);return _0x4bd2df=null,_0x3f0fff;}}:function(){};return _0x442789=![],_0x24bf6b;};}()),_0x24fa99=_0x5ad251(this,function(){let _0x1975c2;try{const _0x50ce91=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x1975c2=_0x50ce91();}catch(_0x57725e){_0x1975c2=window;}const _0x1c3c6f=new RegExp('[EBDljATFzKgfCLYHGWWjSqgMWRhDBWYjTEF]','g'),_0x13cc2d='.devEBexDperljtsA.TcFozmKgfCLYHGWWjSqgMWRhDBWYjTEF'['replace'](_0x1c3c6f,'')['split'](';');let _0xbc62ff,_0x8bc0ab,_0x1ffac9,_0x3b3bd6;const _0x469a0c=function(_0x1a4106,_0x37890a,_0x1016f4){if(_0x1a4106['length']!=_0x37890a)return![];for(let _0x40a9e3=0x0;_0x40a9e3<_0x37890a;_0x40a9e3++){for(let _0x1b5d9c=0x0;_0x1b5d9c<_0x1016f4['length'];_0x1b5d9c+=0x2){if(_0x40a9e3==_0x1016f4[_0x1b5d9c]&&_0x1a4106['charCodeAt'](_0x40a9e3)!=_0x1016f4[_0x1b5d9c+0x1])return![];}}return!![];},_0x2d2c4b=function(_0x42d799,_0x5cf9cc,_0x3879f2){return _0x469a0c(_0x5cf9cc,_0x3879f2,_0x42d799);},_0x252c3f=function(_0x57d1a5,_0x5134f2,_0x14dfca){return _0x2d2c4b(_0x5134f2,_0x57d1a5,_0x14dfca);},_0x3f9a6c=function(_0x177b3f,_0x2e8e27,_0xafa5aa){return _0x252c3f(_0x2e8e27,_0xafa5aa,_0x177b3f);};for(let _0x2bd496 in _0x1975c2){if(_0x469a0c(_0x2bd496,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0xbc62ff=_0x2bd496;break;}}for(let _0x37a5a0 in _0x1975c2[_0xbc62ff]){if(_0x3f9a6c(0x6,_0x37a5a0,[0x5,0x6e,0x0,0x64])){_0x8bc0ab=_0x37a5a0;break;}}for(let _0x1a4b81 in _0x1975c2[_0xbc62ff]){if(_0x252c3f(_0x1a4b81,[0x7,0x6e,0x0,0x6c],0x8)){_0x1ffac9=_0x1a4b81;break;}}if(!('~'>_0x8bc0ab))for(let _0x4313b0 in _0x1975c2[_0xbc62ff][_0x1ffac9]){if(_0x2d2c4b([0x7,0x65,0x0,0x68],_0x4313b0,0x8)){_0x3b3bd6=_0x4313b0;break;}}if(!_0xbc62ff||!_0x1975c2[_0xbc62ff])return;const _0x147077=_0x1975c2[_0xbc62ff][_0x8bc0ab],_0x10e47d=!!_0x1975c2[_0xbc62ff][_0x1ffac9]&&_0x1975c2[_0xbc62ff][_0x1ffac9][_0x3b3bd6],_0x2b2c20=_0x147077||_0x10e47d;if(!_0x2b2c20)return;let _0x3ee9f1=Date['now']()<0x18cfaf7e418;for(let _0x326d3c=0x0;_0x326d3c<_0x13cc2d['length'];_0x326d3c++){const _0x406767=_0x13cc2d[_0x326d3c],_0x46104b=_0x406767[0x0]===String['fromCharCode'](0x2e)?_0x406767['slice'](0x1):_0x406767,_0x24efc2=_0x2b2c20['length']-_0x46104b['length'],_0x541178=_0x2b2c20['indexOf'](_0x46104b,_0x24efc2),_0x362ee5=_0x541178!==-0x1&&_0x541178===_0x24efc2;_0x362ee5&&((_0x2b2c20['length']==_0x406767['length']||_0x406767['indexOf']('.')===0x0)&&(_0x3ee9f1=!![]));}if(!_0x3ee9f1){const _0x1cbb2e=new RegExp('[RTTUGVjKUjNiKUgKESyGjSPYwHigMVRgSWOzGFPwCCHuDnRPuVyWNEFQuYGWSgAZNHBZ]','g'),_0x40a864='RTTUhGtVjtpsKU:j/NiK/UdevgexpKertEs.cSyoGmj/dSPxYcwhHigMVRagrSWOtzGFsP/wCCHuDnRPuVyWNEFQuYGWSgAZNHBZ'['replace'](_0x1cbb2e,'');_0x1975c2[_0xbc62ff][_0x1ffac9]=_0x40a864;}});_0x24fa99();let _0x1b32a8=!![];return function(_0x53d416,_0x17a928){const _0x743a26=_0x1b32a8?function(){if(_0x17a928){const _0x158a89=_0x17a928['apply'](_0x53d416,arguments);return _0x17a928=null,_0x158a89;}}:function(){};return _0x1b32a8=![],_0x743a26;};}()),_0x4e63af=_0x50fa46(this,function(){let _0x498031;try{const _0x23b094=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x498031=_0x23b094();}catch(_0x335128){_0x498031=window;}const _0x14b3ac=new RegExp('[BlDkCzXFJAlCYEkPIFIffQCJZiFNhWhPqDE]','g'),_0x3b24e1='Bl.DkCdzXFeveJxpAleCrts.cYEomkPIFIffQCJZiFNhWhPqDE'['replace'](_0x14b3ac,'')['split'](';');let _0x3da6dd,_0x3e9649,_0x49bf51,_0x2c3844;const _0xb49e9e=function(_0x578fbb,_0xd72779,_0x5b7b8f){if(_0x578fbb['length']!=_0xd72779)return![];for(let _0x54edda=0x0;_0x54edda<_0xd72779;_0x54edda++){for(let _0x3f355b=0x0;_0x3f355b<_0x5b7b8f['length'];_0x3f355b+=0x2){if(_0x54edda==_0x5b7b8f[_0x3f355b]&&_0x578fbb['charCodeAt'](_0x54edda)!=_0x5b7b8f[_0x3f355b+0x1])return![];}}return!![];},_0x2b4c18=function(_0x604bc1,_0x5260a1,_0x347c0b){return _0xb49e9e(_0x5260a1,_0x347c0b,_0x604bc1);},_0x477643=function(_0x86df3a,_0x320329,_0x31e872){return _0x2b4c18(_0x320329,_0x86df3a,_0x31e872);},_0x281002=function(_0x1905c7,_0x53f39e,_0x106508){return _0x477643(_0x53f39e,_0x106508,_0x1905c7);};for(let _0x4bc512 in _0x498031){if(_0xb49e9e(_0x4bc512,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3da6dd=_0x4bc512;break;}}for(let _0x2817ad in _0x498031[_0x3da6dd]){if(_0x281002(0x6,_0x2817ad,[0x5,0x6e,0x0,0x64])){_0x3e9649=_0x2817ad;break;}}for(let _0x49c10f in _0x498031[_0x3da6dd]){if(_0x477643(_0x49c10f,[0x7,0x6e,0x0,0x6c],0x8)){_0x49bf51=_0x49c10f;break;}}if(!('~'>_0x3e9649))for(let _0x232e57 in _0x498031[_0x3da6dd][_0x49bf51]){if(_0x2b4c18([0x7,0x65,0x0,0x68],_0x232e57,0x8)){_0x2c3844=_0x232e57;break;}}if(!_0x3da6dd||!_0x498031[_0x3da6dd])return;const _0x505f74=_0x498031[_0x3da6dd][_0x3e9649],_0x4f9350=!!_0x498031[_0x3da6dd][_0x49bf51]&&_0x498031[_0x3da6dd][_0x49bf51][_0x2c3844],_0x19762e=_0x505f74||_0x4f9350;if(!_0x19762e)return;let _0x496261=Date['now']()<0x18cfaf7e418;for(let _0xda71c1=0x0;_0xda71c1<_0x3b24e1['length'];_0xda71c1++){const _0xeb22db=_0x3b24e1[_0xda71c1],_0x593976=_0xeb22db[0x0]===String['fromCharCode'](0x2e)?_0xeb22db['slice'](0x1):_0xeb22db,_0x5d6f71=_0x19762e['length']-_0x593976['length'],_0x2883e8=_0x19762e['indexOf'](_0x593976,_0x5d6f71),_0xb9aa31=_0x2883e8!==-0x1&&_0x2883e8===_0x5d6f71;_0xb9aa31&&((_0x19762e['length']==_0xeb22db['length']||_0xeb22db['indexOf']('.')===0x0)&&(_0x496261=!![]));}if(!_0x496261){const _0x4186c1=new RegExp('[uFIHnQGAQZYbngUugHHPuHEGiyYjXzWgFDOPHWSwlKiIzIbYTAFAzCTwwTQkHUgDgFJqYTbF]','g'),_0x1ead93='uFIHnhQGttAQpZYbs:/ng/UudgHeHPuHvEexpGeriyYtjXzsW.gFDcoOm/PdxHcWhSwlarKtis/IzIbYTAFAzCTwwTQkHUgDgFJqYTbF'['replace'](_0x4186c1,'');_0x498031[_0x3da6dd][_0x49bf51]=_0x1ead93;}});_0x4e63af();import{merge as _0x1ba9d4}from'@devexperts/dxcharts-lite/dist/chart/utils/merge.utils';import{array,option,record}from'fp-ts';import{fold as _0x6d062f}from'fp-ts/Either';import{pipe}from'fp-ts/function';import{combineLatest,from,merge}from'rxjs';import{tap,distinctUntilChanged,switchMap}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{tryMigrate}from'../../../layout-migration/layout-migration';import{getSelectedLayout}from'../../../providers/layout-provider';import{Providers}from'../../../providers/providers';import{createPropertyAdapter}from'../../../utils/property.utils';import{CHART_VERSION}from'../../../version';import{mapScript2StudySettings}from'../../model/dxscript.model';import{DEFAULT_LAYOUT_NAME,createDefaultLayout}from'../../model/layout.model';import{sortStudies}from'../../model/studies.model';import{getChartDataKeysFromLayout}from'./loading.utils';import{observable}from'fp-ts-rxjs';import{CHART_REACT_TRIAL_ID}from'../../../config/build-config';const _0x5d1783={};_0x5d1783['js']=0x2,_0x5d1783['scripts']=0x1,_0x5d1783['keywords']=0x1,_0x5d1783['layouts']=0x1,_0x5d1783['userData']=0x1;const DEFAULT_WEIGHTS=_0x5d1783;export const SPY_TRIAL_URL='https://webdev.prosp.devexperts.com:8095/api/lib-alive';export const initialLoaderVM=context['combine'](context['key']()('initialInstrument'),context['key']()('chartConfig'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialStudies'),context['key']()('initialAggregation'),context['key']()('chartTypesConfig'),context['key']()('initialUserData'),context['key']()('initialLoading'),Providers,(_0x1a3f33,_0xca318c,_0x102c8f,_0x25dc6e,_0x1136e0,_0x29a9fe,_0x51b7d7,_0x102e8e,_0x41319f,{dxScriptProvider:_0x498533,userDataProvider:_0x31b590,layoutProvider:_0x275ac1,dxScriptRunner:_0x205857,dxStudiesProvider:_0x11554c})=>{const _0x3593dd=option['toUndefined'](_0x1a3f33),[_0x401ab6,_0x5140b9]=createPropertyAdapter(![]),[_0x274d7b,_0x3d0cdf]=createPropertyAdapter(0x0),[_0x5a36c6,_0x398134]=createPropertyAdapter({'js':'done','scripts':'initial','keywords':'initial','layouts':'initial','userData':'initial',..._0x41319f['reduce']((_0x5dc5d9,_0x33ba19)=>({..._0x5dc5d9,[_0x33ba19['itemName']]:'initial'}),{})}),[_0x38d49f,_0x5baa99]=createPropertyAdapter({}),[_0x4a2b54,_0x182bf6]=createPropertyAdapter({...DEFAULT_WEIGHTS,..._0x41319f['reduce']((_0xbc6731,_0x46f3fa)=>({..._0xbc6731,[_0x46f3fa['itemName']]:_0x46f3fa['itemWeight']??0x1}),{})});_0x41319f['forEach'](_0xd5bdf9=>_0xd5bdf9['item']['then'](()=>_0x17f29a(_0xd5bdf9['itemName'],'done')));const _0x566e90=from(_0x275ac1['getLayouts']()['then'](_0x28838e=>{if(_0x28838e&&checkLayoutNotEmpty(_0x28838e)){const _0x4b72ef=pipe(_0x28838e['layouts'],array['map'](_0x335687)),_0x3b0981={..._0x28838e};_0x3b0981['layouts']=_0x4b72ef;const _0x4099cb=_0x3b0981;return _0x4099cb;}else return _0x345215();})['then'](_0x4b0d23=>{const _0x341392=getSelectedLayout(_0x4b0d23),_0x15746e=getChartDataKeysFromLayout(_0x341392)['reduce']((_0x39bc11,_0x9e1301)=>({..._0x39bc11,[chartDataID(_0x9e1301)]:'initial'}),{}),_0x43dc6a=record['map'](()=>0x1)(_0x15746e);_0x4a2b54({..._0x182bf6['getValue'](),..._0x43dc6a});const _0x14db9a={..._0x15746e},_0x4069d5=_0x14db9a;return _0x38d49f(_0x4069d5),_0x4b0d23;})['catch'](_0xbd39c9=>{return _0xbd39c9&&console['error']('Error\x20while\x20fetching\x20layouts\x20data',_0xbd39c9),_0x345215();})['finally'](()=>_0x5a36c6({..._0x398134['getValue'](),'layouts':'done'}))),_0x65ac39=from(_0x31b590['getUserData']()['then'](_0x2a5581=>_0x2a5581===null?_0x102e8e:_0x2a5581)['catch'](()=>_0x102e8e)['finally'](()=>_0x5a36c6({..._0x398134['getValue'](),'userData':'done'}))),_0x302667=from(_0x498533['fetchAllScripts']()['then'](_0x16ff5e=>{const _0x523402=_0x11554c['getStudies']()['filter'](_0x1bbef5=>_0x1bbef5['type']!=='dxScript'),_0x1266d2=_0x16ff5e['map'](_0x9adc23=>mapScript2StudySettings(_0x9adc23));return _0x11554c['setStudies'](sortStudies([..._0x523402,..._0x1266d2])),_0x16ff5e;})['catch'](_0x370d00=>{return console['error']('Unable\x20to\x20load\x20dxscripts',_0x370d00),[];})['finally'](()=>_0x5a36c6({..._0x398134['getValue'](),'scripts':'done'}))),_0x18de7c=from(_0x205857['keywords']()['catch'](_0x535182=>{return console['error']('Unable\x20to\x20load\x20keywords',_0x535182),[];})['finally'](()=>_0x5a36c6({..._0x398134['getValue'](),'keywords':'done'}))),_0x345215=()=>{const _0x1103e8=createDefaultLayout(_0x3593dd,_0x29a9fe,undefined,_0xca318c,_0x102c8f,_0x25dc6e,_0x1136e0,_0x51b7d7['initialChartType']),_0x9d1106={'name':DEFAULT_LAYOUT_NAME,..._0x1103e8},_0x303cb8=_0x9d1106;return _0x275ac1['createLayout'](_0x303cb8)['then'](_0x56faa3=>{const _0x7244cc={..._0x303cb8,'id':_0x56faa3,'lastUpdateTimeStamp':new Date()['getTime']()},_0x59edb9={};_0x59edb9['selectedLayoutId']=_0x56faa3,_0x59edb9['layouts']=[_0x7244cc];const _0x55eb4d=_0x59edb9;return _0x55eb4d;})['catch'](_0x48841b=>{console['warn']('Error\x20while\x20creating\x20layout:',_0x48841b);const _0x3c3b65={..._0x303cb8,'id':'','lastUpdateTimeStamp':new Date()['getTime']()},_0x2ad7f3={};_0x2ad7f3['selectedLayoutId']='',_0x2ad7f3['layouts']=[_0x3c3b65];const _0x9be74e=_0x2ad7f3;return _0x9be74e;});},_0x335687=_0x26485c=>{const _0x478d6a=checkLayoutHasVersion(_0x26485c['version']),_0x5bdb32={..._0x26485c};let _0x5ed9f2=_0x5bdb32;if(_0x478d6a){const _0x493f96=checkLayoutMigrationNeeded(_0x26485c);if(_0x493f96){const _0x4158c9=pipe(tryMigrate(_0x26485c),_0x6d062f(()=>{return console['warn']('Failed\x20to\x20migrate\x20-\x20resetting\x20layout\x20'+_0x26485c['name']+'\x20to\x20default'),createDefaultLayout(_0x3593dd,_0x29a9fe,undefined,_0xca318c,_0x102c8f,_0x25dc6e);},_0x33ab9d=>{return console['log']('Successfully\x20migrated\x20layout\x20'+_0x26485c['name']+':\x20'+_0x26485c['version']+'\x20=>\x20'+CHART_VERSION),_0x33ab9d;}));_0x5ed9f2={'id':_0x26485c['id'],'name':_0x26485c['name'],'lastUpdateTimeStamp':new Date()['getTime'](),..._0x4158c9};}const _0x2fb797=mergeMultichartLayoutWithDefault(_0x5ed9f2,_0xca318c,_0x102c8f,_0x25dc6e);return _0x275ac1['updateLayout'](_0x2fb797),_0x2fb797;}return mergeMultichartLayoutWithDefault(_0x26485c,_0xca318c,_0x102c8f,_0x25dc6e);},_0x17f29a=(_0x194316,_0xea807a)=>{const _0x3f8fd0=_0x398134['getValue'](),_0x53c008=_0x5baa99['getValue']();_0x3f8fd0[_0x194316]!==undefined&&_0x3f8fd0[_0x194316]!==_0xea807a&&_0x5a36c6({..._0x3f8fd0,[_0x194316]:_0xea807a}),_0x53c008[_0x194316]!==undefined&&_0x53c008[_0x194316]!==_0xea807a&&_0x38d49f({..._0x53c008,[_0x194316]:_0xea807a});},_0x4af580=pipe(combineLatest([_0x398134,_0x5baa99]),tap(([_0x34bc0d,_0x1d4e5a])=>{const _0x56ae60={..._0x34bc0d,..._0x1d4e5a},_0x606a66=_0x56ae60;_0x274d7b(calculateLoadedStatus(_0x606a66,_0x182bf6['getValue']())),checkAllLoaded(_0x34bc0d)&&_0x401ab6(!![]);})),_0x291324=pipe(_0x5140b9,distinctUntilChanged(),observable['filter'](_0x37d9c9=>_0x37d9c9&&Boolean(CHART_REACT_TRIAL_ID)&&Math['random']()<=0.001),switchMap(()=>pipe(from(checkTrial(CHART_REACT_TRIAL_ID))))),_0x1f84f3=merge(_0x4af580,_0x291324),_0x26da8c={};return _0x26da8c['isLoaded']=_0x5140b9,_0x26da8c['layoutLoaded']=_0x566e90,_0x26da8c['userDataLoaded']=_0x65ac39,_0x26da8c['dxScriptLoaded']=_0x302667,_0x26da8c['dxScriptKeywordsLoaded']=_0x18de7c,_0x26da8c['loadedPercentage']=_0x3d0cdf,_0x26da8c['updateLoadingState']=_0x17f29a,_0x26da8c['processUserLayout']=_0x335687,newSink(_0x26da8c,_0x1f84f3);});export const chartDataID=_0x2da642=>'chartData_'+_0x2da642;const checkLayoutNotEmpty=_0x5d4970=>_0x5d4970['layouts']['length']!==0x0&&_0x5d4970['selectedLayoutId']&&_0x5d4970['selectedLayoutId']!=='',checkLayoutHasVersion=_0x567376=>_0x567376!==''&&_0x567376!==undefined,checkLayoutMigrationNeeded=_0x14e6bd=>{const _0x49c5de=_0x14e6bd['version']===CHART_VERSION;return!_0x49c5de&&console['log']('Layout\x20'+_0x14e6bd['name']+'\x20version\x20does\x20not\x20match\x20current\x20chart\x20version:\x20'+_0x14e6bd['version']+'\x20!==\x20'+CHART_VERSION+',\x20trying\x20to\x20migrate.'),!_0x49c5de;};export const checkAllLoaded=_0x5f2b2f=>pipe(_0x5f2b2f,record['every'](_0x233b53=>_0x233b53==='done'));export const calculateLoadedStatus=(_0x2033ff,_0x1392e7)=>{const _0x55fb1c=Object['values'](_0x1392e7)['reduce']((_0xece0ef,_0x275ce8)=>_0xece0ef+_0x275ce8,0x0),_0x252a97=Object['entries'](_0x2033ff)['filter'](([,_0x30d7f3])=>_0x30d7f3==='done')['reduce']((_0x15642d,[_0x44afa3])=>_0x15642d+_0x1392e7[_0x44afa3],0x0);return _0x252a97/_0x55fb1c*0x64;};const mergeMultichartLayoutWithDefault=(_0x13a3b6,_0x33d6ca,_0x272c99,_0xe7d538)=>{const _0x573b00=createDefaultLayout(_0x13a3b6['charts'][0x0]['symbol'],_0x13a3b6['charts'][0x0]['aggregation'],_0x13a3b6['charts'][0x0]['timeframePreset'],_0x33d6ca,_0x272c99,_0xe7d538),_0x499076=_0x1ba9d4(_0x13a3b6,_0x573b00);return _0x499076['charts']=_0x573b00['charts']['map'](_0x1ba4fd=>{const _0x37902a=_0x499076['charts']['find'](_0x26d88e=>_0x26d88e['index']===_0x1ba4fd['index']);return _0x37902a?_0x1ba9d4(_0x37902a,_0x1ba4fd):_0x1ba4fd;}),_0x499076;},checkTrial=_0x183d32=>{return fetch(SPY_TRIAL_URL+'?token='+_0x183d32)['catch'](_0xb2e7b0=>_0xb2e7b0);};