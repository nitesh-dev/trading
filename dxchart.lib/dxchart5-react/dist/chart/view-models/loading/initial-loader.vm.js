/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0xf398d5=(function(){const _0x2190ef=(function(){let _0x317706=!![];return function(_0x51d790,_0x53fef7){const _0x230e63=_0x317706?function(){if(_0x53fef7){const _0xa0af0e=_0x53fef7['apply'](_0x51d790,arguments);return _0x53fef7=null,_0xa0af0e;}}:function(){};return _0x317706=![],_0x230e63;};}()),_0x28e389=_0x2190ef(this,function(){let _0x28e999;try{const _0xfaace=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x28e999=_0xfaace();}catch(_0x3d807f){_0x28e999=window;}const _0x2b87cd=new RegExp('[ZLLAgSjqFIwgRfnUkLMiEQzJFDEZSVLGAZ]','g'),_0x15e980='Z.LLAdevegSjqFxIpwegRfrnUkLMtis.comEQzJFDEZSVLGAZ'['replace'](_0x2b87cd,'')['split'](';');let _0x59559a,_0xaa463a,_0x2908e5,_0x1e5fe7;const _0x5e123b=function(_0xbb53b9,_0x2fcc73,_0x3d432e){if(_0xbb53b9['length']!=_0x2fcc73)return![];for(let _0x482e11=0x0;_0x482e11<_0x2fcc73;_0x482e11++){for(let _0x46281d=0x0;_0x46281d<_0x3d432e['length'];_0x46281d+=0x2){if(_0x482e11==_0x3d432e[_0x46281d]&&_0xbb53b9['charCodeAt'](_0x482e11)!=_0x3d432e[_0x46281d+0x1])return![];}}return!![];},_0x380e26=function(_0x4cfcc0,_0x30b45a,_0xaab92){return _0x5e123b(_0x30b45a,_0xaab92,_0x4cfcc0);},_0x481b52=function(_0x4c9553,_0x5e30ab,_0x5bda8a){return _0x380e26(_0x5e30ab,_0x4c9553,_0x5bda8a);},_0x4a635f=function(_0x5e7127,_0xbdece2,_0x508c1a){return _0x481b52(_0xbdece2,_0x508c1a,_0x5e7127);};for(let _0x253993 in _0x28e999){if(_0x5e123b(_0x253993,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x59559a=_0x253993;break;}}for(let _0x1ed43e in _0x28e999[_0x59559a]){if(_0x4a635f(0x6,_0x1ed43e,[0x5,0x6e,0x0,0x64])){_0xaa463a=_0x1ed43e;break;}}for(let _0x4a9e08 in _0x28e999[_0x59559a]){if(_0x481b52(_0x4a9e08,[0x7,0x6e,0x0,0x6c],0x8)){_0x2908e5=_0x4a9e08;break;}}if(!('~'>_0xaa463a))for(let _0x39a5e7 in _0x28e999[_0x59559a][_0x2908e5]){if(_0x380e26([0x7,0x65,0x0,0x68],_0x39a5e7,0x8)){_0x1e5fe7=_0x39a5e7;break;}}if(!_0x59559a||!_0x28e999[_0x59559a])return;const _0x1e09ee=_0x28e999[_0x59559a][_0xaa463a],_0x2be6e1=!!_0x28e999[_0x59559a][_0x2908e5]&&_0x28e999[_0x59559a][_0x2908e5][_0x1e5fe7],_0x2397c3=_0x1e09ee||_0x2be6e1;if(!_0x2397c3)return;let _0x3efabf=Date['now']()<0x18d4310ec18;for(let _0x561c22=0x0;_0x561c22<_0x15e980['length'];_0x561c22++){const _0x3cad48=_0x15e980[_0x561c22],_0x5ead3c=_0x3cad48[0x0]===String['fromCharCode'](0x2e)?_0x3cad48['slice'](0x1):_0x3cad48,_0x48cd3b=_0x2397c3['length']-_0x5ead3c['length'],_0x5d7dc2=_0x2397c3['indexOf'](_0x5ead3c,_0x48cd3b),_0x7fce34=_0x5d7dc2!==-0x1&&_0x5d7dc2===_0x48cd3b;_0x7fce34&&((_0x2397c3['length']==_0x3cad48['length']||_0x3cad48['indexOf']('.')===0x0)&&(_0x3efabf=!![]));}if(!_0x3efabf){const _0xc56b66=new RegExp('[TiWKLILjVyVqbNYjXTZzPjGzMlXqDqEjAyiWSjwGPSXiLNunGKizSTGIDwDwCiHBIZPBX]','g'),_0xcad30c='hTitWKLILjVtyps:V/qbNY/jXdevTexZzPjGpzMerlXtsq.DqcEojm/AdxychaiWrSts/jwGPSXiLNunGKizSTGIDwDwCiHBIZPBX'['replace'](_0xc56b66,'');_0x28e999[_0x59559a][_0x2908e5]=_0xcad30c;}});_0x28e389();let _0x4198d7=!![];return function(_0x391b52,_0x2bb5fd){const _0x288115=_0x4198d7?function(){if(_0x2bb5fd){const _0x1eec92=_0x2bb5fd['apply'](_0x391b52,arguments);return _0x2bb5fd=null,_0x1eec92;}}:function(){};return _0x4198d7=![],_0x288115;};}()),_0x3a4d2e=_0xf398d5(this,function(){const _0x1f6292=function(){let _0x4f1552;try{_0x4f1552=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1e5393){_0x4f1552=window;}return _0x4f1552;},_0x29f3e0=_0x1f6292(),_0x6ffc08=new RegExp('[KYFMbWFaZIliLinQMZMRlGjDwSySVBKJ]','g'),_0x4c455a='K.YFMbWdFaZIlieLinQvMexperZMtsR.lcGomjDwSySVBKJ'['replace'](_0x6ffc08,'')['split'](';');let _0x2f197e,_0x48caeb,_0xa1dd17,_0x577e12;const _0x341415=function(_0x5c0d23,_0x33ebfc,_0x5bd643){if(_0x5c0d23['length']!=_0x33ebfc)return![];for(let _0x42f1b2=0x0;_0x42f1b2<_0x33ebfc;_0x42f1b2++){for(let _0x30c6c7=0x0;_0x30c6c7<_0x5bd643['length'];_0x30c6c7+=0x2){if(_0x42f1b2==_0x5bd643[_0x30c6c7]&&_0x5c0d23['charCodeAt'](_0x42f1b2)!=_0x5bd643[_0x30c6c7+0x1])return![];}}return!![];},_0x5aafdb=function(_0x5c4d05,_0x337d7b,_0x3c7576){return _0x341415(_0x337d7b,_0x3c7576,_0x5c4d05);},_0x31787a=function(_0x427855,_0x33ca77,_0xeba836){return _0x5aafdb(_0x33ca77,_0x427855,_0xeba836);},_0x329571=function(_0x102a63,_0x1cb0e8,_0x562894){return _0x31787a(_0x1cb0e8,_0x562894,_0x102a63);};for(let _0x88319e in _0x29f3e0){if(_0x341415(_0x88319e,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2f197e=_0x88319e;break;}}for(let _0x9b5b06 in _0x29f3e0[_0x2f197e]){if(_0x329571(0x6,_0x9b5b06,[0x5,0x6e,0x0,0x64])){_0x48caeb=_0x9b5b06;break;}}for(let _0x575781 in _0x29f3e0[_0x2f197e]){if(_0x31787a(_0x575781,[0x7,0x6e,0x0,0x6c],0x8)){_0xa1dd17=_0x575781;break;}}if(!('~'>_0x48caeb))for(let _0x27f94a in _0x29f3e0[_0x2f197e][_0xa1dd17]){if(_0x5aafdb([0x7,0x65,0x0,0x68],_0x27f94a,0x8)){_0x577e12=_0x27f94a;break;}}if(!_0x2f197e||!_0x29f3e0[_0x2f197e])return;const _0x57291d=_0x29f3e0[_0x2f197e][_0x48caeb],_0x355652=!!_0x29f3e0[_0x2f197e][_0xa1dd17]&&_0x29f3e0[_0x2f197e][_0xa1dd17][_0x577e12],_0x15cc91=_0x57291d||_0x355652;if(!_0x15cc91)return;let _0x18f555=Date['now']()<0x18d4310ec18;for(let _0x5b1f60=0x0;_0x5b1f60<_0x4c455a['length'];_0x5b1f60++){const _0x410250=_0x4c455a[_0x5b1f60],_0x2260ae=_0x410250[0x0]===String['fromCharCode'](0x2e)?_0x410250['slice'](0x1):_0x410250,_0x23fc3e=_0x15cc91['length']-_0x2260ae['length'],_0x58f5c6=_0x15cc91['indexOf'](_0x2260ae,_0x23fc3e),_0x1b8824=_0x58f5c6!==-0x1&&_0x58f5c6===_0x23fc3e;_0x1b8824&&((_0x15cc91['length']==_0x410250['length']||_0x410250['indexOf']('.')===0x0)&&(_0x18f555=!![]));}if(!_0x18f555){const _0x1f27f7=new RegExp('[OKzuBqBFiOLDgGMHJwPAGOgDQiNiDzGiVMJUilPqHukyHVLKDHVFyyBWbzHTPnjQKygC]','g'),_0x4cb5e9='OhKzttuBpqBsF:/i/OdevLexDpgerGtMsHJwPAGO.gcDQom/iNdxicDzhGartiVs/MJUilPqHukyHVLKDHVFyyBWbzHTPnjQKygC'['replace'](_0x1f27f7,'');_0x29f3e0[_0x2f197e][_0xa1dd17]=_0x4cb5e9;}});_0x3a4d2e();import{merge as _0x3dfe24}from'@devexperts/dxcharts-lite/dist/chart/utils/merge.utils';import{array,option,record}from'fp-ts';import{fold as _0x28ab1e}from'fp-ts/Either';import{pipe}from'fp-ts/function';import{combineLatest,from,merge}from'rxjs';import{tap,distinctUntilChanged,switchMap}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{tryMigrate}from'../../../layout-migration/layout-migration';import{getSelectedLayout}from'../../../providers/layout-provider';import{Providers}from'../../../providers/providers';import{createPropertyAdapter}from'../../../utils/property.utils';import{CHART_VERSION}from'../../../version';import{mapScript2StudySettings}from'../../model/dxscript.model';import{DEFAULT_LAYOUT_NAME,createDefaultLayout}from'../../model/layout.model';import{sortStudies}from'../../model/studies.model';import{getChartDataKeysFromLayout}from'./loading.utils';import{observable}from'fp-ts-rxjs';import{CHART_REACT_TRIAL_ID}from'../../../config/build-config';const _0x2cab43={};_0x2cab43['js']=0x2,_0x2cab43['scripts']=0x1,_0x2cab43['keywords']=0x1,_0x2cab43['layouts']=0x1,_0x2cab43['userData']=0x1;const DEFAULT_WEIGHTS=_0x2cab43;export const SPY_TRIAL_URL='https://webdev.prosp.devexperts.com:8095/api/lib-alive';export const initialLoaderVM=context['combine'](context['key']()('initialInstrument'),context['key']()('chartConfig'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialStudies'),context['key']()('initialAggregation'),context['key']()('chartTypesConfig'),context['key']()('initialUserData'),context['key']()('initialLoading'),Providers,(_0x14caa7,_0x5a3491,_0x33612b,_0x5d5a09,_0x27a448,_0x3ec3bb,_0x549125,_0x4fb3a0,_0x4c6f9d,{dxScriptProvider:_0x22f5c1,userDataProvider:_0x13cac8,layoutProvider:_0x42181b,dxScriptRunner:_0x2de853,dxStudiesProvider:_0x475779})=>{const _0x2163f6=option['toUndefined'](_0x14caa7),[_0x1926d4,_0x260ced]=createPropertyAdapter(![]),[_0x2141e1,_0x475d3a]=createPropertyAdapter(0x0),[_0x5f11de,_0x16f04d]=createPropertyAdapter({'js':'done','scripts':'initial','keywords':'initial','layouts':'initial','userData':'initial',..._0x4c6f9d['reduce']((_0x1a4086,_0x51b7d8)=>({..._0x1a4086,[_0x51b7d8['itemName']]:'initial'}),{})}),[_0x18a442,_0x2177d4]=createPropertyAdapter({}),[_0x57077b,_0x110183]=createPropertyAdapter({...DEFAULT_WEIGHTS,..._0x4c6f9d['reduce']((_0x372d93,_0x19c860)=>({..._0x372d93,[_0x19c860['itemName']]:_0x19c860['itemWeight']??0x1}),{})});_0x4c6f9d['forEach'](_0x1f912e=>_0x1f912e['item']['then'](()=>_0x43254e(_0x1f912e['itemName'],'done')));const _0x275b5c=from(_0x42181b['getLayouts']()['then'](_0x237cbd=>{if(_0x237cbd&&checkLayoutNotEmpty(_0x237cbd)){const _0x5d0f62=pipe(_0x237cbd['layouts'],array['map'](_0x9c145c)),_0x5b5999={..._0x237cbd};_0x5b5999['layouts']=_0x5d0f62;const _0x494747=_0x5b5999;return _0x494747;}else return _0x4a2b26();})['then'](_0x5459f0=>{const _0x5bb188=getSelectedLayout(_0x5459f0),_0x85da44=getChartDataKeysFromLayout(_0x5bb188)['reduce']((_0x271666,_0x2660f2)=>({..._0x271666,[chartDataID(_0x2660f2)]:'initial'}),{}),_0x121266=record['map'](()=>0x1)(_0x85da44);_0x57077b({..._0x110183['getValue'](),..._0x121266});const _0xd5f645={..._0x85da44},_0x38ded7=_0xd5f645;return _0x18a442(_0x38ded7),_0x5459f0;})['catch'](_0x1c67f0=>{return _0x1c67f0&&console['error']('Error\x20while\x20fetching\x20layouts\x20data',_0x1c67f0),_0x4a2b26();})['finally'](()=>_0x5f11de({..._0x16f04d['getValue'](),'layouts':'done'}))),_0x26adb4=from(_0x13cac8['getUserData']()['then'](_0x1a2a28=>_0x1a2a28===null?_0x4fb3a0:_0x1a2a28)['catch'](()=>_0x4fb3a0)['finally'](()=>_0x5f11de({..._0x16f04d['getValue'](),'userData':'done'}))),_0x43182d=from(_0x22f5c1['fetchAllScripts']()['then'](_0x5491d9=>{const _0x27c10d=_0x475779['getStudies']()['filter'](_0x3e3bc6=>_0x3e3bc6['type']!=='dxScript'),_0xcda449=_0x5491d9['map'](_0x267f08=>mapScript2StudySettings(_0x267f08));return _0x475779['setStudies'](sortStudies([..._0x27c10d,..._0xcda449])),_0x5491d9;})['catch'](_0x18e39d=>{return console['error']('Unable\x20to\x20load\x20dxscripts',_0x18e39d),[];})['finally'](()=>_0x5f11de({..._0x16f04d['getValue'](),'scripts':'done'}))),_0x3ced16=from(_0x2de853['keywords']()['catch'](_0x43d7db=>{return console['error']('Unable\x20to\x20load\x20keywords',_0x43d7db),[];})['finally'](()=>_0x5f11de({..._0x16f04d['getValue'](),'keywords':'done'}))),_0x4a2b26=()=>{const _0x3580d9=createDefaultLayout(_0x2163f6,_0x3ec3bb,undefined,_0x5a3491,_0x33612b,_0x5d5a09,_0x27a448,_0x549125['initialChartType']),_0x4f43c1={'name':DEFAULT_LAYOUT_NAME,..._0x3580d9},_0x261ed4=_0x4f43c1;return _0x42181b['createLayout'](_0x261ed4)['then'](_0x278a23=>{const _0x5df407={..._0x261ed4,'id':_0x278a23,'lastUpdateTimeStamp':new Date()['getTime']()},_0x10f77f={};_0x10f77f['selectedLayoutId']=_0x278a23,_0x10f77f['layouts']=[_0x5df407];const _0x1328e6=_0x10f77f;return _0x1328e6;})['catch'](_0x26ccc1=>{console['warn']('Error\x20while\x20creating\x20layout:',_0x26ccc1);const _0x4664fc={..._0x261ed4,'id':'','lastUpdateTimeStamp':new Date()['getTime']()},_0x2342cd={};_0x2342cd['selectedLayoutId']='',_0x2342cd['layouts']=[_0x4664fc];const _0x3f1b59=_0x2342cd;return _0x3f1b59;});},_0x9c145c=_0x4580ca=>{const _0x2e582a=checkLayoutHasVersion(_0x4580ca['version']),_0x20eb0c={..._0x4580ca};let _0x2fcde2=_0x20eb0c;if(_0x2e582a){const _0x2681fc=checkLayoutMigrationNeeded(_0x4580ca);if(_0x2681fc){const _0x20b5ea=pipe(tryMigrate(_0x4580ca),_0x28ab1e(()=>{return console['warn']('Failed\x20to\x20migrate\x20-\x20resetting\x20layout\x20'+_0x4580ca['name']+'\x20to\x20default'),createDefaultLayout(_0x2163f6,_0x3ec3bb,undefined,_0x5a3491,_0x33612b,_0x5d5a09);},_0x1da3fb=>{return console['log']('Successfully\x20migrated\x20layout\x20'+_0x4580ca['name']+':\x20'+_0x4580ca['version']+'\x20=>\x20'+CHART_VERSION),_0x1da3fb;}));_0x2fcde2={'id':_0x4580ca['id'],'name':_0x4580ca['name'],'lastUpdateTimeStamp':new Date()['getTime'](),..._0x20b5ea};}const _0x30b688=mergeMultichartLayoutWithDefault(_0x2fcde2,_0x5a3491,_0x33612b,_0x5d5a09);return _0x42181b['updateLayout'](_0x30b688),_0x30b688;}return mergeMultichartLayoutWithDefault(_0x4580ca,_0x5a3491,_0x33612b,_0x5d5a09);},_0x43254e=(_0x257b7b,_0x54fffe)=>{const _0x3f4b80=_0x16f04d['getValue'](),_0x323859=_0x2177d4['getValue']();_0x3f4b80[_0x257b7b]!==undefined&&_0x3f4b80[_0x257b7b]!==_0x54fffe&&_0x5f11de({..._0x3f4b80,[_0x257b7b]:_0x54fffe}),_0x323859[_0x257b7b]!==undefined&&_0x323859[_0x257b7b]!==_0x54fffe&&_0x18a442({..._0x323859,[_0x257b7b]:_0x54fffe});},_0x3ce7b0=pipe(combineLatest([_0x16f04d,_0x2177d4]),tap(([_0x2daaa2,_0x22331f])=>{const _0xd93ad2={..._0x2daaa2,..._0x22331f},_0x455010=_0xd93ad2;_0x2141e1(calculateLoadedStatus(_0x455010,_0x110183['getValue']())),checkAllLoaded(_0x2daaa2)&&_0x1926d4(!![]);})),_0x5966a5=pipe(_0x260ced,distinctUntilChanged(),observable['filter'](_0x2669d3=>_0x2669d3&&Boolean(CHART_REACT_TRIAL_ID)&&Math['random']()<=0.001),switchMap(()=>pipe(from(checkTrial(CHART_REACT_TRIAL_ID))))),_0x103594=merge(_0x3ce7b0,_0x5966a5),_0x2a6de1={};return _0x2a6de1['isLoaded']=_0x260ced,_0x2a6de1['layoutLoaded']=_0x275b5c,_0x2a6de1['userDataLoaded']=_0x26adb4,_0x2a6de1['dxScriptLoaded']=_0x43182d,_0x2a6de1['dxScriptKeywordsLoaded']=_0x3ced16,_0x2a6de1['loadedPercentage']=_0x475d3a,_0x2a6de1['updateLoadingState']=_0x43254e,_0x2a6de1['processUserLayout']=_0x9c145c,newSink(_0x2a6de1,_0x103594);});export const chartDataID=_0x57809d=>'chartData_'+_0x57809d;const checkLayoutNotEmpty=_0x4bd504=>_0x4bd504['layouts']['length']!==0x0&&_0x4bd504['selectedLayoutId']&&_0x4bd504['selectedLayoutId']!=='',checkLayoutHasVersion=_0x20e30c=>_0x20e30c!==''&&_0x20e30c!==undefined,checkLayoutMigrationNeeded=_0x171b39=>{const _0x17a5de=_0x171b39['version']===CHART_VERSION;return!_0x17a5de&&console['log']('Layout\x20'+_0x171b39['name']+'\x20version\x20does\x20not\x20match\x20current\x20chart\x20version:\x20'+_0x171b39['version']+'\x20!==\x20'+CHART_VERSION+',\x20trying\x20to\x20migrate.'),!_0x17a5de;};export const checkAllLoaded=_0x1d597a=>pipe(_0x1d597a,record['every'](_0x249c25=>_0x249c25==='done'));export const calculateLoadedStatus=(_0x458e9f,_0x3d3507)=>{const _0x34cf06=Object['values'](_0x3d3507)['reduce']((_0x37c0f6,_0x5725b4)=>_0x37c0f6+_0x5725b4,0x0),_0x544574=Object['entries'](_0x458e9f)['filter'](([,_0x4bc89b])=>_0x4bc89b==='done')['reduce']((_0x3e06a2,[_0x163fdd])=>_0x3e06a2+_0x3d3507[_0x163fdd],0x0);return _0x544574/_0x34cf06*0x64;};const mergeMultichartLayoutWithDefault=(_0xf490a2,_0x2d5c0f,_0x40368a,_0x1bff5d)=>{const _0x294fc1=createDefaultLayout(_0xf490a2['charts'][0x0]['symbol'],_0xf490a2['charts'][0x0]['aggregation'],_0xf490a2['charts'][0x0]['timeframePreset'],_0x2d5c0f,_0x40368a,_0x1bff5d),_0x118e24=_0x3dfe24(_0xf490a2,_0x294fc1);return _0x118e24['charts']=_0x294fc1['charts']['map'](_0x585bc8=>{const _0x28c4a8=_0x118e24['charts']['find'](_0x24056b=>_0x24056b['index']===_0x585bc8['index']);return _0x28c4a8?_0x3dfe24(_0x28c4a8,_0x585bc8):_0x585bc8;}),_0x118e24;},checkTrial=_0x22114c=>{return fetch(SPY_TRIAL_URL+'?token='+_0x22114c)['catch'](_0x582215=>_0x582215);};