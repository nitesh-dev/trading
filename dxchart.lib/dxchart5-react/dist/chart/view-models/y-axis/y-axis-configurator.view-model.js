/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const f=(function(){let i=!![];return function(j,k){const l=i?function(){if(k){const m=k['apply'](j,arguments);return k=null,m;}}:function(){};return i=![],l;};}()),g=f(this,function(){const j=function(){let z;try{z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(A){z=window;}return z;},k=j(),l=new RegExp('[aUCBzyCkuMPTwhagMFYRAhTiIlBjjXRwRahF]','g'),m='.adeveUCBzyxpeCkrutsM.coPmTwhagMFYRAhTiIlBjjXRwRahF'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(z,A,B){if(z['length']!=A)return![];for(let C=0x0;C<A;C++){for(let D=0x0;D<B['length'];D+=0x2){if(C==B[D]&&z['charCodeAt'](C)!=B[D+0x1])return![];}}return!![];},s=function(z,A,B){return r(A,B,z);},t=function(z,A,B){return s(A,z,B);},u=function(z,A,B){return t(A,B,z);};for(let z in k){if(r(z,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=z;break;}}for(let A in k[n]){if(u(0x6,A,[0x5,0x6e,0x0,0x64])){o=A;break;}}for(let B in k[n]){if(t(B,[0x7,0x6e,0x0,0x6c],0x8)){p=B;break;}}if(!('~'>o))for(let C in k[n][p]){if(s([0x7,0x65,0x0,0x68],C,0x8)){q=C;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let D=0x0;D<m['length'];D++){const E=m[D],F=E[0x0]===String['fromCharCode'](0x2e)?E['slice'](0x1):E,G=x['length']-F['length'],H=x['indexOf'](F,G),I=H!==-0x1&&H===G;I&&((x['length']==E['length']||E['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const J=new RegExp('[ulMTVTPOEJGEGHREZQMAZkVfyDVOnJfiLnLyIKMuKlljzGfqIgYguHQCXHGqSRnRFQifBVCu]','g'),K='hutlMTtpVs:TPO/EJG/EdGevHREZexQMpAZekVrtfysDVO.nJcfiLom/dxnLyIKchaMrutsK/lljzGfqIgYguHQCXHGqSRnRFQifBVCu'['replace'](J,'');k[n][p]=K;}});g();let h=!![];return function(i,j){const k=h?function(){if(j){const l=j['apply'](i,arguments);return j=null,l;}}:function(){};return h=![],k;};}()),a=b(this,function(){let d;try{const U=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');d=U();}catch(V){d=window;}const e=new RegExp('[lVUwXHPuaTiWzkgCOIDZZWIXuFauKqFygjB]','g'),i='lV.deUvwexpXeHPuraTiWtzs.kcgoCOmIDZZWIXuFauKqFygjB'['replace'](e,'')['split'](';');let I,J,K,L;const M=function(W,X,Y){if(W['length']!=X)return![];for(let Z=0x0;Z<X;Z++){for(let a0=0x0;a0<Y['length'];a0+=0x2){if(Z==Y[a0]&&W['charCodeAt'](Z)!=Y[a0+0x1])return![];}}return!![];},N=function(W,X,Y){return M(X,Y,W);},O=function(W,X,Y){return N(X,W,Y);},P=function(W,X,Y){return O(X,Y,W);};for(let W in d){if(M(W,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){I=W;break;}}for(let X in d[I]){if(P(0x6,X,[0x5,0x6e,0x0,0x64])){J=X;break;}}for(let Y in d[I]){if(O(Y,[0x7,0x6e,0x0,0x6c],0x8)){K=Y;break;}}if(!('~'>J))for(let Z in d[I][K]){if(N([0x7,0x65,0x0,0x68],Z,0x8)){L=Z;break;}}if(!I||!d[I])return;const Q=d[I][J],R=!!d[I][K]&&d[I][K][L],S=Q||R;if(!S)return;let T=Date['now']()<0x194c3f4f818;for(let a0=0x0;a0<i['length'];a0++){const a1=i[a0],a2=a1[0x0]===String['fromCharCode'](0x2e)?a1['slice'](0x1):a1,a3=S['length']-a2['length'],a4=S['indexOf'](a2,a3),a5=a4!==-0x1&&a4===a3;a5&&((S['length']==a1['length']||a1['indexOf']('.')===0x0)&&(T=!![]));}if(!T){const a6=new RegExp('[ZnSWHSygfYnqZqQTlYujfNLXVkyABPMqQYRVzBTLXjMIEPJuCUDqFwqPfBuAYNgCEBWzbA]','g'),a7='htZtnpSsW:/H/SdeyvexpegrtfsY.ncqZom/dxcqQThalrYts/ujfNLXVkyABPMqQYRVzBTLXjMIEPJuCUDqFwqPfBuAYNgCEBWzbA'['replace'](a6,'');d[I][K]=a7;}});a();import{CanvasElement,CHART_UUID}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{deepEqual}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{pipe}from'fp-ts/function';import{Lens}from'monocle-ts';import{merge}from'rxjs';import{distinctUntilChanged,filter,map,skip,tap,withLatestFrom,pairwise}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{callTracerProxy}from'../../../utils/debug/call-tracer';import{convertToProperty,createPropertyAdapter}from'../../../utils/property.utils';import{chartSettingsAutoScalePriceAxis,chartSettingsPriceAxisFit}from'../../model/chart.model';import{lensLockPriceToBarRatio}from'../chart-configurator.view-model';const lensYAxisAlign=Lens['fromPath']()(['chartCore','components','yAxis','align']),priceScaleInverseLens=Lens['fromPath']()(['chartCore','scale','inverse']),lensYAxis=Lens['fromPath']()(['chartCore','components','yAxis','type']),lensAutoScale=Lens['fromPath']()(['chartCore','scale','auto']);export const createYAxisConfiguratorViewModel=context['combine'](context['key']()('chartConfiguratorViewModel'),context['key']()('actionsHistoryVM'),context['key']()('chart'),context['key']()('multiChartViewModel'),context['key']()('chartDataViewModel'),context['key']()('initialGeneralSettings'),context['key']()('chartId'),context['key']()('chartConfig'),(Y,Z,a0,a1,a2,a3,a4,a5)=>{const a6=fromCoreChartSettingsToLocalLabelsConfig(a3,a5['components']['yAxis']['labels']),[a7,a8]=createPropertyAdapter(a6),a9=convertToProperty(a0['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID_Y_AXIS'](CHART_UUID))['pipe'](map(aK=>aK['width']),distinctUntilChanged()),0x0),aa=convertToProperty(a0['bounds']['observeBoundsChanged'](CanvasElement['PANE_UUID'](CHART_UUID))['pipe'](map(aK=>aK['width']),distinctUntilChanged()),0x0),ab=convertToProperty(pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['components']['yAxis']['align'])),'right'),ac=aK=>{if(Y['state']['getValue']()['settings']['chartCore']['components']['yAxis']['type']==='percent')return;pipe(Y['state']['getValue']()['settings'],chartSettingsAutoScalePriceAxis['set'](aK),aL=>Y['setConfig'](aL),()=>Y['setConfig'](lensAutoScale['set'](aK)(Y['state']['getValue']()['settings']),![]));},ad=(aK,aL)=>{const aM=Y['state']['getValue']();if(aM['settings']['chartCore']['components']['yAxis']['type']==='percent')return;const aN=getAxisFit(aM,aK,aL);Y['setConfig'](chartSettingsPriceAxisFit['set'](aN)(aM['settings']));},ae=(aK,aL=!![])=>{const aM=Y['state']['getValue']();Y['setConfig'](lensYAxis['set'](aK)(aM['settings']),aL);},af=()=>{const {lockPriceToBarRatio:aK}=Y['state']['getValue']()['settings']['chartCore']['scale'];if(aK)return;const aL=Y['state']['getValue']()['settings']['chartCore']['components']['yAxis']['type'];ae(aL==='percent'?'regular':'percent');},ag=()=>{const {lockPriceToBarRatio:aK}=Y['state']['getValue']()['settings']['chartCore']['scale'];if(aK)return;const aL=Y['state']['getValue']()['settings']['chartCore']['components']['yAxis']['type'];ae(aL==='logarithmic'?'regular':'logarithmic');},ah=aK=>{Y['setConfig'](priceScaleInverseLens['set'](aK)(Y['state']['getValue']()['settings']));},ai=(aK,aL=!![])=>{aK&&(ae('regular'),ac(![])),Y['setConfig'](lensLockPriceToBarRatio['set'](aK)(Y['state']['getValue']()['settings']),aL);},aj=(aK,aL)=>{const aM=a8['getValue'](),aN={...aM,'labels':{...aM['labels'],[aK]:aL}};an(aM,aN);},ak=aK=>{Y['setConfig'](lensYAxisAlign['set'](aK)(Y['state']['getValue']()['settings']));},al=aK=>{const aL=a8['getValue'](),aM={...aL,'descriptions':aK};an(aL,aM);},am=aK=>{const aL=a8['getValue'](),aM={...aL,'countDownToBarClose':aK};an(aL,aM);},an=(aK,aL)=>{const aM=aP=>{if(a1['state']['getValue']()['isGeneralSettingsSyncEnabled']){const aQ=fromLocalLabelsConfigToCoreChartSettings(Y['state']['getValue']()['settings'],aP);a1['setGeneralSettings'](aQ);}else a7(aP);},aN=()=>aM(aL),aO=()=>aM(aK);Z['pushAction']({'type':'y_axis_labels_change','redo':aN,'undo':aO});},ao=()=>ah(!Y['state']['getValue']()['settings']['chartCore']['scale']['inverse']),ap=()=>ai(!Y['state']['getValue']()['settings']['chartCore']['scale']['lockPriceToBarRatio']),aq=pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['scale']['auto']),distinctUntilChanged(),tap(aK=>{a0['setAutoScale'](aK);})),ar=pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['scale']['lockPriceToBarRatio']),distinctUntilChanged(),tap(aK=>a0['yAxis']['setLockPriceToBarRatio'](aK))),as=pipe(a8,observable['map'](aK=>aK['descriptions']),distinctUntilChanged(),tap(aK=>{a0['yAxis']['changeLabelsDescriptionVisibility'](aK),a0['paneManager']['yExtents']['forEach'](aL=>aL['yAxis']['state']['labels']['descriptions']=aK);})),at=pipe(a8,observable['map'](aK=>aK['countDownToBarClose']?'label':'none'),distinctUntilChanged(),tap(aK=>a0['yAxis']['changeLabelMode']('countdownToBarClose',aK))),au=pipe(a8,observable['map'](aK=>aK['labels']['lastPrice']),filter(Boolean),distinctUntilChanged(),tap(aK=>a0['yAxis']['changeLabelMode']('lastPrice',aK))),av=pipe(a8,observable['map'](aK=>aK['labels']['studies']),filter(Boolean),distinctUntilChanged(),tap(aK=>{const aL=Object['values'](a0['paneManager']['panes']);aL['flatMap'](aM=>Array['from'](aM['dataSeries']))['forEach'](aM=>aM['config']['labelMode']=aK),a0['yAxis']['changeLabelMode']('studies',aK),a0['paneManager']['yExtents']['forEach'](aM=>aM['yAxis']['updateOrderedLabels'](!![]));})),aw=pipe(a8,observable['map'](aK=>aK['labels']['prevDayClose']),filter(Boolean),distinctUntilChanged(),tap(aK=>a0['yAxis']['changeLabelMode']('prevDayClose',aK))),ax=pipe(a8,observable['map'](aK=>aK['labels']['prePostMarket']),filter(Boolean),distinctUntilChanged(),tap(aK=>a0['yAxis']['changeLabelMode']('prePostMarket',aK))),ay=pipe(a8,observable['map'](aK=>aK['labels']['highLow']),filter(Boolean),distinctUntilChanged(),tap(aK=>a0['yAxis']['changeLabelMode']('highLow',aK))),az=pipe(a8,observable['map'](aK=>aK['labels']['bidAsk']),filter(Boolean),distinctUntilChanged(),tap(aK=>a0['yAxis']['changeLabelMode']('bidAsk',aK))),aA=pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['scale']['inverse']),distinctUntilChanged(),tap(aK=>a0['yAxis']['togglePriceScaleInverse'](aK))),aB=pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['components']['yAxis']['type']),distinctUntilChanged(),tap(aK=>a0['yAxis']['setAxisType'](aK))),aC=pipe(a8,skip(0x1),observable['map'](aK=>fromLocalLabelsConfigToCoreChartSettings(Y['state']['getValue']()['settings'],aK)),tap(aK=>{a1['updateLocalChartInfo'](a4,{'chartSettings':{...aK}});})),aD=pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['components']['yAxis']['align']),distinctUntilChanged(),tap(aK=>a0['yAxis']['setYAxisAlign'](aK))),aE=pipe(a1['state'],observable['filter'](aK=>aK['isGeneralSettingsSyncEnabled']),observable['map'](aK=>aK['lastGeneralSettings']),observable['map'](aK=>fromCoreChartSettingsToLocalLabelsConfig(aK,a5['components']['yAxis']['labels'])),observable['filter'](aK=>!deepEqual(aK,a8['getValue']())),tap(aK=>{a7(aK);})),aF=pipe(a2['compareInstruments'],skip(0x1),withLatestFrom(pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['components']['yAxis']['type']))),observable['filter'](([aK,aL])=>record['keys'](aK)['length']===0x0&&aL==='percent'),tap(()=>ae('regular',![]))),aG=pipe(a2['historicalCandlesUpdated'],observable['map'](aK=>aK['length']===0x0),distinctUntilChanged(),tap(aK=>{for(const aL of Object['values'](a0['paneManager']['panes'])){aL['yAxis']['setVisible'](!aK);}})),aH=pipe(a2['compareInstruments'],pairwise(),withLatestFrom(pipe(Y['state'],observable['map'](aK=>aK['settings']['chartCore']['components']['yAxis']['type']))),observable['filter'](([[aK,aL],aM])=>record['keys'](aK)['length']===0x0&&record['keys'](aL)['length']!==0x0&&aM!=='percent'),tap(()=>{ai(![],![]),ae('percent',![]);})),aI=()=>{},aJ=merge(aC,aE,at,as,au,av,aw,ax,ay,aD,az,aA,ar,aq,aB,aF,aH,aG);return newSink(callTracerProxy('yAxisConfiguratorViewModel',{'chartWidth':aa,'yAxisWidth':a9,'yAxisAlign':ab,'config':Y['config'],'setAutoScale':ac,'setPriceAxisFitType':ad,'setAxisType':ae,'defaultConfig':Y['defaultConfig'],'onRestoreDefaultConfig':aI,'setYAxisAlign':ak,'setLockPriceToBarRatio':ai,'labelsConfig':a8,'changeLabelMode':aj,'setDescription':al,'toggleLogAxis':ag,'togglePercentAxis':af,'setCountDownBarClose':am,'togglePriceScaleInverse':ao,'toggleLockPriceToBarRatio':ap,'setYAxisLabelsSettings':an}),aJ);});export function fromCoreChartSettingsToLocalLabelsConfig(f,g){const h=f['chartCore']['components']['yAxis']['labels'];return{'descriptions':h['descriptions'],'countDownToBarClose':getYAxisLabelModeFromCoreChartConfig(h['settings']['countdownToBarClose'])==='label','labels':{'lastPrice':getYAxisLabelModeFromCoreChartConfig(h['settings']['lastPrice']),...g['settings']['studies']&&{'studies':getYAxisLabelModeFromCoreChartConfig(h['settings']['studies'])},...g['settings']['bidAsk']&&{'bidAsk':getYAxisLabelModeFromCoreChartConfig(h['settings']['bidAsk'])},...g['settings']['highLow']&&{'highLow':getYAxisLabelModeFromCoreChartConfig(h['settings']['highLow'])},...g['settings']['prevDayClose']&&{'prevDayClose':getYAxisLabelModeFromCoreChartConfig(h['settings']['prevDayClose'])},...g['settings']['prePostMarket']&&{'prePostMarket':getYAxisLabelModeFromCoreChartConfig(h['settings']['prePostMarket'])}}};}function fromLocalLabelsConfigToCoreChartSettings(g,h){const i={'lastPrice':{'mode':h['labels']['lastPrice']},'countdownToBarClose':{'mode':h['countDownToBarClose']?'label':'none'},...h['labels']['bidAsk']&&{'bidAsk':{'mode':h['labels']['bidAsk']}},...h['labels']['studies']&&{'studies':{'mode':h['labels']['studies']}},...h['labels']['highLow']&&{'highLow':{'mode':h['labels']['highLow']}},...h['labels']['prevDayClose']&&{'prevDayClose':{'mode':h['labels']['prevDayClose']}},...h['labels']['prePostMarket']&&{'prePostMarket':{'mode':h['labels']['prePostMarket']}}},j={...g['chartCore']['components']['yAxis']['labels'],'descriptions':h['descriptions'],'settings':i};return labelsConfigLens['set'](j)({...g});}const labelsConfigLens=Lens['fromPath']()(['chartCore','components','yAxis','labels']),getAxisFit=(f,g,h)=>{switch(g){case'studies':{return{...f['settings']['chartReact']['scale']['fit'],'studies':h};}case'orders':{return{...f['settings']['chartReact']['scale']['fit'],'orders':h};}case'positions':default:{return{...f['settings']['chartReact']['scale']['fit'],'positions':h};}}};function getYAxisLabelModeFromCoreChartConfig(d){return pipe(option['fromNullable'](d),option['getOrElse'](()=>({'mode':'none'})),e=>e['mode']);}