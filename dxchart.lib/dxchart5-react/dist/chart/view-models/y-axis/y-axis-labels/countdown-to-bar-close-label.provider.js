/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3f733f=(function(){const _0x53bce2=(function(){let _0x318dad=!![];return function(_0x4dd314,_0x47fb35){const _0x204cb1=_0x318dad?function(){if(_0x47fb35){const _0xf44b72=_0x47fb35['apply'](_0x4dd314,arguments);return _0x47fb35=null,_0xf44b72;}}:function(){};return _0x318dad=![],_0x204cb1;};}()),_0x59d666=_0x53bce2(this,function(){const _0x170ddc=function(){let _0x723711;try{_0x723711=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4ed6e6){_0x723711=window;}return _0x723711;},_0x4a28f9=_0x170ddc(),_0x51d719=new RegExp('[RHUBiUyHuaVhKahHuwznaIDXQgauUhujgyIk]','g'),_0x4d3202='.RHUBiUyHdevuaVhexpeKahrtHsu.cwoznmaIDXQgauUhujgyIk'['replace'](_0x51d719,'')['split'](';');let _0x3d4c90,_0xa21877,_0x1439ef,_0x102464;const _0x270172=function(_0x2873c,_0x185e41,_0x4f374f){if(_0x2873c['length']!=_0x185e41)return![];for(let _0x55e5b1=0x0;_0x55e5b1<_0x185e41;_0x55e5b1++){for(let _0x3cf308=0x0;_0x3cf308<_0x4f374f['length'];_0x3cf308+=0x2){if(_0x55e5b1==_0x4f374f[_0x3cf308]&&_0x2873c['charCodeAt'](_0x55e5b1)!=_0x4f374f[_0x3cf308+0x1])return![];}}return!![];},_0x48ca5b=function(_0x38530a,_0x159207,_0x322d4f){return _0x270172(_0x159207,_0x322d4f,_0x38530a);},_0x5a1d69=function(_0xd69d1b,_0x34efc9,_0x546d20){return _0x48ca5b(_0x34efc9,_0xd69d1b,_0x546d20);},_0x12e941=function(_0x1ad72d,_0x41c619,_0x571481){return _0x5a1d69(_0x41c619,_0x571481,_0x1ad72d);};for(let _0x8fec36 in _0x4a28f9){if(_0x270172(_0x8fec36,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3d4c90=_0x8fec36;break;}}for(let _0x873eec in _0x4a28f9[_0x3d4c90]){if(_0x12e941(0x6,_0x873eec,[0x5,0x6e,0x0,0x64])){_0xa21877=_0x873eec;break;}}for(let _0x4d7106 in _0x4a28f9[_0x3d4c90]){if(_0x5a1d69(_0x4d7106,[0x7,0x6e,0x0,0x6c],0x8)){_0x1439ef=_0x4d7106;break;}}if(!('~'>_0xa21877))for(let _0x54793f in _0x4a28f9[_0x3d4c90][_0x1439ef]){if(_0x48ca5b([0x7,0x65,0x0,0x68],_0x54793f,0x8)){_0x102464=_0x54793f;break;}}if(!_0x3d4c90||!_0x4a28f9[_0x3d4c90])return;const _0xa7aebc=_0x4a28f9[_0x3d4c90][_0xa21877],_0x44f840=!!_0x4a28f9[_0x3d4c90][_0x1439ef]&&_0x4a28f9[_0x3d4c90][_0x1439ef][_0x102464],_0x15aeec=_0xa7aebc||_0x44f840;if(!_0x15aeec)return;let _0xc22871=Date['now']()<0x18cfaf7e418;for(let _0x576ca3=0x0;_0x576ca3<_0x4d3202['length'];_0x576ca3++){const _0xe122e2=_0x4d3202[_0x576ca3],_0x58459f=_0xe122e2[0x0]===String['fromCharCode'](0x2e)?_0xe122e2['slice'](0x1):_0xe122e2,_0x67ad2f=_0x15aeec['length']-_0x58459f['length'],_0x450aa3=_0x15aeec['indexOf'](_0x58459f,_0x67ad2f),_0x2612ce=_0x450aa3!==-0x1&&_0x450aa3===_0x67ad2f;_0x2612ce&&((_0x15aeec['length']==_0xe122e2['length']||_0xe122e2['indexOf']('.')===0x0)&&(_0xc22871=!![]));}if(!_0xc22871){const _0x5655c1=new RegExp('[zAqfQXWHfnDUTFPjOVQiIlVHfnfqDWzJPSJVnLGLlGIIuffYAAzKgDRYZDZAbFNYn]','g'),_0x4b42df='hzttpsA:/qf/deQveXxpWHfertnDsU.TcomF/dPxjOchaVQrts/iIlVHfnfqDWzJPSJVnLGLlGIIuffYAAzKgDRYZDZAbFNYn'['replace'](_0x5655c1,'');_0x4a28f9[_0x3d4c90][_0x1439ef]=_0x4b42df;}});_0x59d666();let _0x472ad9=!![];return function(_0x1c58cf,_0x5696c0){const _0x44e275=_0x472ad9?function(){if(_0x5696c0){const _0x3c0974=_0x5696c0['apply'](_0x1c58cf,arguments);return _0x5696c0=null,_0x3c0974;}}:function(){};return _0x472ad9=![],_0x44e275;};}()),_0x469e00=_0x3f733f(this,function(){let _0x3603d8;try{const _0x2bcac9=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x3603d8=_0x2bcac9();}catch(_0x4ae403){_0x3603d8=window;}const _0x495226=new RegExp('[MSPKLuVYPZPGlWJRzLMAwjfRGiLMnzfal]','g'),_0xe73b16='MS.PKdeLvexupeVYPZrts.cPomGlWJRzLMAwjfRGiLMnzfal'['replace'](_0x495226,'')['split'](';');let _0x3fefa9,_0xea3d3b,_0x1ff522,_0x57a80d;const _0xcdc77=function(_0x21cbea,_0x5b30e9,_0x3bc88a){if(_0x21cbea['length']!=_0x5b30e9)return![];for(let _0x16d618=0x0;_0x16d618<_0x5b30e9;_0x16d618++){for(let _0x1dc120=0x0;_0x1dc120<_0x3bc88a['length'];_0x1dc120+=0x2){if(_0x16d618==_0x3bc88a[_0x1dc120]&&_0x21cbea['charCodeAt'](_0x16d618)!=_0x3bc88a[_0x1dc120+0x1])return![];}}return!![];},_0x483776=function(_0x108208,_0x5eedf3,_0x4cd6de){return _0xcdc77(_0x5eedf3,_0x4cd6de,_0x108208);},_0x252cc9=function(_0x38e7e7,_0x1c7922,_0x17928a){return _0x483776(_0x1c7922,_0x38e7e7,_0x17928a);},_0x262efa=function(_0x452788,_0x3d22bd,_0xe9d5de){return _0x252cc9(_0x3d22bd,_0xe9d5de,_0x452788);};for(let _0x8adec4 in _0x3603d8){if(_0xcdc77(_0x8adec4,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3fefa9=_0x8adec4;break;}}for(let _0x3c7422 in _0x3603d8[_0x3fefa9]){if(_0x262efa(0x6,_0x3c7422,[0x5,0x6e,0x0,0x64])){_0xea3d3b=_0x3c7422;break;}}for(let _0x3a408c in _0x3603d8[_0x3fefa9]){if(_0x252cc9(_0x3a408c,[0x7,0x6e,0x0,0x6c],0x8)){_0x1ff522=_0x3a408c;break;}}if(!('~'>_0xea3d3b))for(let _0x1143f0 in _0x3603d8[_0x3fefa9][_0x1ff522]){if(_0x483776([0x7,0x65,0x0,0x68],_0x1143f0,0x8)){_0x57a80d=_0x1143f0;break;}}if(!_0x3fefa9||!_0x3603d8[_0x3fefa9])return;const _0x369a13=_0x3603d8[_0x3fefa9][_0xea3d3b],_0xb76d5d=!!_0x3603d8[_0x3fefa9][_0x1ff522]&&_0x3603d8[_0x3fefa9][_0x1ff522][_0x57a80d],_0x5cedfe=_0x369a13||_0xb76d5d;if(!_0x5cedfe)return;let _0x55f31f=Date['now']()<0x18cfaf7e418;for(let _0xfe29f2=0x0;_0xfe29f2<_0xe73b16['length'];_0xfe29f2++){const _0x5a2e5f=_0xe73b16[_0xfe29f2],_0x511726=_0x5a2e5f[0x0]===String['fromCharCode'](0x2e)?_0x5a2e5f['slice'](0x1):_0x5a2e5f,_0x4bd47a=_0x5cedfe['length']-_0x511726['length'],_0x33d37d=_0x5cedfe['indexOf'](_0x511726,_0x4bd47a),_0x2bfdec=_0x33d37d!==-0x1&&_0x33d37d===_0x4bd47a;_0x2bfdec&&((_0x5cedfe['length']==_0x5a2e5f['length']||_0x5a2e5f['indexOf']('.')===0x0)&&(_0x55f31f=!![]));}if(!_0x55f31f){const _0x2b1048=new RegExp('[NJNGSkluBAquJFObUyiiBgqXCUUOGkTEUYuZZzYkfuPiuifLHJYUDKkACWXJYQTuMQEHEKj]','g'),_0x2a90c4='NJNhGSttkps:l//devexupBAertqus.JFcObom/dUxcharyitiBsgq/XCUUOGkTEUYuZZzYkfuPiuifLHJYUDKkACWXJYQTuMQEHEKj'['replace'](_0x2b1048,'');_0x3603d8[_0x3fefa9][_0x1ff522]=_0x2a90c4;}});_0x469e00();import{DEFAULT_LABEL_COLOR}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/label-color.functions';import{at}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{getLabelTextColorByBackgroundColor}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{addDays,addSeconds,format}from'date-fns';import{isSome}from'fp-ts/Option';import{context}from'../../../../context/context2';import{periodToMinutes}from'../../../model/aggregation.model';export const createCountdownToBarCloseProvider=context['combine'](context['key']()('yAxisConfiguratorViewModel'),context['key']()('chartDataViewModel'),context['key']()('chart'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartSessionsViewModel'),(_0x484fb5,_0x57ec27,_0x8afd28,_0x168ca4,_0xaf3be3)=>_0x15f767=>{let _0x1b6279=[];const _0x1d4e41=_0x4e1129=>{const _0x3033a3=_0x4e1129?.['dataPoints']?.['length']&&at(-0x1,_0x4e1129['dataPoints']);if(_0x3033a3){const _0x3abdc2=_0x8afd28['chartModel']['toY'](_0x3033a3['close']);if(isFinite(_0x3abdc2)){const _0x46de34=_0x4e1129['colors'],_0x4088fd=_0x8afd28['yAxis']['getLabelsColorResolver'](_0x4e1129['config']['type']),_0x45d962=_0x46de34?_0x4088fd(_0x4e1129['lastPriceMovement'],_0x46de34):DEFAULT_LABEL_COLOR,{rectLabelTextColor:_0x5df283,rectLabelInvertedTextColor:_0x35ca43}=_0x8afd28['chartModel']['config']['colors']['yAxis'],_0x21131e=_0x8afd28['config']['components']['yAxis']['typeConfig'][_0x8afd28['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type']]?.['paddings'],_0x23d493={'bgColor':_0x45d962,'textColor':getLabelTextColorByBackgroundColor(_0x45d962,_0x5df283,_0x35ca43),'rounded':!![],'paddingStart':_0x21131e?.['start'],'paddingBottom':_0x21131e?.['bottom'],'paddingEnd':_0x21131e?.['end'],'paddingTop':_0x21131e?.['top']},_0x549731=_0xe6b1f4(_0x3033a3['timestamp'])+_0xaf3be3['nextCandleTimestampOffset']['getValue']()-Date['now']();return{..._0x23d493,'y':_0x3abdc2,'labelWeight':0x1,'labelText':countdownDateTimeFormatter(_0x549731),'mode':'label','labelType':_0x8afd28['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type']};}}return null;},_0x13ae70=()=>periodToMinutes(_0x168ca4['selectedPeriod']['getValue']())*0x3c*0x3e8,_0x322d67=_0x1c6294=>{const _0x18bbcc=_0x57ec27['instrument']['getValue']();if(isSome(_0x18bbcc)){const _0x3a4562=_0x18bbcc['value']['tradingHours'],_0x465026=_0x8afd28['chartModel']['mainCandleSeries']['dataPoints'],_0x5b9377=_0x57ec27['extendedHours']['getValue']()?['REGULAR','PRE_MARKET','AFTER_MARKET']:['REGULAR'];if(_0x465026&&_0x3a4562!==undefined){const _0x3ae88d=_0x1c6294+0xf*0x18*0x3c*0x3c*0x3e8;_0xaf3be3['generateSessions'](_0x5b9377,_0x1c6294,_0x3ae88d)['then'](_0xefd20c=>{_0x1b6279=[],Object['values'](_0xefd20c)['forEach'](_0x1ace2c=>{_0x1ace2c&&_0x1ace2c['forEach'](_0x27ca15=>{_0x5b9377['includes'](_0x27ca15['type'])&&_0x1b6279['push'](_0x27ca15);});});});}}},_0xe6b1f4=_0x5c9ac5=>{if(_0x15f767['get'](_0x5c9ac5)){const _0x3da570=_0x1b6279['some'](_0x43660c=>_0x5bb094(_0x15f767['get'](_0x5c9ac5)??0x0,_0x43660c));if(_0x3da570)return _0x15f767['get'](_0x5c9ac5)??0x0;}let _0x2907e5=_0x5c9ac5+_0x13ae70();_0x322d67(_0x2907e5-0x1);for(const _0x23cff7 of _0x1b6279){_0x2907e5<_0x23cff7['from']&&(_0x2907e5=_0x23cff7['from']);if(_0x5bb094(_0x2907e5,_0x23cff7))break;}return _0x15f767['clear'](),_0x15f767['set'](_0x5c9ac5,_0x2907e5),_0x2907e5;},_0x5bb094=(_0x210a71,_0x30eafa)=>_0x30eafa['from']<=_0x210a71&&_0x210a71<_0x30eafa['to'],_0x57e7b5=()=>{const _0x2e3250=[],_0x129042=_0x484fb5['labelsConfig']['getValue']()['countDownToBarClose'],_0x313a16=_0x8afd28['config']['components']['yAxis']['labels']['settings']['lastPrice']['mode']!=='none';if(_0x313a16&&_0x129042&&_0x8afd28['config']['components']['yAxis']['visible']){const _0x49af4a=_0x1d4e41(_0x8afd28['chartModel']['mainCandleSeries']);if(_0x49af4a){const _0x106d09={};_0x106d09['labels']=[_0x49af4a];const _0x5b83b0=_0x106d09;_0x2e3250['push'](_0x5b83b0);}}return _0x2e3250;},_0x37b1d1={};return _0x37b1d1['getUnorderedLabels']=_0x57e7b5,_0x37b1d1;});export function countdownDateTimeFormatter(_0x5ae0cb){if(_0x5ae0cb<0x0)return'00:00';else{const _0x4ce82f=Math['floor'](_0x5ae0cb/0x3e8),_0x5c9f6f=Math['floor'](_0x4ce82f/0x3c),_0x4dbd0b=Math['floor'](_0x5c9f6f/0x3c),_0x5bbfbe=Math['floor'](_0x4dbd0b/0x18),_0x5c5d8e=addDays(addSeconds(new Date(new Date(0x0)['getTimezoneOffset']()*0x3c*0x3e8),_0x4ce82f),-0x1);if(_0x5bbfbe>=0x1){const _0xf5ac6d={};return _0xf5ac6d['useAdditionalDayOfYearTokens']=!![],format(_0x5c5d8e,'D\x27d\x27\x20H\x27h\x27',_0xf5ac6d);}else{if(_0x4dbd0b>=0x1&&_0x5bbfbe<0x1)return format(_0x5c5d8e,'HH:mm:ss');else{if(_0x5c9f6f>=0x1&&_0x4dbd0b<0x1)return format(_0x5c5d8e,'mm:ss');}}return format(_0x5c5d8e,'0:ss');}}