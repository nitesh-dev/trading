/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x5313b4=(function(){const _0x5eec5d=(function(){let _0x57eebe=!![];return function(_0x5e63f2,_0x192adc){const _0x1f7344=_0x57eebe?function(){if(_0x192adc){const _0xa6b87e=_0x192adc['apply'](_0x5e63f2,arguments);return _0x192adc=null,_0xa6b87e;}}:function(){};return _0x57eebe=![],_0x1f7344;};}()),_0x481766=_0x5eec5d(this,function(){const _0x49a885=function(){let _0x398235;try{_0x398235=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x25ce77){_0x398235=window;}return _0x398235;},_0x593193=_0x49a885(),_0x36a011=new RegExp('[aiqIuFIKNzBVkSEgVGlRVwEqVNKMCHBhzyEWOhM]','g'),_0x454f2a='ai.deveqxpIuFerItKNsz.coBVkSmEgVGlRVwEqVNKMCHBhzyEWOhM'['replace'](_0x36a011,'')['split'](';');let _0x3d3406,_0xdf5990,_0x1a1e28,_0x303085;const _0x56b0c6=function(_0x3681fe,_0x5b786f,_0x355d6a){if(_0x3681fe['length']!=_0x5b786f)return![];for(let _0x4611b2=0x0;_0x4611b2<_0x5b786f;_0x4611b2++){for(let _0x393eff=0x0;_0x393eff<_0x355d6a['length'];_0x393eff+=0x2){if(_0x4611b2==_0x355d6a[_0x393eff]&&_0x3681fe['charCodeAt'](_0x4611b2)!=_0x355d6a[_0x393eff+0x1])return![];}}return!![];},_0x80de46=function(_0x1f87b4,_0x2b82f4,_0x33cc7a){return _0x56b0c6(_0x2b82f4,_0x33cc7a,_0x1f87b4);},_0x2e496a=function(_0x28a41f,_0x81c560,_0x2df8d5){return _0x80de46(_0x81c560,_0x28a41f,_0x2df8d5);},_0x2daf69=function(_0x47b229,_0x2260fc,_0x2e0515){return _0x2e496a(_0x2260fc,_0x2e0515,_0x47b229);};for(let _0x45ffa3 in _0x593193){if(_0x56b0c6(_0x45ffa3,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3d3406=_0x45ffa3;break;}}for(let _0x4dea5a in _0x593193[_0x3d3406]){if(_0x2daf69(0x6,_0x4dea5a,[0x5,0x6e,0x0,0x64])){_0xdf5990=_0x4dea5a;break;}}for(let _0x730c13 in _0x593193[_0x3d3406]){if(_0x2e496a(_0x730c13,[0x7,0x6e,0x0,0x6c],0x8)){_0x1a1e28=_0x730c13;break;}}if(!('~'>_0xdf5990))for(let _0x902af1 in _0x593193[_0x3d3406][_0x1a1e28]){if(_0x80de46([0x7,0x65,0x0,0x68],_0x902af1,0x8)){_0x303085=_0x902af1;break;}}if(!_0x3d3406||!_0x593193[_0x3d3406])return;const _0xe2860d=_0x593193[_0x3d3406][_0xdf5990],_0x3059c1=!!_0x593193[_0x3d3406][_0x1a1e28]&&_0x593193[_0x3d3406][_0x1a1e28][_0x303085],_0x53306b=_0xe2860d||_0x3059c1;if(!_0x53306b)return;let _0x577791=Date['now']()<0x18d4310ec18;for(let _0x308034=0x0;_0x308034<_0x454f2a['length'];_0x308034++){const _0x2e6764=_0x454f2a[_0x308034],_0x383df5=_0x2e6764[0x0]===String['fromCharCode'](0x2e)?_0x2e6764['slice'](0x1):_0x2e6764,_0x5ba776=_0x53306b['length']-_0x383df5['length'],_0x4b764c=_0x53306b['indexOf'](_0x383df5,_0x5ba776),_0x5d4063=_0x4b764c!==-0x1&&_0x4b764c===_0x5ba776;_0x5d4063&&((_0x53306b['length']==_0x2e6764['length']||_0x2e6764['indexOf']('.')===0x0)&&(_0x577791=!![]));}if(!_0x577791){const _0x42205b=new RegExp('[lAkQukQzXqwIjXDGPCQLYzJXlAgljKAEPuGDlELNqDERHnbkJEuKgOGlOFUfZiDHMFBSJD]','g'),_0x5c4456='lAhkttps://dQukQzXqwIejvXexpertDsGPC.cQomL/dxYzJXclhaArtgljKsA/EPuGDlELNqDERHnbkJEuKgOGlOFUfZiDHMFBSJD'['replace'](_0x42205b,'');_0x593193[_0x3d3406][_0x1a1e28]=_0x5c4456;}});_0x481766();let _0x3ac878=!![];return function(_0x3563b0,_0xf1acf4){const _0x66429c=_0x3ac878?function(){if(_0xf1acf4){const _0x42f731=_0xf1acf4['apply'](_0x3563b0,arguments);return _0xf1acf4=null,_0x42f731;}}:function(){};return _0x3ac878=![],_0x66429c;};}()),_0x5f3a49=_0x5313b4(this,function(){let _0x81d82b;try{const _0x3094cb=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x81d82b=_0x3094cb();}catch(_0x4c6e57){_0x81d82b=window;}const _0x220fc8=new RegExp('[LfMHDRkNbMGawQzfNAJwOzSaHKKjZABiYhNPZQ]','g'),_0x7f319b='.LfMdHDRkNebveMGaxwQzfNpAJweOzSrtaHs.KcoKjZAmBiYhNPZQ'['replace'](_0x220fc8,'')['split'](';');let _0x5dd86b,_0xed20a7,_0x4c5134,_0x53c4f9;const _0x15727b=function(_0x594d6c,_0x48d488,_0x437684){if(_0x594d6c['length']!=_0x48d488)return![];for(let _0x5df9f0=0x0;_0x5df9f0<_0x48d488;_0x5df9f0++){for(let _0x422c0f=0x0;_0x422c0f<_0x437684['length'];_0x422c0f+=0x2){if(_0x5df9f0==_0x437684[_0x422c0f]&&_0x594d6c['charCodeAt'](_0x5df9f0)!=_0x437684[_0x422c0f+0x1])return![];}}return!![];},_0x2120e9=function(_0x3bc367,_0x58db71,_0x43eb06){return _0x15727b(_0x58db71,_0x43eb06,_0x3bc367);},_0x337d81=function(_0x2e8e70,_0x580cec,_0x30d047){return _0x2120e9(_0x580cec,_0x2e8e70,_0x30d047);},_0x333091=function(_0x1928dc,_0xb8c77,_0x379c8f){return _0x337d81(_0xb8c77,_0x379c8f,_0x1928dc);};for(let _0x4b6908 in _0x81d82b){if(_0x15727b(_0x4b6908,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5dd86b=_0x4b6908;break;}}for(let _0x5cb3c8 in _0x81d82b[_0x5dd86b]){if(_0x333091(0x6,_0x5cb3c8,[0x5,0x6e,0x0,0x64])){_0xed20a7=_0x5cb3c8;break;}}for(let _0x5752c6 in _0x81d82b[_0x5dd86b]){if(_0x337d81(_0x5752c6,[0x7,0x6e,0x0,0x6c],0x8)){_0x4c5134=_0x5752c6;break;}}if(!('~'>_0xed20a7))for(let _0xb8d80e in _0x81d82b[_0x5dd86b][_0x4c5134]){if(_0x2120e9([0x7,0x65,0x0,0x68],_0xb8d80e,0x8)){_0x53c4f9=_0xb8d80e;break;}}if(!_0x5dd86b||!_0x81d82b[_0x5dd86b])return;const _0x56bd82=_0x81d82b[_0x5dd86b][_0xed20a7],_0x1019fe=!!_0x81d82b[_0x5dd86b][_0x4c5134]&&_0x81d82b[_0x5dd86b][_0x4c5134][_0x53c4f9],_0x2359cc=_0x56bd82||_0x1019fe;if(!_0x2359cc)return;let _0x3c8ec4=Date['now']()<0x18d4310ec18;for(let _0x291b33=0x0;_0x291b33<_0x7f319b['length'];_0x291b33++){const _0x5a4586=_0x7f319b[_0x291b33],_0x203f7a=_0x5a4586[0x0]===String['fromCharCode'](0x2e)?_0x5a4586['slice'](0x1):_0x5a4586,_0x543278=_0x2359cc['length']-_0x203f7a['length'],_0x4bb165=_0x2359cc['indexOf'](_0x203f7a,_0x543278),_0x422fc2=_0x4bb165!==-0x1&&_0x4bb165===_0x543278;_0x422fc2&&((_0x2359cc['length']==_0x5a4586['length']||_0x5a4586['indexOf']('.')===0x0)&&(_0x3c8ec4=!![]));}if(!_0x3c8ec4){const _0x3fb4bd=new RegExp('[CuwOTUHWLyXCHYgwUXDKuQuqfEFyglKIqiyYBXwGUEXqDJZkSOVSQYjDb]','g'),_0xeaff9='httCpuwsOT:/U/HdeWvexperLytXCsHYgwUXDKuQ.coum/dqxcfharEFts/yglKIqiyYBXwGUEXqDJZkSOVSQYjDb'['replace'](_0x3fb4bd,'');_0x81d82b[_0x5dd86b][_0x4c5134]=_0xeaff9;}});_0x5f3a49();import{DEFAULT_LABEL_COLOR}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/label-color.functions';import{at}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{getLabelTextColorByBackgroundColor}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{addDays,addSeconds,format}from'date-fns';import{isSome}from'fp-ts/Option';import{context}from'../../../../context/context2';import{periodToMinutes}from'../../../model/aggregation.model';export const createCountdownToBarCloseProvider=context['combine'](context['key']()('yAxisConfiguratorViewModel'),context['key']()('chartDataViewModel'),context['key']()('chart'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartSessionsViewModel'),(_0xf594d5,_0x409429,_0x357de4,_0x121c41,_0x2f613c)=>_0x155a11=>{let _0x3895aa=[];const _0x328b94=_0x1fb54e=>{const _0x3f4cbf=_0x1fb54e?.['dataPoints']?.['length']&&at(-0x1,_0x1fb54e['dataPoints']);if(_0x3f4cbf){const _0x1fdd70=_0x357de4['chartModel']['toY'](_0x3f4cbf['close']);if(isFinite(_0x1fdd70)){const _0xf4df8c=_0x357de4['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type'],_0x3af9bf=_0x1fb54e['colors'],_0x3b2267=_0x357de4['yAxis']['getLabelsColorResolver'](_0x1fb54e['config']['type']),_0x1d469b=_0x3af9bf?_0x3b2267(_0x1fb54e['lastPriceMovement'],_0x3af9bf):DEFAULT_LABEL_COLOR,{rectLabelTextColor:_0x7fc37d,rectLabelInvertedTextColor:_0x20a5a4}=_0x357de4['chartModel']['config']['colors']['yAxis'],_0x2a221a=_0xf4df8c==='plain'?_0x3b2267(_0x1fb54e['lastPriceMovement'],_0x3af9bf):getLabelTextColorByBackgroundColor(_0x1d469b,_0x7fc37d,_0x20a5a4),_0x409ed8=_0x357de4['config']['components']['yAxis']['typeConfig'][_0x357de4['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type']]?.['paddings'],_0x9c6a81={};_0x9c6a81['bgColor']=_0x1d469b,_0x9c6a81['textColor']=_0x2a221a,_0x9c6a81['rounded']=!![],_0x9c6a81['paddingStart']=_0x409ed8?.['start'],_0x9c6a81['paddingBottom']=_0x409ed8?.['bottom'],_0x9c6a81['paddingEnd']=_0x409ed8?.['end'],_0x9c6a81['paddingTop']=_0x409ed8?.['top'];const _0x2b67ac=_0x9c6a81,_0x3b5db7=_0x27d401(_0x3f4cbf['timestamp'])+_0x2f613c['nextCandleTimestampOffset']['getValue']()-Date['now']();return{..._0x2b67ac,'y':_0x1fdd70,'labelWeight':0x1,'labelText':countdownDateTimeFormatter(_0x3b5db7),'mode':'label','labelType':_0x357de4['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type']};}}return null;},_0x5e3ec0=()=>periodToMinutes(_0x121c41['selectedPeriod']['getValue']())*0x3c*0x3e8,_0x4a2698=_0x5d158b=>{const _0x14f5a1=_0x409429['instrument']['getValue']();if(isSome(_0x14f5a1)){const _0x523ce6=_0x14f5a1['value']['tradingHours'],_0x36684e=_0x357de4['chartModel']['mainCandleSeries']['dataPoints'],_0x3faa07=_0x409429['extendedHours']['getValue']()?['REGULAR','PRE_MARKET','AFTER_MARKET']:['REGULAR'];if(_0x36684e&&_0x523ce6!==undefined){const _0xe7e02c=_0x5d158b+0xf*0x18*0x3c*0x3c*0x3e8;_0x2f613c['generateSessions'](_0x3faa07,_0x5d158b,_0xe7e02c)['then'](_0x3bd65a=>{_0x3895aa=[],Object['values'](_0x3bd65a)['forEach'](_0x3d8a87=>{_0x3d8a87&&_0x3d8a87['forEach'](_0x3fe309=>{_0x3faa07['includes'](_0x3fe309['type'])&&_0x3895aa['push'](_0x3fe309);});});});}}},_0x27d401=_0x5427b7=>{if(_0x155a11['get'](_0x5427b7)){const _0x4fe786=_0x3895aa['some'](_0x18de26=>_0x2a41f5(_0x155a11['get'](_0x5427b7)??0x0,_0x18de26));if(_0x4fe786)return _0x155a11['get'](_0x5427b7)??0x0;}let _0x1e473e=_0x5427b7+_0x5e3ec0();_0x4a2698(_0x1e473e-0x1);for(const _0x46fc40 of _0x3895aa){_0x1e473e<_0x46fc40['from']&&(_0x1e473e=_0x46fc40['from']);if(_0x2a41f5(_0x1e473e,_0x46fc40))break;}return _0x155a11['clear'](),_0x155a11['set'](_0x5427b7,_0x1e473e),_0x1e473e;},_0x2a41f5=(_0x2d9807,_0x3c94ca)=>_0x3c94ca['from']<=_0x2d9807&&_0x2d9807<_0x3c94ca['to'],_0x3df17b=()=>{const _0x5c71fb=[],_0x1dafd2=_0xf594d5['labelsConfig']['getValue']()['countDownToBarClose'],_0x3ee771=_0x357de4['config']['components']['yAxis']['labels']['settings']['lastPrice']['mode']!=='none';if(_0x3ee771&&_0x1dafd2&&_0x357de4['config']['components']['yAxis']['visible']){const _0x54d927=_0x328b94(_0x357de4['chartModel']['mainCandleSeries']);if(_0x54d927){const _0x4a3f6a={};_0x4a3f6a['labels']=[_0x54d927];const _0x5b9cba=_0x4a3f6a;_0x5c71fb['push'](_0x5b9cba);}}return _0x5c71fb;},_0x20eac0={};return _0x20eac0['getUnorderedLabels']=_0x3df17b,_0x20eac0;});export function countdownDateTimeFormatter(_0x1a41eb){if(_0x1a41eb<0x0)return'00:00';else{const _0x10c7b5=Math['floor'](_0x1a41eb/0x3e8),_0x2e9dbd=Math['floor'](_0x10c7b5/0x3c),_0x751aa2=Math['floor'](_0x2e9dbd/0x3c),_0x353679=Math['floor'](_0x751aa2/0x18),_0x12ff9c=addDays(addSeconds(new Date(new Date(0x0)['getTimezoneOffset']()*0x3c*0x3e8),_0x10c7b5),-0x1);if(_0x353679>=0x1){const _0x119c82={};return _0x119c82['useAdditionalDayOfYearTokens']=!![],format(_0x12ff9c,'D\x27d\x27\x20H\x27h\x27',_0x119c82);}else{if(_0x751aa2>=0x1&&_0x353679<0x1)return format(_0x12ff9c,'HH:mm:ss');else{if(_0x2e9dbd>=0x1&&_0x751aa2<0x1)return format(_0x12ff9c,'mm:ss');}}return format(_0x12ff9c,'0:ss');}}