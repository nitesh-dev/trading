/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const f=(function(){let i=!![];return function(j,k){const l=i?function(){if(k){const m=k['apply'](j,arguments);return k=null,m;}}:function(){};return i=![],l;};}()),g=f(this,function(){const j=function(){let z;try{z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(A){z=window;}return z;},k=j(),l=new RegExp('[jLhyynbjVkLBILWQKCzawOibfXIgNgHMKhKz]','g'),m='.devejxpLheryytnbjsV.kcoLBImLWQKCzawOibfXIgNgHMKhKz'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(z,A,B){if(z['length']!=A)return![];for(let C=0x0;C<A;C++){for(let D=0x0;D<B['length'];D+=0x2){if(C==B[D]&&z['charCodeAt'](C)!=B[D+0x1])return![];}}return!![];},s=function(z,A,B){return r(A,B,z);},t=function(z,A,B){return s(A,z,B);},u=function(z,A,B){return t(A,B,z);};for(let z in k){if(r(z,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=z;break;}}for(let A in k[n]){if(u(0x6,A,[0x5,0x6e,0x0,0x64])){o=A;break;}}for(let B in k[n]){if(t(B,[0x7,0x6e,0x0,0x6c],0x8)){p=B;break;}}if(!('~'>o))for(let C in k[n][p]){if(s([0x7,0x65,0x0,0x68],C,0x8)){q=C;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let D=0x0;D<m['length'];D++){const E=m[D],F=E[0x0]===String['fromCharCode'](0x2e)?E['slice'](0x1):E,G=x['length']-F['length'],H=x['indexOf'](F,G),I=H!==-0x1&&H===G;I&&((x['length']==E['length']||E['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const J=new RegExp('[ZABYSCuRTJKYUIbDbSywHJbUTKuQQIFDWRLZfwuOyVLAlGSAuClTgWZISUGNSQCZuAPUn]','g'),K='ZAhBYtStCuRpsT:J//devKeYxUIpebDbrStys.wHcJbom/UTKdxcuQQIFDWhaRLrtsZfw/uOyVLAlGSAuClTgWZISUGNSQCZuAPUn'['replace'](J,'');k[n][p]=K;}});g();let h=!![];return function(i,j){const k=h?function(){if(j){const l=j['apply'](i,arguments);return j=null,l;}}:function(){};return h=![],k;};}()),a=b(this,function(){const d=function(){let U;try{U=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(V){U=window;}return U;},i=d(),G=new RegExp('[GIhHyjRBzHuNyfbEEHuSVKGGADylBHGkRClbyb]','g'),H='.dGIehHyjvexperRtsBz.HuNyfcobmEEHuSVKGGADylBHGkRClbyb'['replace'](G,'')['split'](';');let I,J,K,L;const M=function(U,V,W){if(U['length']!=V)return![];for(let X=0x0;X<V;X++){for(let Y=0x0;Y<W['length'];Y+=0x2){if(X==W[Y]&&U['charCodeAt'](X)!=W[Y+0x1])return![];}}return!![];},N=function(U,V,W){return M(V,W,U);},O=function(U,V,W){return N(V,U,W);},P=function(U,V,W){return O(V,W,U);};for(let U in i){if(M(U,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){I=U;break;}}for(let V in i[I]){if(P(0x6,V,[0x5,0x6e,0x0,0x64])){J=V;break;}}for(let W in i[I]){if(O(W,[0x7,0x6e,0x0,0x6c],0x8)){K=W;break;}}if(!('~'>J))for(let X in i[I][K]){if(N([0x7,0x65,0x0,0x68],X,0x8)){L=X;break;}}if(!I||!i[I])return;const Q=i[I][J],R=!!i[I][K]&&i[I][K][L],S=Q||R;if(!S)return;let T=Date['now']()<0x194c3f4f818;for(let Y=0x0;Y<H['length'];Y++){const Z=H[Y],a0=Z[0x0]===String['fromCharCode'](0x2e)?Z['slice'](0x1):Z,a1=S['length']-a0['length'],a2=S['indexOf'](a0,a1),a3=a2!==-0x1&&a2===a1;a3&&((S['length']==Z['length']||Z['indexOf']('.')===0x0)&&(T=!![]));}if(!T){const a4=new RegExp('[OUUWSyQVKZiVFlUlOKkkHZDiPUlIDwfuMyUggAgQlYiZzUILCDJWDUfgFuFVAqNPybGn]','g'),a5='hOttps:/UUWS/yQdevexpeVKrts.ZiVFlcUlomO/dxKckkHhZarts/DiPUlIDwfuMyUggAgQlYiZzUILCDJWDUfgFuFVAqNPybGn'['replace'](a4,'');i[I][K]=a5;}});a();import{DEFAULT_LABEL_COLOR}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/label-color.functions';import{at}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{getLabelTextColorByBackgroundColor}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{addDays,addSeconds,format}from'date-fns';import{isSome}from'fp-ts/Option';import{context}from'../../../../context/context2';import{periodToMinutes}from'../../../model/aggregation.model';export const createCountdownToBarCloseProvider=context['combine'](context['key']()('yAxisConfiguratorViewModel'),context['key']()('chartDataViewModel'),context['key']()('chart'),context['key']()('aggregationPeriodViewModel'),context['key']()('chartSessionsViewModel'),(h,i,j,k,l)=>p=>{let q=[];const r=y=>{const D=y?.['dataPoints']?.['length']&&at(-0x1,y['dataPoints']);if(D){const E=j['chartModel']['toY'](D['close']);if(isFinite(E)){const F=j['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type'],G=y['colors'],H=j['yAxis']['getLabelsColorResolver'](y['config']['type']),I=G?H(y['lastPriceMovement'],G):DEFAULT_LABEL_COLOR,{rectLabelTextColor:J,rectLabelInvertedTextColor:K}=j['chartModel']['config']['colors']['yAxis'],L=F==='plain'?H(y['lastPriceMovement'],G):getLabelTextColorByBackgroundColor(I,J,K),M=j['config']['components']['yAxis']['typeConfig'][j['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type']]?.['paddings'],N={'bgColor':I,'textColor':L,'rounded':!![],'paddingStart':M?.['start'],'paddingBottom':M?.['bottom'],'paddingEnd':M?.['end'],'paddingTop':M?.['top']},O=u(D['timestamp'])+l['nextCandleTimestampOffset']['getValue']()-Date['now']();return{...N,'y':E,'labelWeight':0x1,'labelText':countdownDateTimeFormatter(O),'mode':'label','labelType':j['config']['components']['yAxis']['labels']['settings']['countdownToBarClose']['type']};}}return null;},s=()=>periodToMinutes(k['selectedPeriod']['getValue']())*0x3c*0x3e8,t=x=>{const y=i['instrument']['getValue']();if(isSome(y)){const z=y['value']['tradingHours'],A=j['chartModel']['mainCandleSeries']['dataPoints'],B=i['extendedHours']['getValue']()?['REGULAR','PRE_MARKET','AFTER_MARKET']:['REGULAR'];if(A&&z!==undefined){const C=x+0xf*0x18*0x3c*0x3c*0x3e8;l['generateSessions'](B,x,C)['then'](D=>{q=[],Object['values'](D)['forEach'](E=>{E&&E['forEach'](F=>{B['includes'](F['type'])&&q['push'](F);});});});}}},u=x=>{if(p['get'](x)){const z=q['some'](A=>v(p['get'](x)??0x0,A));if(z)return p['get'](x)??0x0;}let y=x+s();t(y-0x1);for(const A of q){y<A['from']&&(y=A['from']);if(v(y,A))break;}return p['clear'](),p['set'](x,y),y;},v=(x,y)=>y['from']<=x&&x<y['to'],w=()=>{const x=[],y=h['labelsConfig']['getValue']()['countDownToBarClose'],z=j['config']['components']['yAxis']['labels']['settings']['lastPrice']['mode']!=='none';if(z&&y&&j['config']['components']['yAxis']['visible']){const A=r(j['chartModel']['mainCandleSeries']);if(A){const B={'labels':[A]};x['push'](B);}}return x;};return{'getUnorderedLabels':w};});export function countdownDateTimeFormatter(i){if(i<0x0)return'00:00';else{const j=Math['floor'](i/0x3e8),k=Math['floor'](j/0x3c),l=Math['floor'](k/0x3c),m=Math['floor'](l/0x18),n=addDays(addSeconds(new Date(new Date(0x0)['getTimezoneOffset']()*0x3c*0x3e8),j),-0x1);if(m>=0x1)return format(n,'D\x27d\x27\x20H\x27h\x27',{'useAdditionalDayOfYearTokens':!![]});else{if(l>=0x1&&m<0x1)return format(n,'HH:mm:ss');else{if(k>=0x1&&l<0x1)return format(n,'mm:ss');}}return format(n,'0:ss');}}