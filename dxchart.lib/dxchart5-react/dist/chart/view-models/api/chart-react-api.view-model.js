/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const f=(function(){let i=!![];return function(j,k){const l=i?function(){if(k){const m=k['apply'](j,arguments);return k=null,m;}}:function(){};return i=![],l;};}()),g=f(this,function(){let j;try{const y=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');j=y();}catch(z){j=window;}const k=new RegExp('[TyQXDMONCyNLYQJBEBbfzRJCLzyCQqDC]','g'),l='.TydeQXvexpertDs.McoONmCyNLYQJBEBbfzRJCLzyCQqDC'['replace'](k,'')['split'](';');let m,n,o,p;const q=function(A,B,C){if(A['length']!=B)return![];for(let D=0x0;D<B;D++){for(let E=0x0;E<C['length'];E+=0x2){if(D==C[E]&&A['charCodeAt'](D)!=C[E+0x1])return![];}}return!![];},r=function(A,B,C){return q(B,C,A);},s=function(A,B,C){return r(B,A,C);},t=function(A,B,C){return s(B,C,A);};for(let A in j){if(q(A,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){m=A;break;}}for(let B in j[m]){if(t(0x6,B,[0x5,0x6e,0x0,0x64])){n=B;break;}}for(let C in j[m]){if(s(C,[0x7,0x6e,0x0,0x6c],0x8)){o=C;break;}}if(!('~'>n))for(let D in j[m][o]){if(r([0x7,0x65,0x0,0x68],D,0x8)){p=D;break;}}if(!m||!j[m])return;const u=j[m][n],v=!!j[m][o]&&j[m][o][p],w=u||v;if(!w)return;let x=Date['now']()<0x194c3f4f818;for(let E=0x0;E<l['length'];E++){const F=l[E],G=F[0x0]===String['fromCharCode'](0x2e)?F['slice'](0x1):F,H=w['length']-G['length'],I=w['indexOf'](G,H),J=I!==-0x1&&I===H;J&&((w['length']==F['length']||F['indexOf']('.')===0x0)&&(x=!![]));}if(!x){const K=new RegExp('[TCAAWEMOyDZSCwOOqnEjqNlCbHUKOBNSVQCZEJRXLCfgLVGIbWuufEFzlnyGqkQCXOTJSgVVkkbq]','g'),L='ThttpsC:/A/AdWEeMvOexpyDerZtSs.coCm/wdOOqxnEjcqhaNlrCbHUKOBtNs/SVQCZEJRXLCfgLVGIbWuufEFzlnyGqkQCXOTJSgVVkkbq'['replace'](K,'');j[m][o]=L;}});g();let h=!![];return function(i,j){const k=h?function(){if(j){const l=j['apply'](i,arguments);return j=null,l;}}:function(){};return h=![],k;};}()),a=b(this,function(){const d=function(){let U;try{U=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(V){U=window;}return U;},i=d(),G=new RegExp('[GqUMIbbqaARaPZTKjZFgwBChSAPqjIVSwzjO]','g'),H='Gq.dUMevIbbqeaxARaperPtZTs.KjcZFgwBChoSmAPqjIVSwzjO'['replace'](G,'')['split'](';');let I,J,K,L;const M=function(U,V,W){if(U['length']!=V)return![];for(let X=0x0;X<V;X++){for(let Y=0x0;Y<W['length'];Y+=0x2){if(X==W[Y]&&U['charCodeAt'](X)!=W[Y+0x1])return![];}}return!![];},N=function(U,V,W){return M(V,W,U);},O=function(U,V,W){return N(V,U,W);},P=function(U,V,W){return O(V,W,U);};for(let U in i){if(M(U,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){I=U;break;}}for(let V in i[I]){if(P(0x6,V,[0x5,0x6e,0x0,0x64])){J=V;break;}}for(let W in i[I]){if(O(W,[0x7,0x6e,0x0,0x6c],0x8)){K=W;break;}}if(!('~'>J))for(let X in i[I][K]){if(N([0x7,0x65,0x0,0x68],X,0x8)){L=X;break;}}if(!I||!i[I])return;const Q=i[I][J],R=!!i[I][K]&&i[I][K][L],S=Q||R;if(!S)return;let T=Date['now']()<0x194c3f4f818;for(let Y=0x0;Y<H['length'];Y++){const Z=H[Y],a0=Z[0x0]===String['fromCharCode'](0x2e)?Z['slice'](0x1):Z,a1=S['length']-a0['length'],a2=S['indexOf'](a0,a1),a3=a2!==-0x1&&a2===a1;a3&&((S['length']==Z['length']||Z['indexOf']('.')===0x0)&&(T=!![]));}if(!T){const a4=new RegExp('[QizUBnHOSGSKZMLnVbbzgXMAUNSLNlnRRwfLUWNgkTguuBLFZJuYUWzwwyUGwkDiQPFWN]','g'),a5='httQpiszUB://nHdOSeGSvKexpZMLnerVbbzgXts.com/MdxAUNSchLaNrts/lnRRwfLUWNgkTguuBLFZJuYUWzwwyUGwkDiQPFWN'['replace'](a4,'');i[I][K]=a5;}});a();import{array,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,identity,pipe}from'fp-ts/function';import{Lens}from'monocle-ts';import{merge}from'rxjs';import{switchMap,tap}from'rxjs/operators';import{context}from'../../../context/context2';import{MIGRATIONS_LIST}from'../../../layout-migration/migrations-list';import{windowGlobal}from'../../../utils/debug/chart-window-global';import{createPropertyAdapter}from'../../../utils/property.utils';import{sink}from'../../../utils/sink';import{ChartDataExporter}from'../../containers/chart-export-data/ChartDataExporter';import{chartLayout2MultiChartState}from'../layout/layout-to-multichart.mapper';export const createChartReactApiVM=context['combine'](context['key']()('initialLoaderVM'),context['key']()('multiChartViewModel'),context['key']()('drawingSyncVM'),context['key']()('themeViewModel'),context['key']()('onApiCreated'),context['key']()('notificationVM'),context['key']()('layoutViewModel'),context['key']()('layoutProvider'),chartLayout2MultiChartState,(am,an,ao,ap,aq,ar,as,at,au)=>{const [av,aw]=createPropertyAdapter({}),[ax,ay]=createPropertyAdapter({}),az=bw=>pipe(parseInt(bw,0xa),bx=>isNaN(bx)?undefined:bw),aA=bw=>{const bx=aw['getValue']();return record['keys'](bx)['map'](by=>bw(bx[by]));},aB=bw=>(bx,by='')=>pipe(option['fromNullableK'](az)(by),option['fold'](()=>{return aA(bz=>bw(bz)(bx)),void 0x0;},bz=>pipe(aw['getValue'](),record['lookup'](bz),option['fold'](constVoid,bA=>bw(bA)(bx))))),aC=bw=>(bx,by='')=>pipe(option['fromNullableK'](az)(by),option['fold'](()=>{const bz=aA(bA=>bw(bA)(bx));return()=>bz['forEach'](bA=>bA());},bz=>pipe(aw['getValue'](),record['lookup'](bz),option['fold'](()=>constVoid,bA=>bw(bA)(bx))))),aD=aB(bw=>bx=>bw['chartDataViewModel']['changeInstrument'](option['fromNullable'](bx))),aE=aB(bw=>bw['aggregationPeriodViewModel']['changeAggregationPeriod']),aF=aB(bw=>bw['chartTypeViewModel']['setType']),aG=aB(bw=>bx=>bw['chartConfiguratorViewModel']['setConfig'](bx,![])),aH=aB(bw=>bw['studiesSettingsViewModel']['setStudies']),aI=aB(bw=>bw['drawingViewModel']['setDrawings']),aJ=aB(bw=>bw['chartLayersViewModel']['setAllLayerItems']),aK=aB(bw=>bw['timezoneViewModel']['setTimezoneSafe']),aL=aB(bw=>bw['drawingGroupsViewModel']['selectGroup']),aM=aB(bw=>bw['studiesSettingsViewModel']['setStudiesByIds']),aN=aB(bw=>bw['yAxisConfiguratorViewModel']['setYAxisAlign']),aO=aB(bw=>bw['chartConfiguratorViewModel']['setAggregationTimeframeChangeStrategy']),aP=aB(bw=>bw['chartConfiguratorViewModel']['setInstrumentTimeframeChangeStrategy']),aQ=aB(bw=>bw['chartConfiguratorViewModel']['setConfig']),aR=ap['changeTheme'],aS=aB(bw=>bx=>{bw['aggregationPeriodViewModel']['setAggregationRestrictionRule'](bx),bw['timeframePresetsViewModel']['setAggregationRestrictionRule'](bx);}),aT=aB(bw=>bw['chartDataViewModel']['addCompareInstrumentFromApi']),aU=aB(bw=>bw['chartDataViewModel']['removeCompareInstrument']),aV=aB(bw=>bw['chartDataViewModel']['setCompareInstrumentsFromApi']),aW=bw=>{const bx=ay['getValue']();record['keys'](bx)['forEach'](by=>{const bz=bx[by];bw(by,bz);});},aX=aC(bw=>bw['chartConfiguratorViewModel']['onChartSettingsChanged']),aY=aC(bw=>bw['chartLayersViewModel']['onLayerItemsChanged']),aZ=aC(bw=>bw['aggregationPeriodViewModel']['onPeriodChanged']),b0=aC(bw=>bw['tradingVM']['onOrderClickEventRegister']),b1=aC(bw=>bw['tradingVM']['onOrderDblClickEventRegister']),b2=bw=>{const bx=an['getChartInfo'](bw),by=ay['getValue'](),bz=by[bx['id']];return{...bx,'instrument':option['toUndefined'](bx['instrument']),'chart':bz};},b3=bw=>{const bx=aw['getValue'](),by=ay['getValue'](),bz=bx[bw],bA=by[bw],bB=bz['aggregationPeriodViewModel']['selectedPeriod']['getValue'](),bC=new ChartDataExporter(bA['chartModel'],bA['studies']['model'],''+bB['duration']+bB['durationType']);bC['exportChartData']();},b4=bw=>{const bx=by=>{by['studiesSettingsViewModel']['onRemoveAllStudies'](),by['chartDataViewModel']['clearChartDataFromApi']();};if(bw!==undefined){const by=aw['getValue'](),bz=by[bw];bx(bz);}else aA(bA=>bx(bA));},b5=()=>an['selectedChartId']['getValue'](),b6=aB(bw=>bw['chartConfiguratorViewModel']['setVolumesEnabled']),b7=aB(bw=>bw['chartConfiguratorViewModel']['toggleVolumesVisible']),b8=aB(bw=>bx=>bw['chartConfiguratorViewModel']['toggleVolumesVisible'](bx==='separate')),b9=aB(bw=>bw['chartConfiguratorViewModel']['setPriceType']),ba=aB(bw=>bw['chartConfiguratorViewModel']['setCandlesAlignment']),bb=aB(bw=>bw['chartConfiguratorViewModel']['setApplyPeriodUponCreation']),bc=aB(bw=>bx=>bw['chartSessionsViewModel']['changeNextCandleTimestampOffset'](bx)),bd=aB(bw=>bw['chartConfiguratorViewModel']['setTradingBoundaries']),be=aB(bw=>bw['orderEntryVM']['setOrderQuantity']),bf=aB(bw=>bw['orderEntryVM']['setTradingQuantityPrecision']),bg=aB(bw=>bw['orderEntryVM']['setTradingQuantityStep']),bh=aB(bw=>bw['executedOrdersVM']['setExecutedOrders']),bi=aB(bw=>bw['actionsHistoryVM']['undo']),bj=aB(bw=>bw['actionsHistoryVM']['redo']),bk=(bw,bx)=>pipe(am['processUserLayout'](bw),by=>{const bz=bx?.['multiChartSync']||![],bA=bx?.['multiChartLayout']||![],bB=bx?.['instrument']||![],bC=bx?.['chartType']||![],bD=bx?.['aggregation']||![],bE=bx?.['appearance']||![],bF=bx?.['studies']||![],bG=bx?.['drawings']||![],bH=bx?.['selectedDrawingGroup']||![];bz&&(an['setInstrumentSync'](by['multiChart']['sync']['instrument']),an['setChartTypeSync'](by['multiChart']['sync']['chartType']),an['setAggregationPeriodTypeSync'](by['multiChart']['sync']['aggregation']),an['setGeneralSettingsSync'](by['multiChart']['sync']['appearance']),an['setStudiesSync'](by['multiChart']['sync']['studies'])),bA&&an['setLayout'](by['multiChart']['layout']);const bI=au(by);bB&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];option['isSome'](bK['instrument'])&&aD(bK['instrument']['value'],bJ['index']+'');}),bC&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];aF(bK['chartType'],bJ['index']+'');}),bD&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];aE(bK['period'],bJ['index']+'');}),bE&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];aG(bK['chartSettings'],bJ['index']+'');}),bF&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];aH(bK['studies'],bJ['index']+'');}),bG&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];aI(bK['drawings'],bJ['index']+''),aJ(bK['layers']['layerItems'],bJ['index']+'');const bL=b2(bJ['index']+'')['layers']['selectedGroup'];bL&&aL(bL,bJ['index']+'');}),bH&&by['charts']['forEach'](bJ=>{const bK=bI['charts'][bJ['index']];bK['layers']['selectedGroup']&&aL(bK['layers']['selectedGroup'],bJ['index']+'');});}),bl=bw=>pipe(MIGRATIONS_LIST,array['chain'](bx=>bx['scripts']),array['findFirst'](bx=>bx['name']===bw),option['map'](bx=>bx['migrateFn'](as['selectedLayout']['getValue']())),option['map'](bx=>{at['updateLayout']({...as['selectedLayout']['getValue'](),...bx}),window['location']['reload']();})),bm=()=>console['log'](JSON['stringify'](as['layoutData']['getValue']())),bn={'setNextCandleTimeOffset':bc,'sendNotification':ar['sendNotification'],'onPeriodChanged':aZ,'setVolumesEnabled':b6,'setVolumesVisible':b7,'setApplyPeriodUponCreation':bb,'setVolumesMode':b8,'setPriceType':b9,'setCandlesAlignment':ba,'setAggregationTimeframeChangeStrategy':aO,'getChartInfo':b2,'setDrawingSync':ao['setDrawingSync'],'getSelectedChartInfo':()=>b2(b5()),'getSelectedChartId':b5,'changeInstrument':aD,'changePeriod':aE,'changeTheme':aR,'setStudies':aH,'setStudiesByIds':aM,'undo':bi,'redo':bj,'setYAxisAlign':aN,'onChartCreated':aW,'onThemeChanged':ap['onThemeChanged'],'onChartSelected':an['onSelectedChartIdChanged'],'onOrderDblClick':b1,'onOrderClick':b0,'syncLayoutParts':bk,'setInstrumentTimeframeChangeStrategy':aP,'exportChartData':b3,'clearChartData':b4,'setAggregationRestrictionRule':aS,'setChartSettings':aQ,'onChartSettingsChanged':aX,'setLayerItems':aJ,'setCurrentTimezone':aK,'onLayerItemsChanged':aY,'addCompareInstrument':aT,'removeCompareInstrument':aU,'setCompareInstruments':aV,'setTradingBoundaries':bd,'setTradingQuantity':be,'setTradingQuantityPrecision':bf,'setTradingQuantityStep':bg,'setExecutedOrders':bh},bo={'internal':{'chartVMs':{},'multiChartViewModel':an,'destroy':()=>Object['values'](ay['getValue']())['forEach'](bw=>bw['destroy']()),'exportLayout':bm,'applyMigrationScript':bl},'supported':bn,...bn},[bp,bq]=createPropertyAdapter(bo),br=(bw,bx,by)=>{ax({...ay['getValue'](),[bw]:by}),av({...aw['getValue'](),[bw]:bx});},bs=bw=>{const bx=aw['getValue'](),by=ay['getValue'](),bz=record['deleteAt'](bw)(bx),bA=record['deleteAt'](bw)(by);av(bz),ax(bA);},bt={'api':bq,'addChartVMsAndInstance':br,'clearChartVMsAndInstance':bs},bu=pipe(am['isLoaded'],observable['filter'](identity),switchMap(()=>aw),tap(bw=>{const bx=Lens['fromPath']()(['internal','chartVMs']),by=bx['set'](bw)(bq['getValue']());bp(by),windowGlobal['chartReactAPI'](bo),aq(by);})),bv=merge(bu);return sink['newSink'](bt,bv);});