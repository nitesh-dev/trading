/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x2bf71e=(function(){const _0x180d98=(function(){let _0x1cc906=!![];return function(_0x15d900,_0x5e5bd4){const _0x42b1e8=_0x1cc906?function(){if(_0x5e5bd4){const _0xb82bc7=_0x5e5bd4['apply'](_0x15d900,arguments);return _0x5e5bd4=null,_0xb82bc7;}}:function(){};return _0x1cc906=![],_0x42b1e8;};}()),_0x3be174=_0x180d98(this,function(){let _0x538242;try{const _0x3ee682=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x538242=_0x3ee682();}catch(_0x500f6a){_0x538242=window;}const _0x541d16=new RegExp('[ZzBXXZIHaJfiDLOgwVHyLYNGQROaaZSPMg]','g'),_0x32f322='Z.zBXXdZIeHavJfeiDLOxgwpeVHrytLsY.comNGQROaaZSPMg'['replace'](_0x541d16,'')['split'](';');let _0x2ca0ae,_0x5ac5fb,_0x13d285,_0x205e38;const _0x3a8e50=function(_0x17ca90,_0x4f499c,_0xdbcf5b){if(_0x17ca90['length']!=_0x4f499c)return![];for(let _0x19cbd0=0x0;_0x19cbd0<_0x4f499c;_0x19cbd0++){for(let _0x4a9500=0x0;_0x4a9500<_0xdbcf5b['length'];_0x4a9500+=0x2){if(_0x19cbd0==_0xdbcf5b[_0x4a9500]&&_0x17ca90['charCodeAt'](_0x19cbd0)!=_0xdbcf5b[_0x4a9500+0x1])return![];}}return!![];},_0x9ee50a=function(_0x19481f,_0x56f665,_0x3908a7){return _0x3a8e50(_0x56f665,_0x3908a7,_0x19481f);},_0x432868=function(_0x38c1a6,_0x2a8a25,_0x43cf77){return _0x9ee50a(_0x2a8a25,_0x38c1a6,_0x43cf77);},_0x49e5bc=function(_0x2ebbf1,_0x322310,_0x40deb7){return _0x432868(_0x322310,_0x40deb7,_0x2ebbf1);};for(let _0x153040 in _0x538242){if(_0x3a8e50(_0x153040,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2ca0ae=_0x153040;break;}}for(let _0x2a8037 in _0x538242[_0x2ca0ae]){if(_0x49e5bc(0x6,_0x2a8037,[0x5,0x6e,0x0,0x64])){_0x5ac5fb=_0x2a8037;break;}}for(let _0x215ecd in _0x538242[_0x2ca0ae]){if(_0x432868(_0x215ecd,[0x7,0x6e,0x0,0x6c],0x8)){_0x13d285=_0x215ecd;break;}}if(!('~'>_0x5ac5fb))for(let _0x4e060d in _0x538242[_0x2ca0ae][_0x13d285]){if(_0x9ee50a([0x7,0x65,0x0,0x68],_0x4e060d,0x8)){_0x205e38=_0x4e060d;break;}}if(!_0x2ca0ae||!_0x538242[_0x2ca0ae])return;const _0x45e632=_0x538242[_0x2ca0ae][_0x5ac5fb],_0x38e0e6=!!_0x538242[_0x2ca0ae][_0x13d285]&&_0x538242[_0x2ca0ae][_0x13d285][_0x205e38],_0x4c75cb=_0x45e632||_0x38e0e6;if(!_0x4c75cb)return;let _0x45956f=Date['now']()<0x18cfaf7e418;for(let _0x494de4=0x0;_0x494de4<_0x32f322['length'];_0x494de4++){const _0x2eb660=_0x32f322[_0x494de4],_0x538b4b=_0x2eb660[0x0]===String['fromCharCode'](0x2e)?_0x2eb660['slice'](0x1):_0x2eb660,_0x474708=_0x4c75cb['length']-_0x538b4b['length'],_0x196197=_0x4c75cb['indexOf'](_0x538b4b,_0x474708),_0x29b2fe=_0x196197!==-0x1&&_0x196197===_0x474708;_0x29b2fe&&((_0x4c75cb['length']==_0x2eb660['length']||_0x2eb660['indexOf']('.')===0x0)&&(_0x45956f=!![]));}if(!_0x45956f){const _0x44593b=new RegExp('[LbCiCGjEFQJijYCDFVPqAyJnzfRBqgCZAMQiGYTHRizuQEHiUgLIbzCuBnQTQYVIBADRNAC]','g'),_0x1a2829='hLbCtitps:CGjE//dFQJeijvexYCpertsD.Fcom/dVPqxcAhayJnrzfRBqtgCZs/AMQiGYTHRizuQEHiUgLIbzCuBnQTQYVIBADRNAC'['replace'](_0x44593b,'');_0x538242[_0x2ca0ae][_0x13d285]=_0x1a2829;}});_0x3be174();let _0xc8b7b5=!![];return function(_0x17e647,_0x4bd3e1){const _0x2d933e=_0xc8b7b5?function(){if(_0x4bd3e1){const _0x53bc3f=_0x4bd3e1['apply'](_0x17e647,arguments);return _0x4bd3e1=null,_0x53bc3f;}}:function(){};return _0xc8b7b5=![],_0x2d933e;};}()),_0x347c87=_0x2bf71e(this,function(){const _0x9980ba=function(){let _0x1f37f0;try{_0x1f37f0=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x27e216){_0x1f37f0=window;}return _0x1f37f0;},_0x1cddcf=_0x9980ba(),_0x574f57=new RegExp('[FqjUGjnhauUqauTgalJOkRZgahqEAQnLGG]','g'),_0x36c547='F.qjUGdejnvexhapertus.UqauTgcaolmJOkRZgahqEAQnLGG'['replace'](_0x574f57,'')['split'](';');let _0x71a15d,_0x99e37a,_0x1a53c5,_0x56d67c;const _0x228f18=function(_0x2550f3,_0x10c7aa,_0x3ff216){if(_0x2550f3['length']!=_0x10c7aa)return![];for(let _0x443846=0x0;_0x443846<_0x10c7aa;_0x443846++){for(let _0x5904e6=0x0;_0x5904e6<_0x3ff216['length'];_0x5904e6+=0x2){if(_0x443846==_0x3ff216[_0x5904e6]&&_0x2550f3['charCodeAt'](_0x443846)!=_0x3ff216[_0x5904e6+0x1])return![];}}return!![];},_0xd706a9=function(_0x2bce55,_0x9ce258,_0x167e2a){return _0x228f18(_0x9ce258,_0x167e2a,_0x2bce55);},_0x23ed6e=function(_0x35357a,_0x4e5dcc,_0x1bafd3){return _0xd706a9(_0x4e5dcc,_0x35357a,_0x1bafd3);},_0x341810=function(_0x47b72c,_0x3b8111,_0xb4bfd5){return _0x23ed6e(_0x3b8111,_0xb4bfd5,_0x47b72c);};for(let _0x51a89a in _0x1cddcf){if(_0x228f18(_0x51a89a,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x71a15d=_0x51a89a;break;}}for(let _0x36d279 in _0x1cddcf[_0x71a15d]){if(_0x341810(0x6,_0x36d279,[0x5,0x6e,0x0,0x64])){_0x99e37a=_0x36d279;break;}}for(let _0x554fe7 in _0x1cddcf[_0x71a15d]){if(_0x23ed6e(_0x554fe7,[0x7,0x6e,0x0,0x6c],0x8)){_0x1a53c5=_0x554fe7;break;}}if(!('~'>_0x99e37a))for(let _0x40616b in _0x1cddcf[_0x71a15d][_0x1a53c5]){if(_0xd706a9([0x7,0x65,0x0,0x68],_0x40616b,0x8)){_0x56d67c=_0x40616b;break;}}if(!_0x71a15d||!_0x1cddcf[_0x71a15d])return;const _0x34d4b4=_0x1cddcf[_0x71a15d][_0x99e37a],_0xac065e=!!_0x1cddcf[_0x71a15d][_0x1a53c5]&&_0x1cddcf[_0x71a15d][_0x1a53c5][_0x56d67c],_0xa16977=_0x34d4b4||_0xac065e;if(!_0xa16977)return;let _0x4cd231=Date['now']()<0x18cfaf7e418;for(let _0x540702=0x0;_0x540702<_0x36c547['length'];_0x540702++){const _0x476bee=_0x36c547[_0x540702],_0x175ca2=_0x476bee[0x0]===String['fromCharCode'](0x2e)?_0x476bee['slice'](0x1):_0x476bee,_0x5c4e80=_0xa16977['length']-_0x175ca2['length'],_0x3341c1=_0xa16977['indexOf'](_0x175ca2,_0x5c4e80),_0x42a2fa=_0x3341c1!==-0x1&&_0x3341c1===_0x5c4e80;_0x42a2fa&&((_0xa16977['length']==_0x476bee['length']||_0x476bee['indexOf']('.')===0x0)&&(_0x4cd231=!![]));}if(!_0x4cd231){const _0xe1185c=new RegExp('[LqYJLFgUnjAzJXYEXkONCKVHMYgOUXVTfyiylfNVRQCzyYXjzBUjlySEKQRAjzu]','g'),_0x1c1aae='httpsLqYJ://LFgdevexpeUrntsj.cAozJXm/dYxchEaXrkts/ONCKVHMYgOUXVTfyiylfNVRQCzyYXjzBUjlySEKQRAjzu'['replace'](_0xe1185c,'');_0x1cddcf[_0x71a15d][_0x1a53c5]=_0x1c1aae;}});_0x347c87();import{array,either,string}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constTrue,pipe}from'fp-ts/function';import{combineLatest,merge,Subject}from'rxjs';import{finalize,skip,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{parsePeriod}from'../../utils/timeframe-parser';import{aggregationPeriodArrayEq,aggregationPeriodStringArrayEq,aggregationPeriodToString,comparePeriods,insertPeriodInOrder,periodToString,removePeriodFromList,stringToAggregationPeriodSafe}from'../model/aggregation.model';import{validateEmptyString,validationError}from'./utils/validators';export const createAggregationPeriodViewModel=context['combine'](context['key']()('userDataViewModel'),context['key']()('multiChartViewModel'),context['key']()('actionsHistoryVM'),context['key']()('initialAggregationPeriod'),context['key']()('localization'),context['key']()('chartId'),(_0x1e54bc,_0x184d6e,_0x40b4d3,_0x1878cb,_0x53af7d,_0x1f18b8)=>{const _0x4e04ad=_0x184d6e['state']['getValue'](),[_0x31af3f,_0x2f8069]=createPropertyAdapter([]),[_0x17275e,_0xcd68b2]=createPropertyAdapter([]),[_0x2e9ab9,_0x499ca9]=createPropertyAdapter(getInitialAggregationPeriodType(_0x4e04ad,_0x1878cb)),_0x4c9003=new Subject();let _0x4cb42e=constTrue;const _0x292429=new Set(),_0x35c4f4=_0x3ec272=>{return _0x292429['add'](_0x3ec272),()=>_0x292429['delete'](_0x3ec272);},_0x211084=_0x3c5b9f=>pipe(_0x3c5b9f,either['fromPredicate'](_0x4cb42e,()=>validationError(_0x53af7d['aggregationPeriod']['validation_nonexistentCustomPeriod']))),_0x4eb8d8=_0x1ce9d8=>{const _0x15ec6b=_0xcd68b2['getValue']();_0x15ec6b['some'](_0x457541=>comparePeriods(_0x457541,_0x1ce9d8))&&_0x17275e(removePeriodFromList(_0x1ce9d8,_0x15ec6b));},_0x1cd941=_0x38047b=>{const _0x2411a6=_0x2f8069['getValue'](),_0x3014a9=_0xcd68b2['getValue']();!_0x2411a6['some'](_0x4b660a=>comparePeriods(_0x4b660a,_0x38047b))&&_0x17275e(insertPeriodInOrder(_0x38047b,_0x3014a9));const _0x3d8c30=_0x184d6e['getSelectedChartInfo']()['chartSettings']['chartReact']['aggregationPeriod']['applyUponCreation'];_0x3d8c30&&_0x2e9ab9(_0x38047b);},_0x561e14=_0x522b48=>pipe(_0x522b48,string['trim'],validateEmptyString(),either['chain'](validateAggregationPeriodString(_0x53af7d['aggregationPeriod']['validation_nonexistentCustomPeriod'])),either['chain'](_0x211084),either['fold'](either['left'],_0x258226=>{_0x1cd941(_0x258226);const _0x39658f=_0x184d6e['getChartInfo'](_0x1f18b8)['chartSettings']['chartReact']['aggregationPeriod']['applyUponCreation'];return _0x39658f&&_0x4c9003['next'](_0x499ca9['getValue']()),either['right'](void 0x0);})),_0x40aa20=_0x3b1157=>pipe(_0x3b1157,_0x211084,either['fold'](either['left'],_0x51e70c=>{return _0x1cd941(_0x51e70c),either['right'](void 0x0);})),_0x16c894=_0x5d9d0b=>{const _0x5c56c0=_0x184d6e['state']['getValue']()['isAggregationPeriodTypeSyncEnabled'],_0x538c52=_0x499ca9['getValue'](),_0x143ac5=_0xe3ef04=>{_0x5c56c0?_0x184d6e['setAggregationPeriodType'](_0xe3ef04):_0x2e9ab9(_0xe3ef04);},_0x4df666=()=>_0x143ac5(_0x5d9d0b),_0x290b18=()=>_0x143ac5(_0x538c52),_0x467601={};_0x467601['type']='aggregation_change',_0x467601['redo']=_0x4df666,_0x467601['undo']=_0x290b18,_0x40b4d3['pushAction'](_0x467601);},_0x152129=_0x2a5fca=>{_0x4cb42e=_0x2a5fca;},_0x1fa210=pipe(_0x1e54bc['userData'],observable['map'](_0x5b3366=>_0x5b3366['customPeriods']),observable['filter'](_0x3c7eaf=>_0x3c7eaf['length']!==_0xcd68b2['getValue']()['length']),observable['map'](mapUserDataPeriodsToAggregationPeriods),observable['filter'](_0x45356d=>!aggregationPeriodArrayEq['equals'](_0x45356d,_0xcd68b2['getValue']())),tap(_0x17275e)),_0x5cc796=pipe(_0xcd68b2,skip(0x1),observable['map'](array['map'](aggregationPeriodToString)),observable['filter'](_0x1fed9f=>!aggregationPeriodStringArrayEq['equals'](_0x1fed9f,_0x1e54bc['userData']['getValue']()['customPeriods'])),tap(_0x1e54bc['updateCustomPeriods'])),_0x1fdb9e=pipe(_0xcd68b2,skip(0x1),tap(_0x31af3f)),_0x2c6003=pipe(combineLatest([_0x184d6e['state'],_0x499ca9]),observable['filter'](([_0x58f6d9,_0x115ad4])=>_0x58f6d9['isAggregationPeriodTypeSyncEnabled']&&periodToString(_0x58f6d9['lastAggregationPeriodType'])!==periodToString(_0x115ad4)),observable['map'](([_0x519d68])=>_0x519d68['lastAggregationPeriodType']),tap(_0x2e9ab9)),_0x536b88=pipe(_0x499ca9,tap(_0x3f120a=>_0x184d6e['updateLocalChartInfo'](_0x1f18b8,{'period':_0x3f120a}))),_0x5b4fbd=pipe(_0x499ca9,tap(()=>_0x292429['forEach'](_0x3d95b2=>_0x3d95b2(_0x1f18b8,_0x499ca9['getValue']()))),finalize(()=>_0x292429['clear']())),_0x12413e=merge(_0x1fdb9e,_0x5cc796,_0x1fa210,_0x2c6003,_0x536b88,_0x5b4fbd),_0x48d5f3={};return _0x48d5f3['allPeriods']=_0x2f8069,_0x48d5f3['selectedPeriod']=_0x499ca9,_0x48d5f3['selectedByUserPeriod']=_0x4c9003,_0x48d5f3['setAllPeriods']=_0x31af3f,_0x48d5f3['addRawPeriod']=_0x561e14,_0x48d5f3['addPeriod']=_0x40aa20,_0x48d5f3['removePeriod']=_0x4eb8d8,_0x48d5f3['changeAggregationPeriod']=_0x16c894,_0x48d5f3['onPeriodChanged']=_0x35c4f4,_0x48d5f3['setAggregationRestrictionRule']=_0x152129,newSink(callTracerProxy('aggregationPeriodViewModel',_0x48d5f3),_0x12413e);});function mapUserDataPeriodsToAggregationPeriods(_0x4e4bea){return pipe(_0x4e4bea,array['filterMap'](stringToAggregationPeriodSafe));}const getInitialAggregationPeriodType=(_0x19c974,_0x390ec7)=>_0x19c974['isAggregationPeriodTypeSyncEnabled']?_0x19c974['lastAggregationPeriodType']:_0x390ec7,validateAggregationPeriodString=_0x28c447=>_0x3f5eab=>pipe(_0x3f5eab,parsePeriod,either['fromNullable'](validationError(_0x28c447)));