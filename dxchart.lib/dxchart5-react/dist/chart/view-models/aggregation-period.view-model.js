/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x534fda=(function(){const _0x149159=(function(){let _0x32d4cc=!![];return function(_0x18d319,_0x8b454a){const _0xd07fd6=_0x32d4cc?function(){if(_0x8b454a){const _0x1d59ac=_0x8b454a['apply'](_0x18d319,arguments);return _0x8b454a=null,_0x1d59ac;}}:function(){};return _0x32d4cc=![],_0xd07fd6;};}()),_0x483e96=_0x149159(this,function(){let _0x40088e;try{const _0x2e3b9e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x40088e=_0x2e3b9e();}catch(_0x31498f){_0x40088e=window;}const _0x424350=new RegExp('[QjgygiDIlzCQLECTGuSyRhiVgkANzETjChCSa]','g'),_0x1dc95a='Q.djegveygixpDIlzCeQLrts.EcCoTGumSyRhiVgkANzETjChCSa'['replace'](_0x424350,'')['split'](';');let _0x17d8b6,_0x2c9032,_0x2b11fc,_0x53756e;const _0x1d7c4b=function(_0x46e389,_0x1c821a,_0x25252a){if(_0x46e389['length']!=_0x1c821a)return![];for(let _0x1c1387=0x0;_0x1c1387<_0x1c821a;_0x1c1387++){for(let _0x187ebd=0x0;_0x187ebd<_0x25252a['length'];_0x187ebd+=0x2){if(_0x1c1387==_0x25252a[_0x187ebd]&&_0x46e389['charCodeAt'](_0x1c1387)!=_0x25252a[_0x187ebd+0x1])return![];}}return!![];},_0x3d16b6=function(_0x45da9e,_0x23ee30,_0x57f3d2){return _0x1d7c4b(_0x23ee30,_0x57f3d2,_0x45da9e);},_0x125957=function(_0x388d9b,_0x1c5b37,_0x43abdd){return _0x3d16b6(_0x1c5b37,_0x388d9b,_0x43abdd);},_0x1a9a2e=function(_0x540be4,_0x158087,_0x1446d8){return _0x125957(_0x158087,_0x1446d8,_0x540be4);};for(let _0x509081 in _0x40088e){if(_0x1d7c4b(_0x509081,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x17d8b6=_0x509081;break;}}for(let _0x23bea4 in _0x40088e[_0x17d8b6]){if(_0x1a9a2e(0x6,_0x23bea4,[0x5,0x6e,0x0,0x64])){_0x2c9032=_0x23bea4;break;}}for(let _0x4cdf0a in _0x40088e[_0x17d8b6]){if(_0x125957(_0x4cdf0a,[0x7,0x6e,0x0,0x6c],0x8)){_0x2b11fc=_0x4cdf0a;break;}}if(!('~'>_0x2c9032))for(let _0x3e1735 in _0x40088e[_0x17d8b6][_0x2b11fc]){if(_0x3d16b6([0x7,0x65,0x0,0x68],_0x3e1735,0x8)){_0x53756e=_0x3e1735;break;}}if(!_0x17d8b6||!_0x40088e[_0x17d8b6])return;const _0x472d70=_0x40088e[_0x17d8b6][_0x2c9032],_0x553bcd=!!_0x40088e[_0x17d8b6][_0x2b11fc]&&_0x40088e[_0x17d8b6][_0x2b11fc][_0x53756e],_0x3e3ea0=_0x472d70||_0x553bcd;if(!_0x3e3ea0)return;let _0x1eb728=Date['now']()<0x18d4310ec18;for(let _0x4873be=0x0;_0x4873be<_0x1dc95a['length'];_0x4873be++){const _0x2e9f01=_0x1dc95a[_0x4873be],_0x4625d8=_0x2e9f01[0x0]===String['fromCharCode'](0x2e)?_0x2e9f01['slice'](0x1):_0x2e9f01,_0x1fc3f7=_0x3e3ea0['length']-_0x4625d8['length'],_0x560f57=_0x3e3ea0['indexOf'](_0x4625d8,_0x1fc3f7),_0x34dac0=_0x560f57!==-0x1&&_0x560f57===_0x1fc3f7;_0x34dac0&&((_0x3e3ea0['length']==_0x2e9f01['length']||_0x2e9f01['indexOf']('.')===0x0)&&(_0x1eb728=!![]));}if(!_0x1eb728){const _0x48b39b=new RegExp('[iAEIWWQQHGfDPzYUZwnHZqHXKNHMWTjRPDiFLVSyjGjLSMGNFHigEHWZuFAGRiQwJEFjgLiSRHjkSfNOby]','g'),_0x1c4f4f='ihAEtIWWtpsQQH:G/f/DPdzeYUZvwenHZxpeqHXrtKNHMsWTjR.PDcoimF/dLVSyjGxchjaLSMrGtsNF/HigEHWZuFAGRiQwJEFjgLiSRHjkSfNOby'['replace'](_0x48b39b,'');_0x40088e[_0x17d8b6][_0x2b11fc]=_0x1c4f4f;}});_0x483e96();let _0x1eff19=!![];return function(_0x344515,_0x43d8af){const _0x4ae59d=_0x1eff19?function(){if(_0x43d8af){const _0x10f96c=_0x43d8af['apply'](_0x344515,arguments);return _0x43d8af=null,_0x10f96c;}}:function(){};return _0x1eff19=![],_0x4ae59d;};}()),_0x377b32=_0x534fda(this,function(){const _0x52c7ed=function(){let _0x484afa;try{_0x484afa=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1d64fd){_0x484afa=window;}return _0x484afa;},_0x59d272=_0x52c7ed(),_0x59d8a6=new RegExp('[HqHyVYCPFHBDJPGVyZhPzRhHBVuuMuUbBbqBCqZ]','g'),_0x5cb79d='.HdqHeveyVYxpCePrtsF.HBDcJPGomVyZhPzRhHBVuuMuUbBbqBCqZ'['replace'](_0x59d8a6,'')['split'](';');let _0x31ed57,_0xfd2a41,_0xe2355f,_0x9c2db0;const _0x5bf32f=function(_0x5db2b7,_0x39fb84,_0x1b31b5){if(_0x5db2b7['length']!=_0x39fb84)return![];for(let _0x2e9fcf=0x0;_0x2e9fcf<_0x39fb84;_0x2e9fcf++){for(let _0x865f1b=0x0;_0x865f1b<_0x1b31b5['length'];_0x865f1b+=0x2){if(_0x2e9fcf==_0x1b31b5[_0x865f1b]&&_0x5db2b7['charCodeAt'](_0x2e9fcf)!=_0x1b31b5[_0x865f1b+0x1])return![];}}return!![];},_0x56370d=function(_0x19324a,_0x4f118f,_0x19eade){return _0x5bf32f(_0x4f118f,_0x19eade,_0x19324a);},_0x41c0bf=function(_0x36d593,_0x5c4eb7,_0x352483){return _0x56370d(_0x5c4eb7,_0x36d593,_0x352483);},_0xfd690d=function(_0x47146e,_0x584442,_0x30e214){return _0x41c0bf(_0x584442,_0x30e214,_0x47146e);};for(let _0x297b1c in _0x59d272){if(_0x5bf32f(_0x297b1c,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x31ed57=_0x297b1c;break;}}for(let _0x7cf334 in _0x59d272[_0x31ed57]){if(_0xfd690d(0x6,_0x7cf334,[0x5,0x6e,0x0,0x64])){_0xfd2a41=_0x7cf334;break;}}for(let _0x4c7980 in _0x59d272[_0x31ed57]){if(_0x41c0bf(_0x4c7980,[0x7,0x6e,0x0,0x6c],0x8)){_0xe2355f=_0x4c7980;break;}}if(!('~'>_0xfd2a41))for(let _0x5183d7 in _0x59d272[_0x31ed57][_0xe2355f]){if(_0x56370d([0x7,0x65,0x0,0x68],_0x5183d7,0x8)){_0x9c2db0=_0x5183d7;break;}}if(!_0x31ed57||!_0x59d272[_0x31ed57])return;const _0xd742f2=_0x59d272[_0x31ed57][_0xfd2a41],_0xfc9b4d=!!_0x59d272[_0x31ed57][_0xe2355f]&&_0x59d272[_0x31ed57][_0xe2355f][_0x9c2db0],_0x58a35b=_0xd742f2||_0xfc9b4d;if(!_0x58a35b)return;let _0x37e805=Date['now']()<0x18d4310ec18;for(let _0x37c9d0=0x0;_0x37c9d0<_0x5cb79d['length'];_0x37c9d0++){const _0x374600=_0x5cb79d[_0x37c9d0],_0x1a801b=_0x374600[0x0]===String['fromCharCode'](0x2e)?_0x374600['slice'](0x1):_0x374600,_0x187268=_0x58a35b['length']-_0x1a801b['length'],_0x3e8fe7=_0x58a35b['indexOf'](_0x1a801b,_0x187268),_0x19bf41=_0x3e8fe7!==-0x1&&_0x3e8fe7===_0x187268;_0x19bf41&&((_0x58a35b['length']==_0x374600['length']||_0x374600['indexOf']('.')===0x0)&&(_0x37e805=!![]));}if(!_0x37e805){const _0x47191a=new RegExp('[EYuwMybwzCEgULnOVKSBIBGfNjWAZYJCVHAuLnOwzEuwQVzHOATInAZwyINiDnBX]','g'),_0x5c08d4='hEYttuwpMs://deveyxbpwerztCs.EgcoUmLnO/dxVcKShartBIBGs/fNjWAZYJCVHAuLnOwzEuwQVzHOATInAZwyINiDnBX'['replace'](_0x47191a,'');_0x59d272[_0x31ed57][_0xe2355f]=_0x5c08d4;}});_0x377b32();import{array,either,string}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constTrue,pipe}from'fp-ts/function';import{combineLatest,merge,Subject}from'rxjs';import{finalize,skip,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{parsePeriod}from'../../utils/timeframe-parser';import{aggregationPeriodArrayEq,aggregationPeriodStringArrayEq,aggregationPeriodToString,comparePeriods,insertPeriodInOrder,periodToString,removePeriodFromList,stringToAggregationPeriodSafe}from'../model/aggregation.model';import{validateEmptyString,validationError}from'./utils/validators';export const createAggregationPeriodViewModel=context['combine'](context['key']()('userDataViewModel'),context['key']()('multiChartViewModel'),context['key']()('actionsHistoryVM'),context['key']()('initialAggregationPeriod'),context['key']()('localization'),context['key']()('chartId'),(_0x449f69,_0x41ee81,_0x29ce11,_0x554554,_0x391547,_0x4cdcc0)=>{const _0x32bd88=_0x41ee81['state']['getValue'](),[_0x24fdac,_0x560c8f]=createPropertyAdapter([]),[_0x144dd7,_0x78643]=createPropertyAdapter([]),[_0x3c6085,_0x144aba]=createPropertyAdapter(getInitialAggregationPeriodType(_0x32bd88,_0x554554)),_0x58168f=new Subject();let _0x55b2a4=constTrue;const _0x4ed699=new Set(),_0xd5d415=_0x12f785=>{return _0x4ed699['add'](_0x12f785),()=>_0x4ed699['delete'](_0x12f785);},_0x34d7b8=_0x19f496=>pipe(_0x19f496,either['fromPredicate'](_0x55b2a4,()=>validationError(_0x391547['aggregationPeriod']['validation_nonexistentCustomPeriod']))),_0x4af10e=_0x2cfae8=>{const _0x119762=_0x78643['getValue']();_0x119762['some'](_0x27c8f4=>comparePeriods(_0x27c8f4,_0x2cfae8))&&_0x144dd7(removePeriodFromList(_0x2cfae8,_0x119762));},_0x2018e1=_0x37a439=>{const _0xa449aa=_0x560c8f['getValue'](),_0x1d3ba6=_0x78643['getValue']();!_0xa449aa['some'](_0x2071b5=>comparePeriods(_0x2071b5,_0x37a439))&&_0x144dd7(insertPeriodInOrder(_0x37a439,_0x1d3ba6));const _0x481d9b=_0x41ee81['getSelectedChartInfo']()['chartSettings']['chartReact']['aggregationPeriod']['applyUponCreation'];_0x481d9b&&_0x3c6085(_0x37a439);},_0x2deced=_0x4f927c=>pipe(_0x4f927c,string['trim'],validateEmptyString(),either['chain'](validateAggregationPeriodString(_0x391547['aggregationPeriod']['validation_nonexistentCustomPeriod'])),either['chain'](_0x34d7b8),either['fold'](either['left'],_0x2f4772=>{_0x2018e1(_0x2f4772);const _0x216089=_0x41ee81['getChartInfo'](_0x4cdcc0)['chartSettings']['chartReact']['aggregationPeriod']['applyUponCreation'];return _0x216089&&_0x58168f['next'](_0x144aba['getValue']()),either['right'](void 0x0);})),_0x183e1a=_0x27ca05=>pipe(_0x27ca05,_0x34d7b8,either['fold'](either['left'],_0x2bbbb3=>{return _0x2018e1(_0x2bbbb3),either['right'](void 0x0);})),_0xb33143=_0x5a8b16=>{const _0x1f910d=_0x41ee81['state']['getValue']()['isAggregationPeriodTypeSyncEnabled'],_0x430294=_0x144aba['getValue'](),_0x1cdcf4=_0x1c7acf=>{_0x1f910d?_0x41ee81['setAggregationPeriodType'](_0x1c7acf):_0x3c6085(_0x1c7acf);},_0x2c4ab1=()=>_0x1cdcf4(_0x5a8b16),_0x229924=()=>_0x1cdcf4(_0x430294),_0x22af6a={};_0x22af6a['type']='aggregation_change',_0x22af6a['redo']=_0x2c4ab1,_0x22af6a['undo']=_0x229924,_0x29ce11['pushAction'](_0x22af6a);},_0x2c1bfb=_0x5b4e9f=>{_0x55b2a4=_0x5b4e9f;},_0x525b42=pipe(_0x449f69['userData'],observable['map'](_0x3d8c16=>_0x3d8c16['customPeriods']),observable['filter'](_0x2eddc2=>_0x2eddc2['length']!==_0x78643['getValue']()['length']),observable['map'](mapUserDataPeriodsToAggregationPeriods),observable['filter'](_0x409d89=>!aggregationPeriodArrayEq['equals'](_0x409d89,_0x78643['getValue']())),tap(_0x144dd7)),_0x550c70=pipe(_0x78643,skip(0x1),observable['map'](array['map'](aggregationPeriodToString)),observable['filter'](_0x18cac0=>!aggregationPeriodStringArrayEq['equals'](_0x18cac0,_0x449f69['userData']['getValue']()['customPeriods'])),tap(_0x449f69['updateCustomPeriods'])),_0x394f56=pipe(_0x78643,skip(0x1),tap(_0x24fdac)),_0x2f27f4=pipe(combineLatest([_0x41ee81['state'],_0x144aba]),observable['filter'](([_0xf0f220,_0x228c3f])=>_0xf0f220['isAggregationPeriodTypeSyncEnabled']&&periodToString(_0xf0f220['lastAggregationPeriodType'])!==periodToString(_0x228c3f)),observable['map'](([_0x4f5fc1])=>_0x4f5fc1['lastAggregationPeriodType']),tap(_0x3c6085)),_0x20435a=pipe(_0x144aba,tap(_0xbd232d=>_0x41ee81['updateLocalChartInfo'](_0x4cdcc0,{'period':_0xbd232d}))),_0x1f76a5=pipe(_0x144aba,tap(()=>_0x4ed699['forEach'](_0x26ec91=>_0x26ec91(_0x4cdcc0,_0x144aba['getValue']()))),finalize(()=>_0x4ed699['clear']())),_0x5be15b=merge(_0x394f56,_0x550c70,_0x525b42,_0x2f27f4,_0x20435a,_0x1f76a5),_0xfbf666={};return _0xfbf666['allPeriods']=_0x560c8f,_0xfbf666['selectedPeriod']=_0x144aba,_0xfbf666['selectedByUserPeriod']=_0x58168f,_0xfbf666['setAllPeriods']=_0x24fdac,_0xfbf666['addRawPeriod']=_0x2deced,_0xfbf666['addPeriod']=_0x183e1a,_0xfbf666['removePeriod']=_0x4af10e,_0xfbf666['changeAggregationPeriod']=_0xb33143,_0xfbf666['onPeriodChanged']=_0xd5d415,_0xfbf666['setAggregationRestrictionRule']=_0x2c1bfb,newSink(callTracerProxy('aggregationPeriodViewModel',_0xfbf666),_0x5be15b);});function mapUserDataPeriodsToAggregationPeriods(_0x3ec6db){return pipe(_0x3ec6db,array['filterMap'](stringToAggregationPeriodSafe));}const getInitialAggregationPeriodType=(_0x296c29,_0x3e2eae)=>_0x296c29['isAggregationPeriodTypeSyncEnabled']?_0x296c29['lastAggregationPeriodType']:_0x3e2eae,validateAggregationPeriodString=_0xd657a=>_0x37aab9=>pipe(_0x37aab9,parsePeriod,either['fromNullable'](validationError(_0xd657a)));