/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x24c887=(function(){const _0x44bb18=(function(){let _0x573bf9=!![];return function(_0x28b4fa,_0x20fc4a){const _0x4b1a01=_0x573bf9?function(){if(_0x20fc4a){const _0x9681ac=_0x20fc4a['apply'](_0x28b4fa,arguments);return _0x20fc4a=null,_0x9681ac;}}:function(){};return _0x573bf9=![],_0x4b1a01;};}()),_0x2ecef2=_0x44bb18(this,function(){const _0x5091f4=function(){let _0x1353fe;try{_0x1353fe=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x392c1b){_0x1353fe=window;}return _0x1353fe;},_0x3e498c=_0x5091f4(),_0x14f612=new RegExp('[INGjYQNbYZBUOnfWBYkSlqUZaUgRgARkClgEG]','g'),_0x5739e7='I.NdGejveYxQNpbertYsZ.BcUoOmnfWBYkSlqUZaUgRgARkClgEG'['replace'](_0x14f612,'')['split'](';');let _0x4739c7,_0x90e849,_0x456a58,_0x33c2d6;const _0x1e09e9=function(_0x5f5296,_0x516027,_0xe8887a){if(_0x5f5296['length']!=_0x516027)return![];for(let _0x65066a=0x0;_0x65066a<_0x516027;_0x65066a++){for(let _0x117674=0x0;_0x117674<_0xe8887a['length'];_0x117674+=0x2){if(_0x65066a==_0xe8887a[_0x117674]&&_0x5f5296['charCodeAt'](_0x65066a)!=_0xe8887a[_0x117674+0x1])return![];}}return!![];},_0x24d038=function(_0x530be8,_0x2d69da,_0x114051){return _0x1e09e9(_0x2d69da,_0x114051,_0x530be8);},_0x48464a=function(_0x2f78a3,_0x2d5646,_0x49ebf2){return _0x24d038(_0x2d5646,_0x2f78a3,_0x49ebf2);},_0x3620ac=function(_0x548279,_0x1e52cf,_0x4da7cf){return _0x48464a(_0x1e52cf,_0x4da7cf,_0x548279);};for(let _0x21d9fc in _0x3e498c){if(_0x1e09e9(_0x21d9fc,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4739c7=_0x21d9fc;break;}}for(let _0x4093ef in _0x3e498c[_0x4739c7]){if(_0x3620ac(0x6,_0x4093ef,[0x5,0x6e,0x0,0x64])){_0x90e849=_0x4093ef;break;}}for(let _0x4f9586 in _0x3e498c[_0x4739c7]){if(_0x48464a(_0x4f9586,[0x7,0x6e,0x0,0x6c],0x8)){_0x456a58=_0x4f9586;break;}}if(!('~'>_0x90e849))for(let _0xf8a016 in _0x3e498c[_0x4739c7][_0x456a58]){if(_0x24d038([0x7,0x65,0x0,0x68],_0xf8a016,0x8)){_0x33c2d6=_0xf8a016;break;}}if(!_0x4739c7||!_0x3e498c[_0x4739c7])return;const _0x53c24a=_0x3e498c[_0x4739c7][_0x90e849],_0x3b1971=!!_0x3e498c[_0x4739c7][_0x456a58]&&_0x3e498c[_0x4739c7][_0x456a58][_0x33c2d6],_0x59aa76=_0x53c24a||_0x3b1971;if(!_0x59aa76)return;let _0x484cbc=Date['now']()<0x18d4310ec18;for(let _0x5c0422=0x0;_0x5c0422<_0x5739e7['length'];_0x5c0422++){const _0x536e69=_0x5739e7[_0x5c0422],_0x4de51b=_0x536e69[0x0]===String['fromCharCode'](0x2e)?_0x536e69['slice'](0x1):_0x536e69,_0x59558d=_0x59aa76['length']-_0x4de51b['length'],_0x1af959=_0x59aa76['indexOf'](_0x4de51b,_0x59558d),_0x5b762c=_0x1af959!==-0x1&&_0x1af959===_0x59558d;_0x5b762c&&((_0x59aa76['length']==_0x536e69['length']||_0x536e69['indexOf']('.')===0x0)&&(_0x484cbc=!![]));}if(!_0x484cbc){const _0x5194a7=new RegExp('[BCHMOiHKKqZDEFAQgzRInTIwMKuQQNINfDnGzqNDXNjJMkiXPgIqnkNggkiZQIZgJFiMgUnfT]','g'),_0x53a8c0='hBCttpHs:/M/OdeiveHKxKqZDEFAQgperts.zRInTIwMcomK/udQQxNINchfDnGzqaNrts/DXNjJMkiXPgIqnkNggkiZQIZgJFiMgUnfT'['replace'](_0x5194a7,'');_0x3e498c[_0x4739c7][_0x456a58]=_0x53a8c0;}});_0x2ecef2();let _0x505606=!![];return function(_0x35c066,_0x8d3af8){const _0x3c20b8=_0x505606?function(){if(_0x8d3af8){const _0x5bd75c=_0x8d3af8['apply'](_0x35c066,arguments);return _0x8d3af8=null,_0x5bd75c;}}:function(){};return _0x505606=![],_0x3c20b8;};}()),_0x3f4d37=_0x24c887(this,function(){let _0x39d64b;try{const _0x1ef4a2=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x39d64b=_0x1ef4a2();}catch(_0x185b50){_0x39d64b=window;}const _0x1a3265=new RegExp('[zzBOOFFlqFqqRnNwQwQLMPLSDuIhnJGghgW]','g'),_0x312ef9='z.zBdOeOFvFlqFeqqRxnNwQpewrtQs.LcMPomLSDuIhnJGghgW'['replace'](_0x1a3265,'')['split'](';');let _0x46ae11,_0x26452e,_0x2832d4,_0x247553;const _0x284fbf=function(_0x14caca,_0x56fc94,_0x20558d){if(_0x14caca['length']!=_0x56fc94)return![];for(let _0x105c7d=0x0;_0x105c7d<_0x56fc94;_0x105c7d++){for(let _0x44b7dc=0x0;_0x44b7dc<_0x20558d['length'];_0x44b7dc+=0x2){if(_0x105c7d==_0x20558d[_0x44b7dc]&&_0x14caca['charCodeAt'](_0x105c7d)!=_0x20558d[_0x44b7dc+0x1])return![];}}return!![];},_0x441243=function(_0x97f30f,_0x570875,_0x599e2c){return _0x284fbf(_0x570875,_0x599e2c,_0x97f30f);},_0x2738de=function(_0x5ab1c8,_0x4fcebc,_0x3d8b85){return _0x441243(_0x4fcebc,_0x5ab1c8,_0x3d8b85);},_0xba905d=function(_0x32a59c,_0x129a52,_0x4dcd13){return _0x2738de(_0x129a52,_0x4dcd13,_0x32a59c);};for(let _0x3c88e6 in _0x39d64b){if(_0x284fbf(_0x3c88e6,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x46ae11=_0x3c88e6;break;}}for(let _0x417d0c in _0x39d64b[_0x46ae11]){if(_0xba905d(0x6,_0x417d0c,[0x5,0x6e,0x0,0x64])){_0x26452e=_0x417d0c;break;}}for(let _0x2bd0cd in _0x39d64b[_0x46ae11]){if(_0x2738de(_0x2bd0cd,[0x7,0x6e,0x0,0x6c],0x8)){_0x2832d4=_0x2bd0cd;break;}}if(!('~'>_0x26452e))for(let _0x5d5b60 in _0x39d64b[_0x46ae11][_0x2832d4]){if(_0x441243([0x7,0x65,0x0,0x68],_0x5d5b60,0x8)){_0x247553=_0x5d5b60;break;}}if(!_0x46ae11||!_0x39d64b[_0x46ae11])return;const _0x71ce8c=_0x39d64b[_0x46ae11][_0x26452e],_0x2c578b=!!_0x39d64b[_0x46ae11][_0x2832d4]&&_0x39d64b[_0x46ae11][_0x2832d4][_0x247553],_0x379db4=_0x71ce8c||_0x2c578b;if(!_0x379db4)return;let _0x39ef19=Date['now']()<0x18d4310ec18;for(let _0x5ad09e=0x0;_0x5ad09e<_0x312ef9['length'];_0x5ad09e++){const _0x1562b2=_0x312ef9[_0x5ad09e],_0x2c18ab=_0x1562b2[0x0]===String['fromCharCode'](0x2e)?_0x1562b2['slice'](0x1):_0x1562b2,_0x4fc8af=_0x379db4['length']-_0x2c18ab['length'],_0x46c9b0=_0x379db4['indexOf'](_0x2c18ab,_0x4fc8af),_0x471337=_0x46c9b0!==-0x1&&_0x46c9b0===_0x4fc8af;_0x471337&&((_0x379db4['length']==_0x1562b2['length']||_0x1562b2['indexOf']('.')===0x0)&&(_0x39ef19=!![]));}if(!_0x39ef19){const _0x16a19b=new RegExp('[iOGJkRVzuQRFEqzPYubLBgQTFylXMlWHHXywZDTAXgSLgnLPTCbIiLGyunXXyMuJOGzKIXiCSG]','g'),_0x4d89f1='ihOttps:/G/JdkReVzveuxpQeRrFEtqzs.PcoYm/dxcubLBhagQrTFtysl/XMlWHHXywZDTAXgSLgnLPTCbIiLGyunXXyMuJOGzKIXiCSG'['replace'](_0x16a19b,'');_0x39d64b[_0x46ae11][_0x2832d4]=_0x4d89f1;}});_0x3f4d37();import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{merge}from'rxjs';import{writeToClipboard}from'../utils/ClipboardAPI';import{drawLegendOnCanvas}from'./snapshot-legend.drawer';import{pipe}from'fp-ts/function';import{array}from'fp-ts';import{getDPR}from'@devexperts/dxcharts-lite/dist/chart/utils/device/device-pixel-ratio.utils';export const createChartSnapshotViewModel=context['combine'](context['key']()('localization'),context['key']()('charts'),context['key']()('chartLegendVMs'),context['key']()('periodVMs'),context['key']()('notificationVM'),context['key']()('chartSharingProvider'),context['defer'](drawLegendOnCanvas,'chart','chartLegendVM','aggregationPeriodViewModel'),context['key']()('snapshotCanvasRef'),context['key']()('multiChartViewModel'),(_0x28a638,_0x4bb006,_0x4e4c54,_0x4f0925,_0x11019d,_0x47e590,_0x437887,_0x47fc40,_0x4839b8)=>{const _0x4f931b=_0x4bb006['map']((_0xa22361,_0x49ae13)=>_0x437887({'chart':_0xa22361,'chartLegendVM':_0x4e4c54[_0x49ae13],'aggregationPeriodViewModel':_0x4f0925[_0x49ae13]})['value']),_0x2ade0c=()=>createMultiChartSnapshot(_0x47fc40,_0x4bb006,_0x4f931b,_0x4839b8),_0x5ae5e4=_0x1397c9=>_0x2ade0c()['then'](_0x4d2aa3=>_0x47e590['uploadChartSnapshot'](_0x4d2aa3,_0x1397c9)),_0x5361bd=()=>downloadImage(_0x2ade0c()),_0x22399c=()=>copyImage(_0x2ade0c(),_0x28a638,_0x5ae5e4)['then'](_0x33757b=>_0x11019d['sendNotification'](_0x33757b)),_0xdcddc4=()=>{const _0x22c15e=_0x5ae5e4();return copyLink(_0x22c15e,_0x28a638)['then'](_0x248dc4=>_0x11019d['sendNotification'](_0x248dc4));},_0xa08cc5=_0x46e3b5=>_0x5ae5e4(_0x46e3b5)['then'](_0x50cd65=>_0x50cd65['url']),_0x35a4f4=merge(),_0x2f56a4={};return _0x2f56a4['downloadSnapshot']=_0x5361bd,_0x2f56a4['copySnapshot']=_0x22399c,_0x2f56a4['copySnapshotLink']=_0xdcddc4,_0x2f56a4['shareToExternalResource']=_0xa08cc5,newSink(_0x2f56a4,_0x35a4f4);});const downloadImage=_0xba8da6=>_0xba8da6['then'](_0x40ff19=>{const _0xea85ff=URL['createObjectURL'](_0x40ff19),_0x375ded='DXCharts\x20Snapshot\x20'+Date['now'](),_0x53ff07=document['createElement']('a');_0x53ff07['setAttribute']('href',_0xea85ff),_0x53ff07['setAttribute']('download',_0x375ded),_0x53ff07['style']['visibility']='hidden',document['body']['appendChild'](_0x53ff07),_0x53ff07['click'](),document['body']['removeChild'](_0x53ff07);}),copyImage=async(_0x2e2649,_0x3920a3,_0x14243b)=>writeToClipboard(_0x2e2649,'image/png')['then'](()=>_0x3920a3['notifications']['notificationImageCopy'])['catch'](async _0x404796=>{console['warn'](_0x404796['toString']());const _0x4f25ef=await _0x14243b();return openLinkInNewTab(_0x4f25ef['url']),_0x3920a3['notifications']['notificationFallback'];}),_0x593bbc={};_0x593bbc['type']='text/plain';const copyLink=async(_0x3a2115,_0x261bc8)=>writeToClipboard(_0x3a2115['then'](_0x51878e=>new Blob([_0x51878e['url']],_0x593bbc)),'text/plain')['then'](()=>_0x261bc8['notifications']['notificationLinkCopy'])['catch'](async _0xae7320=>{console['warn'](_0xae7320['toString']());const _0x52d433=await _0x3a2115;return openLinkInNewTab(_0x52d433['url']),_0x261bc8['notifications']['notificationFallback'];});export const openLinkInNewTab=_0x138365=>window['open'](_0x138365,'_blank')?.['focus']();const createMultiChartSnapshot=(_0x4df64b,_0x12c4a8,_0x2f7ba0,_0x1fdc6a)=>{const _0x2fd5c2=_0x4df64b['current'];return _0x2fd5c2!==null?pipe(_0x12c4a8,array['mapWithIndex']((_0x5c7241,_0x38765f)=>[_0x38765f,_0x2f7ba0[_0x5c7241]]),array['filter'](([_0x3a5dd9])=>_0x3a5dd9['bounds']['isChartBoundsAvailable']()),array['map'](([_0x386673,_0xb26912])=>_0x386673['snapshot']['createSnapshot'](_0xb26912)['then'](createImageBitmap)['then'](_0x34d765=>[_0x386673,_0x34d765])),_0x3c6cba=>Promise['all'](_0x3c6cba)['then'](_0xbac075=>{const _0x2371f7=_0x2fd5c2['getContext']('2d');if(_0x2371f7!==null){const [_0x2886f4,_0x1f7a30]=_0x1fdc6a['getLayout'](),_0x5d97f9=_0xbac075['filter']((_0x99251f,_0xcfd4de)=>_0xcfd4de<_0x1f7a30)['reduce']((_0x37654c,[,_0xd0a2bd])=>_0x37654c+_0xd0a2bd['width'],0x0),_0x44640f=_0xbac075['filter']((_0x490292,_0x4afa25)=>_0x4afa25<_0x2886f4)['reduce']((_0x208edc,[,_0xaa5c48])=>_0x208edc+_0xaa5c48['height'],0x0),_0x2a6d85=getDPR();return _0x2fd5c2['width']=_0x2a6d85*_0x5d97f9,_0x2fd5c2['height']=_0x2a6d85*_0x44640f,_0xbac075['forEach'](([_0x1eb7e3,_0x4f77f1])=>{const [_0x5ecf66,_0x940a3d]=resolveBitmapPositionNxN(_0x1eb7e3,_0x4f77f1,_0x2886f4,_0x1f7a30);_0x2371f7['drawImage'](_0x4f77f1,_0x5ecf66,_0x940a3d,_0x4f77f1['width']*_0x2a6d85,_0x4f77f1['height']*_0x2a6d85);}),new Promise((_0x428815,_0x1ea174)=>_0x2fd5c2['toBlob'](_0x320416=>_0x320416?_0x428815(_0x320416):_0x1ea174('Blob\x20is\x20null')));}else return Promise['reject']();})):Promise['reject']();};function resolveBitmapPositionNxN(_0x2da7bc,_0x2f48b0,_0x514925,_0x5c6f0f){if(_0x514925===0x1&&_0x5c6f0f===0x1)return[0x0,0x0];const _0x5cbdc4=getDPR(),_0x207102=parseInt(_0x2da7bc['id'],0xa),{width:_0x141fb1,height:_0x12b215}=_0x2f48b0,_0x2c6044=(_0x207102+0x1)%_0x5c6f0f||_0x5c6f0f,_0x3a7ba8=_0x514925===0x1?_0x514925:_0x5c6f0f===0x1?_0x207102%_0x514925+0x1:Math['floor'](_0x207102/_0x514925)+0x1;return[(_0x2c6044-0x1)*_0x141fb1*_0x5cbdc4,(_0x3a7ba8-0x1)*_0x12b215*_0x5cbdc4];}