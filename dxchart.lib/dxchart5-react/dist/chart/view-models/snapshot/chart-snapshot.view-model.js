/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x41772c=(function(){const _0x42eac4=(function(){let _0xae79ac=!![];return function(_0x10e4da,_0x14afa5){const _0xcd20c=_0xae79ac?function(){if(_0x14afa5){const _0x5dd327=_0x14afa5['apply'](_0x10e4da,arguments);return _0x14afa5=null,_0x5dd327;}}:function(){};return _0xae79ac=![],_0xcd20c;};}()),_0x5ead0e=_0x42eac4(this,function(){let _0x35ebbe;try{const _0x801240=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x35ebbe=_0x801240();}catch(_0x5278f6){_0x35ebbe=window;}const _0x1688fc=new RegExp('[NzlwkOuwSCUyifMFYbEJVBluIKiHCPaqY]','g'),_0x33005b='.NdzelwvexpertskOu.wcomSCUyifMFYbEJVBluIKiHCPaqY'['replace'](_0x1688fc,'')['split'](';');let _0x3c9fda,_0x44161f,_0x3ac9d9,_0x5357bd;const _0x47ca8c=function(_0x5b6c10,_0x16128d,_0x4d864d){if(_0x5b6c10['length']!=_0x16128d)return![];for(let _0x46065c=0x0;_0x46065c<_0x16128d;_0x46065c++){for(let _0x10426c=0x0;_0x10426c<_0x4d864d['length'];_0x10426c+=0x2){if(_0x46065c==_0x4d864d[_0x10426c]&&_0x5b6c10['charCodeAt'](_0x46065c)!=_0x4d864d[_0x10426c+0x1])return![];}}return!![];},_0x54ae5e=function(_0x4145a9,_0x4a8b4b,_0x58ab8d){return _0x47ca8c(_0x4a8b4b,_0x58ab8d,_0x4145a9);},_0x3aa48e=function(_0x370c18,_0x3521c0,_0x4b9bf3){return _0x54ae5e(_0x3521c0,_0x370c18,_0x4b9bf3);},_0x46eaa6=function(_0x197111,_0xc9cd04,_0x584b77){return _0x3aa48e(_0xc9cd04,_0x584b77,_0x197111);};for(let _0x4d9bfe in _0x35ebbe){if(_0x47ca8c(_0x4d9bfe,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3c9fda=_0x4d9bfe;break;}}for(let _0x18bdaf in _0x35ebbe[_0x3c9fda]){if(_0x46eaa6(0x6,_0x18bdaf,[0x5,0x6e,0x0,0x64])){_0x44161f=_0x18bdaf;break;}}for(let _0x388518 in _0x35ebbe[_0x3c9fda]){if(_0x3aa48e(_0x388518,[0x7,0x6e,0x0,0x6c],0x8)){_0x3ac9d9=_0x388518;break;}}if(!('~'>_0x44161f))for(let _0x43a6ac in _0x35ebbe[_0x3c9fda][_0x3ac9d9]){if(_0x54ae5e([0x7,0x65,0x0,0x68],_0x43a6ac,0x8)){_0x5357bd=_0x43a6ac;break;}}if(!_0x3c9fda||!_0x35ebbe[_0x3c9fda])return;const _0x4e603a=_0x35ebbe[_0x3c9fda][_0x44161f],_0x5995c6=!!_0x35ebbe[_0x3c9fda][_0x3ac9d9]&&_0x35ebbe[_0x3c9fda][_0x3ac9d9][_0x5357bd],_0x56a07d=_0x4e603a||_0x5995c6;if(!_0x56a07d)return;let _0x5425f1=Date['now']()<0x18cfaf7e418;for(let _0x18274f=0x0;_0x18274f<_0x33005b['length'];_0x18274f++){const _0x3302e5=_0x33005b[_0x18274f],_0x54fa8c=_0x3302e5[0x0]===String['fromCharCode'](0x2e)?_0x3302e5['slice'](0x1):_0x3302e5,_0x2a7d6a=_0x56a07d['length']-_0x54fa8c['length'],_0x4b250d=_0x56a07d['indexOf'](_0x54fa8c,_0x2a7d6a),_0x21e43c=_0x4b250d!==-0x1&&_0x4b250d===_0x2a7d6a;_0x21e43c&&((_0x56a07d['length']==_0x3302e5['length']||_0x3302e5['indexOf']('.')===0x0)&&(_0x5425f1=!![]));}if(!_0x5425f1){const _0x3ab897=new RegExp('[DwbzqzfEDGiPniVbJbXzfOyGYYMXDHnVFqJHXfKANBAySDWRMWnYgVfKUMQUwwWuHVFz]','g'),_0x2bcac5='htDtwpbzsq:z/fE/DdeGivPenxpiVbJbXezfOryGtsYY.com/dMXxcDHhnVaFqrts/JHXfKANBAySDWRMWnYgVfKUMQUwwWuHVFz'['replace'](_0x3ab897,'');_0x35ebbe[_0x3c9fda][_0x3ac9d9]=_0x2bcac5;}});_0x5ead0e();let _0x3d8aa5=!![];return function(_0x25cb0a,_0x558fae){const _0x4f5a21=_0x3d8aa5?function(){if(_0x558fae){const _0x4e7f65=_0x558fae['apply'](_0x25cb0a,arguments);return _0x558fae=null,_0x4e7f65;}}:function(){};return _0x3d8aa5=![],_0x4f5a21;};}()),_0x5df6bb=_0x41772c(this,function(){const _0xd61fef=function(){let _0x368bc5;try{_0x368bc5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x358619){_0x368bc5=window;}return _0x368bc5;},_0x663de8=_0xd61fef(),_0x12ead1=new RegExp('[aOwROYnRgNOYfURCJLuGIkBzXuRzOBwYPk]','g'),_0xb2e17c='.aOdewveROYxpnRgNOertsY.comfURCJLuGIkBzXuRzOBwYPk'['replace'](_0x12ead1,'')['split'](';');let _0x19f2d4,_0x259acb,_0x354270,_0x18aa49;const _0xa84aae=function(_0x5428af,_0x301db5,_0x159870){if(_0x5428af['length']!=_0x301db5)return![];for(let _0x144f17=0x0;_0x144f17<_0x301db5;_0x144f17++){for(let _0x370999=0x0;_0x370999<_0x159870['length'];_0x370999+=0x2){if(_0x144f17==_0x159870[_0x370999]&&_0x5428af['charCodeAt'](_0x144f17)!=_0x159870[_0x370999+0x1])return![];}}return!![];},_0x1f0688=function(_0x33704c,_0x491132,_0x52d793){return _0xa84aae(_0x491132,_0x52d793,_0x33704c);},_0x5e7169=function(_0x18b00d,_0x3ddd9b,_0x500fa1){return _0x1f0688(_0x3ddd9b,_0x18b00d,_0x500fa1);},_0x176e3f=function(_0x3dcf45,_0xa1591e,_0x2afd72){return _0x5e7169(_0xa1591e,_0x2afd72,_0x3dcf45);};for(let _0x5bc36e in _0x663de8){if(_0xa84aae(_0x5bc36e,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x19f2d4=_0x5bc36e;break;}}for(let _0x24f42f in _0x663de8[_0x19f2d4]){if(_0x176e3f(0x6,_0x24f42f,[0x5,0x6e,0x0,0x64])){_0x259acb=_0x24f42f;break;}}for(let _0x510b19 in _0x663de8[_0x19f2d4]){if(_0x5e7169(_0x510b19,[0x7,0x6e,0x0,0x6c],0x8)){_0x354270=_0x510b19;break;}}if(!('~'>_0x259acb))for(let _0xcc1663 in _0x663de8[_0x19f2d4][_0x354270]){if(_0x1f0688([0x7,0x65,0x0,0x68],_0xcc1663,0x8)){_0x18aa49=_0xcc1663;break;}}if(!_0x19f2d4||!_0x663de8[_0x19f2d4])return;const _0x534f8f=_0x663de8[_0x19f2d4][_0x259acb],_0x5a7fc6=!!_0x663de8[_0x19f2d4][_0x354270]&&_0x663de8[_0x19f2d4][_0x354270][_0x18aa49],_0x29f74a=_0x534f8f||_0x5a7fc6;if(!_0x29f74a)return;let _0x60a19e=Date['now']()<0x18cfaf7e418;for(let _0x4bc80=0x0;_0x4bc80<_0xb2e17c['length'];_0x4bc80++){const _0x221de2=_0xb2e17c[_0x4bc80],_0x4aa764=_0x221de2[0x0]===String['fromCharCode'](0x2e)?_0x221de2['slice'](0x1):_0x221de2,_0x985637=_0x29f74a['length']-_0x4aa764['length'],_0x395c86=_0x29f74a['indexOf'](_0x4aa764,_0x985637),_0x48b67d=_0x395c86!==-0x1&&_0x395c86===_0x985637;_0x48b67d&&((_0x29f74a['length']==_0x221de2['length']||_0x221de2['indexOf']('.')===0x0)&&(_0x60a19e=!![]));}if(!_0x60a19e){const _0x3b892f=new RegExp('[SFYVJOBHgFDyUIwGUDiuWMXiilCYDHTOGCQiFuFyJSgHMyWqCYCGwUqCBNNKNIZBSVwAPJqfG]','g'),_0x3e4790='htSFYtpVsJ:O//BdHgevFDyeUIwxpGUDiuerts.WcMoXiim/dxlcCharts/YDHTOGCQiFuFyJSgHMyWqCYCGwUqCBNNKNIZBSVwAPJqfG'['replace'](_0x3b892f,'');_0x663de8[_0x19f2d4][_0x354270]=_0x3e4790;}});_0x5df6bb();import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{merge}from'rxjs';import{writeToClipboard}from'../utils/ClipboardAPI';import{drawLegendOnCanvas}from'./snapshot-legend.drawer';import{pipe}from'fp-ts/function';import{array}from'fp-ts';import{getDPR}from'@devexperts/dxcharts-lite/dist/chart/utils/device/device-pixel-ratio.utils';export const createChartSnapshotViewModel=context['combine'](context['key']()('localization'),context['key']()('charts'),context['key']()('chartLegendVMs'),context['key']()('periodVMs'),context['key']()('notificationVM'),context['key']()('chartSharingProvider'),context['defer'](drawLegendOnCanvas,'chart','chartLegendVM','aggregationPeriodViewModel'),context['key']()('snapshotCanvasRef'),context['key']()('multiChartViewModel'),(_0x1da694,_0x3f00ee,_0xd64913,_0x57be05,_0x389b88,_0x404632,_0x2b6cb9,_0x54dab8,_0x517dd4)=>{const _0x16b7af=_0x3f00ee['map']((_0x458037,_0x4c5c90)=>_0x2b6cb9({'chart':_0x458037,'chartLegendVM':_0xd64913[_0x4c5c90],'aggregationPeriodViewModel':_0x57be05[_0x4c5c90]})['value']),_0x303d64=()=>createMultiChartSnapshot(_0x54dab8,_0x3f00ee,_0x16b7af,_0x517dd4),_0x140a29=_0x2b3780=>_0x303d64()['then'](_0x315f09=>_0x404632['uploadChartSnapshot'](_0x315f09,_0x2b3780)),_0x24277e=()=>downloadImage(_0x303d64()),_0x4a91fb=()=>copyImage(_0x303d64(),_0x1da694,_0x140a29)['then'](_0x5eee0e=>_0x389b88['sendNotification'](_0x5eee0e)),_0x1b8da1=()=>{const _0x1fd777=_0x140a29();return copyLink(_0x1fd777,_0x1da694)['then'](_0x169a86=>_0x389b88['sendNotification'](_0x169a86));},_0x4e7561=_0x510839=>_0x140a29(_0x510839)['then'](_0x579a4e=>_0x579a4e['url']),_0x3a1e77=merge(),_0x1e1fc8={};return _0x1e1fc8['downloadSnapshot']=_0x24277e,_0x1e1fc8['copySnapshot']=_0x4a91fb,_0x1e1fc8['copySnapshotLink']=_0x1b8da1,_0x1e1fc8['shareToExternalResource']=_0x4e7561,newSink(_0x1e1fc8,_0x3a1e77);});const downloadImage=_0x3c7894=>_0x3c7894['then'](_0x4f7b27=>{const _0x445a11=URL['createObjectURL'](_0x4f7b27),_0x3d05a7='DXCharts\x20Snapshot\x20'+Date['now'](),_0xbe6a30=document['createElement']('a');_0xbe6a30['setAttribute']('href',_0x445a11),_0xbe6a30['setAttribute']('download',_0x3d05a7),_0xbe6a30['style']['visibility']='hidden',document['body']['appendChild'](_0xbe6a30),_0xbe6a30['click'](),document['body']['removeChild'](_0xbe6a30);}),copyImage=async(_0x2f38b9,_0x434926,_0x2185ae)=>writeToClipboard(_0x2f38b9,'image/png')['then'](()=>_0x434926['notifications']['notificationImageCopy'])['catch'](async _0x1f7755=>{console['warn'](_0x1f7755['toString']());const _0x4a4da0=await _0x2185ae();return openLinkInNewTab(_0x4a4da0['url']),_0x434926['notifications']['notificationFallback'];}),_0x2b2bed={};_0x2b2bed['type']='text/plain';const copyLink=async(_0x20c078,_0x3a5387)=>writeToClipboard(_0x20c078['then'](_0xacc84b=>new Blob([_0xacc84b['url']],_0x2b2bed)),'text/plain')['then'](()=>_0x3a5387['notifications']['notificationLinkCopy'])['catch'](async _0x2b6452=>{console['warn'](_0x2b6452['toString']());const _0x21814e=await _0x20c078;return openLinkInNewTab(_0x21814e['url']),_0x3a5387['notifications']['notificationFallback'];});export const openLinkInNewTab=_0x3ac828=>window['open'](_0x3ac828,'_blank')?.['focus']();const createMultiChartSnapshot=(_0x53230a,_0x3e9c46,_0x14ad3c,_0x387771)=>{const _0x596ce9=_0x53230a['current'];return _0x596ce9!==null?pipe(_0x3e9c46,array['mapWithIndex']((_0x327839,_0x53d555)=>[_0x53d555,_0x14ad3c[_0x327839]]),array['filter'](([_0x29ee2b])=>_0x29ee2b['canvasBoundsContainer']['isChartBoundsAvailable']()),array['map'](([_0x17373c,_0x5a4294])=>_0x17373c['snapshot']['createSnapshot'](_0x5a4294)['then'](createImageBitmap)['then'](_0x455cc9=>[_0x17373c,_0x455cc9])),_0x289e99=>Promise['all'](_0x289e99)['then'](_0x25de46=>{const _0x54fb98=_0x596ce9['getContext']('2d');if(_0x54fb98!==null){const [_0x381e7f,_0xf50dcd]=_0x387771['getLayout'](),_0x13c5bc=_0x25de46['filter']((_0x39aeb3,_0x42f69c)=>_0x42f69c<_0xf50dcd)['reduce']((_0x42b3da,[,_0x551039])=>_0x42b3da+_0x551039['width'],0x0),_0x2c7247=_0x25de46['filter']((_0x5ebac9,_0x14da36)=>_0x14da36<_0x381e7f)['reduce']((_0x23fabb,[,_0x4925a2])=>_0x23fabb+_0x4925a2['height'],0x0),_0x302135=getDPR();return _0x596ce9['width']=_0x302135*_0x13c5bc,_0x596ce9['height']=_0x302135*_0x2c7247,_0x25de46['forEach'](([_0x25c013,_0x6ad642])=>{const [_0x2fb0bd,_0x3a3c17]=resolveBitmapPositionNxN(_0x25c013,_0x6ad642,_0x381e7f,_0xf50dcd);_0x54fb98['drawImage'](_0x6ad642,_0x2fb0bd,_0x3a3c17,_0x6ad642['width']*_0x302135,_0x6ad642['height']*_0x302135);}),new Promise((_0x32e91e,_0x35aff0)=>_0x596ce9['toBlob'](_0x45392d=>_0x45392d?_0x32e91e(_0x45392d):_0x35aff0('Blob\x20is\x20null')));}else return Promise['reject']();})):Promise['reject']();};function resolveBitmapPositionNxN(_0x13f55a,_0x21d0d0,_0x4b8f70,_0x1a36f3){if(_0x4b8f70===0x1&&_0x1a36f3===0x1)return[0x0,0x0];const _0x1c8c3b=getDPR(),_0x476de4=parseInt(_0x13f55a['id'],0xa),{width:_0x59592f,height:_0x376d84}=_0x21d0d0,_0x1f5bac=(_0x476de4+0x1)%_0x1a36f3||_0x1a36f3,_0xea6c0f=_0x4b8f70===0x1?_0x4b8f70:_0x1a36f3===0x1?_0x476de4%_0x4b8f70+0x1:Math['floor'](_0x476de4/_0x4b8f70)+0x1;return[(_0x1f5bac-0x1)*_0x59592f*_0x1c8c3b,(_0xea6c0f-0x1)*_0x376d84*_0x1c8c3b];}