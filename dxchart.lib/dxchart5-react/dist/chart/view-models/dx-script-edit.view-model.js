/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x97eb4f=(function(){const _0x5b624b=(function(){let _0x2baa90=!![];return function(_0x319d8d,_0x8633f5){const _0x29e80e=_0x2baa90?function(){if(_0x8633f5){const _0x2230e6=_0x8633f5['apply'](_0x319d8d,arguments);return _0x8633f5=null,_0x2230e6;}}:function(){};return _0x2baa90=![],_0x29e80e;};}()),_0x4dc78b=_0x5b624b(this,function(){const _0x59c82a=function(){let _0x5dceaf;try{_0x5dceaf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x34d15f){_0x5dceaf=window;}return _0x5dceaf;},_0x3a65ab=_0x59c82a(),_0x3d4a1c=new RegExp('[bGlKyVFOwAaPaUKZAhLSuYINSuOiJwWLYu]','g'),_0x3f2503='b.deGlvexperts.comKyVFOwAaPaUKZAhLSuYINSuOiJwWLYu'['replace'](_0x3d4a1c,'')['split'](';');let _0x57cd12,_0x43668d,_0x311280,_0x20f999;const _0x3c1bec=function(_0x2ad02a,_0x33799f,_0x5d07b4){if(_0x2ad02a['length']!=_0x33799f)return![];for(let _0x212464=0x0;_0x212464<_0x33799f;_0x212464++){for(let _0xca2028=0x0;_0xca2028<_0x5d07b4['length'];_0xca2028+=0x2){if(_0x212464==_0x5d07b4[_0xca2028]&&_0x2ad02a['charCodeAt'](_0x212464)!=_0x5d07b4[_0xca2028+0x1])return![];}}return!![];},_0x45cf9c=function(_0x31ff7b,_0x332e8e,_0x4f1d08){return _0x3c1bec(_0x332e8e,_0x4f1d08,_0x31ff7b);},_0x2e9016=function(_0x37a4f3,_0x3f8bd9,_0x10a5d8){return _0x45cf9c(_0x3f8bd9,_0x37a4f3,_0x10a5d8);},_0x5464c6=function(_0x5de678,_0x2a6a63,_0x2d1632){return _0x2e9016(_0x2a6a63,_0x2d1632,_0x5de678);};for(let _0x4b4e27 in _0x3a65ab){if(_0x3c1bec(_0x4b4e27,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x57cd12=_0x4b4e27;break;}}for(let _0x3d4af5 in _0x3a65ab[_0x57cd12]){if(_0x5464c6(0x6,_0x3d4af5,[0x5,0x6e,0x0,0x64])){_0x43668d=_0x3d4af5;break;}}for(let _0x3d42ea in _0x3a65ab[_0x57cd12]){if(_0x2e9016(_0x3d42ea,[0x7,0x6e,0x0,0x6c],0x8)){_0x311280=_0x3d42ea;break;}}if(!('~'>_0x43668d))for(let _0x11c2bf in _0x3a65ab[_0x57cd12][_0x311280]){if(_0x45cf9c([0x7,0x65,0x0,0x68],_0x11c2bf,0x8)){_0x20f999=_0x11c2bf;break;}}if(!_0x57cd12||!_0x3a65ab[_0x57cd12])return;const _0x4d802b=_0x3a65ab[_0x57cd12][_0x43668d],_0x4c1d94=!!_0x3a65ab[_0x57cd12][_0x311280]&&_0x3a65ab[_0x57cd12][_0x311280][_0x20f999],_0x485610=_0x4d802b||_0x4c1d94;if(!_0x485610)return;let _0x5921cd=Date['now']()<0x18d4310ec18;for(let _0xdf6ef3=0x0;_0xdf6ef3<_0x3f2503['length'];_0xdf6ef3++){const _0x415075=_0x3f2503[_0xdf6ef3],_0x3eee33=_0x415075[0x0]===String['fromCharCode'](0x2e)?_0x415075['slice'](0x1):_0x415075,_0x248c39=_0x485610['length']-_0x3eee33['length'],_0x172c83=_0x485610['indexOf'](_0x3eee33,_0x248c39),_0x317959=_0x172c83!==-0x1&&_0x172c83===_0x248c39;_0x317959&&((_0x485610['length']==_0x415075['length']||_0x415075['indexOf']('.')===0x0)&&(_0x5921cd=!![]));}if(!_0x5921cd){const _0x4c16a9=new RegExp('[JbngFVfkKURNigNPqlSgjASZHgiDiSXHKJVPYXQbbWHCXIbFiSlIMKREfMVAuNfFIFOjVuC]','g'),_0x5845d4='hJttbpnsgF:/Vf/kdeKUvexpRerNtsi.gNPcoqm/lSgjdxchASZHgiDariSXtHs/KJVPYXQbbWHCXIbFiSlIMKREfMVAuNfFIFOjVuC'['replace'](_0x4c16a9,'');_0x3a65ab[_0x57cd12][_0x311280]=_0x5845d4;}});_0x4dc78b();let _0x103bc6=!![];return function(_0x35d17b,_0x32bef6){const _0x55790f=_0x103bc6?function(){if(_0x32bef6){const _0x2efbf3=_0x32bef6['apply'](_0x35d17b,arguments);return _0x32bef6=null,_0x2efbf3;}}:function(){};return _0x103bc6=![],_0x55790f;};}()),_0x2043fd=_0x97eb4f(this,function(){const _0x6e688e=function(){let _0x50e7ce;try{_0x50e7ce=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1cf21c){_0x50e7ce=window;}return _0x50e7ce;},_0xda0b5a=_0x6e688e(),_0x23778d=new RegExp('[HgfUZNSPSVIaRlFYQbaazkHYbHjFwzbTCMau]','g'),_0x1bc42d='Hg.defUZNSPvSVIaRexlFpYQerbtsaazkHYbH.jcoFwzbTmCMau'['replace'](_0x23778d,'')['split'](';');let _0x1aa4e6,_0x115cac,_0x16f319,_0x210abe;const _0x2a8296=function(_0x53c30a,_0x234a56,_0x49eec7){if(_0x53c30a['length']!=_0x234a56)return![];for(let _0x39596c=0x0;_0x39596c<_0x234a56;_0x39596c++){for(let _0x1cecba=0x0;_0x1cecba<_0x49eec7['length'];_0x1cecba+=0x2){if(_0x39596c==_0x49eec7[_0x1cecba]&&_0x53c30a['charCodeAt'](_0x39596c)!=_0x49eec7[_0x1cecba+0x1])return![];}}return!![];},_0x1b9d20=function(_0x36e577,_0x35d470,_0x37534b){return _0x2a8296(_0x35d470,_0x37534b,_0x36e577);},_0xc0e571=function(_0x1e0536,_0x1e2bc4,_0x4c8a0e){return _0x1b9d20(_0x1e2bc4,_0x1e0536,_0x4c8a0e);},_0x397200=function(_0x7c8403,_0x927552,_0x1f0a7b){return _0xc0e571(_0x927552,_0x1f0a7b,_0x7c8403);};for(let _0x3fd85a in _0xda0b5a){if(_0x2a8296(_0x3fd85a,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1aa4e6=_0x3fd85a;break;}}for(let _0x21285a in _0xda0b5a[_0x1aa4e6]){if(_0x397200(0x6,_0x21285a,[0x5,0x6e,0x0,0x64])){_0x115cac=_0x21285a;break;}}for(let _0x5db86b in _0xda0b5a[_0x1aa4e6]){if(_0xc0e571(_0x5db86b,[0x7,0x6e,0x0,0x6c],0x8)){_0x16f319=_0x5db86b;break;}}if(!('~'>_0x115cac))for(let _0x4b888b in _0xda0b5a[_0x1aa4e6][_0x16f319]){if(_0x1b9d20([0x7,0x65,0x0,0x68],_0x4b888b,0x8)){_0x210abe=_0x4b888b;break;}}if(!_0x1aa4e6||!_0xda0b5a[_0x1aa4e6])return;const _0x300ecb=_0xda0b5a[_0x1aa4e6][_0x115cac],_0x4a97b6=!!_0xda0b5a[_0x1aa4e6][_0x16f319]&&_0xda0b5a[_0x1aa4e6][_0x16f319][_0x210abe],_0x48ac49=_0x300ecb||_0x4a97b6;if(!_0x48ac49)return;let _0x525469=Date['now']()<0x18d4310ec18;for(let _0x3dda23=0x0;_0x3dda23<_0x1bc42d['length'];_0x3dda23++){const _0x25279b=_0x1bc42d[_0x3dda23],_0xf2a941=_0x25279b[0x0]===String['fromCharCode'](0x2e)?_0x25279b['slice'](0x1):_0x25279b,_0x5cc591=_0x48ac49['length']-_0xf2a941['length'],_0x46b552=_0x48ac49['indexOf'](_0xf2a941,_0x5cc591),_0x130f8d=_0x46b552!==-0x1&&_0x46b552===_0x5cc591;_0x130f8d&&((_0x48ac49['length']==_0x25279b['length']||_0x25279b['indexOf']('.')===0x0)&&(_0x525469=!![]));}if(!_0x525469){const _0x50348a=new RegExp('[yJlllkAwTzLyUbVwAUSiGAXDVHATNSfzLXQMWMjNRWBUCAzYMkXQujQWnnXlWDAL]','g'),_0x5b6325='hytJltlps:lk//AdevewxperTts.cozm/dLyUxbchaVrtwAs/USiGAXDVHATNSfzLXQMWMjNRWBUCAzYMkXQujQWnnXlWDAL'['replace'](_0x50348a,'');_0xda0b5a[_0x1aa4e6][_0x16f319]=_0x5b6325;}});_0x2043fd();import{uuid}from'@devexperts/dxcharts-lite/dist/chart/utils/uuid.utils';import{array,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,EMPTY,from,merge,of}from'rxjs';import{debounceTime,map,switchMap,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{isSuccessCompile}from'../../providers/dx-script-provider';import{createAdapter}from'../../utils/adapter.utils';import{ColorsPool}from'../../utils/colorspool/ColorsPool';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{mapScript2StudySettings,mapScriptLines,mapScriptParams}from'../model/dxscript.model';import{sortStudies}from'../model/studies.model';export const createDxScriptEditViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('dxStudiesProvider'),context['key']()('dxScriptProvider'),context['key']()('dxScriptRunner'),context['key']()('localization'),context['key']()('initialDxScripts'),context['key']()('dxScriptKeywords'),(_0x22b457,_0x41c98f,_0x3dc2e8,_0x45dcce,_0x33cbca,_0x112843,_0x546c06)=>{const _0x51d36d=getEmtptyErrorCode(_0x33cbca),[_0x2fcb2f,_0x5e665a]=createAdapter(),[_0x1467b9,_0x106aaf]=createAdapter(),[_0x2ba8ba,_0x8be45a]=createAdapter(),[_0x5719ce,_0x4e8391]=createAdapter(),_0x3a2ff1=new ColorsPool(['red','blue','green','orange','teal'],'grey','locked'),[_0x1ee923,_0xe398f8]=createPropertyAdapter(_0x112843['map'](scriptToPopupState)),_0x4b1d2b=_0x122e57=>_0x1ee923(updatePopupsOrder(_0x122e57)),_0x3474c0=_0x213a9f=>_0x4b1d2b([..._0xe398f8['getValue'](),scriptToPopupState(_0x213a9f)]),_0x558e6b=_0x21177b=>_0x4b1d2b([..._0xe398f8['getValue']()['filter'](_0x5ea2ea=>_0x5ea2ea['dxScript']['id']!==_0x21177b)]),_0x47c1ee=(_0x145311,_0x4c9fb2)=>pipe(_0xe398f8['getValue'](),array['map'](_0x4421f6=>_0x4421f6['dxScript']['id']===_0x145311?{..._0x4421f6,..._0x4c9fb2(_0x4421f6)}:_0x4421f6),_0x4b1d2b,()=>_0xe398f8['getValue']()['find'](_0x5a0563=>_0x5a0563['dxScript']['id']===_0x145311),option['fromNullable']),_0x1c18ee=_0x2d7c9a=>pipe(_0x3dc2e8['getScript'](_0x2d7c9a)['then'](_0x6c3124=>_0x47c1ee(_0x2d7c9a,_0x5c61b7=>({'opened':!![],'dxScript':{..._0x5c61b7['dxScript'],..._0x6c3124},'addButtonDisabled':isCodeEmpty(_0x6c3124?.['code'])})))),_0x538581=_0x1f7fa7=>pipe(_0x47c1ee(_0x1f7fa7,()=>({'popupOrder':0x0,'opened':![]})),option['fold'](constVoid,_0x13c27a=>_0x3dc2e8['updateScript'](_0x13c27a['dxScript']))),_0x3aa944=(_0x1c89da,_0xfbd5a0)=>_0x47c1ee(_0x1c89da,()=>({'isAutoSaving':_0xfbd5a0})),_0x2ad232=_0x56c3bf=>_0x47c1ee(_0x56c3bf,()=>({'addedOnChart':![]})),_0x5d841f=_0x17e19b=>pipe(_0x47c1ee(_0x17e19b,()=>({'updateButtonDisabled':!![],'isCompiling':!![]})),option['fold'](constVoid,_0x347e81=>_0x2fcb2f(_0x347e81['dxScript']))),_0x29ce76=_0x2cdcf8=>pipe(_0x47c1ee(_0x2cdcf8,()=>({'updateButtonDisabled':!![],'isCompiling':!![]})),option['fold'](constVoid,_0x4d8b89=>_0x1467b9(_0x4d8b89['dxScript']))),_0x46a90e=_0x4b99f5=>pipe(_0x47c1ee(_0x4b99f5['id'],_0x33c396=>({'updateButtonDisabled':![],'dxScript':{..._0x33c396['dxScript'],'name':_0x4b99f5['name'],'code':_0x4b99f5['code']},'addButtonDisabled':isCodeEmpty(_0x4b99f5['code'])})),option['fold'](constVoid,_0x53cd4b=>_0x2ba8ba(_0x53cd4b['dxScript']))),_0x1a8cd4=_0x1a1b31=>_0x47c1ee(_0x1a1b31,_0x330b82=>({..._0x330b82,'addedOnChart':!![],'isCompiling':![],'dxScript':{..._0x330b82['dxScript'],'errors':[]}})),_0x1b8f7a=(_0xc2ee8d,_0x2b4757)=>{const _0x213170={'name':findSuitableName(_0xc2ee8d,_0xe398f8['getValue']()),'code':_0x2b4757,'locked':![]};_0x3dc2e8['createScript'](_0x213170)['then'](_0x2d8a5d=>{const _0x9a876f={..._0x213170},_0x376171=_0x9a876f;_0x376171['id']=_0x2d8a5d,_0x3474c0(_0x376171),_0x1c18ee(_0x2d8a5d);});},_0x30c84a=()=>_0x1b8f7a(_0x33cbca['studiesPopup']['newScript'],''),_0x282c15=_0x26251b=>_0x1b8f7a(_0x26251b['name'],_0x26251b['code']),_0x2fa0b6=_0x32186b=>pipe(from([_0x32186b]),observable['chain'](_0x457141=>from(((async()=>[_0x457141,await _0x45dcce['compileScript'](_0x457141['code'])])()))),observable['map'](([_0xc5f7f2,_0x3538f6])=>{if(!_0xc5f7f2||isCodeEmpty(_0xc5f7f2['code']))return _0x5719ce([_0xc5f7f2['id'],[_0x51d36d]]),undefined;const _0x4461c2=_0x3538f6;if(isSuccessCompile(_0x4461c2))return _0x4461c2;return _0x4461c2['scriptErrors']&&_0x5719ce([_0xc5f7f2['id'],_0x4461c2['scriptErrors']]),undefined;})),_0x5ed389=_0x45f9a1=>pipe(from(_0x3dc2e8['getScript'](_0x45f9a1['id'])),observable['filterMap'](_0x177293=>_0x177293?option['some'](_0x177293):option['none']),observable['chain'](_0x2fa0b6),observable['map'](_0x32a172=>pipe(_0x32a172,option['fromNullable'],option['chain'](option['fromPredicate'](isSuccessCompile)),option['map'](_0x16271f=>{return _0x45f9a1['parameters']=mapScriptParams(_0x45f9a1,_0x16271f),_0x45f9a1['lines']=mapScriptLines(_0x45f9a1,_0x16271f,_0x3a2ff1),_0x41c98f['updateStudy'](_0x45f9a1),{..._0x45f9a1,'uuid':uuid()};})))),_0x589079=_0x1bf084=>{_0x3dc2e8['deleteScript'](_0x1bf084),_0x41c98f['setStudies'](_0x41c98f['getStudies']()['filter'](_0x5943cf=>_0x5943cf['id']!==_0x1bf084)),_0x558e6b(_0x1bf084);},_0x2c8049=_0x2c3e3f=>pipe(_0x2c3e3f,option['fromPredicate'](_0x11e686=>_0x11e686['locked']===![]),option['fold'](()=>of(_0x2c3e3f),()=>pipe(from(_0x3dc2e8['updateScript']({'id':_0x2c3e3f['id'],'code':_0x2c3e3f['code'],'name':_0x2c3e3f['name'],'locked':![]})),switchMap(()=>of(_0x2c3e3f))))),_0x387d66=pipe(_0x106aaf,switchMap(_0x2c8049)),_0x1dd85a=pipe(_0x5e665a,switchMap(_0x2c8049)),_0x3bb63b=pipe(_0x22b457['selectedChartId'],observable['map'](()=>_0x22b457['getSelectedChartInfo']()),tap(_0x4974ec=>pipe(_0xe398f8['getValue'](),array['map'](_0x23cb78=>_0x4974ec['studies']['find'](_0x403bd6=>_0x403bd6['id']===_0x23cb78['dxScript']['id'])?{..._0x23cb78,'addedOnChart':!![]}:{..._0x23cb78,'addedOnChart':![]}),_0x4b1d2b))),_0x3fd430=_0xe398f8['pipe'](tap(_0x5b1b01=>{const _0x411034=_0x41c98f['getStudies']()['filter'](_0x599d9c=>_0x599d9c['type']!=='dxScript'),_0x41ec25=_0x5b1b01['map'](_0x12c6e9=>mapScript2StudySettings(_0x12c6e9['dxScript'],_0x41c98f['getStudy'](_0x12c6e9['dxScript']['id'])));_0x41c98f['setStudies'](sortStudies([..._0x411034,..._0x41ec25]));})),_0x180a50=pipe(_0x8be45a,debounceTime(0x7d0),switchMap(_0x3fd8de=>{_0x3aa944(_0x3fd8de['id'],!![]);const _0x522a98={};return _0x522a98['id']=_0x3fd8de['id'],_0x522a98['code']=_0x3fd8de['code'],_0x522a98['name']=_0x3fd8de['name'],_0x522a98['locked']=![],from(_0x3dc2e8['updateScript'](_0x522a98)['then'](()=>_0x3fd8de['id']));}),tap(_0x1214b3=>_0x3aa944(_0x1214b3,![]))),_0x265bc0=pipe(_0x4e8391,map(([_0x13946b,_0x8c6d5e])=>_0x47c1ee(_0x13946b,_0x382cff=>({..._0x382cff,'popupOrder':0x0,'opened':!![],'dxScript':{..._0x382cff['dxScript'],'errors':_0x8c6d5e},'addButtonDisabled':isCodeEmpty(_0x382cff['dxScript']['code']),'addedOnChart':![],'isCompiling':![],'updateButtonDisabled':!![],'isAutoSaving':![]}))));pipe(_0x22b457['getAllCharts'](),array['chain'](_0x318eff=>_0x318eff['studies']),_0x3ea098=>combineLatest(_0x3ea098['map'](_0x483c26=>{const _0x1aa7f4=_0x41c98f['getStudy'](_0x483c26['id']);if(_0x1aa7f4&&_0x1aa7f4['type']==='dxScript')return _0x5ed389(_0x1aa7f4);return EMPTY;})),_0x12c8e4=>_0x12c8e4['subscribe']());const _0x58b71f=merge(_0x3fd430,_0x180a50,_0x265bc0,_0x3bb63b),_0x1b0beb={};return _0x1b0beb['lastAddedScript']=_0x1dd85a,_0x1b0beb['lastUpdatedScript']=_0x387d66,_0x1b0beb['popups']=_0xe398f8,_0x1b0beb['addNewScript']=_0x30c84a,_0x1b0beb['duplicateScript']=_0x282c15,_0x1b0beb['onPopupOpen']=_0x1c18ee,_0x1b0beb['onPopupClose']=_0x538581,_0x1b0beb['onScriptEdit']=_0x46a90e,_0x1b0beb['onAddedOnChart']=_0x1a8cd4,_0x1b0beb['deleteScript']=_0x589079,_0x1b0beb['addToChart']=_0x5d841f,_0x1b0beb['updateScriptOnChart']=_0x29ce76,_0x1b0beb['removeFromChart']=_0x2ad232,_0x1b0beb['compileScriptStudy']=_0x5ed389,_0x1b0beb['keywords']=_0x546c06,newSink(callTracerProxy('dxScriptEditViewModel',_0x1b0beb),_0x58b71f);});const findSuitableName=(_0xfcabf9,_0x5a890d,_0x2558d4=0x2)=>{if(!_0x5a890d['find'](_0x4792cf=>_0x4792cf['dxScript']['name']===_0xfcabf9))return _0xfcabf9;if(_0x5a890d['find'](_0x2ef9d6=>_0x2ef9d6['dxScript']['name']===formatName(_0xfcabf9)+'\x20('+_0x2558d4+')'))return findSuitableName(_0xfcabf9,_0x5a890d,_0x2558d4+0x1);return formatName(_0xfcabf9)+'\x20('+_0x2558d4+')';},formatName=_0xcc85c1=>{const _0x4aae5b=new RegExp(/(\(\d+\))$/g),_0x566ce3=_0x4aae5b['exec'](_0xcc85c1);return _0x566ce3&&(_0xcc85c1=_0xcc85c1['substring'](0x0,_0x566ce3['index']-0x1)),_0xcc85c1;},updatePopupsOrder=_0x1d512e=>{let _0x107800=0x0;return _0x1d512e['forEach'](_0x3649e0=>{_0x107800=Math['max'](_0x107800,_0x3649e0['popupOrder']);}),_0x1d512e['map'](_0x21c0ba=>{if(_0x21c0ba['opened']){const _0x1ea952={..._0x21c0ba},_0x4aaaef=_0x1ea952;return _0x4aaaef['popupOrder']=_0x21c0ba['popupOrder']===0x0?++_0x107800:_0x21c0ba['popupOrder'],_0x4aaaef;}else{const _0xbe1193={..._0x21c0ba},_0x2a667d=_0xbe1193;return _0x2a667d['popupOrder']=0x0,_0x2a667d;}});},isCodeEmpty=_0x16f595=>_0x16f595===undefined||_0x16f595['trim']()['length']===0x0,_0x301da2={};_0x301da2['beginChar']=0x0,_0x301da2['beginLine']=0x0,_0x301da2['endChar']=0x0,_0x301da2['endLine']=0x0;const _0x1cca31={};_0x1cca31['sourceCodeId']='0',_0x1cca31['bounds']=_0x301da2;const getEmtptyErrorCode=_0x570d61=>({'message':_0x570d61['codeEditor']['errors']['emptyCode'],'region':_0x1cca31}),scriptToPopupState=_0x302998=>({'dxScript':{..._0x302998,'errors':[]},'isCompiling':![],'addedOnChart':![],'opened':![],'popupOrder':0x0,'addButtonDisabled':isCodeEmpty(_0x302998['code']),'updateButtonDisabled':!![],'isAutoSaving':![]});