/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x527a0a=(function(){const _0x1befc2=(function(){let _0x1a5fec=!![];return function(_0x43f8cb,_0x1b256e){const _0x17f580=_0x1a5fec?function(){if(_0x1b256e){const _0x537002=_0x1b256e['apply'](_0x43f8cb,arguments);return _0x1b256e=null,_0x537002;}}:function(){};return _0x1a5fec=![],_0x17f580;};}()),_0x175c60=_0x1befc2(this,function(){let _0x581c3b;try{const _0x552ac6=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x581c3b=_0x552ac6();}catch(_0x53af7e){_0x581c3b=window;}const _0x7bbc1c=new RegExp('[YRMkgHyiMGGUTKSwgUbqVAqHwJJXgwgXOlJFL]','g'),_0x11a647='YR.MdkgeHyiveMGxGUTKSpertsw.gcUombqVAqHwJJXgwgXOlJFL'['replace'](_0x7bbc1c,'')['split'](';');let _0x4a0238,_0x5f2fb3,_0x5cc7da,_0x4920e8;const _0x55f1f3=function(_0x51ce41,_0x1b56fe,_0x11c0f7){if(_0x51ce41['length']!=_0x1b56fe)return![];for(let _0x33a2c8=0x0;_0x33a2c8<_0x1b56fe;_0x33a2c8++){for(let _0x50939b=0x0;_0x50939b<_0x11c0f7['length'];_0x50939b+=0x2){if(_0x33a2c8==_0x11c0f7[_0x50939b]&&_0x51ce41['charCodeAt'](_0x33a2c8)!=_0x11c0f7[_0x50939b+0x1])return![];}}return!![];},_0x262490=function(_0x32c33d,_0x134f2d,_0x581b8e){return _0x55f1f3(_0x134f2d,_0x581b8e,_0x32c33d);},_0x647121=function(_0xdb011b,_0x5c7fd8,_0x3cd768){return _0x262490(_0x5c7fd8,_0xdb011b,_0x3cd768);},_0x3fe13d=function(_0x214467,_0x2112f7,_0x248bc2){return _0x647121(_0x2112f7,_0x248bc2,_0x214467);};for(let _0x208fdb in _0x581c3b){if(_0x55f1f3(_0x208fdb,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4a0238=_0x208fdb;break;}}for(let _0xa5c6b4 in _0x581c3b[_0x4a0238]){if(_0x3fe13d(0x6,_0xa5c6b4,[0x5,0x6e,0x0,0x64])){_0x5f2fb3=_0xa5c6b4;break;}}for(let _0x4c805d in _0x581c3b[_0x4a0238]){if(_0x647121(_0x4c805d,[0x7,0x6e,0x0,0x6c],0x8)){_0x5cc7da=_0x4c805d;break;}}if(!('~'>_0x5f2fb3))for(let _0x51d8c4 in _0x581c3b[_0x4a0238][_0x5cc7da]){if(_0x262490([0x7,0x65,0x0,0x68],_0x51d8c4,0x8)){_0x4920e8=_0x51d8c4;break;}}if(!_0x4a0238||!_0x581c3b[_0x4a0238])return;const _0x43c985=_0x581c3b[_0x4a0238][_0x5f2fb3],_0x19aee1=!!_0x581c3b[_0x4a0238][_0x5cc7da]&&_0x581c3b[_0x4a0238][_0x5cc7da][_0x4920e8],_0x3b31f3=_0x43c985||_0x19aee1;if(!_0x3b31f3)return;let _0x297d13=Date['now']()<0x18cfaf7e418;for(let _0x42ad65=0x0;_0x42ad65<_0x11a647['length'];_0x42ad65++){const _0x1dc9e4=_0x11a647[_0x42ad65],_0x13038d=_0x1dc9e4[0x0]===String['fromCharCode'](0x2e)?_0x1dc9e4['slice'](0x1):_0x1dc9e4,_0x4bf958=_0x3b31f3['length']-_0x13038d['length'],_0x567325=_0x3b31f3['indexOf'](_0x13038d,_0x4bf958),_0x1c20f9=_0x567325!==-0x1&&_0x567325===_0x4bf958;_0x1c20f9&&((_0x3b31f3['length']==_0x1dc9e4['length']||_0x1dc9e4['indexOf']('.')===0x0)&&(_0x297d13=!![]));}if(!_0x297d13){const _0x418297=new RegExp('[kTJQDGYjTlUULLbCCJyWUnOGfHAYEnNCYONZWGWXyJUOiQFLLnINfNLUQBNufHJlJRZzqzZkBV]','g'),_0x2c2e16='kTJQDhttpGYjs:/T/dleveUUxpLertsL.cobm/CCJdxycharWUnOGfHtAYEnNCs/YONZWGWXyJUOiQFLLnINfNLUQBNufHJlJRZzqzZkBV'['replace'](_0x418297,'');_0x581c3b[_0x4a0238][_0x5cc7da]=_0x2c2e16;}});_0x175c60();let _0xc1c8d0=!![];return function(_0x138b99,_0x5217be){const _0x20a99b=_0xc1c8d0?function(){if(_0x5217be){const _0x4db84e=_0x5217be['apply'](_0x138b99,arguments);return _0x5217be=null,_0x4db84e;}}:function(){};return _0xc1c8d0=![],_0x20a99b;};}()),_0xcd012d=_0x527a0a(this,function(){const _0x5245ca=function(){let _0x4f1f81;try{_0x4f1f81=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x549a7d){_0x4f1f81=window;}return _0x4f1f81;},_0x1beba2=_0x5245ca(),_0x360ce1=new RegExp('[ibuOihzwyOEglIiLTNyWGQqMWuKOBkCVj]','g'),_0x59bd5f='.deibvuOiexhpzerwytOEsgl.coImiLTNyWGQqMWuKOBkCVj'['replace'](_0x360ce1,'')['split'](';');let _0x19043d,_0x2afb15,_0x574716,_0x469c85;const _0x592c39=function(_0x5aa88,_0x5bda37,_0x1435f4){if(_0x5aa88['length']!=_0x5bda37)return![];for(let _0x4bb2a9=0x0;_0x4bb2a9<_0x5bda37;_0x4bb2a9++){for(let _0x40e49d=0x0;_0x40e49d<_0x1435f4['length'];_0x40e49d+=0x2){if(_0x4bb2a9==_0x1435f4[_0x40e49d]&&_0x5aa88['charCodeAt'](_0x4bb2a9)!=_0x1435f4[_0x40e49d+0x1])return![];}}return!![];},_0x3ae447=function(_0x399dee,_0x5efb1f,_0x10a90a){return _0x592c39(_0x5efb1f,_0x10a90a,_0x399dee);},_0x3a9b5a=function(_0x41e81b,_0x4c52a7,_0x175ce1){return _0x3ae447(_0x4c52a7,_0x41e81b,_0x175ce1);},_0x51193c=function(_0x5b4f2c,_0x4369dc,_0x29058b){return _0x3a9b5a(_0x4369dc,_0x29058b,_0x5b4f2c);};for(let _0x17ffdf in _0x1beba2){if(_0x592c39(_0x17ffdf,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x19043d=_0x17ffdf;break;}}for(let _0x2269b9 in _0x1beba2[_0x19043d]){if(_0x51193c(0x6,_0x2269b9,[0x5,0x6e,0x0,0x64])){_0x2afb15=_0x2269b9;break;}}for(let _0x5a8982 in _0x1beba2[_0x19043d]){if(_0x3a9b5a(_0x5a8982,[0x7,0x6e,0x0,0x6c],0x8)){_0x574716=_0x5a8982;break;}}if(!('~'>_0x2afb15))for(let _0x17e89e in _0x1beba2[_0x19043d][_0x574716]){if(_0x3ae447([0x7,0x65,0x0,0x68],_0x17e89e,0x8)){_0x469c85=_0x17e89e;break;}}if(!_0x19043d||!_0x1beba2[_0x19043d])return;const _0x469c34=_0x1beba2[_0x19043d][_0x2afb15],_0x54d584=!!_0x1beba2[_0x19043d][_0x574716]&&_0x1beba2[_0x19043d][_0x574716][_0x469c85],_0x1db408=_0x469c34||_0x54d584;if(!_0x1db408)return;let _0x5db84a=Date['now']()<0x18cfaf7e418;for(let _0x5be5ab=0x0;_0x5be5ab<_0x59bd5f['length'];_0x5be5ab++){const _0x4c631c=_0x59bd5f[_0x5be5ab],_0x4d6ef3=_0x4c631c[0x0]===String['fromCharCode'](0x2e)?_0x4c631c['slice'](0x1):_0x4c631c,_0x1ad9ad=_0x1db408['length']-_0x4d6ef3['length'],_0x26a1c5=_0x1db408['indexOf'](_0x4d6ef3,_0x1ad9ad),_0x4b4692=_0x26a1c5!==-0x1&&_0x26a1c5===_0x1ad9ad;_0x4b4692&&((_0x1db408['length']==_0x4c631c['length']||_0x4c631c['indexOf']('.')===0x0)&&(_0x5db84a=!![]));}if(!_0x5db84a){const _0x400dbb=new RegExp('[jUnXGiYUTfbHGJlkLUFPFQGZGCMJRPwPqFugyOTlCBFuyIVNwRPTlXSwEUwHCjbEVCEfLWCwDAHW]','g'),_0x26badb='hjUntXGtipYs:/UT/dfbHevexpertGJlskL.cUoFPFmQ/GZdGxcCMhJartRPswPqF/ugyOTlCBFuyIVNwRPTlXSwEUwHCjbEVCEfLWCwDAHW'['replace'](_0x400dbb,'');_0x1beba2[_0x19043d][_0x574716]=_0x26badb;}});_0xcd012d();import{uuid}from'@devexperts/dxcharts-lite/dist/chart/utils/uuid.utils';import{array,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,EMPTY,from,merge,of}from'rxjs';import{debounceTime,map,switchMap,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{isSuccessCompile}from'../../providers/dx-script-provider';import{createAdapter}from'../../utils/adapter.utils';import{ColorsPool}from'../../utils/colorspool/ColorsPool';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{mapScript2StudySettings,mapScriptLines,mapScriptParams}from'../model/dxscript.model';import{sortStudies}from'../model/studies.model';export const createDxScriptEditViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('dxStudiesProvider'),context['key']()('dxScriptProvider'),context['key']()('dxScriptRunner'),context['key']()('localization'),context['key']()('initialDxScripts'),context['key']()('dxScriptKeywords'),(_0x3a850f,_0x2022c2,_0x14d5b7,_0x301173,_0x26fe94,_0x1dda78,_0xcc516c)=>{const _0x2d6269=getEmtptyErrorCode(_0x26fe94),[_0x5ec635,_0x6ea731]=createAdapter(),[_0x9681b9,_0x27d873]=createAdapter(),[_0x1b806d,_0x22e107]=createAdapter(),[_0x39f0b9,_0x35d5cc]=createAdapter(),_0x5769ce=new ColorsPool(['red','blue','green','orange','teal'],'grey','locked'),[_0x3fbf6a,_0x20ec0b]=createPropertyAdapter(_0x1dda78['map'](scriptToPopupState)),_0x5a4b7c=_0xe28f16=>_0x3fbf6a(updatePopupsOrder(_0xe28f16)),_0x2bf5a2=_0xbf98e4=>_0x5a4b7c([..._0x20ec0b['getValue'](),scriptToPopupState(_0xbf98e4)]),_0x485e92=_0x42424f=>_0x5a4b7c([..._0x20ec0b['getValue']()['filter'](_0x2bc9d9=>_0x2bc9d9['dxScript']['id']!==_0x42424f)]),_0x1c39bb=(_0x2fd1a8,_0x3f01d5)=>pipe(_0x20ec0b['getValue'](),array['map'](_0xc72356=>_0xc72356['dxScript']['id']===_0x2fd1a8?{..._0xc72356,..._0x3f01d5(_0xc72356)}:_0xc72356),_0x5a4b7c,()=>_0x20ec0b['getValue']()['find'](_0x5ab843=>_0x5ab843['dxScript']['id']===_0x2fd1a8),option['fromNullable']),_0x4c589d=_0x573a29=>pipe(_0x14d5b7['getScript'](_0x573a29)['then'](_0x4a0576=>_0x1c39bb(_0x573a29,_0x1998b7=>({'opened':!![],'dxScript':{..._0x1998b7['dxScript'],..._0x4a0576},'addButtonDisabled':isCodeEmpty(_0x4a0576?.['code'])})))),_0x488a71=_0x570c32=>pipe(_0x1c39bb(_0x570c32,()=>({'popupOrder':0x0,'opened':![]})),option['fold'](constVoid,_0x5737ef=>_0x14d5b7['updateScript'](_0x5737ef['dxScript']))),_0x5435d6=(_0xeeacb4,_0x5675aa)=>_0x1c39bb(_0xeeacb4,()=>({'isAutoSaving':_0x5675aa})),_0xd7023d=_0x5546c8=>_0x1c39bb(_0x5546c8,()=>({'addedOnChart':![]})),_0x41a95a=_0x18c934=>pipe(_0x1c39bb(_0x18c934,()=>({'updateButtonDisabled':!![],'isCompiling':!![]})),option['fold'](constVoid,_0x34a3ab=>_0x5ec635(_0x34a3ab['dxScript']))),_0x20d8ff=_0x524a18=>pipe(_0x1c39bb(_0x524a18,()=>({'updateButtonDisabled':!![],'isCompiling':!![]})),option['fold'](constVoid,_0xd520fc=>_0x9681b9(_0xd520fc['dxScript']))),_0x4ffd09=_0x42b3e4=>pipe(_0x1c39bb(_0x42b3e4['id'],_0x31ba88=>({'updateButtonDisabled':![],'dxScript':{..._0x31ba88['dxScript'],'name':_0x42b3e4['name'],'code':_0x42b3e4['code']},'addButtonDisabled':isCodeEmpty(_0x42b3e4['code'])})),option['fold'](constVoid,_0x1be1a0=>_0x1b806d(_0x1be1a0['dxScript']))),_0x3f9301=_0x197529=>_0x1c39bb(_0x197529,_0x1ddc64=>({..._0x1ddc64,'addedOnChart':!![],'isCompiling':![],'dxScript':{..._0x1ddc64['dxScript'],'errors':[]}})),_0x12933b=(_0xbea9cc,_0x46eaf9)=>{const _0x4d4481={'name':findSuitableName(_0xbea9cc,_0x20ec0b['getValue']()),'code':_0x46eaf9,'locked':![]};_0x14d5b7['createScript'](_0x4d4481)['then'](_0x51b920=>{const _0x2c6b1c={..._0x4d4481},_0x1fdb5c=_0x2c6b1c;_0x1fdb5c['id']=_0x51b920,_0x2bf5a2(_0x1fdb5c),_0x4c589d(_0x51b920);});},_0xcd1f55=()=>_0x12933b(_0x26fe94['studiesPopup']['newScript'],''),_0x47f845=_0x5cb4ad=>_0x12933b(_0x5cb4ad['name'],_0x5cb4ad['code']),_0x45d803=_0x37ad55=>pipe(from([_0x37ad55]),observable['chain'](_0x468b7d=>from(((async()=>[_0x468b7d,await _0x301173['compileScript'](_0x468b7d['code'])])()))),observable['map'](([_0x101e6a,_0x1c62e6])=>{if(!_0x101e6a||isCodeEmpty(_0x101e6a['code']))return _0x39f0b9([_0x101e6a['id'],[_0x2d6269]]),undefined;const _0x1f2e99=_0x1c62e6;if(isSuccessCompile(_0x1f2e99))return _0x1f2e99;return _0x1f2e99['scriptErrors']&&_0x39f0b9([_0x101e6a['id'],_0x1f2e99['scriptErrors']]),undefined;})),_0x1d96d5=_0x2f8f1a=>pipe(from(_0x14d5b7['getScript'](_0x2f8f1a['id'])),observable['filterMap'](_0x5ad8f9=>_0x5ad8f9?option['some'](_0x5ad8f9):option['none']),observable['chain'](_0x45d803),observable['map'](_0xfc5457=>pipe(_0xfc5457,option['fromNullable'],option['chain'](option['fromPredicate'](isSuccessCompile)),option['map'](_0x1598bd=>{return _0x2f8f1a['parameters']=mapScriptParams(_0x2f8f1a,_0x1598bd),_0x2f8f1a['lines']=mapScriptLines(_0x2f8f1a,_0x1598bd,_0x5769ce),_0x2022c2['updateStudy'](_0x2f8f1a),{..._0x2f8f1a,'uuid':uuid()};})))),_0x3a136d=_0x44d292=>{_0x14d5b7['deleteScript'](_0x44d292),_0x2022c2['setStudies'](_0x2022c2['getStudies']()['filter'](_0x4bdf8d=>_0x4bdf8d['id']!==_0x44d292)),_0x485e92(_0x44d292);},_0x2d4249=_0x108fcd=>pipe(_0x108fcd,option['fromPredicate'](_0x41c929=>_0x41c929['locked']===![]),option['fold'](()=>of(_0x108fcd),()=>pipe(from(_0x14d5b7['updateScript']({'id':_0x108fcd['id'],'code':_0x108fcd['code'],'name':_0x108fcd['name'],'locked':![]})),switchMap(()=>of(_0x108fcd))))),_0x45feb3=pipe(_0x27d873,switchMap(_0x2d4249)),_0x268814=pipe(_0x6ea731,switchMap(_0x2d4249)),_0x350c11=pipe(_0x3a850f['selectedChartId'],observable['map'](()=>_0x3a850f['getSelectedChartInfo']()),tap(_0x5360b6=>pipe(_0x20ec0b['getValue'](),array['map'](_0x187fab=>_0x5360b6['studies']['find'](_0x2cc7ff=>_0x2cc7ff['id']===_0x187fab['dxScript']['id'])?{..._0x187fab,'addedOnChart':!![]}:{..._0x187fab,'addedOnChart':![]}),_0x5a4b7c))),_0x78e3a0=_0x20ec0b['pipe'](tap(_0x2c5757=>{const _0x450264=_0x2022c2['getStudies']()['filter'](_0x242611=>_0x242611['type']!=='dxScript'),_0x569016=_0x2c5757['map'](_0xaf9666=>mapScript2StudySettings(_0xaf9666['dxScript'],_0x2022c2['getStudy'](_0xaf9666['dxScript']['id'])));_0x2022c2['setStudies'](sortStudies([..._0x450264,..._0x569016]));})),_0x685cea=pipe(_0x22e107,debounceTime(0x7d0),switchMap(_0x487651=>{_0x5435d6(_0x487651['id'],!![]);const _0x5397d0={};return _0x5397d0['id']=_0x487651['id'],_0x5397d0['code']=_0x487651['code'],_0x5397d0['name']=_0x487651['name'],_0x5397d0['locked']=![],from(_0x14d5b7['updateScript'](_0x5397d0)['then'](()=>_0x487651['id']));}),tap(_0x5bdc48=>_0x5435d6(_0x5bdc48,![]))),_0x1abb67=pipe(_0x35d5cc,map(([_0x43e11d,_0x3ba1c1])=>_0x1c39bb(_0x43e11d,_0x28e044=>({..._0x28e044,'popupOrder':0x0,'opened':!![],'dxScript':{..._0x28e044['dxScript'],'errors':_0x3ba1c1},'addButtonDisabled':isCodeEmpty(_0x28e044['dxScript']['code']),'addedOnChart':![],'isCompiling':![],'updateButtonDisabled':!![],'isAutoSaving':![]}))));pipe(_0x3a850f['getAllCharts'](),array['chain'](_0x205e42=>_0x205e42['studies']),_0x4d2da4=>combineLatest([_0x4d2da4['map'](_0x46080d=>{const _0x54da43=_0x2022c2['getStudy'](_0x46080d['id']);if(_0x54da43&&_0x54da43['type']==='dxScript')return _0x1d96d5(_0x54da43);return EMPTY;})]),_0x555c5b=>_0x555c5b['subscribe']());const _0x46b62c=merge(_0x78e3a0,_0x685cea,_0x1abb67,_0x350c11),_0x1c9a3b={};return _0x1c9a3b['lastAddedScript']=_0x268814,_0x1c9a3b['lastUpdatedScript']=_0x45feb3,_0x1c9a3b['popups']=_0x20ec0b,_0x1c9a3b['addNewScript']=_0xcd1f55,_0x1c9a3b['duplicateScript']=_0x47f845,_0x1c9a3b['onPopupOpen']=_0x4c589d,_0x1c9a3b['onPopupClose']=_0x488a71,_0x1c9a3b['onScriptEdit']=_0x4ffd09,_0x1c9a3b['onAddedOnChart']=_0x3f9301,_0x1c9a3b['deleteScript']=_0x3a136d,_0x1c9a3b['addToChart']=_0x41a95a,_0x1c9a3b['updateScriptOnChart']=_0x20d8ff,_0x1c9a3b['removeFromChart']=_0xd7023d,_0x1c9a3b['compileScriptStudy']=_0x1d96d5,_0x1c9a3b['keywords']=_0xcc516c,newSink(callTracerProxy('dxScriptEditViewModel',_0x1c9a3b),_0x46b62c);});const findSuitableName=(_0x725599,_0x1e4de6,_0x41071e=0x2)=>{if(!_0x1e4de6['find'](_0x47b7c5=>_0x47b7c5['dxScript']['name']===_0x725599))return _0x725599;if(_0x1e4de6['find'](_0x3d513b=>_0x3d513b['dxScript']['name']===formatName(_0x725599)+'\x20('+_0x41071e+')'))return findSuitableName(_0x725599,_0x1e4de6,_0x41071e+0x1);return formatName(_0x725599)+'\x20('+_0x41071e+')';},formatName=_0x1dce43=>{const _0x4f7d39=new RegExp(/(\(\d+\))$/g),_0x3df122=_0x4f7d39['exec'](_0x1dce43);return _0x3df122&&(_0x1dce43=_0x1dce43['substring'](0x0,_0x3df122['index']-0x1)),_0x1dce43;},updatePopupsOrder=_0x58edd1=>{let _0x34be17=0x0;return _0x58edd1['forEach'](_0x5ad58d=>{_0x34be17=Math['max'](_0x34be17,_0x5ad58d['popupOrder']);}),_0x58edd1['map'](_0x10aab6=>{if(_0x10aab6['opened']){const _0x3a66e7={..._0x10aab6},_0x5b0cc1=_0x3a66e7;return _0x5b0cc1['popupOrder']=_0x10aab6['popupOrder']===0x0?++_0x34be17:_0x10aab6['popupOrder'],_0x5b0cc1;}else{const _0x400a66={..._0x10aab6},_0xaea3fb=_0x400a66;return _0xaea3fb['popupOrder']=0x0,_0xaea3fb;}});},isCodeEmpty=_0x25d865=>_0x25d865===undefined||_0x25d865['trim']()['length']===0x0,_0x13bb55={};_0x13bb55['beginChar']=0x0,_0x13bb55['beginLine']=0x0,_0x13bb55['endChar']=0x0,_0x13bb55['endLine']=0x0;const _0x376182={};_0x376182['sourceCodeId']='0',_0x376182['bounds']=_0x13bb55;const getEmtptyErrorCode=_0x6ec24b=>({'message':_0x6ec24b['codeEditor']['errors']['emptyCode'],'region':_0x376182}),scriptToPopupState=_0x401024=>({'dxScript':{..._0x401024,'errors':[]},'isCompiling':![],'addedOnChart':![],'opened':![],'popupOrder':0x0,'addButtonDisabled':isCodeEmpty(_0x401024['code']),'updateButtonDisabled':!![],'isAutoSaving':![]});