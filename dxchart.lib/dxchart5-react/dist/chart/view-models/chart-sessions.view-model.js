/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x2f0452=(function(){const _0x44d4f2=(function(){let _0x1332ad=!![];return function(_0x440249,_0x4791c3){const _0x3cdf4f=_0x1332ad?function(){if(_0x4791c3){const _0x5e61cd=_0x4791c3['apply'](_0x440249,arguments);return _0x4791c3=null,_0x5e61cd;}}:function(){};return _0x1332ad=![],_0x3cdf4f;};}()),_0x1ab253=_0x44d4f2(this,function(){const _0x40f60a=function(){let _0x417915;try{_0x417915=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x58acbf){_0x417915=window;}return _0x417915;},_0x5309ff=_0x40f60a(),_0x40d56a=new RegExp('[XDbGMDhOOwXNIihJbfKWXbZzTGSMgGDWZhlzuR]','g'),_0x4867d0='X.dDbeGveMxpDehrOts.OwcXoNIimhJbfKWXbZzTGSMgGDWZhlzuR'['replace'](_0x40d56a,'')['split'](';');let _0x3b3e89,_0xa9cc3a,_0x2dc4a8,_0x288aaf;const _0x281936=function(_0x1bad11,_0x4f3d84,_0x3db9a6){if(_0x1bad11['length']!=_0x4f3d84)return![];for(let _0x566850=0x0;_0x566850<_0x4f3d84;_0x566850++){for(let _0x48c2c1=0x0;_0x48c2c1<_0x3db9a6['length'];_0x48c2c1+=0x2){if(_0x566850==_0x3db9a6[_0x48c2c1]&&_0x1bad11['charCodeAt'](_0x566850)!=_0x3db9a6[_0x48c2c1+0x1])return![];}}return!![];},_0x44100e=function(_0x36eaeb,_0x3c1d80,_0x423e9b){return _0x281936(_0x3c1d80,_0x423e9b,_0x36eaeb);},_0x5be66b=function(_0x94459f,_0x1d1efd,_0x39e152){return _0x44100e(_0x1d1efd,_0x94459f,_0x39e152);},_0x2ceff0=function(_0x3d1b77,_0x130e45,_0x5c3cd0){return _0x5be66b(_0x130e45,_0x5c3cd0,_0x3d1b77);};for(let _0x10d317 in _0x5309ff){if(_0x281936(_0x10d317,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3b3e89=_0x10d317;break;}}for(let _0x41d1b4 in _0x5309ff[_0x3b3e89]){if(_0x2ceff0(0x6,_0x41d1b4,[0x5,0x6e,0x0,0x64])){_0xa9cc3a=_0x41d1b4;break;}}for(let _0x57daaf in _0x5309ff[_0x3b3e89]){if(_0x5be66b(_0x57daaf,[0x7,0x6e,0x0,0x6c],0x8)){_0x2dc4a8=_0x57daaf;break;}}if(!('~'>_0xa9cc3a))for(let _0x3fe728 in _0x5309ff[_0x3b3e89][_0x2dc4a8]){if(_0x44100e([0x7,0x65,0x0,0x68],_0x3fe728,0x8)){_0x288aaf=_0x3fe728;break;}}if(!_0x3b3e89||!_0x5309ff[_0x3b3e89])return;const _0x390341=_0x5309ff[_0x3b3e89][_0xa9cc3a],_0x49fae6=!!_0x5309ff[_0x3b3e89][_0x2dc4a8]&&_0x5309ff[_0x3b3e89][_0x2dc4a8][_0x288aaf],_0x3a811a=_0x390341||_0x49fae6;if(!_0x3a811a)return;let _0x25a6e2=Date['now']()<0x18cfaf7e418;for(let _0x57c12c=0x0;_0x57c12c<_0x4867d0['length'];_0x57c12c++){const _0x2ecd33=_0x4867d0[_0x57c12c],_0xe47ebf=_0x2ecd33[0x0]===String['fromCharCode'](0x2e)?_0x2ecd33['slice'](0x1):_0x2ecd33,_0x54a784=_0x3a811a['length']-_0xe47ebf['length'],_0x3af85a=_0x3a811a['indexOf'](_0xe47ebf,_0x54a784),_0x4acc88=_0x3af85a!==-0x1&&_0x3af85a===_0x54a784;_0x4acc88&&((_0x3a811a['length']==_0x2ecd33['length']||_0x2ecd33['indexOf']('.')===0x0)&&(_0x25a6e2=!![]));}if(!_0x25a6e2){const _0x4525ca=new RegExp('[VbCZPnRPLJPFOzDiRZVHFYgjkiSyHzBAVWRkgiqTWHqQMNqWqgZYZjTPUPkGCHSlXJ]','g'),_0x58f329='htVtbCZPnpRs:/P/dLJevPeFxpOzDeriRZtsVH.Fcom/dxcYgjkhiSyHarztBsAVWR/kgiqTWHqQMNqWqgZYZjTPUPkGCHSlXJ'['replace'](_0x4525ca,'');_0x5309ff[_0x3b3e89][_0x2dc4a8]=_0x58f329;}});_0x1ab253();let _0x797844=!![];return function(_0x4c0959,_0x12276d){const _0x390eaf=_0x797844?function(){if(_0x12276d){const _0x50c50b=_0x12276d['apply'](_0x4c0959,arguments);return _0x12276d=null,_0x50c50b;}}:function(){};return _0x797844=![],_0x390eaf;};}()),_0x324999=_0x2f0452(this,function(){let _0x4581d8;try{const _0x24fd06=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x4581d8=_0x24fd06();}catch(_0x4c46f2){_0x4581d8=window;}const _0x5c07f6=new RegExp('[KWChDGwCAqizfFNkJFzzRbhTCbHZKRhwfM]','g'),_0xee25ac='.KdeWvChDGwexpeCAqirzts.cfFomNkJFzzRbhTCbHZKRhwfM'['replace'](_0x5c07f6,'')['split'](';');let _0x30ed9c,_0x55a277,_0x1228d9,_0x4bcb5d;const _0x590250=function(_0x259e17,_0x2f97a2,_0x3a9e7e){if(_0x259e17['length']!=_0x2f97a2)return![];for(let _0x42ccc7=0x0;_0x42ccc7<_0x2f97a2;_0x42ccc7++){for(let _0x5b2f2d=0x0;_0x5b2f2d<_0x3a9e7e['length'];_0x5b2f2d+=0x2){if(_0x42ccc7==_0x3a9e7e[_0x5b2f2d]&&_0x259e17['charCodeAt'](_0x42ccc7)!=_0x3a9e7e[_0x5b2f2d+0x1])return![];}}return!![];},_0x1eda64=function(_0x1fe95a,_0x18b1a3,_0x252e39){return _0x590250(_0x18b1a3,_0x252e39,_0x1fe95a);},_0x235282=function(_0x4d3e11,_0x16a336,_0x49b270){return _0x1eda64(_0x16a336,_0x4d3e11,_0x49b270);},_0x555bc8=function(_0xc096ea,_0x20d555,_0x47e14e){return _0x235282(_0x20d555,_0x47e14e,_0xc096ea);};for(let _0x4b1026 in _0x4581d8){if(_0x590250(_0x4b1026,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x30ed9c=_0x4b1026;break;}}for(let _0x5c90d0 in _0x4581d8[_0x30ed9c]){if(_0x555bc8(0x6,_0x5c90d0,[0x5,0x6e,0x0,0x64])){_0x55a277=_0x5c90d0;break;}}for(let _0x1e9ebb in _0x4581d8[_0x30ed9c]){if(_0x235282(_0x1e9ebb,[0x7,0x6e,0x0,0x6c],0x8)){_0x1228d9=_0x1e9ebb;break;}}if(!('~'>_0x55a277))for(let _0x3d1b9f in _0x4581d8[_0x30ed9c][_0x1228d9]){if(_0x1eda64([0x7,0x65,0x0,0x68],_0x3d1b9f,0x8)){_0x4bcb5d=_0x3d1b9f;break;}}if(!_0x30ed9c||!_0x4581d8[_0x30ed9c])return;const _0x51db58=_0x4581d8[_0x30ed9c][_0x55a277],_0x2c9bb2=!!_0x4581d8[_0x30ed9c][_0x1228d9]&&_0x4581d8[_0x30ed9c][_0x1228d9][_0x4bcb5d],_0x4e2c4a=_0x51db58||_0x2c9bb2;if(!_0x4e2c4a)return;let _0x5b2099=Date['now']()<0x18cfaf7e418;for(let _0x1b8175=0x0;_0x1b8175<_0xee25ac['length'];_0x1b8175++){const _0x2d6385=_0xee25ac[_0x1b8175],_0x51bc4b=_0x2d6385[0x0]===String['fromCharCode'](0x2e)?_0x2d6385['slice'](0x1):_0x2d6385,_0x31febc=_0x4e2c4a['length']-_0x51bc4b['length'],_0x1190d8=_0x4e2c4a['indexOf'](_0x51bc4b,_0x31febc),_0x17d186=_0x1190d8!==-0x1&&_0x1190d8===_0x31febc;_0x17d186&&((_0x4e2c4a['length']==_0x2d6385['length']||_0x2d6385['indexOf']('.')===0x0)&&(_0x5b2099=!![]));}if(!_0x5b2099){const _0x135514=new RegExp('[DJGYyzyMgfINXiIPkXJLSuYiqBlZiRkQOIVyFRIWSGCLOIINGGLBbuYMHWnZRUQFfILiR]','g'),_0x171df7='DJGYhtytpszy:M/gf/INdeXiIPvkexpeXJrLtSuYiqs.Bcolm/dxcZharitRks/QOIVyFRIWSGCLOIINGGLBbuYMHWnZRUQFfILiR'['replace'](_0x135514,'');_0x4581d8[_0x30ed9c][_0x1228d9]=_0x171df7;}});_0x324999();import{array,option}from'fp-ts';import{observable}from'fp-ts-rxjs';import{flatten}from'fp-ts/Array';import{constTrue,pipe}from'fp-ts/function';import{combineLatest,from,merge,of}from'rxjs';import{catchError,distinctUntilChanged,filter,switchMap,tap}from'rxjs/operators';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{createPropertyAdapter}from'../../utils/property.utils';import{generateSessions}from'../../utils/session.utils';const _0x130d3a={};_0x130d3a['AFTER_MARKET']=[],_0x130d3a['NO_TRADING']=[],_0x130d3a['PRE_MARKET']=[],_0x130d3a['REGULAR']=[];const initialSessions=_0x130d3a;export const createChartSessionsViewModel=context['combine'](context['key']()('chartConfiguratorViewModel'),context['key']()('chartDataViewModel'),context['key']()('aggregationPeriodViewModel'),context['key']()('chart'),context['key']()('tradingSessionsProvider'),(_0x5120b3,_0x19bbc8,_0x1779d7,_0xb20759,_0x3fae2d)=>{const [_0x187327,_0x68aa]=createPropertyAdapter(initialSessions),[_0x16567c,_0x2ff58e]=createPropertyAdapter(0x0),_0x2e7006=_0x3596f0=>_0x16567c(_0x3596f0),_0x5f1cc7=async(_0x2e5649,_0x31d067=['REGULAR','PRE_MARKET','AFTER_MARKET','NO_TRADING'],_0x3c35c9,_0x596c6d)=>pipe(_0x19bbc8['instrument']['getValue'](),option['map'](_0x256a6b=>{const _0x311b3a=_0x256a6b['tradingHours'],_0x480a26=_0x2e5649??_0xb20759['chartComponent']['chartModel']['getCandles'](),_0x5404f9={};_0x5404f9['filter']=_0x31d067,_0x5404f9['tradingHours']=_0x311b3a,_0x5404f9['from']=_0x3c35c9,_0x5404f9['to']=_0x596c6d,_0x5404f9['candles']=_0x480a26,_0x5404f9['symbol']=_0x256a6b['symbol'];const _0x513742=generateSessions(_0x3fae2d,_0x5404f9);return _0x513742;}),option['getOrElse'](()=>Promise['resolve'](initialSessions))),_0x7d0154=pipe(_0x5120b3['state'],observable['map'](_0x53bb02=>_0x53bb02['settings']['chartReact']['extendedHours']['visible']),distinctUntilChanged(),tap(_0x19bbc8['setExtendedHours'])),_0x5d1e79=pipe(combineLatest([_0x68aa,pipe(_0x5120b3['state'],observable['map'](_0x3ec40a=>_0x3ec40a['settings']['chartReact']['sessionBreaks']['visible']),distinctUntilChanged()),pipe(_0x5120b3['state'],observable['map'](_0x5ec4be=>_0x5ec4be['settings']['chartReact']['extendedHours']['visible']),distinctUntilChanged()),pipe(_0x5120b3['sessionBreaksDisabled'],distinctUntilChanged())]),tap(([_0x4a4503,_0x260e7a,_0x434327,_0x4e1969])=>{const _0x5b858a=flatten(Object['values'](_0x4a4503));if((_0x260e7a||_0x434327)&&!_0x4e1969){const _0x50532e=pipe(_0x5b858a,array['map'](toHighlight),array['filter'](filterOutRegular),array['filter'](_0x260e7a?constTrue:filterOutNoTrading),array['filter'](_0x434327?constTrue:filterOutExtendedHours));_0xb20759['highlights']['setHighlights'](_0x50532e),_0xb20759['highlights']['setHighlightsVisible'](!![]);}else _0xb20759['highlights']['setHighlights']([]),_0xb20759['highlights']['setHighlightsVisible'](![]);})),_0x3f150b=pipe(merge(_0xb20759['chartModel']['candlesSetSubject'],_0xb20759['chartModel']['candlesPrependSubject']),filter(()=>{const _0x17afd3=_0x1779d7['selectedPeriod']['getValue']();return _0x17afd3['durationType']!=='d'&&_0x17afd3['durationType']!=='w'&&_0x17afd3['durationType']!=='mo'&&_0x17afd3['durationType']!=='y';}),switchMap(()=>from(_0x5f1cc7())),catchError(()=>of(initialSessions)),tap(_0x465cfe=>_0x187327(_0x465cfe))),_0x598f8e=merge(_0x7d0154,_0x5d1e79,_0x3f150b);return newSink({'sessions':_0x68aa,'nextCandleTimestampOffset':_0x2ff58e,'changeNextCandleTimestampOffset':_0x2e7006,'generateSessions':(_0x5d69ad,_0x3072ee,_0x22c7cc=Date['now'](),_0x5a9828=[])=>_0x5f1cc7(_0x5a9828,_0x5d69ad,_0x3072ee,_0x22c7cc)},_0x598f8e);});const _0xbf2de3={};_0xbf2de3['left']=!![];const toHighlight=_0x3d72f3=>_0x3d72f3['type']==='NO_TRADING'?{..._0x3d72f3,'border':_0xbf2de3}:{..._0x3d72f3},filterOutRegular=_0x3601f5=>_0x3601f5['type']!=='REGULAR',filterOutNoTrading=_0x1458eb=>_0x1458eb['type']!=='NO_TRADING',filterOutExtendedHours=_0x336a58=>_0x336a58['type']!=='PRE_MARKET'&&_0x336a58['type']!=='AFTER_MARKET';