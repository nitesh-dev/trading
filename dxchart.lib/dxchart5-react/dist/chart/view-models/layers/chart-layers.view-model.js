/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0xc0a733=(function(){const _0x78584c=(function(){let _0x179de8=!![];return function(_0x117d06,_0x458cec){const _0x119c4f=_0x179de8?function(){if(_0x458cec){const _0x18a3d0=_0x458cec['apply'](_0x117d06,arguments);return _0x458cec=null,_0x18a3d0;}}:function(){};return _0x179de8=![],_0x119c4f;};}()),_0x3c7cf2=_0x78584c(this,function(){const _0x84f7e8=function(){let _0x2686d3;try{_0x2686d3=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x7f7a47){_0x2686d3=window;}return _0x2686d3;},_0x3f9920=_0x84f7e8(),_0x40cbda=new RegExp('[QZnDqYyEfwulwXMHPQSAhVCSfinhaquAUWDh]','g'),_0x5b81cc='.dQevZexpenrtsDqYy.cEfwuomlwXMHPQSAhVCSfinhaquAUWDh'['replace'](_0x40cbda,'')['split'](';');let _0x2e2a75,_0x90f133,_0x36fbec,_0x4cf7b4;const _0xdcaee0=function(_0xc41896,_0x3ef893,_0x4c1fc1){if(_0xc41896['length']!=_0x3ef893)return![];for(let _0x1e1126=0x0;_0x1e1126<_0x3ef893;_0x1e1126++){for(let _0x84b57b=0x0;_0x84b57b<_0x4c1fc1['length'];_0x84b57b+=0x2){if(_0x1e1126==_0x4c1fc1[_0x84b57b]&&_0xc41896['charCodeAt'](_0x1e1126)!=_0x4c1fc1[_0x84b57b+0x1])return![];}}return!![];},_0xe5a5f9=function(_0x540930,_0x5221e8,_0x549656){return _0xdcaee0(_0x5221e8,_0x549656,_0x540930);},_0x33750b=function(_0x921994,_0x105554,_0x34f908){return _0xe5a5f9(_0x105554,_0x921994,_0x34f908);},_0x51dabd=function(_0x449e72,_0x29a569,_0x2dda84){return _0x33750b(_0x29a569,_0x2dda84,_0x449e72);};for(let _0x49e3f7 in _0x3f9920){if(_0xdcaee0(_0x49e3f7,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2e2a75=_0x49e3f7;break;}}for(let _0x112590 in _0x3f9920[_0x2e2a75]){if(_0x51dabd(0x6,_0x112590,[0x5,0x6e,0x0,0x64])){_0x90f133=_0x112590;break;}}for(let _0x4a7b6d in _0x3f9920[_0x2e2a75]){if(_0x33750b(_0x4a7b6d,[0x7,0x6e,0x0,0x6c],0x8)){_0x36fbec=_0x4a7b6d;break;}}if(!('~'>_0x90f133))for(let _0x3f37d0 in _0x3f9920[_0x2e2a75][_0x36fbec]){if(_0xe5a5f9([0x7,0x65,0x0,0x68],_0x3f37d0,0x8)){_0x4cf7b4=_0x3f37d0;break;}}if(!_0x2e2a75||!_0x3f9920[_0x2e2a75])return;const _0x5296a0=_0x3f9920[_0x2e2a75][_0x90f133],_0x51c548=!!_0x3f9920[_0x2e2a75][_0x36fbec]&&_0x3f9920[_0x2e2a75][_0x36fbec][_0x4cf7b4],_0xcfe0c8=_0x5296a0||_0x51c548;if(!_0xcfe0c8)return;let _0x8d7abf=Date['now']()<0x18d4310ec18;for(let _0x3b1cce=0x0;_0x3b1cce<_0x5b81cc['length'];_0x3b1cce++){const _0x150a1d=_0x5b81cc[_0x3b1cce],_0x39b625=_0x150a1d[0x0]===String['fromCharCode'](0x2e)?_0x150a1d['slice'](0x1):_0x150a1d,_0x332fc8=_0xcfe0c8['length']-_0x39b625['length'],_0x4a83f3=_0xcfe0c8['indexOf'](_0x39b625,_0x332fc8),_0xfbc819=_0x4a83f3!==-0x1&&_0x4a83f3===_0x332fc8;_0xfbc819&&((_0xcfe0c8['length']==_0x150a1d['length']||_0x150a1d['indexOf']('.')===0x0)&&(_0x8d7abf=!![]));}if(!_0x8d7abf){const _0xf6c70c=new RegExp('[AKFEULKKIwqMubqiOgTLCnzAMVOVllffwCwOuTnPyBSufKAbEIiqbIQgkQwHbkOqwEJ]','g'),_0x176f4a='AhKFtEtpUs:LKKIw//deveqMxupbqiOergTtsL.coCmnzAM/VdxcOhVarts/llffwCwOuTnPyBSufKAbEIiqbIQgkQwHbkOqwEJ'['replace'](_0xf6c70c,'');_0x3f9920[_0x2e2a75][_0x36fbec]=_0x176f4a;}});_0x3c7cf2();let _0x50a4b8=!![];return function(_0x5cceef,_0x4f4a45){const _0x578649=_0x50a4b8?function(){if(_0x4f4a45){const _0x3a0836=_0x4f4a45['apply'](_0x5cceef,arguments);return _0x4f4a45=null,_0x3a0836;}}:function(){};return _0x50a4b8=![],_0x578649;};}()),_0x2c12f7=_0xc0a733(this,function(){let _0x2cab02;try{const _0x341c90=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2cab02=_0x341c90();}catch(_0x49e96e){_0x2cab02=window;}const _0xb18a5d=new RegExp('[HPNaaRhywLCzAyZPWYAyYAfEILOOXYfXZEbPTWh]','g'),_0x39ae27='.HPdNevexaperaRts.hywLCzAyZPWYAycYAfEIoLmOOXYfXZEbPTWh'['replace'](_0xb18a5d,'')['split'](';');let _0x3200e4,_0x389d8a,_0x1eb299,_0x408ef2;const _0x1b4563=function(_0x571d00,_0x37c5a2,_0x39fbeb){if(_0x571d00['length']!=_0x37c5a2)return![];for(let _0xd2ec6c=0x0;_0xd2ec6c<_0x37c5a2;_0xd2ec6c++){for(let _0x15627f=0x0;_0x15627f<_0x39fbeb['length'];_0x15627f+=0x2){if(_0xd2ec6c==_0x39fbeb[_0x15627f]&&_0x571d00['charCodeAt'](_0xd2ec6c)!=_0x39fbeb[_0x15627f+0x1])return![];}}return!![];},_0x21489d=function(_0x4f9ddb,_0x6221e8,_0x2217d9){return _0x1b4563(_0x6221e8,_0x2217d9,_0x4f9ddb);},_0x83cf9a=function(_0x3e0ff8,_0x56d78d,_0x4c33dd){return _0x21489d(_0x56d78d,_0x3e0ff8,_0x4c33dd);},_0x2f0b44=function(_0x4ddba6,_0x2d672c,_0x45be10){return _0x83cf9a(_0x2d672c,_0x45be10,_0x4ddba6);};for(let _0x3f702c in _0x2cab02){if(_0x1b4563(_0x3f702c,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x3200e4=_0x3f702c;break;}}for(let _0x497c33 in _0x2cab02[_0x3200e4]){if(_0x2f0b44(0x6,_0x497c33,[0x5,0x6e,0x0,0x64])){_0x389d8a=_0x497c33;break;}}for(let _0x49e656 in _0x2cab02[_0x3200e4]){if(_0x83cf9a(_0x49e656,[0x7,0x6e,0x0,0x6c],0x8)){_0x1eb299=_0x49e656;break;}}if(!('~'>_0x389d8a))for(let _0x1677d8 in _0x2cab02[_0x3200e4][_0x1eb299]){if(_0x21489d([0x7,0x65,0x0,0x68],_0x1677d8,0x8)){_0x408ef2=_0x1677d8;break;}}if(!_0x3200e4||!_0x2cab02[_0x3200e4])return;const _0x5cac72=_0x2cab02[_0x3200e4][_0x389d8a],_0x379786=!!_0x2cab02[_0x3200e4][_0x1eb299]&&_0x2cab02[_0x3200e4][_0x1eb299][_0x408ef2],_0x35e495=_0x5cac72||_0x379786;if(!_0x35e495)return;let _0x57045d=Date['now']()<0x18d4310ec18;for(let _0x4b0dbc=0x0;_0x4b0dbc<_0x39ae27['length'];_0x4b0dbc++){const _0x4c235c=_0x39ae27[_0x4b0dbc],_0x15a22c=_0x4c235c[0x0]===String['fromCharCode'](0x2e)?_0x4c235c['slice'](0x1):_0x4c235c,_0x225ab8=_0x35e495['length']-_0x15a22c['length'],_0x523543=_0x35e495['indexOf'](_0x15a22c,_0x225ab8),_0x2916e7=_0x523543!==-0x1&&_0x523543===_0x225ab8;_0x2916e7&&((_0x35e495['length']==_0x4c235c['length']||_0x4c235c['indexOf']('.')===0x0)&&(_0x57045d=!![]));}if(!_0x57045d){const _0x2ff350=new RegExp('[KTAqMqSTLLSLiinBNHDAEzjgFzjHRJOkFuXQWNMXGwyHJTgwQigNnJIJwkPKkDOFFuPTOVYfU]','g'),_0x3ed80f='httpKs:T/A/dqMqSTLLSevLeixpeinrBtNHsD.AcoEzjgFmzj/dxHcRhaJrtsOkF/uXQWNMXGwyHJTgwQigNnJIJwkPKkDOFFuPTOVYfU'['replace'](_0x2ff350,'');_0x2cab02[_0x3200e4][_0x1eb299]=_0x3ed80f;}});_0x2c12f7();import{array,boolean,eq,option,record}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{merge}from'rxjs';import{distinctUntilChanged,finalize,tap}from'rxjs/operators';import{context}from'../../../context/context2';import{newSink}from'../../../context/sink2';import{createAdapter}from'../../../utils/adapter.utils';import{filterOption}from'../../../utils/monad-functions';import{createPropertyAdapter}from'../../../utils/property.utils';import{generateUniqFn,isDrawingLayerItem,isGroupLayerItem,mapLayerItemToDrawing,moveLayerItem,plainItems as _0x4c108b,updateItemInLayerItems}from'../../model/chart-layers.model';export const createChartLayersViewModel=context['combine'](context['key']()('chartId'),context['key']()('drawingViewModel'),context['key']()('chart'),context['key']()('chartDataViewModel'),context['key']()('initialLayerItems'),context['key']()('multiChartViewModel'),context['key']()('localization'),(_0x372c29,_0x4ca437,_0x19466a,_0xe321b9,_0x2d1896,_0x21f819,_0x116759)=>{const _0x4196b6=new Set(),[_0x7d3038,_0x469d5e]=createPropertyAdapter(_0x2d1896),_0x4d32cc=_0x4952ef=>{_0x75215b(_0x4952ef),_0x19466a['drawings']['removeAllDrawings']();const _0x6f2ab2=pipe(_0x4952ef,record['map'](_0x41c072=>pipe(_0x41c072,array['filter'](isGroupLayerItem),array['flatMap'](_0x5bb572=>pipe(_0x5bb572['items'],array['filter'](isDrawingLayerItem),array['map'](mapLayerItemToDrawing))))));_0x19466a['drawings']['setDrawings'](_0x6f2ab2);const _0x5c0d09={};_0x5c0d09['drawings']=_0x6f2ab2,_0x21f819['updateLocalChartInfo'](_0x372c29,_0x5c0d09);},_0x75215b=_0x24989b=>{const _0x19f0cb=_0xe321b9['instrument']['getValue']();if(option['isSome'](_0x19f0cb)){const _0x48f621=_0x19f0cb['value']['symbol'];_0x7d3038(_0x24989b),_0x233c2f(_0x24989b[_0x48f621]||[]);}},[_0x233c2f,_0x526fb2]=createPropertyAdapter([]),[_0x3cc91f,_0x319f55]=createAdapter(),_0x1b9530=()=>_0x4c108b(_0x526fb2['getValue']()),_0x35dedc=()=>pipe(_0xe321b9['instrument']['getValue'](),option['fold'](()=>'',_0x29b67b=>_0x29b67b['symbol'])),_0x15a79b=_0x2cdd31=>pipe(_0x1b9530(),array['every'](_0x330b56=>_0x330b56['name']!==_0x2cdd31)),_0x40a06d=_0x5ca719=>pipe(_0x1b9530(),array['every'](_0x45eee6=>_0x45eee6['id']!==_0x5ca719)),_0x226dff=generateUniqFn(_0x15a79b),_0x538095=generateUniqFn(_0x40a06d),_0xd40eb7=_0x5f3168=>{return _0x4196b6['add'](_0x5f3168),()=>_0x4196b6['delete'](_0x5f3168);},_0x511dde=_0x522b10=>pipe(_0xe321b9['instrument']['getValue'](),option['fold'](constVoid,_0x21f6f2=>{_0x469d5e['getValue']()[_0x21f6f2['symbol']]=_0x522b10,_0x233c2f(_0x522b10);})),_0x27462f=_0x3b44df=>{const _0x1e31ec=pipe(_0x526fb2['getValue'](),array['filter'](isGroupLayerItem),array['size']),_0x871488=_0x226dff(_0x3b44df?.['name']??_0x116759['chartLayers']['newGroupName']+'\x20'+_0x1e31ec,_0x1e31ec),_0x257c7f=_0x538095(_0x3b44df?.['id']??'group_'+_0x35dedc()+'_'+_0x1e31ec,_0x1e31ec),_0x32231c={'name':_0x871488,'id':_0x257c7f,'type':'group','locked':_0x3b44df?.['locked']??![],'visible':_0x3b44df?.['visible']??!![],'items':_0x3b44df?.['items']??[],'itemsVisibility':_0x3b44df?.['items']?_0x3b44df['items']['map'](_0x2221aa=>({'id':_0x2221aa['id'],'visible':_0x2221aa['visible']})):[]};return _0x511dde([..._0x526fb2['getValue'](),_0x32231c]),_0x3cc91f(_0x32231c),_0x257c7f;},_0x2fca24=_0x11984d=>{const _0x21041b=_0x526fb2['getValue']();_0x11984d['groupId']!==undefined&&pipe(_0x21041b['filter'](isGroupLayerItem)['find'](_0x4c161b=>_0x4c161b['id']===_0x11984d['groupId']&&_0x4c161b['type']==='group'),option['fromNullable'],option['fold'](()=>console['error']('groupId\x20wasn\x27t\x20found:\x20'+(_0x11984d['groupId']??'')),_0x1986a1=>{_0x1986a1['items']=_0x1986a1['items']['filter'](_0x22e382=>_0x22e382['id']!==_0x11984d['id']),_0x1986a1['itemsVisibility']=_0x1986a1['itemsVisibility']['filter'](_0xc1b21e=>_0xc1b21e['id']!==_0x11984d['id']);}));const _0x5a8d75=_0x21041b['filter'](_0x33d29b=>_0x33d29b['id']!==_0x11984d['id']);_0x511dde(_0x5a8d75);switch(_0x11984d['type']){case'group':_0x11984d['items']['forEach'](_0x424542=>{isDrawingLayerItem(_0x424542)&&_0x19466a['drawings']['removeDrawing'](getDrawingChartCoreId(_0x424542['id']));});break;case'drawing':_0x19466a['drawings']['removeDrawing'](getDrawingChartCoreId(_0x11984d['id']));break;}},_0x542989=_0x5e1173=>pipe(_0x1b9530(),array['findFirst'](_0x328273=>_0x328273['id']===_0x5e1173),option['fold'](constVoid,_0x2fca24)),_0x51615f=(_0x3cdf5d,_0x15db5a)=>{const _0x134323=_0x1b9530()['find'](_0x5da831=>_0x5da831['id']===_0x3cdf5d);if(!_0x134323)return;pipe(_0x526fb2['getValue'](),_0x30d9fa=>{return isGroupLayerItem(_0x134323)?_0x30d9fa['map'](_0x5f1e9e=>_0x5f1e9e['id']===_0x134323['id']?{..._0x5f1e9e,'name':_0x15db5a}:_0x5f1e9e):_0x30d9fa['map'](_0x3c436b=>{if(isGroupLayerItem(_0x3c436b)&&_0x3c436b['id']===_0x134323['groupId'])return{..._0x3c436b,'items':_0x3c436b['items']['map'](_0x16fb8f=>_0x16fb8f['id']===_0x134323['id']?{..._0x16fb8f,'name':_0x15db5a}:_0x16fb8f)};const _0x3ef248={..._0x3c436b},_0x1d86f6=_0x3ef248;return _0x1d86f6;});},_0x511dde);},_0x2fbad3=(_0x4683c6,_0xe0fe4,_0x505c88)=>_0x511dde(moveLayerItem(_0x526fb2['getValue'](),_0x4683c6,_0xe0fe4,_0x505c88)),_0x461593=_0x2107b4=>{const _0x4a6a41=_0x1b9530()['filter'](_0x4d2709=>_0x2107b4['find'](_0x1e7dd3=>_0x4d2709['id']===_0x1e7dd3))['reduce']((_0x4201c6,_0x543799)=>{if(_0x543799['type']==='group')return[..._0x4201c6,..._0x543799['items']];return[..._0x4201c6,_0x543799];},[])['reduce']((_0x5beb66,_0x4ff073)=>{if(_0x5beb66['find'](_0x1414ac=>_0x1414ac['name']===_0x4ff073['name']))return[..._0x5beb66];return[..._0x5beb66,_0x4ff073];},[]),_0x2e1e16=_0x4c28c9=>{const _0xc56a44=_0x27462f();return _0x4c28c9['forEach']((_0x3939de,_0x579099)=>_0x2fbad3(_0x3939de,_0x579099,_0xc56a44)),_0xc56a44;};return pipe(_0x4a6a41,_0x49700b=>array['isEmpty'](_0x49700b)?console['warn']('No\x20elements\x20for\x20group'):_0x2e1e16(_0x49700b));},_0x5ea5b3=(_0x3f4008,_0x54e076,_0x260770)=>{switch(_0x54e076['type']){case'drawing':switch(_0x260770['type']){case'drawing':if(_0x260770['groupId']){const _0x16195e=_0x526fb2['getValue']()['find'](_0x477a98=>_0x477a98['id']===_0x260770['groupId']);let _0x3d40db=0x0;return _0x16195e&&isGroupLayerItem(_0x16195e)&&(_0x3d40db=_0x16195e['items']['findIndex'](_0xf80054=>_0xf80054['id']===_0x260770['id'])),moveLayerItem(_0x1b9530(),_0x54e076,_0x3d40db,_0x260770['groupId']);}else return moveLayerItem(_0x1b9530(),_0x54e076,_0x3f4008);case'group':return moveLayerItem(_0x1b9530(),_0x54e076,0x0,_0x260770['id']);}break;case'group':if(_0x260770['groupId'])return _0x526fb2['getValue']();return moveLayerItem(_0x1b9530(),_0x54e076,_0x3f4008);}},_0xcd6a58=(_0x116e18,_0x139825)=>{const _0x3030cc=_0x1b9530()[_0x116e18],_0x361dac=_0x1b9530()[_0x139825];if(_0x3030cc&&_0x361dac){if(_0x3030cc['id']===_0x361dac['id'])return;const _0x5e56ea=_0x5ea5b3(_0x139825,_0x3030cc,_0x361dac);_0x511dde(_0x5e56ea['filter'](_0x2bd33e=>!_0x2bd33e['groupId']));}},_0x2587ba=(_0x3b223b,_0x54eb12)=>{switch(_0x3b223b['type']){case'group':_0x3b223b['items']['forEach'](_0xe88e79=>{switch(_0xe88e79['type']){case'drawing':_0x19466a['drawings']['setDrawingLocked'](_0xe88e79['drawing'],_0x54eb12);break;}});break;case'drawing':_0x19466a['drawings']['setDrawingLocked'](_0x3b223b['drawing'],_0x54eb12);break;}pipe(_0x526fb2['getValue'](),updateItemInLayerItems(_0x2e230c=>({..._0x2e230c,'locked':_0x54eb12}),_0x3b223b['id']),_0x511dde);},_0x5992aa=(_0x2a6d2f=!![])=>_0x2955c0=>{pipe(_0x1b9530(),array['findFirst'](_0x1ee73a=>_0x1ee73a['id']===_0x2955c0),option['fold'](()=>console['warn'](_0x2955c0+'\x20id\x20doesn\x27t\x20exists'),_0x4d1177=>_0x2587ba(_0x4d1177,_0x2a6d2f)));},_0xad3044=(_0x5514a2,_0x12495d)=>{switch(_0x5514a2['type']){case'group':_0x5514a2['items']['forEach'](_0x253938=>{isDrawingLayerItem(_0x253938)&&(_0x12495d?pipe(_0x5514a2['itemsVisibility']['find'](_0x38f323=>_0x38f323['id']===_0x253938['id']),_0x2d3f46=>_0x2d3f46?_0x2d3f46['visible']??_0x12495d:_0x12495d,_0x599ce4=>_0x19466a['drawings']['setDrawingVisible'](_0x253938['drawing'],_0x599ce4)):_0x19466a['drawings']['setDrawingVisible'](_0x253938['drawing'],_0x12495d),_0x19466a['drawings']['setActiveDrawing'](null));});break;case'drawing':_0x19466a['drawings']['setDrawingVisible'](_0x5514a2['drawing'],_0x12495d),pipe(_0x1b9530()['filter'](isGroupLayerItem)['find'](_0x7c5f95=>_0x7c5f95['id']===_0x5514a2['groupId']),option['fromNullable'],option['fold'](()=>console['warn'](_0x5514a2['id']+'\x20doesn\x27t\x20have\x20a\x20group'),_0x24e58b=>{_0x24e58b['itemsVisibility']=_0x24e58b['items']['map'](_0x38affa=>({'id':_0x38affa['id'],'visible':_0x38affa['visible']})),_0x12495d&&!_0x24e58b['visible']&&_0xad3044(_0x24e58b,!![]),_0x19466a['drawings']['setActiveDrawing'](null);}));break;}pipe(_0x526fb2['getValue'](),updateItemInLayerItems(_0x22bca7=>_0x22bca7['type']==='drawing'&&_0x22bca7['groupId']&&_0x12495d?pipe(_0x1b9530()['filter'](isGroupLayerItem)['find'](_0x176827=>_0x176827['id']===_0x22bca7['groupId']),_0x32d2e1=>{if(_0x32d2e1){const _0x1a1a1c=_0x32d2e1['itemsVisibility']['find'](_0x4244d1=>_0x4244d1['id']===_0x22bca7['id']);return _0x1a1a1c?_0x1a1a1c['visible']??_0x12495d:_0x12495d;}else return _0x12495d;},_0x2d97eb=>({..._0x22bca7,'visible':_0x2d97eb})):{..._0x22bca7,'visible':_0x12495d},_0x5514a2['id']),_0x511dde);},_0x5d476a=(_0x3eff11=!![])=>_0x5cfc32=>pipe(_0x1b9530(),array['findFirst'](_0x4aafa2=>_0x4aafa2['id']===_0x5cfc32),option['fold'](()=>console['warn'](_0x5cfc32+'\x20id\x20doesn\x27t\x20exists'),_0xd1a7b7=>_0xad3044(_0xd1a7b7,_0x3eff11))),_0x5de5d3=_0x5ebe5b=>{const _0x394d80=_0x1b9530()['filter'](_0x40823c=>isDrawingLayerItem(_0x40823c)&&_0x40823c['drawing']['type']===_0x5ebe5b['type'])['length']+0x1,_0x4e1a66=_0x226dff(formatDrawingName(_0x116759['drawings']['types'][_0x5ebe5b['type']],_0x394d80),_0x394d80),_0x5b2051={'id':getDrawingLayerItemId(_0x5ebe5b),'type':'drawing','name':_0x4e1a66,'drawing':_0x5ebe5b,'visible':_0x5ebe5b['visible'],'locked':_0x5ebe5b['locked']};_0x511dde([_0x5b2051,..._0x526fb2['getValue']()]),_0x3cc91f(_0x5b2051);},_0x8329a9=(_0x32bfb0,_0x2b5421)=>_0x32bfb0['forEach'](_0x327fc3=>{const _0x32d1dd=_0x2b5421['find'](_0x44acf3=>getDrawingLayerItemId(_0x327fc3['_internalDrawing'])===_0x44acf3['id']);_0x32d1dd&&pipe(_0x526fb2['getValue'](),updateItemInLayerItems(_0xd119f4=>({..._0xd119f4,'locked':_0x327fc3['locked'],'visible':_0x327fc3['visible']}),_0x32d1dd['id']),_0x511dde);}),_0x115b6b=(_0x3c2057,_0x38f0d8)=>_0x38f0d8['filter'](_0x10f178=>!_0x3c2057['find'](_0xf5b63a=>getDrawingLayerItemId(_0xf5b63a['_internalDrawing'])===_0x10f178['id']))['forEach'](_0x2fca24),_0x31674c=(_0x5d37d0,_0x95eca1)=>_0x5d37d0['filter'](_0x96a1e5=>!_0x95eca1['find'](_0x206535=>getDrawingLayerItemId(_0x96a1e5['_internalDrawing'])===_0x206535['id']))['forEach'](_0x2a0e1e=>_0x5de5d3(_0x2a0e1e['_internalDrawing'])),_0x27b533=(_0x212a5c,_0x2dd1dd)=>{_0x8329a9(_0x212a5c,_0x2dd1dd),_0x115b6b(_0x212a5c,_0x2dd1dd),_0x31674c(_0x212a5c,_0x2dd1dd);},_0x3d1f73=pipe(_0xe321b9['instrument'],filterOption(),tap(_0x6731d6=>{const _0x5189ae=_0x469d5e['getValue']()[_0x6731d6['symbol']]??[];_0x511dde(_0x5189ae),_0x5189ae['forEach'](_0x4af49b=>{_0x5d476a(_0x4af49b['visible'])(_0x4af49b['id']),_0x5992aa(_0x4af49b['locked']??![])(_0x4af49b['id']);});})),_0x576dfd=pipe(_0x4ca437['drawings'],observable['map'](_0x14f289=>_0x14f289[option['toUndefined'](_0xe321b9['instrument']['getValue']())?.['symbol']??'']??[]),tap(_0x1590a3=>{const _0xe7f619=_0x1b9530()['filter'](isDrawingLayerItem);_0x27b533(_0x1590a3,_0xe7f619);})),_0x551f6b=pipe(_0x526fb2,observable['map'](()=>pipe(_0x1b9530(),array['filter'](isDrawingLayerItem))),distinctUntilChanged(drawingsEq['equals']),tap(_0x4e515f=>pipe(_0x4e515f,array['map'](_0x1a226a=>_0x1a226a['id']),_0x19466a['drawings']['setDrawingsOrder']))),_0x51d8a6=pipe(_0x526fb2,tap(()=>{_0x21f819['updateLocalChartInfo'](_0x372c29,{'layers':{..._0x21f819['getSelectedChartInfo']()['layers'],'layerItems':_0x469d5e['getValue']()}});})),_0x272170=pipe(_0x4ca437['isVisible'],distinctUntilChanged(),tap(_0x13439d=>{_0x1b9530()['filter'](isGroupLayerItem)['forEach'](_0x5d8bd9=>_0x5d476a(_0x13439d)(_0x5d8bd9['id']));})),_0x18862a=pipe(_0x526fb2,tap(()=>_0x4196b6['forEach'](_0x2ff6c9=>_0x2ff6c9(_0x372c29,_0x469d5e['getValue']()))),finalize(()=>_0x4196b6['clear']())),_0x222cf7=merge(_0x3d1f73,_0x576dfd,_0x551f6b,_0x51d8a6,_0x18862a,_0x272170);return newSink({'layerItems':_0x526fb2,'addedLayerItem':_0x319f55,'setAllLayerItems':_0x4d32cc,'createGroup':_0x27462f,'renameItem':_0x51615f,'deleteItem':_0x542989,'moveItem':_0x2fbad3,'createGroupOnSelectedItems':_0x461593,'moveItemDnD':_0xcd6a58,'setItemLock':(_0x331cd1,_0x1ef6f2)=>_0x5992aa(_0x1ef6f2)(_0x331cd1),'setItemVisible':(_0x1f1c02,_0x1b49bc)=>_0x5d476a(_0x1b49bc)(_0x1f1c02),'onLayerItemsChanged':_0xd40eb7},_0x222cf7);});export const drawingsEq=array['getEq'](eq['struct']({'id':eq['eqStrict'],'visible':boolean['Eq'],'locked':boolean['Eq']}));const formatDrawingName=(_0x2e783b,_0xe98152)=>{return _0x2e783b+'\x20'+_0xe98152;};export const getDrawingChartCoreId=_0x5e5eac=>{return _0x5e5eac['replace']('drawing_','');};export const getDrawingLayerItemId=_0x12a3e8=>'drawing_'+_0x12a3e8['id'];