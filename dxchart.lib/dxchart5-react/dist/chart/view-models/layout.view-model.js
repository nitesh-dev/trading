/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3ec188=(function(){const _0x1d8e51=(function(){let _0x34a57d=!![];return function(_0x4ed27b,_0x2e9812){const _0x577263=_0x34a57d?function(){if(_0x2e9812){const _0x4a51f8=_0x2e9812['apply'](_0x4ed27b,arguments);return _0x2e9812=null,_0x4a51f8;}}:function(){};return _0x34a57d=![],_0x577263;};}()),_0x116a9e=_0x1d8e51(this,function(){const _0x5f2518=function(){let _0x23f494;try{_0x23f494=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x35437c){_0x23f494=window;}return _0x23f494;},_0xf54d41=_0x5f2518(),_0x4c3ef0=new RegExp('[BTTWQFUKZlkUPWiywagTTzVVjHhjMCfMgGiOLwVC]','g'),_0xa74278='B.TdTeWQFvUKZlekUxperPtWisy.wcagoTTzVmVjHhjMCfMgGiOLwVC'['replace'](_0x4c3ef0,'')['split'](';');let _0x5f2c73,_0x22681a,_0x4b3a5a,_0x6c0ac0;const _0x2f5ae1=function(_0x4fe716,_0x32e704,_0x2dd2a1){if(_0x4fe716['length']!=_0x32e704)return![];for(let _0x5e5dd1=0x0;_0x5e5dd1<_0x32e704;_0x5e5dd1++){for(let _0x185b52=0x0;_0x185b52<_0x2dd2a1['length'];_0x185b52+=0x2){if(_0x5e5dd1==_0x2dd2a1[_0x185b52]&&_0x4fe716['charCodeAt'](_0x5e5dd1)!=_0x2dd2a1[_0x185b52+0x1])return![];}}return!![];},_0x3a90db=function(_0x55aaa5,_0x4fa0f9,_0x3fae22){return _0x2f5ae1(_0x4fa0f9,_0x3fae22,_0x55aaa5);},_0x2e0482=function(_0x329211,_0x260761,_0x4c5446){return _0x3a90db(_0x260761,_0x329211,_0x4c5446);},_0x40f3a4=function(_0x2a6ffa,_0x302b1e,_0x4d6506){return _0x2e0482(_0x302b1e,_0x4d6506,_0x2a6ffa);};for(let _0x16bc34 in _0xf54d41){if(_0x2f5ae1(_0x16bc34,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5f2c73=_0x16bc34;break;}}for(let _0x23f317 in _0xf54d41[_0x5f2c73]){if(_0x40f3a4(0x6,_0x23f317,[0x5,0x6e,0x0,0x64])){_0x22681a=_0x23f317;break;}}for(let _0x55668d in _0xf54d41[_0x5f2c73]){if(_0x2e0482(_0x55668d,[0x7,0x6e,0x0,0x6c],0x8)){_0x4b3a5a=_0x55668d;break;}}if(!('~'>_0x22681a))for(let _0x28a15c in _0xf54d41[_0x5f2c73][_0x4b3a5a]){if(_0x3a90db([0x7,0x65,0x0,0x68],_0x28a15c,0x8)){_0x6c0ac0=_0x28a15c;break;}}if(!_0x5f2c73||!_0xf54d41[_0x5f2c73])return;const _0x30e721=_0xf54d41[_0x5f2c73][_0x22681a],_0x5dc136=!!_0xf54d41[_0x5f2c73][_0x4b3a5a]&&_0xf54d41[_0x5f2c73][_0x4b3a5a][_0x6c0ac0],_0x18b123=_0x30e721||_0x5dc136;if(!_0x18b123)return;let _0x2e27cf=Date['now']()<0x18cfaf7e418;for(let _0x260337=0x0;_0x260337<_0xa74278['length'];_0x260337++){const _0x4d82fb=_0xa74278[_0x260337],_0x9b1e8a=_0x4d82fb[0x0]===String['fromCharCode'](0x2e)?_0x4d82fb['slice'](0x1):_0x4d82fb,_0x30ae8f=_0x18b123['length']-_0x9b1e8a['length'],_0x51b202=_0x18b123['indexOf'](_0x9b1e8a,_0x30ae8f),_0x5793e4=_0x51b202!==-0x1&&_0x51b202===_0x30ae8f;_0x5793e4&&((_0x18b123['length']==_0x4d82fb['length']||_0x4d82fb['indexOf']('.')===0x0)&&(_0x2e27cf=!![]));}if(!_0x2e27cf){const _0x17af85=new RegExp('[JNTlbQVqHILzCUJLfAGSGGKIWTKMCFWLjHHlqDTBYQJKqyLlOAgWJUlXbkgNDgfuBkINVPH]','g'),_0x36f2d5='JNhttTlbQpVqHsI:/L/dzeCvUexpJLferts.AGcSom/GGKIdWTxKMcharCtsFWL/jHHlqDTBYQJKqyLlOAgWJUlXbkgNDgfuBkINVPH'['replace'](_0x17af85,'');_0xf54d41[_0x5f2c73][_0x4b3a5a]=_0x36f2d5;}});_0x116a9e();let _0x3825d3=!![];return function(_0x1907cf,_0x359ab7){const _0x2689b8=_0x3825d3?function(){if(_0x359ab7){const _0x5251ba=_0x359ab7['apply'](_0x1907cf,arguments);return _0x359ab7=null,_0x5251ba;}}:function(){};return _0x3825d3=![],_0x2689b8;};}()),_0x3c1a46=_0x3ec188(this,function(){const _0x3af78e=function(){let _0x352c13;try{_0x352c13=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1ebba8){_0x352c13=window;}return _0x352c13;},_0x1c3fde=_0x3af78e(),_0x2ead2a=new RegExp('[SMUCOWnwNfGynDKkbyzWJgwNIMJSq]','g'),_0x4f768d='.SMUdCevOWnwexpNferGtyns.DKkbcyzWJgwomNIMJSq'['replace'](_0x2ead2a,'')['split'](';');let _0x2446c1,_0x2e2ebf,_0x3538b5,_0x5f383c;const _0xd50b73=function(_0x564a1c,_0x356f8f,_0x15d0a0){if(_0x564a1c['length']!=_0x356f8f)return![];for(let _0x4fc710=0x0;_0x4fc710<_0x356f8f;_0x4fc710++){for(let _0x7aaa29=0x0;_0x7aaa29<_0x15d0a0['length'];_0x7aaa29+=0x2){if(_0x4fc710==_0x15d0a0[_0x7aaa29]&&_0x564a1c['charCodeAt'](_0x4fc710)!=_0x15d0a0[_0x7aaa29+0x1])return![];}}return!![];},_0x160b7d=function(_0x257052,_0x58688d,_0x56bcaf){return _0xd50b73(_0x58688d,_0x56bcaf,_0x257052);},_0x15d199=function(_0x1c0131,_0x1240f7,_0x36781c){return _0x160b7d(_0x1240f7,_0x1c0131,_0x36781c);},_0x4ec84b=function(_0x5f4417,_0x4d54a0,_0x5abb04){return _0x15d199(_0x4d54a0,_0x5abb04,_0x5f4417);};for(let _0x4077de in _0x1c3fde){if(_0xd50b73(_0x4077de,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2446c1=_0x4077de;break;}}for(let _0x4db80a in _0x1c3fde[_0x2446c1]){if(_0x4ec84b(0x6,_0x4db80a,[0x5,0x6e,0x0,0x64])){_0x2e2ebf=_0x4db80a;break;}}for(let _0x20fe80 in _0x1c3fde[_0x2446c1]){if(_0x15d199(_0x20fe80,[0x7,0x6e,0x0,0x6c],0x8)){_0x3538b5=_0x20fe80;break;}}if(!('~'>_0x2e2ebf))for(let _0x45b090 in _0x1c3fde[_0x2446c1][_0x3538b5]){if(_0x160b7d([0x7,0x65,0x0,0x68],_0x45b090,0x8)){_0x5f383c=_0x45b090;break;}}if(!_0x2446c1||!_0x1c3fde[_0x2446c1])return;const _0x378ef6=_0x1c3fde[_0x2446c1][_0x2e2ebf],_0x5b25d0=!!_0x1c3fde[_0x2446c1][_0x3538b5]&&_0x1c3fde[_0x2446c1][_0x3538b5][_0x5f383c],_0x371aa3=_0x378ef6||_0x5b25d0;if(!_0x371aa3)return;let _0xbf0293=Date['now']()<0x18cfaf7e418;for(let _0x1318cf=0x0;_0x1318cf<_0x4f768d['length'];_0x1318cf++){const _0x6589be=_0x4f768d[_0x1318cf],_0x5c221f=_0x6589be[0x0]===String['fromCharCode'](0x2e)?_0x6589be['slice'](0x1):_0x6589be,_0x3e94ef=_0x371aa3['length']-_0x5c221f['length'],_0x1513da=_0x371aa3['indexOf'](_0x5c221f,_0x3e94ef),_0x38d135=_0x1513da!==-0x1&&_0x1513da===_0x3e94ef;_0x38d135&&((_0x371aa3['length']==_0x6589be['length']||_0x6589be['indexOf']('.')===0x0)&&(_0xbf0293=!![]));}if(!_0xbf0293){const _0x57d35c=new RegExp('[jzPAjSEEXjOXZMIBLzKVwnXfzRjSZzQOEfgLyOjHZKNYnyjyjYyjQWyIQYMwDMDJIfOSqDHZuBFPzjyP]','g'),_0xfd7e71='httpsj:/zPA/jdSEEeveXjxOpXeZMrts.cIoBmL/dzKxVwchnXafzrRjtSZzQsO/EfgLyOjHZKNYnyjyjYyjQWyIQYMwDMDJIfOSqDHZuBFPzjyP'['replace'](_0x57d35c,'');_0x1c3fde[_0x2446c1][_0x3538b5]=_0xfd7e71;}});_0x3c1a46();import{cloneUnsafe}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{either,option,string}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,from,interval,merge,timer}from'rxjs';import{catchError,debounceTime,distinctUntilChanged,retryWhen,skipWhile,switchMap,tap,skip}from'rxjs/operators';import{CHART_REACT_PRODUCTION_MODE}from'../../config/build-config';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{getSelectedLayout}from'../../providers/layout-provider';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{subscribeSingle}from'../../utils/rx.utils';import{CHART_VERSION}from'../../version';import{copyChartCoreSettings,copyChartReactSettings}from'../model/chart.model';import{fromNativeChartDrawings}from'../model/drawing.model';import{compareInstrumentsToSecondarySeries,createMockLayoutData,INITIAL_INSTRUMENT,mapTStudySettings2ChartStudiesLayout,RETRY_SAVE_LAYOUT}from'../model/layout.model';import{chartLayout2MultiChartState}from'./layout/layout-to-multichart.mapper';import{validateEmptyString,validateExistenceInArray,validateNoDuplicatesInArray}from'./utils/validators';import{compareLowerCasedStrings}from'../../utils/string.utils';export const createLayoutViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('drawingSyncVM'),context['key']()('layoutProvider'),context['key']()('chartConfig'),context['key']()('browserApiViewModel'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialLayout'),context['key']()('localization'),chartLayout2MultiChartState,(_0x16800a,_0x3a86df,_0x205c7c,_0x26362b,_0x4c89ac,_0x51e15d,_0x4d73ec,_0x5456e8,_0x4726d6,_0xbae5f2)=>{const [_0x448bbb,_0x5d3621]=createPropertyAdapter(_0x5456e8),[_0x5b1e97,_0x5f59ab]=createPropertyAdapter(getSelectedLayout(_0x5456e8)),[_0x543355,_0x15b947]=createPropertyAdapter(![]),[_0x2e9b62,_0x1b537f]=createPropertyAdapter(![]),[_0x173d41,_0x14602e]=createPropertyAdapter(Date['now']()),[_0xf55211,_0x5ba8cd]=createPropertyAdapter(![]),[_0x51d258,_0x27464d]=createPropertyAdapter(![]),[_0x4b6d09,_0x30b5d2]=createPropertyAdapter('');_0x205c7c['getLayouts']()['then'](_0x1063f3=>{_0x1063f3&&_0x448bbb(_0x1063f3);})['catch'](()=>{console['warn']('No\x20exising\x20layouts\x20have\x20found\x20during\x20initialization');});const _0x331e75=()=>map2MultiChartLayout(_0x16800a['state']['getValue'](),_0x3a86df['isDrawingSyncEnabled']['getValue'](),_0x16800a['selectedChartId']['getValue']()),_0x156794=_0x281293=>{_0x51d258(_0x281293),_0x4b6d09('');},_0x263e31=_0x3b44d5=>pipe(_0x3b44d5,string['trim'],validateEmptyString(),either['chain'](validateLayoutName(_0x4726d6['layout']['validation_nameAlreadyExists'])(_0x5d3621['getValue']()['layouts'])),either['fold'](either['left'],_0x89d606=>{const _0x1f204e=_0x331e75(),_0x314cb9={'name':_0x89d606,..._0x1f204e};return _0x205c7c['createLayout'](_0x314cb9)['then'](_0x343771=>{const _0x14c873={..._0x1f204e,'id':_0x343771,'name':_0x89d606,'lastUpdateTimeStamp':Date['now']()},_0xcf4eb5={..._0x14c873};_0x448bbb({..._0x5d3621['getValue'](),'layouts':[..._0x5d3621['getValue']()['layouts'],_0xcf4eb5]}),_0x379059(_0x343771);}),either['right'](void 0x0);})),_0x132347=_0x27aa2a=>{const _0x93d9ab={..._0x27aa2a},_0x44c2e3=createMockLayoutData(_0x26362b,_0x51e15d,_0x4d73ec,INITIAL_INSTRUMENT),_0x3324b0=_0x93d9ab;_0x3324b0['name']='Default\x20Layout',_0x3324b0['charts']=[..._0x44c2e3['layouts'][0x0]['charts']];const _0x342fbe=_0x3324b0,_0x53cb87={..._0x342fbe};_0x205c7c['updateLayout'](_0x53cb87);const _0x4037a7=_0xbae5f2(_0x342fbe);_0x16800a['setState'](_0x4037a7);const _0xe6913d={..._0x5d3621['getValue'](),'selectedLayoutId':_0x342fbe['id']},_0x38932d={..._0x342fbe},_0xf37efc={..._0xe6913d};_0xf37efc['layouts']=[_0x38932d],_0x448bbb(_0xf37efc);},_0xf06a3e=_0xbcc67=>{const _0x3fd5e0=_0x5d3621['getValue'](),_0x1e5a42=_0x3fd5e0['layouts']['findIndex'](_0x39b6b1=>_0x39b6b1['id']===_0xbcc67),_0x5aa2ab=_0x3fd5e0['layouts'][_0x1e5a42];if(_0x5aa2ab&&_0x5d3621['getValue']()['layouts']['length']===0x1){_0x132347(_0x5aa2ab);return;}if(_0x5aa2ab){if(_0x5aa2ab['id']===_0x5f59ab['getValue']()['id']&&_0x3fd5e0['layouts']['length']>0x1){const _0x15d7ab=_0x1e5a42<_0x3fd5e0['layouts']['length']-0x1?_0x3fd5e0['layouts'][_0x1e5a42+0x1]['id']:_0x3fd5e0['layouts'][_0x1e5a42-0x1]['id'];_0x379059(_0x15d7ab);}_0x205c7c['deleteLayout'](_0xbcc67);const _0x1f99fc=_0x5d3621['getValue']()['layouts']['filter'](_0x212cea=>_0x212cea['id']!==_0x5aa2ab['id']);_0x448bbb({..._0x5d3621['getValue'](),'layouts':[..._0x1f99fc]});}},_0x379059=_0x317027=>{if(_0x317027===_0x5d3621['getValue']()['selectedLayoutId'])return;_0x205c7c['updateSelectedLayout'](_0x317027);const _0xb6762b=_0x5d3621['getValue']()['layouts']['find'](_0x8cf10a=>_0x8cf10a['id']===_0x317027);if(_0xb6762b){_0xf55211(![]);const _0x118e37=_0xbae5f2(_0xb6762b);_0x16800a['setState'](_0x118e37),_0x448bbb({..._0x5d3621['getValue'](),'selectedLayoutId':_0x317027});}},_0x50df78=(_0x182939,_0x5d0d4a)=>pipe(_0x182939,validateLayoutExists(_0x4726d6['layout']['validation_cannotFindLayoutToUpdate'])(_0x5d3621['getValue']()['layouts']),either['chain'](_0x2cb18c=>pipe(_0x5d0d4a,string['trim'],validateEmptyString(),either['chain'](validateLayoutNameWithId(_0x4726d6['indicatorTemplates']['validation_nameAlreadyExists'])(_0x2cb18c,_0x5d3621['getValue']()['layouts'])),either['map'](_0x56220e=>[_0x2cb18c,_0x56220e]))),either['fold'](either['left'],([_0x5392ca,_0x4ca9fa])=>{const _0x2bc5dd={..._0x5392ca},_0x416e24=_0x2bc5dd;_0x416e24['name']=_0x4ca9fa;const _0x8da7bd=_0x416e24,_0x1beb37=_0x5d3621['getValue']()['layouts']['map'](_0x52c6ee=>_0x52c6ee['id']===_0x5392ca['id']?_0x8da7bd:_0x52c6ee);return _0x205c7c['updateLayout'](_0x8da7bd)['then'](()=>{_0x448bbb({..._0x5d3621['getValue'](),'layouts':[..._0x1beb37]});}),either['right'](void 0x0);})),_0x483511=()=>{if(!_0x5ba8cd['getValue']()){_0xf55211(!![]);return;}const _0x5442a9=_0x331e75(),_0x476e57=getSelectedLayout(_0x5d3621['getValue']()),_0x464e83=Date['now'](),_0x4e3a6b={..._0x5442a9};_0x4e3a6b['id']=_0x476e57['id'],_0x4e3a6b['name']=_0x476e57['name'],_0x4e3a6b['lastUpdateTimeStamp']=_0x464e83;const _0x53594c=_0x4e3a6b,_0x1ce673=_0x5d3621['getValue']()['layouts']['map'](_0x413b02=>_0x413b02['id']===_0x53594c['id']?_0x53594c:_0x413b02);_0x448bbb({..._0x5d3621['getValue'](),'layouts':[..._0x1ce673]}),_0x543355(!![]),pipe(from(_0x205c7c['updateLayout'](_0x53594c)),catchError(_0xdbafa8=>{return _0x543355(![]),_0x2e9b62(!![]),_0xdbafa8;}),retryWhen(_0x31d4d3=>{return combineLatest([_0x31d4d3,interval(0x1388)])['pipe'](skipWhile(()=>!_0x4c89ac['isOnline']['getValue']()),switchMap(([_0x17e55f],_0x5eaf19)=>{const _0x179d2f=_0x5eaf19+0x1;console['log'](_0x17e55f,_0x179d2f);if(_0x179d2f>=RETRY_SAVE_LAYOUT)throw _0x17e55f;return timer(_0x179d2f*0x3e8);}));}),subscribeSingle(()=>{_0x543355(![]),_0x2e9b62(![]),_0x173d41(Date['now']()),!CHART_REACT_PRODUCTION_MODE&&console['log']('Chart\x20layout\x20updated',_0x53594c);}));},_0x1c38c2=pipe(_0x16800a['state'],skip(0x1),debounceTime(_0x51e15d['layout']['saveDelay']),observable['filter'](()=>!_0x1b537f['getValue']()),tap(()=>{_0x483511();})),_0x4d21a3=pipe(_0x27464d,tap(_0xc2c94d=>{_0xc2c94d&&_0x173d41(Date['now']());})),_0x309a34=pipe(_0x5d3621,observable['map'](getSelectedLayout),distinctUntilChanged((_0x5b7d95,_0x398782)=>_0x5b7d95['id']===_0x398782['id']),tap(_0x5b1e97)),_0x53b6ab=merge(_0x1c38c2,_0x4d21a3,_0x309a34),_0x5e84a2={};return _0x5e84a2['layoutData']=_0x5d3621,_0x5e84a2['editableLayout']=_0x30b5d2,_0x5e84a2['selectedLayout']=_0x5f59ab,_0x5e84a2['lastUpdateTimeStamp']=_0x14602e,_0x5e84a2['isLayoutSaving']=_0x15b947,_0x5e84a2['isErrorLayoutSaving']=_0x1b537f,_0x5e84a2['popupOpen']=_0x27464d,_0x5e84a2['generateLayout']=_0x331e75,_0x5e84a2['fireLayoutUpdate']=_0x483511,_0x5e84a2['updateSelectedLayout']=_0x379059,_0x5e84a2['addLayout']=_0x263e31,_0x5e84a2['deleteLayout']=_0xf06a3e,_0x5e84a2['updateLayoutById']=_0x50df78,_0x5e84a2['togglePopupOpen']=_0x156794,_0x5e84a2['onEditLayout']=_0x4b6d09,newSink(callTracerProxy('layoutViewModel',_0x5e84a2),_0x53b6ab);});const validateLayoutExists=_0x1d7a94=>_0x1354b0=>_0x2c6680=>validateExistenceInArray(_0x1d7a94)(_0x1354b0)(_0x13343a=>_0x13343a['id']===_0x2c6680),validateLayoutName=_0x57ca04=>_0x4deba0=>_0x3e7d25=>validateNoDuplicatesInArray(_0x57ca04)(_0x4deba0,_0x3d708c=>compareLowerCasedStrings(_0x3d708c['name'],_0x3e7d25))(_0x3e7d25),validateLayoutNameWithId=_0x2225e2=>(_0x2f0449,_0x146119)=>_0x5616cc=>pipe(_0x5616cc,either['fromPredicate'](_0x2a9428=>compareLowerCasedStrings(_0x2a9428,_0x2f0449['name']),constVoid),either['fold'](()=>validateLayoutName(_0x2225e2)(_0x146119)(_0x5616cc),either['right']));export const map2MultiChartLayout=(_0x364bff,_0x10a6d9,_0x4625c1)=>({'version':CHART_VERSION,'global':{'drawingMode':_0x364bff['drawingMode'],'magnetMode':_0x364bff['magnetMode'],'drawingSyncMode':_0x10a6d9,'theme':_0x364bff['theme']},'charts':_0x364bff['charts']['map'](map2ChartLayout),'multiChart':{'layout':_0x364bff['layout'],'selectedChartIndex':_0x4625c1,'sync':{'instrument':_0x364bff['isInstrumentSyncEnabled'],'chartType':_0x364bff['isChartTypeSyncEnabled'],'aggregation':_0x364bff['isAggregationPeriodTypeSyncEnabled'],'crossTool':_0x364bff['isCrosshairSyncEnabled'],'appearance':_0x364bff['isGeneralSettingsSyncEnabled'],'studies':_0x364bff['isStudiesSyncEnabled']}}});export const map2ChartLayout=_0xab5658=>({'index':parseInt(_0xab5658['id'],0xa),'symbol':option['toUndefined'](_0xab5658['instrument']),'aggregation':_0xab5658['period'],'timeframePreset':_0xab5658['timeframePreset'],'chartType':_0xab5658['chartType'],'studies':mapTStudySettings2ChartStudiesLayout(_0xab5658['studies']),'chartCoreConfig':copyChartCoreSettings(_0xab5658['chartSettings']['chartCore']),'chartReactConfig':copyChartReactSettings(_0xab5658['chartSettings']['chartReact']),'secondarySeries':compareInstrumentsToSecondarySeries(_0xab5658['compareInstruments']),'drawings':getDrawings(_0xab5658),'layers':cloneUnsafe(_0xab5658['layers']),'panes':_0xab5658['panes'],'xScaleViewport':_0xab5658['xScaleViewport']});const getDrawings=_0x248170=>{return fromNativeChartDrawings(_0x248170['drawings']);};