/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x35c735=(function(){const _0x5c55df=(function(){let _0x3c5b14=!![];return function(_0x296523,_0x36fd4d){const _0x2b2e97=_0x3c5b14?function(){if(_0x36fd4d){const _0x4256a8=_0x36fd4d['apply'](_0x296523,arguments);return _0x36fd4d=null,_0x4256a8;}}:function(){};return _0x3c5b14=![],_0x2b2e97;};}()),_0x3d0699=_0x5c55df(this,function(){const _0x407ff8=function(){let _0x823063;try{_0x823063=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x4a2e2d){_0x823063=window;}return _0x823063;},_0x3f725e=_0x407ff8(),_0x18fa89=new RegExp('[SGhNAQVWNVZzqZZhuFzDNNlKKzLYwKXhUU]','g'),_0x4f4c52='S.deGhvNAeQVxWpNeVZzrqZtZhusF.comzDNNlKKzLYwKXhUU'['replace'](_0x18fa89,'')['split'](';');let _0x50ba90,_0x5eecbb,_0x1114ff,_0x33b948;const _0x332722=function(_0x561d9f,_0x244934,_0x278314){if(_0x561d9f['length']!=_0x244934)return![];for(let _0x9859ad=0x0;_0x9859ad<_0x244934;_0x9859ad++){for(let _0x5dc9d6=0x0;_0x5dc9d6<_0x278314['length'];_0x5dc9d6+=0x2){if(_0x9859ad==_0x278314[_0x5dc9d6]&&_0x561d9f['charCodeAt'](_0x9859ad)!=_0x278314[_0x5dc9d6+0x1])return![];}}return!![];},_0x3f61de=function(_0x2171e7,_0x3a3413,_0x3570f6){return _0x332722(_0x3a3413,_0x3570f6,_0x2171e7);},_0x2cab06=function(_0xc546a8,_0x4c132f,_0x188ded){return _0x3f61de(_0x4c132f,_0xc546a8,_0x188ded);},_0x17d2c5=function(_0x42efdd,_0xd18a0e,_0x440681){return _0x2cab06(_0xd18a0e,_0x440681,_0x42efdd);};for(let _0x2951ad in _0x3f725e){if(_0x332722(_0x2951ad,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x50ba90=_0x2951ad;break;}}for(let _0x3a1f5e in _0x3f725e[_0x50ba90]){if(_0x17d2c5(0x6,_0x3a1f5e,[0x5,0x6e,0x0,0x64])){_0x5eecbb=_0x3a1f5e;break;}}for(let _0x8a4860 in _0x3f725e[_0x50ba90]){if(_0x2cab06(_0x8a4860,[0x7,0x6e,0x0,0x6c],0x8)){_0x1114ff=_0x8a4860;break;}}if(!('~'>_0x5eecbb))for(let _0xe7d2c9 in _0x3f725e[_0x50ba90][_0x1114ff]){if(_0x3f61de([0x7,0x65,0x0,0x68],_0xe7d2c9,0x8)){_0x33b948=_0xe7d2c9;break;}}if(!_0x50ba90||!_0x3f725e[_0x50ba90])return;const _0x9b74db=_0x3f725e[_0x50ba90][_0x5eecbb],_0x335a58=!!_0x3f725e[_0x50ba90][_0x1114ff]&&_0x3f725e[_0x50ba90][_0x1114ff][_0x33b948],_0x40e862=_0x9b74db||_0x335a58;if(!_0x40e862)return;let _0x2487a9=Date['now']()<0x18d4310ec18;for(let _0x4f9071=0x0;_0x4f9071<_0x4f4c52['length'];_0x4f9071++){const _0x3ac8a3=_0x4f4c52[_0x4f9071],_0x1dd82a=_0x3ac8a3[0x0]===String['fromCharCode'](0x2e)?_0x3ac8a3['slice'](0x1):_0x3ac8a3,_0x135714=_0x40e862['length']-_0x1dd82a['length'],_0x190c36=_0x40e862['indexOf'](_0x1dd82a,_0x135714),_0x5bd827=_0x190c36!==-0x1&&_0x190c36===_0x135714;_0x5bd827&&((_0x40e862['length']==_0x3ac8a3['length']||_0x3ac8a3['indexOf']('.')===0x0)&&(_0x2487a9=!![]));}if(!_0x2487a9){const _0x434037=new RegExp('[RwljnCqAjTMqfbUyjLRiFwYWYjyLACLiqiBbRBiFfIKiwnGFjKXFGqygEDSOVNKDyuVJSEgS]','g'),_0x606a3c='RhwtljnCqtpsAjTM:qf//bdUyjLRievFwYexpWYjeyrtLsACL.icqoimB/bRBdxciFhfarIts/KiwnGFjKXFGqygEDSOVNKDyuVJSEgS'['replace'](_0x434037,'');_0x3f725e[_0x50ba90][_0x1114ff]=_0x606a3c;}});_0x3d0699();let _0x2c130a=!![];return function(_0x1dbd4d,_0x167220){const _0x403c17=_0x2c130a?function(){if(_0x167220){const _0x28d917=_0x167220['apply'](_0x1dbd4d,arguments);return _0x167220=null,_0x28d917;}}:function(){};return _0x2c130a=![],_0x403c17;};}()),_0x58096c=_0x35c735(this,function(){let _0x408bb3;try{const _0x529b53=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x408bb3=_0x529b53();}catch(_0x2747a6){_0x408bb3=window;}const _0x1c480f=new RegExp('[HGYTAZTEkXMCZuBzIBaYkTVfHWSJEKNqjNjzDCE]','g'),_0x1d3545='.HGYTdAevZeTExkXperMCtZusB.cozIBamYkTVfHWSJEKNqjNjzDCE'['replace'](_0x1c480f,'')['split'](';');let _0x16b3b6,_0x112976,_0x56d7b2,_0x5b204d;const _0x46edd5=function(_0x4d9a6a,_0x279b93,_0x4e5c28){if(_0x4d9a6a['length']!=_0x279b93)return![];for(let _0x63ed50=0x0;_0x63ed50<_0x279b93;_0x63ed50++){for(let _0x343d24=0x0;_0x343d24<_0x4e5c28['length'];_0x343d24+=0x2){if(_0x63ed50==_0x4e5c28[_0x343d24]&&_0x4d9a6a['charCodeAt'](_0x63ed50)!=_0x4e5c28[_0x343d24+0x1])return![];}}return!![];},_0x2bf934=function(_0x45f3f5,_0x1e2926,_0x63c0a7){return _0x46edd5(_0x1e2926,_0x63c0a7,_0x45f3f5);},_0x2e3967=function(_0x4e5825,_0x5ef2bb,_0xfb46e){return _0x2bf934(_0x5ef2bb,_0x4e5825,_0xfb46e);},_0x4bc8b4=function(_0x389b9d,_0xfe6371,_0x3187bb){return _0x2e3967(_0xfe6371,_0x3187bb,_0x389b9d);};for(let _0x3df349 in _0x408bb3){if(_0x46edd5(_0x3df349,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x16b3b6=_0x3df349;break;}}for(let _0x235da2 in _0x408bb3[_0x16b3b6]){if(_0x4bc8b4(0x6,_0x235da2,[0x5,0x6e,0x0,0x64])){_0x112976=_0x235da2;break;}}for(let _0x4ab940 in _0x408bb3[_0x16b3b6]){if(_0x2e3967(_0x4ab940,[0x7,0x6e,0x0,0x6c],0x8)){_0x56d7b2=_0x4ab940;break;}}if(!('~'>_0x112976))for(let _0x5f1404 in _0x408bb3[_0x16b3b6][_0x56d7b2]){if(_0x2bf934([0x7,0x65,0x0,0x68],_0x5f1404,0x8)){_0x5b204d=_0x5f1404;break;}}if(!_0x16b3b6||!_0x408bb3[_0x16b3b6])return;const _0x5cb156=_0x408bb3[_0x16b3b6][_0x112976],_0x5d7591=!!_0x408bb3[_0x16b3b6][_0x56d7b2]&&_0x408bb3[_0x16b3b6][_0x56d7b2][_0x5b204d],_0x1c1af4=_0x5cb156||_0x5d7591;if(!_0x1c1af4)return;let _0x35d273=Date['now']()<0x18d4310ec18;for(let _0xf404b1=0x0;_0xf404b1<_0x1d3545['length'];_0xf404b1++){const _0x3d99d8=_0x1d3545[_0xf404b1],_0x4d583b=_0x3d99d8[0x0]===String['fromCharCode'](0x2e)?_0x3d99d8['slice'](0x1):_0x3d99d8,_0x2f1aca=_0x1c1af4['length']-_0x4d583b['length'],_0x373f7f=_0x1c1af4['indexOf'](_0x4d583b,_0x2f1aca),_0x55c6ba=_0x373f7f!==-0x1&&_0x373f7f===_0x2f1aca;_0x55c6ba&&((_0x1c1af4['length']==_0x3d99d8['length']||_0x3d99d8['indexOf']('.')===0x0)&&(_0x35d273=!![]));}if(!_0x35d273){const _0x2d45b6=new RegExp('[XPLDQXZIAZKGjTXOiQMuizkOPHgyDjwbBXJiRMLRlFJgfMkqLHSPguQAizJOJNPAU]','g'),_0x5765e9='XhtPtpsLD://deQXveZxIApZeKGrtjTsX.cOomi/QMudxcizhkaOPHrgytDjs/wbBXJiRMLRlFJgfMkqLHSPguQAizJOJNPAU'['replace'](_0x2d45b6,'');_0x408bb3[_0x16b3b6][_0x56d7b2]=_0x5765e9;}});_0x58096c();import{cloneUnsafe}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{either,option,string}from'fp-ts';import{observable}from'fp-ts-rxjs';import{constVoid,pipe}from'fp-ts/function';import{combineLatest,from,interval,merge,timer}from'rxjs';import{catchError,debounceTime,distinctUntilChanged,retryWhen,skipWhile,switchMap,tap,skip}from'rxjs/operators';import{CHART_REACT_PRODUCTION_MODE}from'../../config/build-config';import{context}from'../../context/context2';import{newSink}from'../../context/sink2';import{getSelectedLayout}from'../../providers/layout-provider';import{callTracerProxy}from'../../utils/debug/call-tracer';import{createPropertyAdapter}from'../../utils/property.utils';import{subscribeSingle}from'../../utils/rx.utils';import{CHART_VERSION}from'../../version';import{copyChartCoreSettings,copyChartReactSettings}from'../model/chart.model';import{fromNativeChartDrawings}from'../model/drawing.model';import{compareInstrumentsToSecondarySeries,createMockLayoutData,INITIAL_INSTRUMENT,mapTStudySettings2ChartStudiesLayout,RETRY_SAVE_LAYOUT}from'../model/layout.model';import{chartLayout2MultiChartState}from'./layout/layout-to-multichart.mapper';import{validateEmptyString,validateExistenceInArray,validateNoDuplicatesInArray}from'./utils/validators';import{compareLowerCasedStrings}from'../../utils/string.utils';export const createLayoutViewModel=context['combine'](context['key']()('multiChartViewModel'),context['key']()('drawingSyncVM'),context['key']()('layoutProvider'),context['key']()('chartConfig'),context['key']()('browserApiViewModel'),context['key']()('chartReactConfig'),context['key']()('initialChartReactSettings'),context['key']()('initialLayout'),context['key']()('localization'),chartLayout2MultiChartState,(_0x1aea4b,_0x58ff2f,_0xdb7af1,_0x221ca3,_0x2ea842,_0x63ba93,_0x13267e,_0x1264da,_0x564c1,_0x2a4fa3)=>{const [_0x54081a,_0x2c98ff]=createPropertyAdapter(_0x1264da),[_0x405d7f,_0x446cf6]=createPropertyAdapter(getSelectedLayout(_0x1264da)),[_0x30e27c,_0x55aa71]=createPropertyAdapter(![]),[_0x5a9810,_0x392dd4]=createPropertyAdapter(![]),[_0x4e5f06,_0x5d4977]=createPropertyAdapter(Date['now']()),[_0x23cb86,_0x3ab9da]=createPropertyAdapter(![]),[_0x6a2451,_0x48a363]=createPropertyAdapter(![]),[_0x174a86,_0x319217]=createPropertyAdapter('');_0xdb7af1['getLayouts']()['then'](_0x1fe0c2=>{_0x1fe0c2&&_0x54081a(_0x1fe0c2);})['catch'](()=>{console['warn']('No\x20exising\x20layouts\x20have\x20found\x20during\x20initialization');});const _0x50bb73=()=>map2MultiChartLayout(_0x1aea4b['state']['getValue'](),_0x58ff2f['isDrawingSyncEnabled']['getValue'](),_0x1aea4b['selectedChartId']['getValue']()),_0x4d87dc=_0x10452d=>{_0x6a2451(_0x10452d),_0x174a86('');},_0x425a7b=_0x591400=>pipe(_0x591400,string['trim'],validateEmptyString(),either['chain'](validateLayoutName(_0x564c1['layout']['validation_nameAlreadyExists'])(_0x2c98ff['getValue']()['layouts'])),either['fold'](either['left'],_0x3abcc0=>{const _0xbf57e1=_0x50bb73(),_0x1f1071={'name':_0x3abcc0,..._0xbf57e1};return _0xdb7af1['createLayout'](_0x1f1071)['then'](_0x5bf120=>{const _0x5bbcbc={..._0xbf57e1,'id':_0x5bf120,'name':_0x3abcc0,'lastUpdateTimeStamp':Date['now']()},_0x467d6d={..._0x5bbcbc};_0x54081a({..._0x2c98ff['getValue'](),'layouts':[..._0x2c98ff['getValue']()['layouts'],_0x467d6d]}),_0x1e941d(_0x5bf120);}),either['right'](void 0x0);})),_0x89154d=_0x57343e=>{const _0x5aa152={..._0x57343e},_0x42db27=createMockLayoutData(_0x221ca3,_0x63ba93,_0x13267e,INITIAL_INSTRUMENT),_0x276318=_0x5aa152;_0x276318['name']='Default\x20Layout',_0x276318['charts']=[..._0x42db27['layouts'][0x0]['charts']];const _0x5d59c1=_0x276318,_0x592181={..._0x5d59c1};_0xdb7af1['updateLayout'](_0x592181);const _0x49e92c=_0x2a4fa3(_0x5d59c1);_0x1aea4b['setState'](_0x49e92c);const _0x147011={..._0x2c98ff['getValue'](),'selectedLayoutId':_0x5d59c1['id']},_0x347be8={..._0x5d59c1},_0x3e56ec={..._0x147011};_0x3e56ec['layouts']=[_0x347be8],_0x54081a(_0x3e56ec);},_0x8689e2=_0x3c8f18=>{const _0x8d2e8f=_0x2c98ff['getValue'](),_0x3f182a=_0x8d2e8f['layouts']['findIndex'](_0x36e0be=>_0x36e0be['id']===_0x3c8f18),_0x1e8268=_0x8d2e8f['layouts'][_0x3f182a];if(_0x1e8268&&_0x2c98ff['getValue']()['layouts']['length']===0x1){_0x89154d(_0x1e8268);return;}if(_0x1e8268){if(_0x1e8268['id']===_0x446cf6['getValue']()['id']&&_0x8d2e8f['layouts']['length']>0x1){const _0x1aa838=_0x3f182a<_0x8d2e8f['layouts']['length']-0x1?_0x8d2e8f['layouts'][_0x3f182a+0x1]['id']:_0x8d2e8f['layouts'][_0x3f182a-0x1]['id'];_0x1e941d(_0x1aa838);}_0xdb7af1['deleteLayout'](_0x3c8f18);const _0x1065a1=_0x2c98ff['getValue']()['layouts']['filter'](_0x478c2d=>_0x478c2d['id']!==_0x1e8268['id']);_0x54081a({..._0x2c98ff['getValue'](),'layouts':[..._0x1065a1]});}},_0x1e941d=_0x395751=>{if(_0x395751===_0x2c98ff['getValue']()['selectedLayoutId'])return;_0xdb7af1['updateSelectedLayout'](_0x395751);const _0x516dc6=_0x2c98ff['getValue']()['layouts']['find'](_0x61a733=>_0x61a733['id']===_0x395751);if(_0x516dc6){_0x23cb86(![]);const _0x82b61=_0x2a4fa3(_0x516dc6);_0x1aea4b['setState'](_0x82b61),_0x54081a({..._0x2c98ff['getValue'](),'selectedLayoutId':_0x395751});}},_0x4338c7=(_0x7de92a,_0x1bada3)=>pipe(_0x7de92a,validateLayoutExists(_0x564c1['layout']['validation_cannotFindLayoutToUpdate'])(_0x2c98ff['getValue']()['layouts']),either['chain'](_0x5809b3=>pipe(_0x1bada3,string['trim'],validateEmptyString(),either['chain'](validateLayoutNameWithId(_0x564c1['indicatorTemplates']['validation_nameAlreadyExists'])(_0x5809b3,_0x2c98ff['getValue']()['layouts'])),either['map'](_0x178ecd=>[_0x5809b3,_0x178ecd]))),either['fold'](either['left'],([_0x1bb9d6,_0x2d2349])=>{const _0x34c7c4={..._0x1bb9d6},_0x59b0ba=_0x34c7c4;_0x59b0ba['name']=_0x2d2349;const _0x3083b1=_0x59b0ba,_0x22a9bc=_0x2c98ff['getValue']()['layouts']['map'](_0x599aa6=>_0x599aa6['id']===_0x1bb9d6['id']?_0x3083b1:_0x599aa6);return _0xdb7af1['updateLayout'](_0x3083b1)['then'](()=>{_0x54081a({..._0x2c98ff['getValue'](),'layouts':[..._0x22a9bc]});}),either['right'](void 0x0);})),_0x81424f=()=>{if(!_0x3ab9da['getValue']()){_0x23cb86(!![]);return;}const _0x296797=_0x50bb73(),_0x3692f1=getSelectedLayout(_0x2c98ff['getValue']()),_0x4f13f4=Date['now'](),_0x1e25e7={..._0x296797};_0x1e25e7['id']=_0x3692f1['id'],_0x1e25e7['name']=_0x3692f1['name'],_0x1e25e7['lastUpdateTimeStamp']=_0x4f13f4;const _0x207a4e=_0x1e25e7,_0x2931d7=_0x2c98ff['getValue']()['layouts']['map'](_0x5e92b0=>_0x5e92b0['id']===_0x207a4e['id']?_0x207a4e:_0x5e92b0);_0x54081a({..._0x2c98ff['getValue'](),'layouts':[..._0x2931d7]}),_0x30e27c(!![]),pipe(from(_0xdb7af1['updateLayout'](_0x207a4e)),catchError(_0x27c8ec=>{return _0x30e27c(![]),_0x5a9810(!![]),_0x27c8ec;}),retryWhen(_0x4519fa=>{return combineLatest([_0x4519fa,interval(0x1388)])['pipe'](skipWhile(()=>!_0x2ea842['isOnline']['getValue']()),switchMap(([_0x5334b7],_0x4351f4)=>{const _0x5a3a8b=_0x4351f4+0x1;console['log'](_0x5334b7,_0x5a3a8b);if(_0x5a3a8b>=RETRY_SAVE_LAYOUT)throw _0x5334b7;return timer(_0x5a3a8b*0x3e8);}));}),subscribeSingle(()=>{_0x30e27c(![]),_0x5a9810(![]),_0x4e5f06(Date['now']()),!CHART_REACT_PRODUCTION_MODE&&console['log']('Chart\x20layout\x20updated',_0x207a4e);}));},_0x4be26e=pipe(_0x1aea4b['state'],skip(0x1),debounceTime(_0x63ba93['layout']['saveDelay']),observable['filter'](()=>!_0x392dd4['getValue']()),tap(()=>{_0x81424f();})),_0x271a35=pipe(_0x48a363,tap(_0x4a17e0=>{_0x4a17e0&&_0x4e5f06(Date['now']());})),_0x53a51e=pipe(_0x2c98ff,observable['map'](getSelectedLayout),distinctUntilChanged((_0x4f60a8,_0x42ad9b)=>_0x4f60a8['id']===_0x42ad9b['id']),tap(_0x405d7f)),_0x43c170=merge(_0x4be26e,_0x271a35,_0x53a51e),_0x3fa4e4={};return _0x3fa4e4['layoutData']=_0x2c98ff,_0x3fa4e4['editableLayout']=_0x319217,_0x3fa4e4['selectedLayout']=_0x446cf6,_0x3fa4e4['lastUpdateTimeStamp']=_0x5d4977,_0x3fa4e4['isLayoutSaving']=_0x55aa71,_0x3fa4e4['isErrorLayoutSaving']=_0x392dd4,_0x3fa4e4['popupOpen']=_0x48a363,_0x3fa4e4['generateLayout']=_0x50bb73,_0x3fa4e4['fireLayoutUpdate']=_0x81424f,_0x3fa4e4['updateSelectedLayout']=_0x1e941d,_0x3fa4e4['addLayout']=_0x425a7b,_0x3fa4e4['deleteLayout']=_0x8689e2,_0x3fa4e4['updateLayoutById']=_0x4338c7,_0x3fa4e4['togglePopupOpen']=_0x4d87dc,_0x3fa4e4['onEditLayout']=_0x174a86,newSink(callTracerProxy('layoutViewModel',_0x3fa4e4),_0x43c170);});const validateLayoutExists=_0x59fc0a=>_0x21b33b=>_0xba3110=>validateExistenceInArray(_0x59fc0a)(_0x21b33b)(_0x15a224=>_0x15a224['id']===_0xba3110),validateLayoutName=_0x2a01ea=>_0x2346fc=>_0x112bd2=>validateNoDuplicatesInArray(_0x2a01ea)(_0x2346fc,_0x37dcd6=>compareLowerCasedStrings(_0x37dcd6['name'],_0x112bd2))(_0x112bd2),validateLayoutNameWithId=_0x15deb2=>(_0x34e0ec,_0x1cf0fb)=>_0x5087b7=>pipe(_0x5087b7,either['fromPredicate'](_0x4073fc=>compareLowerCasedStrings(_0x4073fc,_0x34e0ec['name']),constVoid),either['fold'](()=>validateLayoutName(_0x15deb2)(_0x1cf0fb)(_0x5087b7),either['right']));export const map2MultiChartLayout=(_0xfa9966,_0x746761,_0x1fd877)=>({'version':CHART_VERSION,'global':{'drawingMode':_0xfa9966['drawingMode'],'magnetMode':_0xfa9966['magnetMode'],'drawingSyncMode':_0x746761,'theme':_0xfa9966['theme']},'charts':_0xfa9966['charts']['map'](map2ChartLayout),'multiChart':{'layout':_0xfa9966['layout'],'selectedChartIndex':_0x1fd877,'sync':{'instrument':_0xfa9966['isInstrumentSyncEnabled'],'chartType':_0xfa9966['isChartTypeSyncEnabled'],'aggregation':_0xfa9966['isAggregationPeriodTypeSyncEnabled'],'crossTool':_0xfa9966['isCrosshairSyncEnabled'],'appearance':_0xfa9966['isGeneralSettingsSyncEnabled'],'studies':_0xfa9966['isStudiesSyncEnabled']}}});export const map2ChartLayout=_0x507fe4=>({'index':parseInt(_0x507fe4['id'],0xa),'symbol':option['toUndefined'](_0x507fe4['instrument']),'aggregation':_0x507fe4['period'],'timeframePreset':_0x507fe4['timeframePreset'],'chartType':_0x507fe4['chartType'],'studies':mapTStudySettings2ChartStudiesLayout(_0x507fe4['studies']),'chartCoreConfig':copyChartCoreSettings(_0x507fe4['chartSettings']['chartCore']),'chartReactConfig':copyChartReactSettings(_0x507fe4['chartSettings']['chartReact']),'secondarySeries':compareInstrumentsToSecondarySeries(_0x507fe4['compareInstruments']),'drawings':getDrawings(_0x507fe4),'layers':cloneUnsafe(_0x507fe4['layers']),'panes':_0x507fe4['panes'],'xScaleViewport':_0x507fe4['xScaleViewport']});const getDrawings=_0x248bab=>{return fromNativeChartDrawings(_0x248bab['drawings']);};