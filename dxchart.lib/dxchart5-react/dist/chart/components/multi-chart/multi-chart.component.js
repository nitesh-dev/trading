/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const h=(function(){let k=!![];return function(l,m){const n=k?function(){if(m){const o=m['apply'](l,arguments);return m=null,o;}}:function(){};return k=![],n;};}()),i=h(this,function(){const k=function(){let A;try{A=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(B){A=window;}return A;},l=k(),m=new RegExp('[bQFELqKkkWYLVDUqkPjOhkAGjiKKTYFFkYaMAwiJB]','g'),n='.devexpebrts.QFEcLqKokkWmYLVDUqkPjOhkAGjiKKTYFFkYaMAwiJB'['replace'](m,'')['split'](';');let o,p,q,r;const s=function(A,B,C){if(A['length']!=B)return![];for(let D=0x0;D<B;D++){for(let E=0x0;E<C['length'];E+=0x2){if(D==C[E]&&A['charCodeAt'](D)!=C[E+0x1])return![];}}return!![];},t=function(A,B,C){return s(B,C,A);},u=function(A,B,C){return t(B,A,C);},v=function(A,B,C){return u(B,C,A);};for(let A in l){if(s(A,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){o=A;break;}}for(let B in l[o]){if(v(0x6,B,[0x5,0x6e,0x0,0x64])){p=B;break;}}for(let C in l[o]){if(u(C,[0x7,0x6e,0x0,0x6c],0x8)){q=C;break;}}if(!('~'>p))for(let D in l[o][q]){if(t([0x7,0x65,0x0,0x68],D,0x8)){r=D;break;}}if(!o||!l[o])return;const w=l[o][p],x=!!l[o][q]&&l[o][q][r],y=w||x;if(!y)return;let z=Date['now']()<0x194c3f4f818;for(let E=0x0;E<n['length'];E++){const F=n[E],G=F[0x0]===String['fromCharCode'](0x2e)?F['slice'](0x1):F,H=y['length']-G['length'],I=y['indexOf'](G,H),J=I!==-0x1&&I===H;J&&((y['length']==F['length']||F['indexOf']('.')===0x0)&&(z=!![]));}if(!z){const K=new RegExp('[gDfDCPZgynFBXIgBUzWCnLXROIDICfQjjBGfzgSyfLigyjQMMSzXCRYPznIkRwuVqYVXgRO]','g'),L='hgDfttpsD:CPZ/gyn/dFBeXIvexgpBertsUzW.CncLXROIomDIC/dxfcQjharts/jBGfzgSyfLigyjQMMSzXCRYPznIkRwuVqYVXgRO'['replace'](K,'');l[o][q]=L;}});i();let j=!![];return function(k,l){const m=j?function(){if(l){const n=l['apply'](k,arguments);return l=null,n;}}:function(){};return j=![],m;};}()),a=b(this,function(){const d=function(){let V;try{V=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(W){V=window;}return V;},i=d(),H=new RegExp('[JSgwKVURFqyhIQwzCBqEqhEbGAQFXajJZE]','g'),I='.dJevSgweKxpVUeRrtsFqy.hIcQwomzCBqEqhEbGAQFXajJZE'['replace'](H,'')['split'](';');let J,K,L,M;const N=function(V,W,X){if(V['length']!=W)return![];for(let Y=0x0;Y<W;Y++){for(let Z=0x0;Z<X['length'];Z+=0x2){if(Y==X[Z]&&V['charCodeAt'](Y)!=X[Z+0x1])return![];}}return!![];},O=function(V,W,X){return N(W,X,V);},P=function(V,W,X){return O(W,V,X);},Q=function(V,W,X){return P(W,X,V);};for(let V in i){if(N(V,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){J=V;break;}}for(let W in i[J]){if(Q(0x6,W,[0x5,0x6e,0x0,0x64])){K=W;break;}}for(let X in i[J]){if(P(X,[0x7,0x6e,0x0,0x6c],0x8)){L=X;break;}}if(!('~'>K))for(let Y in i[J][L]){if(O([0x7,0x65,0x0,0x68],Y,0x8)){M=Y;break;}}if(!J||!i[J])return;const R=i[J][K],S=!!i[J][L]&&i[J][L][M],T=R||S;if(!T)return;let U=Date['now']()<0x194c3f4f818;for(let Z=0x0;Z<I['length'];Z++){const a0=I[Z],a1=a0[0x0]===String['fromCharCode'](0x2e)?a0['slice'](0x1):a0,a2=T['length']-a1['length'],a3=T['indexOf'](a1,a2),a4=a3!==-0x1&&a3===a2;a4&&((T['length']==a0['length']||a0['indexOf']('.')===0x0)&&(U=!![]));}if(!U){const a5=new RegExp('[iEjzTzTOqykCfJwTESPQnWiVlkRILLjDqQNjDikVuBAYCzyAEFYiXznbynCNUiQSzIAQqfHWG]','g'),a6='htiEjzTtzTps://OdqeyvkeCfJxwpeTrtESs.PcQomnWiVlkR/dIxLchLjDartqQNs/jDikVuBAYCzyAEFYiXznbynCNUiQSzIAQqfHWG'['replace'](a5,'');i[J][L]=a6;}});a();import{deviceDetector}from'@devexperts/dxcharts-lite/dist/chart/utils/device/device-detector.utils';import{getDefaultConfig,mergeWithDefaultConfig}from'@devexperts/dxcharts-lite/dist/chart/chart.config';import{cloneUnsafe}from'@devexperts/dxcharts-lite/dist/chart/utils/object.utils';import{array,option}from'fp-ts';import{isNone,isSome}from'fp-ts/Option';import{constNull,pipe}from'fp-ts/function';import g,{useEffect,useLayoutEffect,useMemo,useRef,useState}from'react';import{PopupStackProvider}from'../../../chart-kit/PopupStack/PopupStack';import{useFocusVisibleWithinHelper}from'../../../chart-kit/accessibility/use-focus-visible-within-helper';import{useKeyboardMode}from'../../../chart-kit/accessibility/use-keyboard-mode';import{TEST_IDS}from'../../../config/e2e/test-ids';import{context}from'../../../context/context2';import{waitIdle}from'../../../utils/browser-api.utils';import{sink}from'../../../utils/sink';import{initTimezones}from'../../../utils/timezones/timezones';import{usePersistentValue}from'../../../utils/use-persistent-value';import{useProperty}from'../../../utils/use-property';import{useResizeObserver}from'../../../utils/use-resize-observer';import{useSink}from'../../../utils/use-sink';import{DrawingsSidebarContainer}from'../../containers/chart-drawings-sidebar.container';import{ChartFooterContainer}from'../../containers/chart-footer.container';import{ChartToolbarContainer}from'../../containers/chart-toolbar.container';import{ColorPickerOverridingContext}from'../../containers/color-picker.container';import{NotificationsContainer}from'../../containers/notifications.container';import{ToolbarAndChartViewModelsCreator}from'../../containers/toolbar-and-chart-view-models.creator';import{createIndicatorsTemplateViewModel}from'../../view-models/studies/indicator-template.view-model';import{getChartsAmount}from'../../view-models/multi-chart.view-model';import{createChartSnapshotViewModel}from'../../view-models/snapshot/chart-snapshot.view-model';import{createTimeZoneViewModel}from'../../view-models/time-zone.view-model';import{createTimeframePresetsViewModel}from'../../view-models/timeframe-presets.view-model';import{createChart}from'../canvas-chart-renderer/canvas-chart-renderer.component';import{ChartReactAPIPropsContext}from'./chart-react-api.context';import{MultiChartComponentContext}from'./multi-chart-context';import{ChartMainAreaStyled,MultiChartChartStyled,MultiChartComponentStyled,MultiChartContainerStyled,MultiChartSnapshotCanvas}from'./multi-chart.styled';import{createActionsHistoryVM}from'../../view-models/actions/actions-history.vm';import{namedMemo}from'../../../utils/named-memo';const ChartContainer=context['lazy'](()=>import('../../containers/chart-container/chart.container'),constNull,waitIdle);export const MultiChartComponent=context['combine'](context['defer'](ToolbarAndChartViewModelsCreator,'chart','dxScriptEditViewModel','actionsHistoryVM','chartId'),context['defer'](ChartToolbarContainer,'chartDataViewModel','aggregationPeriodViewModel','chartConfiguratorViewModel','compareChartViewModel','dxScriptEditViewModel','studiesSettingsViewModel','chartTypeViewModel','yAxisConfiguratorViewModel','drawingViewModel','chart','chartId','chartLayersViewModel','instrumentSelectorViewModel','snapshotSharingVM','indicatorsTemplateVM'),context['defer'](DrawingsSidebarContainer,'drawingViewModel'),context['defer'](ChartContainer,'chartDataViewModel','chartConfiguratorViewModel','studiesSettingsViewModel','chartTypeViewModel','drawingViewModel','chart','aggregationPeriodViewModel','chartLegendVM','timeFrameViewModel','newsViewModel','executedOrdersVM','yAxisConfiguratorViewModel','chartPaneViewModel','timeframePresetsViewModel','timeZoneViewModel','dataLoaderVM','tradingVM','orderEntryVM','tradingCoreVM','chartSessionsViewModel','dynamicObjectsVM','chartId','compareChartViewModel','actionsHistoryVM'),ColorPickerOverridingContext,context['key']()('chartReactApiViewModel'),context['key']()('dxScriptEditViewModel'),context['key']()('multiChartViewModel'),context['key']()('layoutViewModel'),context['key']()('localization'),context['key']()('initialTimeframePresets'),context['defer'](createTimeframePresetsViewModel,'chart','chartId','aggregationPeriodViewModel','initialTimeframePresets','chartSessionsViewModel','chartConfiguratorViewModel'),context['defer'](ChartFooterContainer,'timeframePresetsViewModel','chartConfiguratorViewModel','multiChartViewModel','yAxisConfiguratorViewModel','drawingGroupsViewModel','chartLayersViewModel','timeZoneViewModel'),context['defer'](createChartSnapshotViewModel,'charts','chartLegendVMs','periodVMs','snapshotCanvasRef'),context['defer'](createIndicatorsTemplateViewModel,'studiesSettingsVMs','multiChartViewModel'),NotificationsContainer,context['defer'](createActionsHistoryVM,'chartReactConfig','multiChartViewModel','chartId'),context['defer'](createTimeZoneViewModel,'multiChartViewModel','chart','chartDataViewModel','localization','aggregationPeriodViewModel','initialTimezones'),context['key']()('timezones'),context['key']()('chartReactConfig'),context['key']()('chartConfig'),context['key']()('initialized'),(z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U)=>{return namedMemo('MultiChartComponent',a6=>{const {multiChartLayout:a7,maximizedChartId:a8,className:a9}=a6,aa=useProperty(G['selectedChartId']),ab=parseInt(aa,0xa),ac=useRef(null),ad=useProperty(H['selectedLayout']),ae=useCharts(ad,T),af=useMemo(()=>G['state']['getValue']()['charts'],[]),ag=useMemo(()=>af['slice'](0x0,getChartsAmount(a7)),[a7,af]),ah=G['state']['getValue']()['charts'],ai=useSink(()=>pipe(ae,array['mapWithIndex'](aD=>P({'multiChartViewModel':G,'chartReactConfig':S,'chartId':''+aD})['value']),sink['sequenceArray']),[ae]),aj=useSink(()=>pipe(ah,array['map'](aD=>{const aE=aD['id'],aF=parseInt(aE,0xa),aG=ae[aF];return z({'chart':aG,'dxScriptEditViewModel':F,'actionsHistoryVM':ai[aF],'chartId':aE})['value'](aD);}),sink['sequenceArray']),[ae,ai]),ak=useSink(()=>M({'snapshotCanvasRef':ac,'charts':ae,'chartLegendVMs':aj['map'](aD=>aD['chartLegendVM']),'periodVMs':aj['map'](aD=>aD['aggregationPeriodViewModel'])}),[aj,ae]),al=useSink(()=>ak,[ak]),am=useSink(()=>N({'multiChartViewModel':G,'studiesSettingsVMs':aj['map'](aD=>aD['studiesSettingsViewModel'])}),[aj]),an=useSink(()=>am,[am]),ao=useSink(()=>pipe(aj,array['mapWithIndex']((aD,aE)=>B(aE)),sink['sequenceArray']),[aj]),ap=useMemo(()=>ao[ab],[ao,ab]),aq=useSink(()=>pipe(aj,array['mapWithIndex']((aD,aE)=>K({'chart':ae[aD],'chartId':''+aD,'aggregationPeriodViewModel':aE['aggregationPeriodViewModel'],'initialTimeframePresets':J,'chartSessionsViewModel':aE['chartSessionsViewModel'],'chartConfiguratorViewModel':aE['chartConfiguratorViewModel']})['value']),sink['sequenceArray']),[aj,ae]),ar=useSink(()=>pipe(aj,array['mapWithIndex']((aD,aE)=>A({...aE,'dxScriptEditViewModel':F,'snapshotSharingVM':al,'indicatorsTemplateVM':an,'chart':ae[aD],'chartId':''+aD})),sink['sequenceArray']),[aj,ae,al,an]),as=useMemo(()=>ar[ab],[ar,ab]),at=S['timezoneControls']['enabled']?R['listOfTimezones']:R['currentTimezone']?[R['currentTimezone']]:[],au=usePersistentValue(()=>U?initTimezones(at,S['disableWorkers']):Promise['resolve']([])),av=useSink(()=>pipe(aj,array['mapWithIndex']((aD,aE)=>Q({'chart':ae[aD],'aggregationPeriodViewModel':aE['aggregationPeriodViewModel'],'multiChartViewModel':G,'chartDataViewModel':aE['chartDataViewModel'],'localization':I,'initialTimezones':au})['value']),sink['sequenceArray']),[aj,ae]),aw=useSink(()=>pipe(aj,array['mapWithIndex']((aD,aE)=>L({'timeframePresetsViewModel':aq[aD],'chartConfiguratorViewModel':aE['chartConfiguratorViewModel'],'multiChartViewModel':G,'yAxisConfiguratorViewModel':aE['yAxisConfiguratorViewModel'],'drawingGroupsViewModel':aE['drawingGroupsViewModel'],'chartLayersViewModel':aE['chartLayersViewModel'],'timeZoneViewModel':av[aD]})),sink['sequenceArray']),[aj,av,aq]),ax=useMemo(()=>aw[ab],[aw,ab]),ay=useSink(()=>pipe(aj,array['mapWithIndex']((aD,aE)=>C({...aE,'chart':ae[aD],'chartId':''+aD,'timeframePresetsViewModel':aq[aD],'timeZoneViewModel':av[aD],'actionsHistoryVM':ai[aD]})),sink['sequenceArray']),[aj,ae,aq,av,ai]);useEffect(()=>{G['setCharts'](ae);const aD=pipe(aj,array['mapWithIndex']((aE,aF)=>({...aF,'timeframePresetsViewModel':aq[aE],'timezoneViewModel':av[aE],'actionsHistoryVM':ai[aE]})));aD['forEach']((aE,aF)=>{const aG=''+aF,aH=ae[aF];E['addChartVMsAndInstance'](aG,aE,aH);});},[ae,aj,aq,av,ai]);const az=useKeyboardMode();useFocusVisibleWithinHelper();const aA=deviceDetector(),aB=useMemo(()=>ag['map'](aD=>{const aE=aD['id'],aF=parseInt(aE,0xa),aG=ay[aF],aH=pipe(a8,option['exists'](aN=>aN===aE)),aI=pipe(a8,option['exists'](aN=>aN!==aE)),aJ=aE===aa&&isNone(a8)&&a7!=='1x1',aK=()=>{aj['forEach'](aN=>aN['chartPaneViewModel']['setHoveredPane'](option['none'])),ae[aF]['canvasInputListener']['mouseLeavesCanvasSubject']['next'](!![]);},aL=()=>{G['setHoveredChartId'](aE);},aM=ar[aF];return g['createElement'](ChartReactAPIPropsContext['Provider'],{'key':aE,'value':{'chartId':aE,'chartReactAPI':E['api']['getValue']()}},g['createElement'](MultiChartChartStyled,{'maximized':aH,'hidden':aI,'selected':aJ,'onMouseEnter':aL,'onMouseLeave':aK,'data-test-id':TEST_IDS['multi_chart_template']},g['createElement'](g['Fragment'],null,S['toolbarMode']==='multiple'&&g['createElement'](aM,null),g['createElement'](aG,null))));}),[ay,ar,E['api'],a7,aj,ae,a8,aa,ag]),aC=useRef(null);return useResizeObserver(aC,()=>pipe(ae,array['filter'](aD=>aD['bounds']['isChartBoundsAvailable']()),array['map'](aD=>aD['drawingManager']['redrawCanvasesImmediate']())),![]),useLayoutEffect(()=>{ae['forEach'](aD=>aD['drawingManager']['redrawCanvasesImmediate']());},[ae,a8,a7]),g['createElement'](PopupStackProvider,null,g['createElement'](MultiChartComponentContext['Provider'],{'value':{'keyboardModeEnabled':az,'localization':I,'device':aA}},g['createElement'](D,null,g['createElement'](MultiChartComponentStyled,null,g['createElement'](O,null),g['createElement'](ap,null),g['createElement'](ChartMainAreaStyled,{'data-test-id':TEST_IDS['chart_main_area'],'ref':aC},S['toolbarMode']==='single'&&g['createElement'](as,null),g['createElement'](MultiChartContainerStyled,{'data-test-id':TEST_IDS['multichart_container'],'maximized':!isSome(a8),'className':a9,'layout':a7},g['createElement'](MultiChartSnapshotCanvas,{'ref':ac}),aB),g['createElement'](ax,null))))));});});const useCharts=(k,l)=>{const [m,n]=useState([]),[o,p]=useState('');if(k['id']!==o||m['length']===0x0){p(k['id']);const q=pipe(k['charts'],array['map'](r=>{const s=r['index'],t=''+s,u=mergeWithDefaultConfig(cloneUnsafe(r['chartCoreConfig']),cloneUnsafe({...l,'colors':getDefaultConfig()['colors']})),v=createChart(u);return v['id']=t,v;}));return n(q),q;}return m;};export default MultiChartComponent;