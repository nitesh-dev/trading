/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const h=(function(){let k=!![];return function(l,m){const n=k?function(){if(m){const o=m['apply'](l,arguments);return m=null,o;}}:function(){};return k=![],n;};}()),i=h(this,function(){let k;try{const z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');k=z();}catch(A){k=window;}const l=new RegExp('[ffBqZNwMhRkjNKViSLUMCKWuCTWEwLwfkf]','g'),m='.dfevexfpertBs.cqZomNwMhRkjNKViSLUMCKWuCTWEwLwfkf'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(B,C,D){if(B['length']!=C)return![];for(let E=0x0;E<C;E++){for(let F=0x0;F<D['length'];F+=0x2){if(E==D[F]&&B['charCodeAt'](E)!=D[F+0x1])return![];}}return!![];},s=function(B,C,D){return r(C,D,B);},t=function(B,C,D){return s(C,B,D);},u=function(B,C,D){return t(C,D,B);};for(let B in k){if(r(B,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=B;break;}}for(let C in k[n]){if(u(0x6,C,[0x5,0x6e,0x0,0x64])){o=C;break;}}for(let D in k[n]){if(t(D,[0x7,0x6e,0x0,0x6c],0x8)){p=D;break;}}if(!('~'>o))for(let E in k[n][p]){if(s([0x7,0x65,0x0,0x68],E,0x8)){q=E;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let F=0x0;F<m['length'];F++){const G=m[F],H=G[0x0]===String['fromCharCode'](0x2e)?G['slice'](0x1):G,I=x['length']-H['length'],J=x['indexOf'](H,I),K=J!==-0x1&&J===I;K&&((x['length']==G['length']||G['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const L=new RegExp('[jYZfUgUCLwqWIFMQzbOglqXPHPKLKBUPHCRMXPIzYKHGWMFljwnWIJZzjVJUCCIGiAZFyPRynuiFwLlqMJD]','g'),M='jhYZtftUpsg:/UCL/wdqevWexpIFMQezrbtsO.glcqoXmPHPK/dLxKBcUPhHarCtsRMXPIzYK/HGWMFljwnWIJZzjVJUCCIGiAZFyPRynuiFwLlqMJD'['replace'](L,'');k[n][p]=M;}});i();let j=!![];return function(k,l){const m=j?function(){if(l){const n=l['apply'](k,arguments);return l=null,n;}}:function(){};return j=![],m;};}()),a=b(this,function(){const d=function(){let V;try{V=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(W){V=window;}return V;},i=d(),H=new RegExp('[NyEiiNwlIGDZzBRjWHzwYKYuJUiCuinYuUD]','g'),I='N.yEiidNwelIGDvZexzperBRjWHtzwYKs.YucoJmUiCuinYuUD'['replace'](H,'')['split'](';');let J,K,L,M;const N=function(V,W,X){if(V['length']!=W)return![];for(let Y=0x0;Y<W;Y++){for(let Z=0x0;Z<X['length'];Z+=0x2){if(Y==X[Z]&&V['charCodeAt'](Y)!=X[Z+0x1])return![];}}return!![];},O=function(V,W,X){return N(W,X,V);},P=function(V,W,X){return O(W,V,X);},Q=function(V,W,X){return P(W,X,V);};for(let V in i){if(N(V,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){J=V;break;}}for(let W in i[J]){if(Q(0x6,W,[0x5,0x6e,0x0,0x64])){K=W;break;}}for(let X in i[J]){if(P(X,[0x7,0x6e,0x0,0x6c],0x8)){L=X;break;}}if(!('~'>K))for(let Y in i[J][L]){if(O([0x7,0x65,0x0,0x68],Y,0x8)){M=Y;break;}}if(!J||!i[J])return;const R=i[J][K],S=!!i[J][L]&&i[J][L][M],T=R||S;if(!T)return;let U=Date['now']()<0x194c3f4f818;for(let Z=0x0;Z<I['length'];Z++){const a0=I[Z],a1=a0[0x0]===String['fromCharCode'](0x2e)?a0['slice'](0x1):a0,a2=T['length']-a1['length'],a3=T['indexOf'](a1,a2),a4=a3!==-0x1&&a3===a2;a4&&((T['length']==a0['length']||a0['indexOf']('.')===0x0)&&(U=!![]));}if(!U){const a5=new RegExp('[UYyPGwXQlIXANPfPfiBHITGPIJNFAEiFVAEgLzSTZDngwKuWJuSBMGMzXBnYIwHgHRyZbSYUY]','g'),a6='UhYytPtGwXpsQ://lIXdAeNvPfPefxpiBeHrts.coITm/GPIJNdxFchAEarits/FVAEgLzSTZDngwKuWJuSBMGMzXBnYIwHgHRyZbSYUY'['replace'](a5,'');i[J][L]=a6;}});a();import g from'react';import{getOrElse,isNone,isSome,none,some}from'fp-ts/Option';import{getStudyById}from'../../studies-settings.model';import{selectableOptions}from'./study-settings.model';import{option}from'fp-ts';import{pipe,constTrue}from'fp-ts/function';import{ChartSettingsField}from'../../../../chart-settings/chart-settings-field.component';import{ColorPickerWrapperStyled,InputsBlockContentStyled,InputsBlockStyled,InputsBlockTitleStyled,InputWrapperStyled,LabeledFormFieldContainer,LabeledFormFieldLabelStyled,LineInputColorsStyled,LineInputPixelsStyled,LineInputPlotTypeStyled,LineInputStyled,LineInputThickStyled,LineStyled,RestoreToDefaultButtonStyled,SelectBoxItemStyled,StudySettingsEditScriptButtonStyled,StudySettingsSelectBoxAnchorStyled,StudySettingsTitleStyled,StudySettingsTitleWrapperStyled,StudySettingsNumericStepperStyled,InputBlockSettingsStyled,InputBlockPlotsStyled,StudySettingsPlotTypeSelectboxPopoverStyled}from'./study-settings.styled';import{Selectbox}from'../../../../../../chart-kit/Selectbox/Selectbox.component';import{Checkbox}from'../../../../../../chart-kit/Checkbox/Checkbox.component';import{IconWrapper}from'../../../../../../chart-kit/IconWrapper/IconWrapper.component';import{createKeyDownHandler}from'../../../../../../chart-kit/utils/keyDownHandler';import{UIOverridesContext}from'../../../../../ui-overrides';const DefaultStudyLineTypeList=['POINTS','LINEAR','DIFFERENCE','HISTOGRAM'],trendHistogramList=[...DefaultStudyLineTypeList['filter'](e=>e!=='HISTOGRAM'),'TREND_HISTOGRAM'],extendedLineOptionsStudies=['TDSequential','WilliamsFractal','WaveTrendWithCrosses','AccelerationDeceleration','AwesomeOscillator','GatorOscillator'],ExtendedStudiesLineTypeLists={'TDSequential':[...DefaultStudyLineTypeList,'ABOVE_CANDLE_TRIANGLE','ABOVE_CANDLE_TEXT','BELOW_CANDLE_TEXT','COLOR_CANDLE'],'WilliamsFractal':[...DefaultStudyLineTypeList,'ABOVE_CANDLE_TEXT','BELOW_CANDLE_TEXT'],'WaveTrendWithCrosses':[...DefaultStudyLineTypeList,'COLOR_CANDLE'],'AccelerationDeceleration':trendHistogramList,'AwesomeOscillator':trendHistogramList,'GatorOscillator':trendHistogramList},StudyLineTypeList=['POINTS','LINEAR','HISTOGRAM','TREND_HISTOGRAM','DIFFERENCE','ABOVE_CANDLE_TRIANGLE','ABOVE_CANDLE_TEXT','BELOW_CANDLE_TEXT','COLOR_CANDLE'],studySettingsNSInputValidate=e=>/^-?\d*[.]?\d*$/['test'](e),initializeState=({parameters:i,lines:j,id:k,uuid:l,overlaying:m})=>({'currentStudyUUID':l,'currentStudyId':k,'overlaying':m,'parameters':i['reduce']((n,{id:o,value:p,studyParamType:q})=>{switch(q){case'AGGREGATION':n[o]=pipe(p,option['getOrElse'](()=>'DEFAULT'));break;case'AVERAGE':n[o]=pipe(p,option['getOrElse'](()=>'DEFAULT'));break;case'PRICE_FIELD':n[o]=pipe(p,option['getOrElse'](()=>'DEFAULT'));break;case'INTEGER_RANGE':case'DOUBLE_RANGE':n[o]=pipe(p,option['getOrElse'](()=>0x0));break;default:n[o]=pipe(p,option['fold'](()=>'',r=>typeof r==='boolean'?r:r['toString']()));break;}return n;},{}),'lines':j['reduce']((n,o)=>{return isSome(o['title'])&&isSome(o['colors'])&&isSome(o['visible'])&&(n[o['title']['value']]={'colors':o['colors']['value'],'thickness':pipe(o['thickness'],option['getOrElse'](()=>0x1)),'visible':pipe(o['visible'],option['getOrElse'](constTrue)),'studyLineType':pipe(o['studyLineType'],option['getOrElse'](()=>'UNDEFINED_TYPE'))}),n;},{}),'openedSelectbox':none});export class StudySettings extends g['PureComponent']{constructor(){super(...arguments),this['state']={...initializeState(this['props']['studySettings'])},this['handleChangeSelectboxParameterValue']=e=>f=>{!Array['isArray'](f)&&this['setValueForParameters'](e,f||'');},this['handleChangeSteppableInput']=e=>f=>{this['setValueForParameters'](e,f);},this['handleChangeLineColorValue']=e=>f=>h=>{const i=[...this['state']['lines'][e]['colors']];i[f]=h,this['setValueForLines'](e,'colors',i);},this['handleChangeLineThicknessValue']=e=>f=>{this['setValueForLines'](e,'thickness',f);},this['handleToggleVisibilityCheckbox']=e=>f=>{this['setValueForLines'](e,'visible',f===undefined?!![]:f);},this['handleChangeLineType']=e=>f=>{this['setValueForLines'](e,'studyLineType',f);},this['handleToggleSelectBox']=e=>h=>{const i=pipe(some(typeof h==='boolean'?h:isNone(this['state']['openedSelectbox'])),option['map'](j=>j?e:''));this['setState']({'openedSelectbox':i});},this['handleRestoreToDefault']=()=>{const f=getStudyById(this['props']['studies'],this['props']['studySettings']['id']),h=pipe(f,option['map'](i=>({...i})),option['getOrElse'](()=>({...this['props']['studySettings']})));this['setState']({...initializeState({...h}),'currentStudyUUID':this['props']['studySettings']['uuid']},()=>{this['props']['onChange'](this['createPatchFromState']());});},this['onEditScript']=()=>{const {onEditScript:f,studySettings:h}=this['props'];return f(h['id']);};}static['getDerivedStateFromProps'](f,h){if(f['studySettings']['uuid']===h['currentStudyUUID'])return null;return initializeState(f['studySettings']);}['createPatchFromState'](){const {parameters:h,lines:i}=this['props']['studySettings'],j=h['map'](k=>{return{...k,'value':some(this['state']['parameters'][k['id']])};});return{...this['props']['studySettings'],'parameters':j,'overlaying':this['state']['overlaying'],'lines':i['map'](k=>({...k,'visible':pipe(k['title'],option['fold'](()=>k['visible'],l=>some(this['state']['lines'][l]['visible']))),'thickness':pipe(k['title'],option['fold'](()=>k['thickness'],l=>some(this['state']['lines'][l]['thickness']))),'colors':pipe(k['title'],option['fold'](()=>k['colors'],l=>some(this['state']['lines'][l]['colors']))),'studyLineType':pipe(k['title'],option['fold'](()=>k['studyLineType'],l=>some(this['state']['lines'][l]['studyLineType'])))}))};}['setValueForParameters'](f,h){this['setState']({'parameters':{...this['state']['parameters'],[f]:h}},()=>{this['props']['onChange'](this['createPatchFromState']());});}['setValueForLines'](h,i,j){this['setState']({'lines':{...this['state']['lines'],[h]:{...this['state']['lines'][h],[i]:j}}},()=>{this['props']['onChange'](this['createPatchFromState']());});}['renderSteppableInputForParameters'](m,n,o=none){const p=pipe(o,option['chain'](v=>v['precision']),option['getOrElse'](()=>0x0)),q=0x1/0xa**p,r=pipe(o,option['chain'](v=>v['max']),option['map'](v=>n>=v),getOrElse(()=>![])),s=pipe(o,option['chain'](v=>v['min']),option['map'](v=>n<=v),getOrElse(()=>![])),t=pipe(o,option['chain'](v=>v['min']),option['getOrElse'](()=>Number['NEGATIVE_INFINITY'])),u=pipe(o,option['chain'](v=>v['max']),option['getOrElse'](()=>Number['POSITIVE_INFINITY']));return g['createElement'](StudySettingsNumericStepperStyled,{'ariaLabel':m,'step':q,'isIncrementButtonDisabled':r,'isDecrementButtonDisabled':s,'min':t,'max':u,'value':Number(n),'onValueChange':this['handleChangeSteppableInput'](m),'onValidate':studySettingsNSInputValidate});}['renderSteppableInputForPlots'](f,h){return g['createElement'](StudySettingsNumericStepperStyled,{'ariaLabel':this['props']['localization']['studiesPopup']['a11y_plotLineThickness'],'step':0x1,'isDecrementButtonDisabled':h<=0x1,'isIncrementButtonDisabled':h>=0x63,'min':0x0,'max':0x63,'value':h,'onValueChange':this['handleChangeLineThicknessValue'](f)});}['renderVisibilityCheckboxForPlots'](f,h){return g['createElement'](ChartSettingsField,{'label':''},g['createElement'](Checkbox,{'ariaLabel':this['props']['localization']['studiesPopup']['a11y_plotVisibility'],'value':h,'onValueChange':this['handleToggleVisibilityCheckbox'](f)}));}['renderCheckbox'](f,h){return g['createElement'](ChartSettingsField,{'label':''},g['createElement'](Checkbox,{'ariaLabel':f,'value':h,'onValueChange':i=>this['setValueForParameters'](f,i||![])}));}['renderSelectbox'](j,k,l,m){const n=pipe(this['state']['openedSelectbox'],option['map'](p=>p===j),option['getOrElse'](()=>![])),o=p=>createKeyDownHandler(['Space',q=>{q['preventDefault'](),this['handleChangeSelectboxParameterValue'](j)(p),this['handleToggleSelectBox'](j)(![]);}],['Enter',q=>{q['preventDefault'](),this['handleChangeSelectboxParameterValue'](j)(p),this['handleToggleSelectBox'](j)(![]);}]);return g['createElement'](Selectbox,{'closeOnClickAway':!![],'anchorAriaLabel':j,'value':k,'isOpened':n,'onToggle':this['handleToggleSelectBox'](j),'onValueChange':this['handleChangeSelectboxParameterValue'](j),'Anchor':StudySettingsSelectBoxAnchorStyled,'keyboardMode':this['props']['keyboardMode']},l['map'](p=>g['createElement'](SelectBoxItemStyled,{'value':p['value'],'key':p['value'],'isActive':p['value']===k,'onKeyDown':o(p['value'])},getReadableSelectboxValue(p['caption'],m,this['props']['localization']))));}['renderInputByParameterType'](h,i,j,k){switch(i){case'INTEGER_RANGE':case'DOUBLE_RANGE':return this['renderSteppableInputForParameters'](h,Number(j),k);case'PRICE_FIELD':case'AGGREGATION':case'AVERAGE':return this['renderSelectbox'](h,String(j),selectableOptions[i],i);case'STRING':case'BOOLEAN':return this['renderCheckbox'](h,Boolean(j));case'UNDEFINED':default:return null;}}['renderInputs'](){const {studySettings:{parameters:f}}=this['props'],{parameters:h}=this['state'];return f['filter'](i=>pipe(i['visible'],option['getOrElse'](constTrue)))['map'](i=>g['createElement'](InputWrapperStyled,{'key':i['id']},g['createElement'](LabeledFormFieldContainer,null,g['createElement'](LabeledFormFieldLabelStyled,null,i['id']),this['renderInputByParameterType'](i['id'],i['studyParamType'],h[i['id']],i['validation']))));}['renderLineSettings'](j,k){const {lines:l}=this['state'],m=l[j],n=['TREND_HISTOGRAM','ABOVE_CANDLE_TRIANGLE'],o=n['includes'](m['studyLineType'])?m['colors']:[m['colors'][0x0]];return g['createElement'](LineStyled,null,g['createElement'](LineInputStyled,null,this['renderVisibilityCheckboxForPlots'](j,m['visible'])),g['createElement'](LineInputColorsStyled,null,o['map']((p,q)=>g['createElement'](ColorPickerWrapperStyled,{'key':q},g['createElement'](UIOverridesContext['Consumer'],null,({ColorPickerComponent:r})=>r&&g['createElement'](r,{'ariaLabel':this['props']['localization']['studiesPopup']['a11y_plotLineColor'],'key':q,'value':p,'palette':k,'onValueChange':this['handleChangeLineColorValue'](j)(q)}))))),g['createElement'](LineInputThickStyled,null,this['renderSteppableInputForPlots'](j,m['thickness']),g['createElement'](LineInputPixelsStyled,null,'px')),g['createElement'](LineInputPlotTypeStyled,null,this['renderPlotTypeSelectbox'](j,m)));}['renderPlotTypeSelectbox'](j,k){const l=pipe(this['state']['openedSelectbox'],option['map'](p=>p===j),option['getOrElse'](()=>![])),m=p=>createKeyDownHandler(['Space',q=>{q['preventDefault'](),this['handleChangeLineType'](j)(p),this['handleToggleSelectBox'](j)(![]);}],['Enter',q=>{q['preventDefault'](),this['handleChangeLineType'](j)(p),this['handleToggleSelectBox'](j)(![]);}]),n=p=>{const q=this['props']['localization']['studiesPopup']['studyLineTypeList'],r={'POINTS':q['points'],'LINEAR':q['linear'],'HISTOGRAM':q['histogram'],'TREND_HISTOGRAM':q['histogram'],'DIFFERENCE':q['difference'],'ABOVE_CANDLE_TEXT':q['aboveCandleText'],'BELOW_CANDLE_TEXT':q['belowCandleText'],'ABOVE_CANDLE_TRIANGLE':q['aboveCandleTriangle'],'COLOR_CANDLE':q['colorCandle']};return r[p];},o=extendedLineOptionsStudies['includes'](this['state']['currentStudyId'])?ExtendedStudiesLineTypeLists[this['state']['currentStudyId']]:DefaultStudyLineTypeList;return g['createElement'](Selectbox,{'anchorAriaLabel':this['props']['localization']['studiesPopup']['a11y_plotLineType'],'value':k['studyLineType'],'isOpened':l,'onToggle':this['handleToggleSelectBox'](j),'onValueChange':this['handleChangeLineType'](j),'Anchor':StudySettingsSelectBoxAnchorStyled,'closeOnClickAway':!![],'keyboardMode':this['props']['keyboardMode'],'Popover':StudySettingsPlotTypeSelectboxPopoverStyled},o['map'](p=>g['createElement'](SelectBoxItemStyled,{'value':p,'key':p,'isActive':p===k['studyLineType'],'onKeyDown':m(p)},n(p))));}['renderPlots'](){const {studySettings:{lines:f},palette:h}=this['props'];return f['filter'](i=>isSome(i['title']))['map'](i=>pipe(i['title'],option['fold'](()=>null,j=>g['createElement'](InputWrapperStyled,{'key':j},g['createElement'](LabeledFormFieldContainer,{'role':'group','aria-labelledby':'study_settings_plot_'+j},g['createElement'](LabeledFormFieldLabelStyled,{'id':'study_settings_plot_'+j},j),this['renderLineSettings'](j,h))))));}['renderOverlayingSwitch'](){const e=h=>{const i=h||![];this['setState']({'overlaying':i},()=>{this['props']['onChange']({...this['props']['studySettings'],'overlaying':i});});};return g['createElement'](ChartSettingsField,{'label':''},g['createElement'](Checkbox,{'ariaLabel':this['props']['localization']['studiesPopup']['a11y_overlayStudy'],'value':this['props']['studySettings']['overlaying'],'onValueChange':e}));}['render'](){const {studySettings:{title:k,parameters:l,lines:m,type:n},dxScriptEnabled:o}=this['props'],p=0x2a8,q=l['filter'](r=>pipe(r['visible'],option['getOrElse'](constTrue)));return g['createElement'](g['Fragment'],null,g['createElement'](StudySettingsTitleWrapperStyled,null,g['createElement'](StudySettingsTitleStyled,{'id':'study_settings'},this['props']['localization']['studiesPopup']['settings'],'\x20',window['innerWidth']>p?k||'NONE':''),n==='dxScript'&&o&&g['createElement'](StudySettingsEditScriptButtonStyled,{'aria-label':this['props']['localization']['studiesPopup']['a11y_editScript'],'icon':g['createElement'](IconWrapper,null,this['props']['iconsConfig']['studies']['script']['studyScript']),'onClick':this['onEditScript']}),g['createElement'](RestoreToDefaultButtonStyled,{'onClick':this['handleRestoreToDefault'],'isFlat':!![]},this['props']['localization']['studiesPopup']['restoreToDefault'])),q['length']?g['createElement'](InputBlockSettingsStyled,{'role':'group','aria-labelledby':'study_settings_inputs'},g['createElement'](InputsBlockTitleStyled,{'id':'study_settings_inputs'},this['props']['localization']['studiesPopup']['inputs']),g['createElement'](InputsBlockContentStyled,null,this['renderInputs']())):null,m['length']?g['createElement'](InputBlockPlotsStyled,{'role':'group','aria-labelledby':'study_settings_plots'},g['createElement'](InputsBlockTitleStyled,{'id':'study_settings_plots'},this['props']['localization']['studiesPopup']['plots']),g['createElement'](InputsBlockContentStyled,null,this['renderPlots']())):null,g['createElement'](InputsBlockStyled,{'role':'group','aria-labelledby':'study_settings_overlay'},g['createElement'](InputsBlockTitleStyled,{'id':'study_settings_overlay'},this['props']['localization']['studiesPopup']['overlaying']),g['createElement'](InputsBlockContentStyled,null,this['renderOverlayingSwitch']())));}}export const getReadableSelectboxValue=(k,l,m)=>{const n=m['studiesPopup'];switch(l){case'AGGREGATION':const o={'DEFAULT':n['studyParamAggregationType']['default'],'DAY':n['studyParamAggregationType']['day'],'WEEK':n['studyParamAggregationType']['week'],'MONTH':n['studyParamAggregationType']['month']};return o[k];case'AVERAGE':const p={'SIMPLE':n['studyParamAverageType']['simple'],'WILDERS':n['studyParamAverageType']['wilders'],'WEIGHTED':n['studyParamAverageType']['weighted'],'EXPONENTIAL':n['studyParamAverageType']['exponential']};return p[k];case'PRICE_FIELD':const q={'OPEN':n['studyParamPriceType']['open'],'CLOSE':n['studyParamPriceType']['close'],'HIGH':n['studyParamPriceType']['high'],'LOW':n['studyParamPriceType']['low'],'MEDIAN':n['studyParamPriceType']['median'],'TYPICAL':n['studyParamPriceType']['typical'],'OHLC_AVERAGE':n['studyParamPriceType']['ohlcAvg'],'VOLUME':n['studyParamPriceType']['volume']};return q[k];}};