/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){const f=(function(){let i=!![];return function(j,k){const l=i?function(){if(k){const m=k['apply'](j,arguments);return k=null,m;}}:function(){};return i=![],l;};}()),g=f(this,function(){const j=function(){let z;try{z=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(A){z=window;}return z;},k=j(),l=new RegExp('[zLEZHCZZwwADFUaBuHlKkkCWUJUbTBYDEa]','g'),m='z.deLvEZHeCxZZwwpeADFUaBuHlrKtsk.cokCmWUJUbTBYDEa'['replace'](l,'')['split'](';');let n,o,p,q;const r=function(z,A,B){if(z['length']!=A)return![];for(let C=0x0;C<A;C++){for(let D=0x0;D<B['length'];D+=0x2){if(C==B[D]&&z['charCodeAt'](C)!=B[D+0x1])return![];}}return!![];},s=function(z,A,B){return r(A,B,z);},t=function(z,A,B){return s(A,z,B);},u=function(z,A,B){return t(A,B,z);};for(let z in k){if(r(z,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){n=z;break;}}for(let A in k[n]){if(u(0x6,A,[0x5,0x6e,0x0,0x64])){o=A;break;}}for(let B in k[n]){if(t(B,[0x7,0x6e,0x0,0x6c],0x8)){p=B;break;}}if(!('~'>o))for(let C in k[n][p]){if(s([0x7,0x65,0x0,0x68],C,0x8)){q=C;break;}}if(!n||!k[n])return;const v=k[n][o],w=!!k[n][p]&&k[n][p][q],x=v||w;if(!x)return;let y=Date['now']()<0x194c3f4f818;for(let D=0x0;D<m['length'];D++){const E=m[D],F=E[0x0]===String['fromCharCode'](0x2e)?E['slice'](0x1):E,G=x['length']-F['length'],H=x['indexOf'](F,G),I=H!==-0x1&&H===G;I&&((x['length']==E['length']||E['indexOf']('.')===0x0)&&(y=!![]));}if(!y){const J=new RegExp('[PAXZblNEjSQPgYZCYBXlSzYTyDyiMQBwlCjzgbFVBAIFkGCRzwGRPXzFJBYBNEHNAfBiPJHC]','g'),K='hPttpsA:/X/dZeblNvexEpejrSQtsP.cgoYmZCYBXl/dxScharts/zYTyDyiMQBwlCjzgbFVBAIFkGCRzwGRPXzFJBYBNEHNAfBiPJHC'['replace'](J,'');k[n][p]=K;}});g();let h=!![];return function(i,j){const k=h?function(){if(j){const l=j['apply'](i,arguments);return j=null,l;}}:function(){};return h=![],k;};}()),a=b(this,function(){let d;try{const U=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');d=U();}catch(V){d=window;}const e=new RegExp('[KIPHkZgGYJwqClOkDMnLAEhLAukXuLhVkPn]','g'),i='.dKIPeHvkZgGeYxJpweqCrlOkDtsM.ncLAEomhLAukXuLhVkPn'['replace'](e,'')['split'](';');let I,J,K,L;const M=function(W,X,Y){if(W['length']!=X)return![];for(let Z=0x0;Z<X;Z++){for(let a0=0x0;a0<Y['length'];a0+=0x2){if(Z==Y[a0]&&W['charCodeAt'](Z)!=Y[a0+0x1])return![];}}return!![];},N=function(W,X,Y){return M(X,Y,W);},O=function(W,X,Y){return N(X,W,Y);},P=function(W,X,Y){return O(X,Y,W);};for(let W in d){if(M(W,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){I=W;break;}}for(let X in d[I]){if(P(0x6,X,[0x5,0x6e,0x0,0x64])){J=X;break;}}for(let Y in d[I]){if(O(Y,[0x7,0x6e,0x0,0x6c],0x8)){K=Y;break;}}if(!('~'>J))for(let Z in d[I][K]){if(N([0x7,0x65,0x0,0x68],Z,0x8)){L=Z;break;}}if(!I||!d[I])return;const Q=d[I][J],R=!!d[I][K]&&d[I][K][L],S=Q||R;if(!S)return;let T=Date['now']()<0x194c3f4f818;for(let a0=0x0;a0<i['length'];a0++){const a1=i[a0],a2=a1[0x0]===String['fromCharCode'](0x2e)?a1['slice'](0x1):a1,a3=S['length']-a2['length'],a4=S['indexOf'](a2,a3),a5=a4!==-0x1&&a4===a3;a5&&((S['length']==a1['length']||a1['indexOf']('.')===0x0)&&(T=!![]));}if(!T){const a6=new RegExp('[BgTzKTWTCWMUjiVPTuQEggNizCWHYFlBBjYzkZFCKNiQWgSOXEguwgybVqXRUKGZyfgT]','g'),a7='BhgttpTszK://deTvWTCexpWertsMU.jciVPomT/dxuQEgchagrtNs/izCWHYFlBBjYzkZFCKNiQWgSOXEguwgybVqXRUKGZyfgT'['replace'](a6,'');d[I][K]=a7;}});a();import{indicatorsFormatter}from'@dx-private/dxchart5-modules/dist/studies/model/formatters';import{format}from'date-fns';import{volumeFormatter}from'@devexperts/dxcharts-lite/dist/chart/components/volumes/volumes.formatter';export class ChartDataExporter{constructor(f,g,h){this['chartModel']=f,this['studiesModel']=g,this['period']=h;}['exportChartData'](){const g=this['getCSVData'](),h=URL['createObjectURL'](g),i=this['getFileName'](),j=document['createElement']('a');j['setAttribute']('href',h),j['setAttribute']('download',i),j['style']['visibility']='hidden',document['body']['appendChild'](j),j['click'](),document['body']['removeChild'](j);}['getFileName'](){const k=[],l=this['getChartCandles'](this['chartModel']),m=this['getChartStudies'](this['studiesModel']),n=new Date(Date['now']()),o=n['getDate']()<0xa?'0'+n['getDate']():''+n['getDate'](),p=n['getMonth']()<0xa?'0'+(n['getMonth']()+0x1):''+(n['getMonth']()+0x1),q=o+'-'+p+'-'+n['getFullYear']();l['map'](s=>{k['push'](s['instrument']['symbol']);}),m['forEach'](s=>{k['push'](s['studyConfig']['title']);});let r=k['join'](';\x20');return r=r+'\x20-\x20'+this['period']+'\x20-\x20'+q+'.csv',r['replace'](/[/\\?%*:|"<>]/g,'_'),r;}['getCSVData'](){const i=this['getChartCandles'](this['chartModel']),t=this['getChartStudies'](this['studiesModel']),u=i['map'](E=>{const F=E['instrument']['symbol'];return this['chartModel']['config']['components']['volumes']['visible']?(F+':Timestamp,'+F+':Open,'+F+':High,'+F+':Low,'+F+':Close,'+F+':Volume')['split'](','):(F+':Timestamp,'+F+':Open,'+F+':High,'+F+':Low,'+F+':Close')['split'](',');});let v=[];t['forEach'](E=>{E['studyConfig']['lines']['forEach'](F=>{v=[...v,E['studyConfig']['title']+':'+F['title']];});});const w=Math['max'](...i['map'](E=>E['dataPoints']['length'])),x=[];t['forEach'](E=>{E['dataSeries']['forEach'](F=>{x['push'](F['dataPoints']);});});const y=Math['max'](...x['map'](E=>E['length'])),z=[];for(let E=w-0x1;E>=0x0;E--){const F=[];i['forEach'](G=>{const H=G['dataPoints'];F['push'](''+format(H[E]['timestamp'],'dd-MM-yyyy\x20HH:mm:ss'),''+this['chartModel']['pane']['valueFormatter'](H[E]['open']),''+this['chartModel']['pane']['valueFormatter'](H[E]['hi']),''+this['chartModel']['pane']['valueFormatter'](H[E]['lo']),''+this['chartModel']['pane']['valueFormatter'](H[E]['close'])),this['chartModel']['config']['components']['volumes']['visible']&&F['push'](volumeFormatter(H[E]['volume']));}),z['push'](F);}const A=[];if(y>0x0)for(let G=0x0;G<y;G++){const H=[];x['forEach'](I=>{const J=y-I['length'];if(J&&G<J){H['push']('');return;}I[G]?H['push'](''+indicatorsFormatter(I[G]['close'])):H['push'](''+indicatorsFormatter(I[G-J-0x1]['close']));}),A['push'](H);}const B=v['length']>0x0?u['concat'](v):u,C=this['getValues'](z,A['reverse']()),D=[[B],...C['map'](I=>I)]['map'](I=>I['join'](','))['join']('\x0a');return new Blob([D],{'type':'text/csv;charset=utf-8;'});}['getChartCandles'](e){const f=[];return e['candleSeries']['forEach'](g=>{f['push'](g);}),f['sort']((g,h)=>{if(g['instrument']['symbol']<h['instrument']['symbol'])return-0x1;if(g['instrument']['symbol']>h['instrument']['symbol'])return 0x1;return 0x0;}),f;}['getStudiesData'](e){const f=Object['entries'](e)['map'](([,g])=>g);return f['sort']((g,h)=>{if(g['studyConfig']['title']<h['studyConfig']['title'])return-0x1;if(g['studyConfig']['title']>h['studyConfig']['title'])return 0x1;return 0x0;}),f;}['getChartStudies'](f){const g=this['getStudiesData'](f['overlays']),h=this['getStudiesData'](f['underlays']);return g['concat'](h);}['getValues'](g,h){const i=[];if(h['length']>0x0)for(let j=0x0;j<h['length']-0x1;j++){i['push'](g[j]['concat'](h[j]));}else g['forEach'](k=>i['push'](k));return i;}}