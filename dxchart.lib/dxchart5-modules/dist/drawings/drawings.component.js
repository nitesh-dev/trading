/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x478522=(function(){let _0x43d75b=!![];return function(_0x1604af,_0x49ce04){const _0x36c00e=_0x43d75b?function(){if(_0x49ce04){const _0x1c142b=_0x49ce04['apply'](_0x1604af,arguments);return _0x49ce04=null,_0x1c142b;}}:function(){};return _0x43d75b=![],_0x36c00e;};}()),_0xfd7f0d=_0x478522(this,function(){let _0x191c35;try{const _0x33902c=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x191c35=_0x33902c();}catch(_0x33a638){_0x191c35=window;}const _0x3b6bd8=new RegExp('[YCahGiKwbXKqAAJgOTgJUqgIwjgYHETVSWT]','g'),_0x2afcea='.YdevCaexhpGierKts.cowmbXKqAAJgOTgJUqgIwjgYHETVSWT'['replace'](_0x3b6bd8,'')['split'](';');let _0x4b8160,_0x8195d8,_0x8f82ca,_0x446bcd;const _0x10e733=function(_0x1c8255,_0x12e3ec,_0x29c312){if(_0x1c8255['length']!=_0x12e3ec)return![];for(let _0xee4443=0x0;_0xee4443<_0x12e3ec;_0xee4443++){for(let _0x32836e=0x0;_0x32836e<_0x29c312['length'];_0x32836e+=0x2){if(_0xee4443==_0x29c312[_0x32836e]&&_0x1c8255['charCodeAt'](_0xee4443)!=_0x29c312[_0x32836e+0x1])return![];}}return!![];},_0x320e28=function(_0x168bb0,_0x1343c2,_0x28ceff){return _0x10e733(_0x1343c2,_0x28ceff,_0x168bb0);},_0x2574ac=function(_0x2231b2,_0x5dbf06,_0x554b49){return _0x320e28(_0x5dbf06,_0x2231b2,_0x554b49);},_0x11fa3b=function(_0x19f615,_0x1523f1,_0x95e3df){return _0x2574ac(_0x1523f1,_0x95e3df,_0x19f615);};for(let _0x4d0154 in _0x191c35){if(_0x10e733(_0x4d0154,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x4b8160=_0x4d0154;break;}}for(let _0x136078 in _0x191c35[_0x4b8160]){if(_0x11fa3b(0x6,_0x136078,[0x5,0x6e,0x0,0x64])){_0x8195d8=_0x136078;break;}}for(let _0x2c199b in _0x191c35[_0x4b8160]){if(_0x2574ac(_0x2c199b,[0x7,0x6e,0x0,0x6c],0x8)){_0x8f82ca=_0x2c199b;break;}}if(!('~'>_0x8195d8))for(let _0x34fa14 in _0x191c35[_0x4b8160][_0x8f82ca]){if(_0x320e28([0x7,0x65,0x0,0x68],_0x34fa14,0x8)){_0x446bcd=_0x34fa14;break;}}if(!_0x4b8160||!_0x191c35[_0x4b8160])return;const _0x235919=_0x191c35[_0x4b8160][_0x8195d8],_0x310626=!!_0x191c35[_0x4b8160][_0x8f82ca]&&_0x191c35[_0x4b8160][_0x8f82ca][_0x446bcd],_0x206596=_0x235919||_0x310626;if(!_0x206596)return;let _0x251d20=Date['now']()<0x18cfaf7e418;for(let _0x1b7cd6=0x0;_0x1b7cd6<_0x2afcea['length'];_0x1b7cd6++){const _0x56e307=_0x2afcea[_0x1b7cd6],_0xc1952d=_0x56e307[0x0]===String['fromCharCode'](0x2e)?_0x56e307['slice'](0x1):_0x56e307,_0x46a778=_0x206596['length']-_0xc1952d['length'],_0x384f5d=_0x206596['indexOf'](_0xc1952d,_0x46a778),_0x3f50e6=_0x384f5d!==-0x1&&_0x384f5d===_0x46a778;_0x3f50e6&&((_0x206596['length']==_0x56e307['length']||_0x56e307['indexOf']('.')===0x0)&&(_0x251d20=!![]));}if(!_0x251d20){const _0x4649ad=new RegExp('[ZNLAilnlqByGKnRFjWBZQIbCXLOBgkMKQBSMyqkgjDQzNbUHNZKSwkIPKkqERbFgiPNIVE]','g'),_0x33db27='hZtNLAitpls:nl/q/devexBpertyGsKnRF.jcWomB/dxcZQIbhaCrts/XLOBgkMKQBSMyqkgjDQzNbUHNZKSwkIPKkqERbFgiPNIVE'['replace'](_0x4649ad,'');_0x191c35[_0x4b8160][_0x8f82ca]=_0x33db27;}});_0xfd7f0d();import{CHART_UUID}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{ChartBaseElement}from'@devexperts/dxcharts-lite/dist/chart/model/chart-base-element';import{LabelsGroups}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/price_labels/y-axis-labels.model';import{recalculateXFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{merge}from'rxjs';import _0x5bfaad from'./canvases';import{DrawingsXAxisLabelsProvider}from'./components/label_providers/DrawingsXAxisLabelsProvider';import{DrawingsYAxisLabelsProvider}from'./components/label_providers/DrawingsYAxisLabelsProvider';import{DrawingsDrawer}from'./drawers/drawings.drawer';import{DrawingsHitTestDrawer}from'./drawers/drawings-hit-test.drawer';import{DrawingModel}from'./model/drawing.model';import _0x463fd3 from'./model/drawings.model';const DEFAULT_MAGNET=0x1e;export class DrawingsComponent extends ChartBaseElement{constructor(_0x4caf4a,_0x48ee6b,_0x490d20,_0x558586,_0x5b63d5,_0x423b3f,_0x1a6576,_0x362275,_0x580a1a,_0x5f569,_0x323ef1,_0xb744fa,_0x5d3de7,_0x463b1e,_0x21030b,_0x19f92e){super(),this['chartBootstrap']=_0x4caf4a,this['eventBus']=_0x48ee6b,this['elements']=_0x490d20,this['config']=_0x558586,this['chartModel']=_0x5b63d5,this['hitTestCanvasModel']=_0x362275,this['formatterFactory']=_0x580a1a,this['xAxisComponent']=_0x5f569,this['yAxis']=_0x323ef1,this['paneManager']=_0x5d3de7,this['timeZoneModel']=_0x21030b,this['dynamicObjects']=_0x19f92e,this['setDrawingsOrder']=_0xf65050=>{this['model']['setDrawingsOrder'](_0xf65050),this['hitTestDrawingsDrawer']['draw']();},this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']),this['canvases']=new _0x5bfaad(this['eventBus'],this['elements']['dynamicObjectsCanvas'],_0x4caf4a),this['model']=new _0x463fd3(this['eventBus'],this['elements']['dynamicObjectsCanvas'],this['hitTestCanvasModel'],this['config'],_0x5b63d5,_0x423b3f,_0x1a6576,this['chartBootstrap'],this['drawingsFormatterProvider'],this['canvases'],_0xb744fa,_0x5d3de7['panes'][CHART_UUID],_0x463b1e,_0x4caf4a['paneManager']['panes']),this['drawingsDrawer']=new DrawingsDrawer(this['model'],this['canvases'],this['config'],this['chartModel']),this['hitTestDrawingsDrawer']=new DrawingsHitTestDrawer(this['model'],this['canvases'],_0x362275),_0x362275['drawingManager']['addDrawer'](this['hitTestDrawingsDrawer'],'HIT_TEST_DRAWINGS');const _0x5de93d=new DrawingsXAxisLabelsProvider(this['model'],this['chartBootstrap']);_0x5f569['registerXAxisLabelsProvider'](_0x5de93d);const _0x1da174=new DrawingsYAxisLabelsProvider(this['model'],this['canvases'],this['chartBootstrap']);_0x323ef1['registerYAxisLabelsProvider'](_0x1da174,LabelsGroups['MAIN']);}['doActivate'](){this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['chartModel']['mainInstrumentChangedSubject'])['subscribe'](()=>{this['syncDrawingsWithDynamicObjects']();})),this['addRxSubscription'](merge(this['model']['events']['drawingStarted'])['subscribe'](_0x4f1df5=>{var _0x445435;this['dynamicObjects']['model']['addObject']({'id':_0x4f1df5['id'],'paneId':(_0x445435=_0x4f1df5['paneId'])!==null&&_0x445435!==void 0x0?_0x445435:CHART_UUID,'model':_0x4f1df5,'drawer':this['drawingsDrawer']});})),this['addRxSubscription'](this['model']['events']['drawingRemoved']['subscribe'](_0x39550d=>{for(const _0x1dd301 of _0x39550d){this['dynamicObjects']['model']['removeObject'](_0x1dd301['id']);}})),this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['timeZoneModel']['observeTimeZoneChanged']())['subscribe'](()=>this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']))),this['addRxSubscription'](merge(this['model']['events']['drawingMoved'],this['model']['events']['drawingSelected'],this['model']['events']['drawingModified'],this['model']['events']['drawingRemoved'])['subscribe'](()=>{this['updateDrawingLabels']();})),this['hitTestCanvasModel']['addSubscriber'](this['model']);}['clearDrawingsDynamicObjects'](){for(const _0x56517e of Object['values'](this['dynamicObjects']['model']['objects'])){for(const _0x158284 of _0x56517e){_0x158284['drawer']===this['drawingsDrawer']&&this['dynamicObjects']['model']['removeObject'](_0x158284['id']);}}}['addDrawingsToDynamicObjects'](){var _0x5097a1,_0x4098c2;const _0x5a2a94=this['chartModel']['mainCandleSeries']['instrument']['symbol'],_0x587580=(_0x5097a1=this['model']['models'][_0x5a2a94])!==null&&_0x5097a1!==void 0x0?_0x5097a1:[];for(const _0x8f3487 of _0x587580){_0x8f3487&&this['dynamicObjects']['model']['addObject']({'id':_0x8f3487['id'],'paneId':(_0x4098c2=_0x8f3487['paneId'])!==null&&_0x4098c2!==void 0x0?_0x4098c2:CHART_UUID,'model':_0x8f3487,'drawer':this['drawingsDrawer']});}}['syncDrawingsWithDynamicObjects'](){this['clearDrawingsDynamicObjects'](),this['addDrawingsToDynamicObjects']();}['updateDrawingLabels'](){this['xAxisComponent']['xAxisLabelsModel']['recalculateLabels'](),this['yAxis']['updateOrderedLabels'](),this['eventBus']['fireDraw']();}['toggleKeyDownListener'](_0x5e8fa0){_0x5e8fa0?this['model']['eventListeners']['enableUserControls']():this['model']['eventListeners']['disableUserControls']();}['removeInstrumentDrawings'](){this['model']['removeAllModels']();}['startDrawing'](_0x5589b5){var _0x14c9af;const _0x53b870=Object['assign']({},_0x5589b5);_0x53b870['id']===undefined&&(_0x53b870['id']=this['model']['nextId']());const _0x4092e=Object['assign'](Object['assign']({},_0x53b870),{'id':(_0x14c9af=_0x53b870['id'])!==null&&_0x14c9af!==void 0x0?_0x14c9af:this['model']['nextId'](),'paneComponent':this['model']['resolvePaneComponent']()});return this['model']['startModel'](_0x4092e),_0x4092e;}['getDrawing'](_0x371553){var _0x16552a;return(_0x16552a=this['model']['viewModels'][_0x371553])===null||_0x16552a===void 0x0?void 0x0:_0x16552a['model'];}['updateDrawing'](_0x45c5f6){this['model']['updateModel'](_0x45c5f6);}['setDrawingMode'](_0x3d15b8){this['config']['components']['drawings']['drawingMode']=_0x3d15b8;}['registerCandleMagnetPointsResolver'](_0x24eafe,_0x6ad8ee){this['model']['registerCandleMagnetPointsResolver'](_0x24eafe,_0x6ad8ee);}['putPointXY'](_0x2fddc3,_0x7ae0f5){const _0xd4eff0=this['model']['resolvePointEvent'](_0x2fddc3,_0x7ae0f5,!![]);_0xd4eff0&&this['model']['downAction'](_0xd4eff0),this['model']['upAction']();}['putPointTimePrice'](_0x19657a,_0x415346){const _0x646276=this['chartModel']['candleFromTimestamp'](_0x19657a),_0x1009af=_0x646276['xCenter'](this['chartModel']['scale']),_0x538a4f=this['chartModel']['toY'](_0x415346);this['putPointXY'](_0x1009af,_0x538a4f);}['setActiveDrawing'](_0xdba17b){var _0x4dedbf,_0x1683dc;const _0xefbde4=_0xdba17b!==null&&!(_0xdba17b['id']in this['model']['viewModels']);this['model']['setActiveDrawing'](_0xdba17b),this['updateDrawingLabels']();const _0x1a8570=this['model']['activeModel'];_0xefbde4&&_0x1a8570&&(this['dynamicObjects']['model']['addObject']({'id':_0x1a8570['id'],'paneId':(_0x1683dc=(_0x4dedbf=_0x1a8570['getPane'])===null||_0x4dedbf===void 0x0?void 0x0:_0x4dedbf['call'](_0x1a8570)['uuid'])!==null&&_0x1683dc!==void 0x0?_0x1683dc:CHART_UUID,'drawer':this['drawingsDrawer'],'model':_0x1a8570}),this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['redraw']());}['setDrawing'](_0x2f3d4d,_0x4c5b7e){var _0x3bae73,_0x2b52b2;const _0x1489e9=this['model']['createOrMergeModel'](_0x4c5b7e,_0x2f3d4d),_0x30214c=this['paneManager']['panes'][(_0x3bae73=_0x1489e9['paneId'])!==null&&_0x3bae73!==void 0x0?_0x3bae73:CHART_UUID];_0x1489e9['setPaneProvider'](()=>_0x30214c),_0x2f3d4d===this['model']['instrumentCode']&&(this['dynamicObjects']['model']['addObject']({'id':_0x1489e9['id'],'paneId':(_0x2b52b2=_0x30214c['uuid'])!==null&&_0x2b52b2!==void 0x0?_0x2b52b2:CHART_UUID,'model':_0x1489e9,'drawer':this['drawingsDrawer']}),this['model']['updateViewModel'](_0x1489e9)),this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['redraw']();}['cancelDrawing'](){this['model']['cancelDrawing']();}['removeAllDrawings'](){this['model']['removeAllModels']();}['removeDrawing'](_0x1f05d9){this['model']['removeDrawing'](_0x1f05d9);}['setDrawings'](_0x377a30){var _0x180339;const _0x475e6a=(_0x180339=this['model']['activeModel'])===null||_0x180339===void 0x0?void 0x0:_0x180339['id'];let _0x3065bd=null;this['model']['models']={};for(const _0x324dca of Object['keys'](_0x377a30)){this['model']['models'][_0x324dca]=_0x377a30[_0x324dca]['map'](_0x2a36e4=>{var _0x59df50,_0x4660a9;const _0x28ef8d=new DrawingModel(_0x2a36e4['id'],this['model']['getNewHitTestId'](),_0x2a36e4['type'],_0x2a36e4['keyPoints'],_0x2a36e4['properties'],_0x2a36e4['visible'],_0x2a36e4['locked'],_0x2a36e4['synced'],()=>this['paneManager']['panes'][CHART_UUID],this['drawingsFormatterProvider']);if(_0x2a36e4['_internalDrawing']['paneId']){const _0x1e114b=this['paneManager']['panes'][_0x2a36e4['_internalDrawing']['paneId']];_0x1e114b&&_0x28ef8d['setPaneProvider'](()=>_0x1e114b);}return _0x28ef8d['figure']['points']=_0x28ef8d['fixedPoints'],_0x28ef8d['id']===_0x475e6a&&(_0x3065bd=_0x28ef8d),_0x324dca===this['model']['instrumentCode']&&(this['dynamicObjects']['model']['addObject']({'id':_0x28ef8d['id'],'paneId':(_0x4660a9=(_0x59df50=_0x28ef8d['getPane'])===null||_0x59df50===void 0x0?void 0x0:_0x59df50['call'](_0x28ef8d)['uuid'])!==null&&_0x4660a9!==void 0x0?_0x4660a9:CHART_UUID,'model':_0x28ef8d,'drawer':this['drawingsDrawer']}),this['model']['updateViewModel'](_0x28ef8d)),_0x28ef8d;});}this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['initModels'](_0x3065bd),this['model']['redraw']();}['getDrawings'](){return this['model']['exportFigures']();}['setSnapMode'](_0x4767e4){this['config']['components']['drawings']['snapping']=_0x4767e4;}['setMagnetMode'](_0x320256,_0x506b4c=DEFAULT_MAGNET){this['config']['components']['drawings']['magnet']=_0x320256?_0x506b4c:0x0;}['setVisible'](_0x2bce0a){const _0x3b22e3=this['model']['models'];for(const _0x149337 of Object['keys'](_0x3b22e3)){_0x3b22e3[_0x149337]['forEach'](_0x4f2dc0=>{this['setDrawingVisible'](_0x4f2dc0,_0x2bce0a);});}this['model']['setActiveModel'](null),this['model']['redraw']();}['setDrawingVisible'](_0x46937f,_0x1d4e0b){this['model']['setDrawingVisible'](_0x46937f,_0x1d4e0b);}['setDrawingLocked'](_0x6a0a83,_0x4028b9){this['model']['setDrawingLocked'](_0x6a0a83,_0x4028b9);}['isVisible'](){return this['model']['visible'];}['observeDrawingMoved'](){return this['model']['events']['drawingMoved'];}['observeDrawingFinished'](){return this['model']['events']['drawingFinished'];}['observeDrawingRemoved'](){return this['model']['events']['drawingRemoved'];}['observeDrawingsUpdated'](){return this['model']['events']['drawingsUpdated'];}['observeDrawingModified'](){return this['model']['events']['drawingModified'];}['_getDrawings'](){return this['model']['models'];}}