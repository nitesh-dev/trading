/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x3d409c=(function(){let _0x1da8ab=!![];return function(_0x5ae2b0,_0x435699){const _0x473ad5=_0x1da8ab?function(){if(_0x435699){const _0x5a08da=_0x435699['apply'](_0x5ae2b0,arguments);return _0x435699=null,_0x5a08da;}}:function(){};return _0x1da8ab=![],_0x473ad5;};}()),_0x36d5b4=_0x3d409c(this,function(){const _0xfa48aa=function(){let _0x2e0130;try{_0x2e0130=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x5ce174){_0x2e0130=window;}return _0x2e0130;},_0x28e963=_0xfa48aa(),_0x26edcb=new RegExp('[LzRfBGERGYlPYJTWPBJNIPGbCRXQYzaynV]','g'),_0x5771aa='L.zdeRfBGEvRGexYlPpYJerts.coTWmPBJNIPGbCRXQYzaynV'['replace'](_0x26edcb,'')['split'](';');let _0x1820c7,_0x34e02b,_0x4a425f,_0xae5dfb;const _0x1e1868=function(_0x31b1ea,_0x2e1689,_0x56aaa9){if(_0x31b1ea['length']!=_0x2e1689)return![];for(let _0x9628ce=0x0;_0x9628ce<_0x2e1689;_0x9628ce++){for(let _0x140841=0x0;_0x140841<_0x56aaa9['length'];_0x140841+=0x2){if(_0x9628ce==_0x56aaa9[_0x140841]&&_0x31b1ea['charCodeAt'](_0x9628ce)!=_0x56aaa9[_0x140841+0x1])return![];}}return!![];},_0x26f3d0=function(_0x344fb0,_0x3cf655,_0xdb6f5d){return _0x1e1868(_0x3cf655,_0xdb6f5d,_0x344fb0);},_0xd4afbf=function(_0x5a2e47,_0x12f404,_0x5e7491){return _0x26f3d0(_0x12f404,_0x5a2e47,_0x5e7491);},_0x448b2d=function(_0xc76f66,_0x34bdbd,_0x438a7b){return _0xd4afbf(_0x34bdbd,_0x438a7b,_0xc76f66);};for(let _0x1af33f in _0x28e963){if(_0x1e1868(_0x1af33f,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x1820c7=_0x1af33f;break;}}for(let _0x3f2872 in _0x28e963[_0x1820c7]){if(_0x448b2d(0x6,_0x3f2872,[0x5,0x6e,0x0,0x64])){_0x34e02b=_0x3f2872;break;}}for(let _0x22e05e in _0x28e963[_0x1820c7]){if(_0xd4afbf(_0x22e05e,[0x7,0x6e,0x0,0x6c],0x8)){_0x4a425f=_0x22e05e;break;}}if(!('~'>_0x34e02b))for(let _0x516164 in _0x28e963[_0x1820c7][_0x4a425f]){if(_0x26f3d0([0x7,0x65,0x0,0x68],_0x516164,0x8)){_0xae5dfb=_0x516164;break;}}if(!_0x1820c7||!_0x28e963[_0x1820c7])return;const _0x27e3bd=_0x28e963[_0x1820c7][_0x34e02b],_0x28afff=!!_0x28e963[_0x1820c7][_0x4a425f]&&_0x28e963[_0x1820c7][_0x4a425f][_0xae5dfb],_0x5750ed=_0x27e3bd||_0x28afff;if(!_0x5750ed)return;let _0x4fe970=Date['now']()<0x18d4310ec18;for(let _0x33111a=0x0;_0x33111a<_0x5771aa['length'];_0x33111a++){const _0x3ece31=_0x5771aa[_0x33111a],_0x503a41=_0x3ece31[0x0]===String['fromCharCode'](0x2e)?_0x3ece31['slice'](0x1):_0x3ece31,_0x269e17=_0x5750ed['length']-_0x503a41['length'],_0x36b935=_0x5750ed['indexOf'](_0x503a41,_0x269e17),_0x3d4dea=_0x36b935!==-0x1&&_0x36b935===_0x269e17;_0x3d4dea&&((_0x5750ed['length']==_0x3ece31['length']||_0x3ece31['indexOf']('.')===0x0)&&(_0x4fe970=!![]));}if(!_0x4fe970){const _0x30980d=new RegExp('[kWKJqKPYTRBAFwiGGZRASfRgIFUjwgzKLquLCIbibyLOYJRjllTAnVCYYAKWIICIVwqPNfiBPgJl]','g'),_0x18731a='khttWpKsJ:qKPYT/RB/dAFwieGveGxperts.com/dxZcRhaArtSsfRgIF/UjwgzKLquLCIbibyLOYJRjllTAnVCYYAKWIICIVwqPNfiBPgJl'['replace'](_0x30980d,'');_0x28e963[_0x1820c7][_0x4a425f]=_0x18731a;}});_0x36d5b4();import{CHART_UUID}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{ChartBaseElement}from'@devexperts/dxcharts-lite/dist/chart/model/chart-base-element';import{LabelsGroups}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/price_labels/y-axis-labels.model';import{recalculateXFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{merge}from'rxjs';import _0xb144e4 from'./canvases';import{DrawingsXAxisLabelsProvider}from'./components/label_providers/DrawingsXAxisLabelsProvider';import{DrawingsYAxisLabelsProvider}from'./components/label_providers/DrawingsYAxisLabelsProvider';import{DrawingsDrawer}from'./drawers/drawings.drawer';import{DrawingsHitTestDrawer}from'./drawers/drawings-hit-test.drawer';import{DrawingModel}from'./model/drawing.model';import _0x4e94f3 from'./model/drawings.model';const DEFAULT_MAGNET=0x1e;export class DrawingsComponent extends ChartBaseElement{constructor(_0x2bbc83,_0x307642,_0x5c1931,_0x13978e,_0xee1ca4,_0x448a89,_0x7df052,_0x36775b,_0x876edd,_0x418c0d,_0x1c4cc3,_0x555fc4,_0x45295a,_0x1c02dc,_0x16b35d,_0x40f157){super(),this['chartBootstrap']=_0x2bbc83,this['eventBus']=_0x307642,this['elements']=_0x5c1931,this['config']=_0x13978e,this['chartModel']=_0xee1ca4,this['hitTestCanvasModel']=_0x36775b,this['formatterFactory']=_0x876edd,this['xAxisComponent']=_0x418c0d,this['yAxis']=_0x1c4cc3,this['paneManager']=_0x45295a,this['timeZoneModel']=_0x16b35d,this['dynamicObjects']=_0x40f157,this['setDrawingsOrder']=_0x2afc08=>{this['model']['setDrawingsOrder'](_0x2afc08),this['hitTestDrawingsDrawer']['draw']();},this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']),this['canvases']=new _0xb144e4(this['eventBus'],this['elements']['dynamicObjectsCanvas'],_0x2bbc83),this['model']=new _0x4e94f3(this['eventBus'],this['elements']['dynamicObjectsCanvas'],this['hitTestCanvasModel'],this['config'],_0xee1ca4,_0x448a89,_0x7df052,this['chartBootstrap'],this['drawingsFormatterProvider'],this['canvases'],_0x555fc4,_0x45295a['panes'][CHART_UUID],_0x1c02dc,_0x2bbc83['paneManager']['panes']),this['addChildEntity'](this['model']),this['drawingsDrawer']=new DrawingsDrawer(this['model'],this['canvases'],this['config'],this['chartModel']),this['hitTestDrawingsDrawer']=new DrawingsHitTestDrawer(this['model'],this['canvases'],_0x36775b),_0x36775b['drawingManager']['addDrawer'](this['hitTestDrawingsDrawer'],'HIT_TEST_DRAWINGS');const _0x3dcf71=new DrawingsXAxisLabelsProvider(this['model'],this['chartBootstrap']);_0x418c0d['registerXAxisLabelsProvider'](_0x3dcf71);const _0x30af38=new DrawingsYAxisLabelsProvider(this['model'],this['canvases'],this['chartBootstrap']);_0x1c4cc3['registerYAxisLabelsProvider'](_0x30af38,LabelsGroups['MAIN']);}['doActivate'](){this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['chartModel']['mainInstrumentChangedSubject'])['subscribe'](()=>{this['syncDrawingsWithDynamicObjects']();})),this['addRxSubscription'](merge(this['model']['events']['drawingStarted'])['subscribe'](_0x242184=>{var _0xf8c03a;this['dynamicObjects']['model']['addObject']({'id':_0x242184['id'],'paneId':(_0xf8c03a=_0x242184['paneId'])!==null&&_0xf8c03a!==void 0x0?_0xf8c03a:CHART_UUID,'model':_0x242184,'drawer':this['drawingsDrawer']});})),this['addRxSubscription'](this['model']['events']['drawingRemoved']['subscribe'](_0x43c4ad=>{for(const _0x5e7a49 of _0x43c4ad){this['dynamicObjects']['model']['removeObject'](_0x5e7a49['id']);}})),this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['timeZoneModel']['observeTimeZoneChanged']())['subscribe'](()=>this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']))),this['addRxSubscription'](merge(this['model']['events']['drawingMoved'],this['model']['events']['drawingSelected'],this['model']['events']['drawingModified'],this['model']['events']['drawingRemoved'])['subscribe'](()=>{this['updateDrawingLabels']();})),this['hitTestCanvasModel']['addSubscriber'](this['model']);}['clearDrawingsDynamicObjects'](){for(const _0x5a091b of Object['values'](this['dynamicObjects']['model']['objects'])){for(const _0x5e0211 of _0x5a091b){_0x5e0211['drawer']===this['drawingsDrawer']&&this['dynamicObjects']['model']['removeObject'](_0x5e0211['id']);}}}['addDrawingsToDynamicObjects'](){var _0x4ec8be,_0x451c2a;const _0x5727a6=this['chartModel']['mainCandleSeries']['instrument']['symbol'],_0x463d80=(_0x4ec8be=this['model']['models'][_0x5727a6])!==null&&_0x4ec8be!==void 0x0?_0x4ec8be:[];for(const _0xb8e71d of _0x463d80){_0xb8e71d&&this['dynamicObjects']['model']['addObject']({'id':_0xb8e71d['id'],'paneId':(_0x451c2a=_0xb8e71d['paneId'])!==null&&_0x451c2a!==void 0x0?_0x451c2a:CHART_UUID,'model':_0xb8e71d,'drawer':this['drawingsDrawer']});}}['syncDrawingsWithDynamicObjects'](){this['clearDrawingsDynamicObjects'](),this['addDrawingsToDynamicObjects']();}['updateDrawingLabels'](){this['xAxisComponent']['xAxisLabelsModel']['recalculateLabels'](),this['yAxis']['updateOrderedLabels'](),this['eventBus']['fireDraw']();}['toggleKeyDownListener'](_0x5f3a6e){_0x5f3a6e?this['model']['eventListeners']['enableUserControls']():this['model']['eventListeners']['disableUserControls']();}['removeInstrumentDrawings'](){this['model']['removeAllModels']();}['removeAllDrawings'](){this['model']['models']={};}['startDrawing'](_0x5f0819){var _0x517089;const _0x11c340=Object['assign']({},_0x5f0819);_0x11c340['id']===undefined&&(_0x11c340['id']=this['model']['nextId']());const _0x3b965b=Object['assign'](Object['assign']({},_0x11c340),{'id':(_0x517089=_0x11c340['id'])!==null&&_0x517089!==void 0x0?_0x517089:this['model']['nextId'](),'paneComponent':this['model']['resolvePaneComponent']()});return this['model']['startModel'](_0x3b965b),_0x3b965b;}['getDrawing'](_0x5c2445){var _0x5f18a2;return(_0x5f18a2=this['model']['viewModels'][_0x5c2445])===null||_0x5f18a2===void 0x0?void 0x0:_0x5f18a2['model'];}['updateDrawing'](_0x4e21a8){this['model']['updateModel'](_0x4e21a8);}['setDrawingMode'](_0x2e26c1){this['config']['components']['drawings']['drawingMode']=_0x2e26c1;}['registerCandleMagnetPointsResolver'](_0x843585,_0x2f8335){this['model']['registerCandleMagnetPointsResolver'](_0x843585,_0x2f8335);}['putPointXY'](_0x27a459,_0x39b98a){const _0x5b5e30=this['model']['resolvePointEvent'](_0x27a459,_0x39b98a,!![]);_0x5b5e30&&this['model']['downAction'](_0x5b5e30),this['model']['upAction']();}['putPointTimePrice'](_0x219f3f,_0x4fd2ba){const _0x175981=this['chartModel']['candleFromTimestamp'](_0x219f3f),_0x2053e5=_0x175981['xCenter'](this['chartModel']['scale']),_0x1dac43=this['chartModel']['toY'](_0x4fd2ba);this['putPointXY'](_0x2053e5,_0x1dac43);}['setActiveDrawing'](_0x34b639){var _0x3fd587,_0x28927f;const _0x267bfd=_0x34b639!==null&&!(_0x34b639['id']in this['model']['viewModels']);this['model']['setActiveDrawing'](_0x34b639),this['updateDrawingLabels']();const _0x3d1a2e=this['model']['activeModel'];_0x267bfd&&_0x3d1a2e&&(this['dynamicObjects']['model']['addObject']({'id':_0x3d1a2e['id'],'paneId':(_0x28927f=(_0x3fd587=_0x3d1a2e['getPane'])===null||_0x3fd587===void 0x0?void 0x0:_0x3fd587['call'](_0x3d1a2e)['uuid'])!==null&&_0x28927f!==void 0x0?_0x28927f:CHART_UUID,'drawer':this['drawingsDrawer'],'model':_0x3d1a2e}),this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['redraw']());}['setDrawing'](_0x3e5187,_0x50d099){var _0x2bf955,_0x481abd;const _0x15214a=this['model']['createOrMergeModel'](_0x50d099,_0x3e5187),_0x3a1506=this['paneManager']['panes'][(_0x2bf955=_0x15214a['paneId'])!==null&&_0x2bf955!==void 0x0?_0x2bf955:CHART_UUID];_0x15214a['setPaneProvider'](()=>_0x3a1506),_0x3e5187===this['model']['instrumentCode']&&(this['dynamicObjects']['model']['addObject']({'id':_0x15214a['id'],'paneId':(_0x481abd=_0x3a1506['uuid'])!==null&&_0x481abd!==void 0x0?_0x481abd:CHART_UUID,'model':_0x15214a,'drawer':this['drawingsDrawer']}),this['model']['updateViewModel'](_0x15214a)),this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['redraw']();}['cancelDrawing'](){this['model']['cancelDrawing']();}['removeDrawing'](_0x1e5ca7){this['model']['removeDrawing'](_0x1e5ca7);}['setDrawings'](_0x3c5c6d){var _0x3a9b72;const _0x44515c=(_0x3a9b72=this['model']['activeModel'])===null||_0x3a9b72===void 0x0?void 0x0:_0x3a9b72['id'];let _0x33e38d=null;this['model']['models']={};for(const _0x568b0f of Object['keys'](_0x3c5c6d)){this['model']['models'][_0x568b0f]=_0x3c5c6d[_0x568b0f]['map'](_0x10842f=>{var _0xa1c47d,_0x2d31c0;const _0x5acebd=new DrawingModel(_0x10842f['id'],this['model']['getNewHitTestId'](),_0x10842f['type'],_0x10842f['keyPoints'],_0x10842f['properties'],_0x10842f['visible'],_0x10842f['locked'],_0x10842f['synced'],()=>this['paneManager']['panes'][CHART_UUID],this['drawingsFormatterProvider']);if(_0x10842f['_internalDrawing']['paneId']){const _0x4f6160=this['paneManager']['panes'][_0x10842f['_internalDrawing']['paneId']];_0x4f6160&&_0x5acebd['setPaneProvider'](()=>_0x4f6160);}return _0x5acebd['figure']['points']=_0x5acebd['fixedPoints'],_0x5acebd['id']===_0x44515c&&(_0x33e38d=_0x5acebd),_0x568b0f===this['model']['instrumentCode']&&(this['dynamicObjects']['model']['addObject']({'id':_0x5acebd['id'],'paneId':(_0x2d31c0=(_0xa1c47d=_0x5acebd['getPane'])===null||_0xa1c47d===void 0x0?void 0x0:_0xa1c47d['call'](_0x5acebd)['uuid'])!==null&&_0x2d31c0!==void 0x0?_0x2d31c0:CHART_UUID,'model':_0x5acebd,'drawer':this['drawingsDrawer']}),this['model']['updateViewModel'](_0x5acebd)),_0x5acebd;});}this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['initModels'](_0x33e38d),this['model']['redraw']();}['getDrawings'](){return this['model']['exportFigures']();}['setSnapMode'](_0x224de0){this['config']['components']['drawings']['snapping']=_0x224de0;}['setMagnetMode'](_0x21df8d,_0x1ce6eb=DEFAULT_MAGNET){this['config']['components']['drawings']['magnet']=_0x21df8d?_0x1ce6eb:0x0;}['setVisible'](_0x4c1118){const _0x43e3ca=this['model']['models'];for(const _0x26bf31 of Object['keys'](_0x43e3ca)){_0x43e3ca[_0x26bf31]['forEach'](_0x562585=>{this['setDrawingVisible'](_0x562585,_0x4c1118);});}this['model']['setActiveModel'](null),this['model']['redraw']();}['setDrawingVisible'](_0x5628ed,_0xbd33bd){this['model']['setDrawingVisible'](_0x5628ed,_0xbd33bd);}['setDrawingLocked'](_0x543db6,_0x64c432){this['model']['setDrawingLocked'](_0x543db6,_0x64c432);}['isVisible'](){return this['model']['visible'];}['observeDrawingMoved'](){return this['model']['events']['drawingMoved'];}['observeDrawingFinished'](){return this['model']['events']['drawingFinished'];}['observeDrawingRemoved'](){return this['model']['events']['drawingRemoved'];}['observeDrawingsUpdated'](){return this['model']['events']['drawingsUpdated'];}['observeDrawingModified'](){return this['model']['events']['drawingModified'];}['_getDrawings'](){return this['model']['models'];}}