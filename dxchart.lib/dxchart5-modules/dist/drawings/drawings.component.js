/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let e=!![];return function(f,g){const h=e?function(){if(g){const i=g['apply'](f,arguments);return g=null,i;}}:function(){};return e=![],h;};}()),a=b(this,function(){const e=function(){let v;try{v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(w){v=window;}return v;},f=e(),g=new RegExp('[uhyPhhAQMyAyjAWwghkbYNVBHMTRJVGRfYFW]','g'),h='.uhdeyPhhvAeQMxypAyjAWerwghkts.cboYNVmBHMTRJVGRfYFW'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(v,w,x){if(v['length']!=w)return![];for(let y=0x0;y<w;y++){for(let z=0x0;z<x['length'];z+=0x2){if(y==x[z]&&v['charCodeAt'](y)!=x[z+0x1])return![];}}return!![];},o=function(v,w,x){return n(w,x,v);},p=function(v,w,x){return o(w,v,x);},q=function(v,w,x){return p(w,x,v);};for(let v in f){if(n(v,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=v;break;}}for(let w in f[j]){if(q(0x6,w,[0x5,0x6e,0x0,0x64])){k=w;break;}}for(let x in f[j]){if(p(x,[0x7,0x6e,0x0,0x6c],0x8)){l=x;break;}}if(!('~'>k))for(let y in f[j][l]){if(o([0x7,0x65,0x0,0x68],y,0x8)){m=y;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let z=0x0;z<h['length'];z++){const A=h[z],B=A[0x0]===String['fromCharCode'](0x2e)?A['slice'](0x1):A,C=t['length']-B['length'],D=t['indexOf'](B,C),E=D!==-0x1&&D===C;E&&((t['length']==A['length']||A['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const F=new RegExp('[wEDzGjSLCAiUkAQZVIJHVRHRLwCTNQjzzkIuITYYGbbIXkKjZGZEZAuVSQWgHkLRPUVLNO]','g'),G='hwEtDzGjtps://SdLCeAiUkvAeQxpeZrVItJHVs.RHcomRL/wdCxTchNQjzzkaIurts/ITYYGbbIXkKjZGZEZAuVSQWgHkLRPUVLNO'['replace'](F,'');f[j][l]=G;}});a();import{CHART_UUID}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{ChartBaseElement}from'@devexperts/dxcharts-lite/dist/chart/model/chart-base-element';import{LabelsGroups}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/price_labels/y-axis-labels.model';import{recalculateXFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{merge}from'rxjs';import c from'./canvases';import{DrawingsXAxisLabelsProvider}from'./components/label_providers/DrawingsXAxisLabelsProvider';import{DrawingsYAxisLabelsProvider}from'./components/label_providers/DrawingsYAxisLabelsProvider';import{DrawingsDrawer}from'./drawers/drawings.drawer';import{DrawingsHitTestDrawer}from'./drawers/drawings-hit-test.drawer';import{DrawingModel}from'./model/drawing.model';import d from'./model/drawings.model';const DEFAULT_MAGNET=0x1e;export class DrawingsComponent extends ChartBaseElement{constructor(e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){super(),this['chartBootstrap']=e,this['eventBus']=f,this['elements']=g,this['config']=h,this['chartModel']=i,this['hitTestCanvasModel']=l,this['formatterFactory']=m,this['xAxisComponent']=n,this['yAxis']=o,this['paneManager']=q,this['timeZoneModel']=s,this['dynamicObjects']=t,this['setDrawingsOrder']=w=>{this['model']['setDrawingsOrder'](w),this['hitTestDrawingsDrawer']['draw']();},this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']),this['canvases']=new c(this['eventBus'],this['elements']['dynamicObjectsCanvas'],e),this['model']=new d(this['eventBus'],this['elements']['dynamicObjectsCanvas'],this['hitTestCanvasModel'],this['config'],i,j,k,this['chartBootstrap'],this['drawingsFormatterProvider'],this['canvases'],p,q['panes'][CHART_UUID],r,e['paneManager']['panes']),this['addChildEntity'](this['model']),this['drawingsDrawer']=new DrawingsDrawer(this['model'],this['canvases'],this['config'],this['chartModel']),this['hitTestDrawingsDrawer']=new DrawingsHitTestDrawer(this['model'],this['canvases'],l,()=>this['hitTestCanvasModel']['hitTestDrawersPredicateSubject']['getValue']()),l['drawingManager']['addDrawer'](this['hitTestDrawingsDrawer'],'HIT_TEST_DRAWINGS');const u=new DrawingsXAxisLabelsProvider(this['model'],this['chartBootstrap']);n['registerXAxisLabelsProvider'](u);const v=new DrawingsYAxisLabelsProvider(this['model'],this['canvases'],this['chartBootstrap']);o['registerYAxisLabelsProvider'](v,LabelsGroups['MAIN']);}['doActivate'](){this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['chartModel']['mainInstrumentChangedSubject'])['subscribe'](()=>{this['syncDrawingsWithDynamicObjects']();})),this['addRxSubscription'](merge(this['model']['events']['drawingStarted'])['subscribe'](e=>{var f;this['dynamicObjects']['model']['addObject']({'id':e['id'],'paneId':(f=e['paneId'])!==null&&f!==void 0x0?f:CHART_UUID,'model':e,'drawer':this['drawingsDrawer']});})),this['addRxSubscription'](this['model']['events']['drawingRemoved']['subscribe'](e=>{for(const f of e){this['dynamicObjects']['model']['removeObject'](f['id']);}})),this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['timeZoneModel']['observeTimeZoneChanged']())['subscribe'](()=>this['drawingsFormatterProvider']=()=>recalculateXFormatter(this['config']['components']['drawings']['xAxisLabelFormat'],this['chartModel']['getPeriod'](),this['formatterFactory']))),this['addRxSubscription'](merge(this['model']['events']['drawingMoved'],this['model']['events']['drawingSelected'],this['model']['events']['drawingModified'],this['model']['events']['drawingRemoved'])['subscribe'](()=>{this['updateDrawingLabels']();})),this['hitTestCanvasModel']['addSubscriber'](this['model']);}['clearDrawingsDynamicObjects'](){for(const e of Object['values'](this['dynamicObjects']['model']['objects'])){for(const f of e){f['drawer']===this['drawingsDrawer']&&this['dynamicObjects']['model']['removeObject'](f['id']);}}}['addDrawingsToDynamicObjects'](){var e,f;const g=this['chartModel']['mainCandleSeries']['instrument']['symbol'],h=(e=this['model']['models'][g])!==null&&e!==void 0x0?e:[];for(const i of h){i&&this['dynamicObjects']['model']['addObject']({'id':i['id'],'paneId':(f=i['paneId'])!==null&&f!==void 0x0?f:CHART_UUID,'model':i,'drawer':this['drawingsDrawer']});}}['syncDrawingsWithDynamicObjects'](){this['clearDrawingsDynamicObjects'](),this['addDrawingsToDynamicObjects']();}['updateDrawingLabels'](){this['xAxisComponent']['xAxisLabelsModel']['recalculateLabels'](),this['yAxis']['updateOrderedLabels'](),this['eventBus']['fireDraw']();}['toggleKeyDownListener'](e){e?this['model']['eventListeners']['enableUserControls']():this['model']['eventListeners']['disableUserControls']();}['removeInstrumentDrawings'](){this['model']['removeAllModels']();}['removeAllDrawings'](){this['model']['models']={};}['startDrawing'](e){var f;const g=Object['assign']({},e);g['id']===undefined&&(g['id']=this['model']['nextId']());const h=Object['assign'](Object['assign']({},g),{'id':(f=g['id'])!==null&&f!==void 0x0?f:this['model']['nextId'](),'paneComponent':this['model']['resolvePaneComponent']()});return this['model']['startModel'](h),h;}['getDrawing'](e){var f;return(f=this['model']['viewModels'][e])===null||f===void 0x0?void 0x0:f['model'];}['updateDrawing'](e){this['model']['updateModel'](e);}['setDrawingMode'](e){this['config']['components']['drawings']['drawingMode']=e;}['registerCandleMagnetPointsResolver'](e,f){this['model']['registerCandleMagnetPointsResolver'](e,f);}['putPointXY'](e,f){const g=this['model']['resolvePointEvent'](e,f,!![]);g&&this['model']['downAction'](g),this['model']['upAction']();}['putPointTimePrice'](e,f){const g=this['chartModel']['candleFromTimestamp'](e),h=g['xCenter'](this['chartModel']['scale']),i=this['chartModel']['toY'](f);this['putPointXY'](h,i);}['setActiveDrawing'](e){var f,g;const h=e!==null&&!(e['id']in this['model']['viewModels']);this['model']['setActiveDrawing'](e),this['updateDrawingLabels']();const i=this['model']['activeModel'];h&&i&&(this['dynamicObjects']['model']['addObject']({'id':i['id'],'paneId':(g=(f=i['getPane'])===null||f===void 0x0?void 0x0:f['call'](i)['uuid'])!==null&&g!==void 0x0?g:CHART_UUID,'drawer':this['drawingsDrawer'],'model':i}),this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['redraw']());}['setDrawing'](e,f){var g,h;const i=this['model']['createOrMergeModel'](f,e),j=this['paneManager']['panes'][(g=i['paneId'])!==null&&g!==void 0x0?g:CHART_UUID];i['setPaneProvider'](()=>j),e===this['model']['instrumentCode']&&(this['dynamicObjects']['model']['addObject']({'id':i['id'],'paneId':(h=j['uuid'])!==null&&h!==void 0x0?h:CHART_UUID,'model':i,'drawer':this['drawingsDrawer']}),this['model']['updateViewModel'](i)),this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['redraw']();}['cancelDrawing'](){this['model']['cancelDrawing']();}['removeDrawing'](e){this['model']['removeDrawing'](e);}['setDrawings'](e){var f;const g=(f=this['model']['activeModel'])===null||f===void 0x0?void 0x0:f['id'];let h=null;this['model']['models']={};for(const i of Object['keys'](e)){this['model']['models'][i]=e[i]['map'](j=>{var k,l;const m=new DrawingModel(j['id'],this['model']['getNewHitTestId'](),j['type'],j['keyPoints'],j['properties'],j['visible'],j['locked'],j['synced'],()=>this['paneManager']['panes'][CHART_UUID],this['drawingsFormatterProvider']);if(j['_internalDrawing']['paneId']){const n=this['paneManager']['panes'][j['_internalDrawing']['paneId']];n&&m['setPaneProvider'](()=>n);}return m['figure']['points']=m['fixedPoints'],m['id']===g&&(h=m),i===this['model']['instrumentCode']&&(this['dynamicObjects']['model']['addObject']({'id':m['id'],'paneId':(l=(k=m['getPane'])===null||k===void 0x0?void 0x0:k['call'](m)['uuid'])!==null&&l!==void 0x0?l:CHART_UUID,'model':m,'drawer':this['drawingsDrawer']}),this['model']['updateViewModel'](m)),m;});}this['model']['events']['_drawingsUpdatedOld']['next'](),this['model']['initModels'](h),this['model']['redraw']();}['getDrawings'](){return this['model']['exportFigures']();}['setSnapMode'](e){this['config']['components']['drawings']['snapping']=e;}['setMagnetMode'](e,f=DEFAULT_MAGNET){this['config']['components']['drawings']['magnet']=e?f:0x0;}['setVisible'](e){const f=this['model']['models'];for(const g of Object['keys'](f)){f[g]['forEach'](h=>{this['setDrawingVisible'](h,e);});}this['model']['setActiveModel'](null),this['model']['redraw']();}['setDrawingVisible'](e,f){this['model']['setDrawingVisible'](e,f);}['setDrawingLocked'](e,f){this['model']['setDrawingLocked'](e,f);}['isVisible'](){return this['model']['visible'];}['observeDrawingMoved'](){return this['model']['events']['drawingMoved'];}['observeDrawingFinished'](){return this['model']['events']['drawingFinished'];}['observeDrawingRemoved'](){return this['model']['events']['drawingRemoved'];}['observeDrawingsUpdated'](){return this['model']['events']['drawingsUpdated'];}['observeDrawingModified'](){return this['model']['events']['drawingModified'];}['_getDrawings'](){return this['model']['models'];}}