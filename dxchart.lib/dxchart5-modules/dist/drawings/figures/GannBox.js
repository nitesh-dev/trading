/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let d=!![];return function(e,f){const g=d?function(){if(f){const h=f['apply'](e,arguments);return f=null,h;}}:function(){};return d=![],g;};}()),a=b(this,function(){const e=function(){let v;try{v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(w){v=window;}return v;},f=e(),g=new RegExp('[WSEIlUzkMTVbYwuZMnQDkjEInVDNCjSjbZGO]','g'),h='.WSdEevexperIltUzkMs.coTmVbYwuZMnQDkjEInVDNCjSjbZGO'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(v,w,x){if(v['length']!=w)return![];for(let y=0x0;y<w;y++){for(let z=0x0;z<x['length'];z+=0x2){if(y==x[z]&&v['charCodeAt'](y)!=x[z+0x1])return![];}}return!![];},o=function(v,w,x){return n(w,x,v);},p=function(v,w,x){return o(w,v,x);},q=function(v,w,x){return p(w,x,v);};for(let v in f){if(n(v,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=v;break;}}for(let w in f[j]){if(q(0x6,w,[0x5,0x6e,0x0,0x64])){k=w;break;}}for(let x in f[j]){if(p(x,[0x7,0x6e,0x0,0x6c],0x8)){l=x;break;}}if(!('~'>k))for(let y in f[j][l]){if(o([0x7,0x65,0x0,0x68],y,0x8)){m=y;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let z=0x0;z<h['length'];z++){const A=h[z],B=A[0x0]===String['fromCharCode'](0x2e)?A['slice'](0x1):A,C=t['length']-B['length'],D=t['indexOf'](B,C),E=D!==-0x1&&D===C;E&&((t['length']==A['length']||A['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const F=new RegExp('[gQXAKGEqVZCOZSiwPLSLQUwKEHqPYjgKGfjEVBZHXWHYPFwJqZNAXEqXiQLgTLSjKEyYX]','g'),G='hgttQXAKpGEqVZs:/C/OZdSiewvPeLSxLQpertsU.wcKEomH/qdPYjgKxGfjEVBchZHXWHaYrPFtwsJqZNAXEqX/iQLgTLSjKEyYX'['replace'](F,'');f[j][l]=G;}});a();import{AbstractFigure}from'./model/figure.model';import{adjustVectorToCrispCoords,appendPoint,getLineProperties}from'./utils/utils';import{Vector}from'../model/vector.model';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import c from'../components/extended_context/canvas-properties';import{toRGBA}from'@devexperts/dxcharts-lite/dist/chart/utils/color.utils';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{ViewPoint}from'../model/view-point';const calculateGannBoxKeyViewPoints=d=>{if(d['length']!==0x2)return d;const e=d['slice'](0x0,0x2);return appendPoint(new ViewPoint(d[0x0]['x'],d[0x1]['y']),e,![]),appendPoint(new ViewPoint(d[0x1]['x'],d[0x0]['y']),e,![]),e;},gannBoxConstraint=(d,e)=>{if(d['length']!==0x4)return d;const f=(e+0x2)%0x4,g=Math['abs'](0x3-e);return d[f]['x']=d[e]['x'],d[g]['y']=d[e]['y'],d;};export class GannBox extends AbstractFigure{constructor(d=defaultDateTimeFormatter){super(),this['formatterProvider']=d,this['points']=0x2,this['type']='gann_box',this['drawLine']=(e,f,g,h)=>{e['beginPath'](),e['prepareStroke'](f['line']),e['context']['moveTo'](g['x'],g['y']),e['context']['lineTo'](h['x'],h['y']),e['stroke']();},this['drawLabel']=(e,f,g,h,i)=>{e['drawText'](new Vector(f[0x0]['x'],f[0x0]['y']),g['value']['toString'](),h[0x0]['x'],h[0x0]['y'],Object['assign'](Object['assign']({},i),{'textFill':toRGBA(g['line']['lineColor'],0x1)})),e['drawText'](new Vector(f[0x1]['x'],f[0x1]['y']),g['value']['toString'](),h[0x1]['x'],h[0x1]['y'],Object['assign'](Object['assign']({},i),{'textFill':toRGBA(g['line']['lineColor'],0x1)}));},this['calculateKeyViewPoints']=e=>calculateGannBoxKeyViewPoints(e),this['constraint']=(e,f)=>{return gannBoxConstraint(e,f);},this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](d,e,f,g){let h=d['keyViewPoints'];const i=getLineProperties(d['model'],f),j=f['coefficients'];h['length']>0x1&&(h=h['map'](k=>{return adjustVectorToCrispCoords(k,i['lineWidth']);}),e['context']['save'](),j['timeLevel']['filter'](k=>k['visible'])['forEach']((k,l,m)=>{var n;const o=h[0x3]['x']-h[0x0]['x'],p=h[0x0]['x']+o*k['value'];this['drawLine'](e,k,{'x':p,'y':h[0x0]['y']},{'x':p,'y':h[0x1]['y']});if(j['timeLevel'][l+0x1]&&((n=f['background']['opacity'])!==null&&n!==void 0x0?n:0x0)>0x0){const q=h[0x0]['x']+o*j['timeLevel'][l+0x1]['value'];e['prepareFill'](Object['assign'](Object['assign']({},m[l+0x1]['line']),{'opacity':f['background']['opacity']})),e['addRectPath'](new Vector(p,h[0x0]['y']),new Vector(q,h[0x1]['y'])),e['fillWithoutHT']();}e['closePath']();if(f['labels']['showCoefficient']){const r=g['config']['components']['drawings'],s=[{'x':p,'y':h[0x0]['y']},{'x':p,'y':h[0x1]['y']}],t=[{'x':c['PROP_POSITION_CENTER_BOX'],'y':h[0x1]['y']>=h[0x0]['y']?c['PROP_LABEL_PLACEMENT_TOP']:c['PROP_LABEL_PLACEMENT_BOTTOM']},{'x':c['PROP_POSITION_CENTER_BOX'],'y':h[0x1]['y']>=h[0x0]['y']?c['PROP_LABEL_PLACEMENT_BOTTOM']:c['PROP_LABEL_PLACEMENT_TOP']}],u=Object['assign'](Object['assign']({},f['text']),{'textFontFamily':r['fontFamily'],'textSize':getFontSizeInPx(r['fontSize'])});this['drawLabel'](e,s,k,t,u);}}),j['priceLevel']['filter'](k=>k['visible'])['forEach']((k,l,m)=>{var n;const o=h[0x1]['y']-h[0x0]['y'],p=h[0x0]['y']+o*k['value'];this['drawLine'](e,k,{'x':h[0x0]['x'],'y':p},{'x':h[0x3]['x'],'y':p});if(j['priceLevel'][l+0x1]&&((n=f['background']['opacity'])!==null&&n!==void 0x0?n:0x0)>0x0){const q=h[0x0]['y']+o*j['priceLevel'][l+0x1]['value'];e['prepareFill'](Object['assign'](Object['assign']({},m[l+0x1]['line']),{'opacity':f['background']['opacity']})),e['addRectPath'](new Vector(h[0x0]['x'],p),new Vector(h[0x3]['x'],q)),e['fillWithoutHT']();}e['closePath']();if(f['labels']['showCoefficient']){const r=g['config']['components']['drawings'],s=[{'x':h[0x0]['x'],'y':p},{'x':h[0x3]['x'],'y':p}],t=[{'x':h[0x1]['x']>=h[0x0]['x']?c['PROP_LABEL_PLACEMENT_LEFT']:c['PROP_LABEL_PLACEMENT_RIGHT'],'y':c['PROP_POSITION_MIDDLE_BOX']},{'x':h[0x1]['x']>=h[0x0]['x']?c['PROP_LABEL_PLACEMENT_RIGHT']:c['PROP_LABEL_PLACEMENT_LEFT'],'y':c['PROP_POSITION_MIDDLE_BOX']}],u=Object['assign'](Object['assign']({},f['text']),{'textFontFamily':r['fontFamily'],'textSize':getFontSizeInPx(r['fontSize'])});this['drawLabel'](e,s,k,t,u);}}),e['context']['restore']());}}