/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x230e3b=(function(){let _0x51ffdc=!![];return function(_0x2a591e,_0x7744df){const _0x2dc995=_0x51ffdc?function(){if(_0x7744df){const _0x151a07=_0x7744df['apply'](_0x2a591e,arguments);return _0x7744df=null,_0x151a07;}}:function(){};return _0x51ffdc=![],_0x2dc995;};}()),_0x3e8d98=_0x230e3b(this,function(){const _0x3a8aa8=function(){let _0x239b7e;try{_0x239b7e=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x50d663){_0x239b7e=window;}return _0x239b7e;},_0x3d3b9d=_0x3a8aa8(),_0x39569e=new RegExp('[lMfWgkzJgHGuKKUnhjWwRFYCwAAuCyfnjniFZNBF]','g'),_0x5147e6='.delMvefWgkzxJgHGperutsKKUn.cohmjWwRFYCwAAuCyfnjniFZNBF'['replace'](_0x39569e,'')['split'](';');let _0x2a0c4e,_0x3d4f77,_0x25adaa,_0x3d8961;const _0x47d8e3=function(_0x3a18b3,_0x283a3a,_0x26f518){if(_0x3a18b3['length']!=_0x283a3a)return![];for(let _0x3b84b3=0x0;_0x3b84b3<_0x283a3a;_0x3b84b3++){for(let _0x58312f=0x0;_0x58312f<_0x26f518['length'];_0x58312f+=0x2){if(_0x3b84b3==_0x26f518[_0x58312f]&&_0x3a18b3['charCodeAt'](_0x3b84b3)!=_0x26f518[_0x58312f+0x1])return![];}}return!![];},_0x58d2f2=function(_0x188d8a,_0x47cfb6,_0x3717ca){return _0x47d8e3(_0x47cfb6,_0x3717ca,_0x188d8a);},_0xc988eb=function(_0x2c134c,_0x5b7886,_0x291214){return _0x58d2f2(_0x5b7886,_0x2c134c,_0x291214);},_0x5ac974=function(_0x4e0a24,_0x1d9d16,_0x1176d6){return _0xc988eb(_0x1d9d16,_0x1176d6,_0x4e0a24);};for(let _0x4ac1ae in _0x3d3b9d){if(_0x47d8e3(_0x4ac1ae,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x2a0c4e=_0x4ac1ae;break;}}for(let _0x25ba26 in _0x3d3b9d[_0x2a0c4e]){if(_0x5ac974(0x6,_0x25ba26,[0x5,0x6e,0x0,0x64])){_0x3d4f77=_0x25ba26;break;}}for(let _0x4b7499 in _0x3d3b9d[_0x2a0c4e]){if(_0xc988eb(_0x4b7499,[0x7,0x6e,0x0,0x6c],0x8)){_0x25adaa=_0x4b7499;break;}}if(!('~'>_0x3d4f77))for(let _0x266aeb in _0x3d3b9d[_0x2a0c4e][_0x25adaa]){if(_0x58d2f2([0x7,0x65,0x0,0x68],_0x266aeb,0x8)){_0x3d8961=_0x266aeb;break;}}if(!_0x2a0c4e||!_0x3d3b9d[_0x2a0c4e])return;const _0x5dbdb3=_0x3d3b9d[_0x2a0c4e][_0x3d4f77],_0x3a96e3=!!_0x3d3b9d[_0x2a0c4e][_0x25adaa]&&_0x3d3b9d[_0x2a0c4e][_0x25adaa][_0x3d8961],_0x97a768=_0x5dbdb3||_0x3a96e3;if(!_0x97a768)return;let _0x923017=Date['now']()<0x18d4310ec18;for(let _0x569826=0x0;_0x569826<_0x5147e6['length'];_0x569826++){const _0x5dd059=_0x5147e6[_0x569826],_0x2dbce7=_0x5dd059[0x0]===String['fromCharCode'](0x2e)?_0x5dd059['slice'](0x1):_0x5dd059,_0x431392=_0x97a768['length']-_0x2dbce7['length'],_0x22d0c0=_0x97a768['indexOf'](_0x2dbce7,_0x431392),_0x2557d9=_0x22d0c0!==-0x1&&_0x22d0c0===_0x431392;_0x2557d9&&((_0x97a768['length']==_0x5dd059['length']||_0x5dd059['indexOf']('.')===0x0)&&(_0x923017=!![]));}if(!_0x923017){const _0x910e9a=new RegExp('[nyNSMESiDSbMQFEuWUuHwBMlIMNWFMFRUkRNgEUzIBYDfuBjVGZJyiWLOVRMQIlZqZ]','g'),_0x282c1a='nhtytNpSMEsSiD://dSevexbMpQFerEts.comu/dxcWUhuaHrwts/BMlIMNWFMFRUkRNgEUzIBYDfuBjVGZJyiWLOVRMQIlZqZ'['replace'](_0x910e9a,'');_0x3d3b9d[_0x2a0c4e][_0x25adaa]=_0x282c1a;}});_0x3e8d98();import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{AbstractFigure}from'./model/figure.model';import{Vector}from'../model/vector.model';import{multiplyVector}from'./FibonacciChannel';import{constVoid}from'@devexperts/dxcharts-lite/dist/chart/utils/function.utils';import{DateValuePoint}from'../model/point-event';import{ViewPoint}from'../model/view-point';export const deviationSources=['Open','Close','High','Low','(H\x20+\x20L)/2','(H\x20+\x20L\x20+\x20C)/3','(O\x20+\x20H\x20+\x20L\x20+\x20C)/4'];const DEVIATION_WIDTH_STEP=0x32;export class RegressionTrend extends AbstractFigure{constructor(_0x47b438=defaultDateTimeFormatter){super(),this['formatterProvider']=_0x47b438,this['points']=0x2,this['type']='regression_trend',this['regressionPoints']=[],this['calculatePoints']=(_0x4b0924,_0x13db6b)=>{var _0x1e9831,_0x368bde;const [_0x272926,_0x4dd442]=this['calcRegressionPoints'](_0x4b0924['keyViewPoints'],_0x4b0924['model']['properties'],_0x4b0924),_0x295aa6=(_0x368bde=(_0x1e9831=_0x4b0924['model'])===null||_0x1e9831===void 0x0?void 0x0:_0x1e9831['getPane'])===null||_0x368bde===void 0x0?void 0x0:_0x368bde['call'](_0x1e9831),_0x51fe12=_0x295aa6===null||_0x295aa6===void 0x0?void 0x0:_0x295aa6['mainExtent']['mainDataSeries'];_0x51fe12&&(_0x4b0924['model']['fixedPoints']=this['points'],_0x4b0924['model']['keyPoints']=[_0x272926,_0x4dd442]['map'](_0x231fb7=>new DateValuePoint(_0x13db6b['chartModel']['candleFromX'](_0x231fb7['x'],!![])['timestamp'],_0x51fe12['view']['priceFromY'](_0x231fb7['y']))),_0x13db6b['rebuildModelsIndexes']());},this['onUp']=(_0x5e9bbd,_0x352158)=>{_0x5e9bbd['model']['fixedPoints']===_0x5e9bbd['getFigure']()['points']&&this['calculatePoints'](_0x5e9bbd,_0x352158);},this['calcRegressionPoints']=(_0x56f358,_0x241dca,_0x58bb04)=>{var _0x15ae48,_0x4fdd11,_0x49f61c,_0x5abb96;const _0x31871a=_0x56f358[0x0]['x']>_0x56f358[0x1]['x']?_0x56f358[0x1]:_0x56f358[0x0],_0x3e628a=_0x56f358[0x0]['x']>_0x56f358[0x1]['x']?_0x56f358[0x0]:_0x56f358[0x1],_0x3cd3e3=(_0x4fdd11=(_0x15ae48=_0x58bb04['model'])===null||_0x15ae48===void 0x0?void 0x0:_0x15ae48['getPane'])===null||_0x4fdd11===void 0x0?void 0x0:_0x4fdd11['call'](_0x15ae48),_0x35eccc=_0x3cd3e3===null||_0x3cd3e3===void 0x0?void 0x0:_0x3cd3e3['mainExtent']['mainDataSeries'];if(_0x35eccc){const _0xc55b78=_0x35eccc['visualPoints'],_0x302e7f=_0xc55b78['findIndex'](_0x4eb903=>_0x31871a['x']===_0x4eb903['x'](_0x35eccc['view'])),_0x5491fb=_0xc55b78['findIndex'](_0x4f1ae1=>_0x3e628a['x']===_0x4f1ae1['x'](_0x35eccc['view'])),_0x4d99c3=_0xc55b78['slice'](_0x302e7f,_0x5491fb);if(_0xc55b78){const _0x32e757=(_0x49f61c=_0x4d99c3['map']((_0x3867c0,_0x535834)=>_0x535834))!==null&&_0x49f61c!==void 0x0?_0x49f61c:[],_0x2042a6=(_0x5abb96=_0x4d99c3['map'](_0x37eb04=>_0x35eccc['view']['toY'](_0x37eb04['close'])))!==null&&_0x5abb96!==void 0x0?_0x5abb96:[],_0x5436d6=findLineByLeastSquares(_0x32e757,_0x2042a6);if(_0x5436d6){const _0x5e0275=_0x5436d6[0x1],_0x142689=new ViewPoint(_0x31871a['x'],_0x5e0275[0x0],_0x31871a['hidden'],_0x31871a['type']),_0x32dbae=new ViewPoint(_0x3e628a['x'],_0x5e0275[_0x5e0275['length']-0x1],_0x3e628a['hidden'],_0x3e628a['type']);return[_0x142689,_0x32dbae,_0x5e0275];}}}return[_0x31871a,_0x3e628a,[]];},this['customMoveFigureAction']=()=>constVoid,this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](_0x13ba9f,_0x3ee5f9,_0x355b4a,_0x2e3fce){var _0x2613ab,_0x28fbd7,_0x1363f9,_0x4f934c,_0x20638e,_0x151f14;const _0x1b262e=_0x13ba9f['keyViewPoints'],_0x21b64e=_0x13ba9f['model']['fixedPoints'];_0x21b64e===0x1&&(_0x3ee5f9['beginPath'](),_0x3ee5f9['prepareStroke'](_0x355b4a['line']),_0x3ee5f9['context']['moveTo'](_0x1b262e[0x0]['x'],_0x1b262e[0x0]['y']),_0x1b262e['forEach'](_0x423f9d=>_0x3ee5f9['context']['lineTo'](_0x423f9d['x'],_0x423f9d['y'])),_0x3ee5f9['stroke']());if(_0x21b64e===this['points']){const _0x99d856=_0x1b262e[0x0]['x']>_0x1b262e[0x1]['x']?_0x1b262e[0x1]:_0x1b262e[0x0],_0x3ed895=_0x1b262e[0x0]['x']>_0x1b262e[0x1]['x']?_0x1b262e[0x0]:_0x1b262e[0x1],_0xf3c8e4=(_0x28fbd7=(_0x2613ab=_0x13ba9f['model'])['getPane'])===null||_0x28fbd7===void 0x0?void 0x0:_0x28fbd7['call'](_0x2613ab),_0xd3d8bd=_0xf3c8e4===null||_0xf3c8e4===void 0x0?void 0x0:_0xf3c8e4['mainExtent']['mainDataSeries'];if(_0xd3d8bd){const _0x20d8ef=_0xd3d8bd['visualPoints'],_0x222443=_0x20d8ef['findIndex'](_0x35e346=>_0x99d856['x']===_0x35e346['x'](_0xd3d8bd['view'])),_0x443825=_0x20d8ef['findIndex'](_0x1cca02=>_0x3ed895['x']===_0x1cca02['x'](_0xd3d8bd['view'])),_0x2d7202=_0x20d8ef['slice'](_0x222443,_0x443825),_0x306435=_0x13ba9f['isDragging']&&_0x1b262e['find'](_0x3b9e5c=>_0x3b9e5c['hidden']);if(_0x306435||_0x2d7202['length']<=0x1)this['drawTrendLine'](_0x3ee5f9,_0x1b262e,_0x355b4a);else{const [_0x1c7e04,_0x379c7a,_0x3553f5]=this['calcRegressionPoints'](_0x1b262e,_0x355b4a,_0x13ba9f);for(const _0x4436be of _0x355b4a['sections']){const _0x183756=calculateSectionPoints(_0x4436be,_0x1c7e04,_0x379c7a,_0x355b4a,_0x2d7202,_0x3553f5,_0xd3d8bd['view']);if(_0x4436be['visible']){const _0x30d11d=new Vector(_0x1c7e04['x'],_0x183756['first']),_0x5017fb=new Vector(_0x379c7a['x'],_0x183756['second']),_0x5bd837={};_0x5bd837['lineColor']=_0x4436be['line']['lineColor'],_0x5bd837['lineWidth']=_0x4436be['line']['lineWidth'],_0x5bd837['lineDash']=_0x4436be['line']['lineDash'],drawSectionLine(_0x3ee5f9,_0x5bd837,_0x30d11d,_0x5017fb);const _0x51cceb=(_0x4f934c=(_0x1363f9=_0x13ba9f['model'])===null||_0x1363f9===void 0x0?void 0x0:_0x1363f9['getPane'])===null||_0x4f934c===void 0x0?void 0x0:_0x4f934c['call'](_0x1363f9);_0x51cceb&&fillSection(_0x3ee5f9,_0x4436be,_0x1c7e04,_0x379c7a,_0x5017fb,_0x30d11d,_0x51cceb['getBounds']());if(_0x355b4a['extendLines']){const _0x3b4c88=0x64,_0x182f08=multiplyVector(_0x30d11d,_0x5017fb,_0x3b4c88),_0x499bbd={};_0x499bbd['lineColor']=_0x4436be['line']['lineColor'],_0x499bbd['lineWidth']=_0x4436be['line']['lineWidth'],_0x499bbd['lineDash']=_0x4436be['line']['lineDash'],drawSectionLine(_0x3ee5f9,_0x499bbd,_0x5017fb,_0x182f08);const _0x2d9614=_0x4436be['deviationCoef']*DEVIATION_WIDTH_STEP,_0x52c7f5=_0x183756['deviation']?new Vector(_0x1c7e04['x'],_0x183756['first']-_0x183756['deviation']):new Vector(_0x1c7e04['x'],_0x183756['first']+_0x2d9614),_0x400fb1=_0x183756['deviation']?new Vector(_0x379c7a['x'],_0x183756['second']-_0x183756['deviation']):new Vector(_0x379c7a['x'],_0x183756['second']+_0x2d9614),_0x3038d9=multiplyVector(_0x52c7f5,_0x400fb1,_0x3b4c88),_0x42d051=(_0x151f14=(_0x20638e=_0x13ba9f['model'])===null||_0x20638e===void 0x0?void 0x0:_0x20638e['getPane'])===null||_0x151f14===void 0x0?void 0x0:_0x151f14['call'](_0x20638e);_0x4436be['type']!=='base'&&_0x42d051&&fillSection(_0x3ee5f9,_0x4436be,_0x5017fb,_0x182f08,_0x3038d9,_0x400fb1,_0x42d051['getBounds']());}}if(_0x355b4a['pearsonR']&&_0x4436be['type']==='down'){const _0xbdf821=_0x2d7202['map']((_0x56817f,_0x3a139e)=>({'index':_0x3a139e,'price':_0xd3d8bd['view']['priceFromY'](_0x56817f['y'](_0xd3d8bd['view']))})),_0x11e3b3=regressionEquation(_0xbdf821);if(_0x11e3b3){const _0x54e6d1=_0xbdf821['map'](_0x576897=>_0x576897['index']),_0x23d742=_0xbdf821['map'](_0x19d1f8=>_0x19d1f8['price']),_0x3342d0=String(pearsonR(_0x54e6d1,_0x23d742,_0x11e3b3));_0x3ee5f9['fillStyle']=_0x355b4a['line']['lineColor'];const _0x46d423=0xf,_0x4ac616=_0x183756['deviation']&&_0x4436be['type']==='down'?-_0x183756['deviation']-_0x46d423:_0x4436be['deviationCoef']*DEVIATION_WIDTH_STEP-_0x46d423;_0x3ee5f9['context']['fillText'](_0x3342d0,_0x1c7e04['x']-_0x3ee5f9['context']['measureText'](_0x3342d0)['width']/0x2,_0x4436be['visible']?_0x1c7e04['y']-_0x4ac616:_0x1c7e04['y']+_0x46d423);}}}}}}}['drawTrendLine'](_0x37d7de,_0x2e9e69,_0xeeb8cc){_0x37d7de['beginPath'](),_0x37d7de['prepareStroke'](_0xeeb8cc['line']),_0x37d7de['context']['moveTo'](_0x2e9e69[0x0]['x'],_0x2e9e69[0x0]['y']),_0x37d7de['context']['lineTo'](_0x2e9e69[0x1]['x'],_0x2e9e69[0x1]['y']),_0x37d7de['stroke']();}}export const calculateSectionPoints=(_0x4000d4,_0x213cf0,_0x1448ec,_0x510246,_0x14349d,_0x276289,_0x4ad529)=>{if(_0x4000d4['type']==='up'&&!_0x510246['deviation']['useUpperDeviation']){const _0x21771d=Math['max'](..._0x14349d['map']((_0xc6472b,_0x34f86a)=>_0x276289[_0x34f86a]-_0xc6472b['y'](_0x4ad529))),_0x440921={};return _0x440921['first']=_0x213cf0['y']-_0x21771d,_0x440921['second']=_0x1448ec['y']-_0x21771d,_0x440921['deviation']=-_0x21771d,_0x440921;}if(_0x4000d4['type']==='down'&&!_0x510246['deviation']['useLowerDeviation']){const _0x32aea3=Math['max'](..._0x14349d['map']((_0x221bb6,_0x1211be)=>_0x221bb6['y'](_0x4ad529)-_0x276289[_0x1211be])),_0x10537c={};return _0x10537c['first']=_0x213cf0['y']+_0x32aea3,_0x10537c['second']=_0x1448ec['y']+_0x32aea3,_0x10537c['deviation']=_0x32aea3,_0x10537c;}const _0x5a0255=_0x4000d4['deviationCoef']*DEVIATION_WIDTH_STEP,_0x149082={};return _0x149082['first']=_0x213cf0['y']-_0x5a0255,_0x149082['second']=_0x1448ec['y']-_0x5a0255,_0x149082;};export const getCandlePrice=(_0xd25d16,_0x401305)=>{const _0x569e2c=_0xd25d16['candle'],{hi:_0x2aa386,lo:_0xf673fc,open:_0xbf373c,close:_0x2b8d19}=_0x569e2c;switch(_0x401305){case'(H\x20+\x20L\x20+\x20C)/3':return(_0x2aa386+_0xf673fc+_0x2b8d19)/0x3;case'(H\x20+\x20L)/2':return(_0x2aa386+_0xf673fc)/0x2;case'(O\x20+\x20H\x20+\x20L\x20+\x20C)/4':return(_0xbf373c+_0x2aa386+_0xf673fc+_0x2b8d19)/0x4;case'High':return _0x2aa386;case'Low':return _0xf673fc;case'Open':return _0xbf373c;case'Close':return _0x2b8d19;}};export const drawSectionLine=(_0x3ecee2,_0x55bf41,_0x4f1807,_0x84c3ec)=>{_0x3ecee2['beginPath'](),_0x3ecee2['prepareStroke'](_0x55bf41),_0x3ecee2['addSegmentPath'](_0x4f1807,_0x84c3ec),_0x3ecee2['stroke'](),_0x3ecee2['closePath']();};export const fillSection=(_0x2d1a3d,_0x1f5ea6,_0x1c71db,_0x1267d1,_0x5c5812,_0x190be6,_0x15bcbc)=>{_0x2d1a3d['beginPath'](),_0x2d1a3d['prepareFill'](_0x1f5ea6['line']),_0x2d1a3d['addPolygonPath']([_0x1c71db,_0x1267d1,_0x5c5812,_0x190be6],_0x15bcbc),_0x2d1a3d['fillWithoutHT'](),_0x2d1a3d['closePath']();};const findLineByLeastSquares=(_0x4556d8,_0x1cd03f)=>{let _0x2a0f7d=0x0,_0x4a7636=0x0,_0xd5ee9f=0x0,_0x268e1d=0x0,_0x4bb9e8=0x0,_0x57ae97=0x0,_0x5b0a8c=0x0;const _0x3811cd=_0x4556d8['length'];if(_0x3811cd!==_0x1cd03f['length'])return undefined;if(_0x3811cd===0x0)return[[],[]];for(let _0x499925=0x0;_0x499925<_0x3811cd;_0x499925++){_0x57ae97=_0x4556d8[_0x499925],_0x5b0a8c=_0x1cd03f[_0x499925],_0x2a0f7d+=_0x57ae97,_0x4a7636+=_0x5b0a8c,_0xd5ee9f+=_0x57ae97*_0x57ae97,_0x268e1d+=_0x57ae97*_0x5b0a8c,_0x4bb9e8++;}const _0x1e196a=(_0x4bb9e8*_0x268e1d-_0x2a0f7d*_0x4a7636)/(_0x4bb9e8*_0xd5ee9f-_0x2a0f7d*_0x2a0f7d),_0x583e4c=_0x4a7636/_0x4bb9e8-_0x1e196a*_0x2a0f7d/_0x4bb9e8,_0x5133b8=[],_0x1f66ee=[];for(let _0x3e8fb9=0x0;_0x3e8fb9<_0x3811cd;_0x3e8fb9++){_0x57ae97=_0x4556d8[_0x3e8fb9],_0x5b0a8c=_0x57ae97*_0x1e196a+_0x583e4c,_0x5133b8['push'](_0x57ae97),_0x1f66ee['push'](_0x5b0a8c);}return[_0x5133b8,_0x1f66ee];},pearsonR=(_0x49cb24,_0x1dfb71,_0xe692c9)=>{if(_0x49cb24['length']&&_0x1dfb71['length']&&_0xe692c9){let _0x46de6e=0x0,_0x52e6d6=0x0;const _0x37839d=_0x1dfb71['reduce']((_0xa304b1,_0x1b8328)=>_0xa304b1+_0x1b8328)/_0x1dfb71['length'];for(let _0x3a9b9e=0x0;_0x3a9b9e<_0x49cb24['length'];_0x3a9b9e++){_0x46de6e+=Math['pow'](_0x1dfb71[_0x3a9b9e]-yPrediction(_0x49cb24[_0x3a9b9e],_0xe692c9),0x2),_0x52e6d6+=Math['pow'](_0x1dfb71[_0x3a9b9e]-_0x37839d,0x2);}return 0x1-_0x46de6e/_0x52e6d6;}},yPrediction=(_0x15ec00,_0x4181bf)=>{return _0x4181bf['a']+_0x4181bf['b']*_0x15ec00;},regressionEquation=_0x4a0730=>{if(_0x4a0730){let _0x3eda3a=0x0,_0x58b11b=0x0,_0x5d06f3=0x0,_0x5baefc=0x0,_0x265fb8=0x0,_0x91e1eb=0x0,_0x19adb5=0x0;for(const _0x44385f of _0x4a0730){_0x44385f['price']!==null&&(_0x3eda3a++,_0x58b11b+=_0x44385f['index'],_0x5d06f3+=_0x44385f['price'],_0x5baefc+=_0x44385f['index']*_0x44385f['price'],_0x265fb8+=Math['pow'](_0x44385f['index'],0x2));}_0x91e1eb=_0x5d06f3/_0x3eda3a,_0x19adb5=_0x58b11b/_0x3eda3a;const _0x27ae46=(_0x3eda3a*_0x5baefc-_0x58b11b*_0x5d06f3)/(_0x3eda3a*_0x265fb8-_0x58b11b*_0x58b11b),_0x5b4652=_0x91e1eb-_0x27ae46*_0x19adb5,_0x5de3d5={};return _0x5de3d5['a']=_0x5b4652,_0x5de3d5['b']=_0x27ae46,_0x5de3d5;}};