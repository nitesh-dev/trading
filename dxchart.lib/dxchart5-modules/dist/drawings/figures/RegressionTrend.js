/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x1ee5b2=(function(){let _0x5a1b97=!![];return function(_0x14dab2,_0x175a0e){const _0x1cc635=_0x5a1b97?function(){if(_0x175a0e){const _0x4659fb=_0x175a0e['apply'](_0x14dab2,arguments);return _0x175a0e=null,_0x4659fb;}}:function(){};return _0x5a1b97=![],_0x1cc635;};}()),_0x9a6e75=_0x1ee5b2(this,function(){let _0x2c84ce;try{const _0x29bd9d=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x2c84ce=_0x29bd9d();}catch(_0x2986bc){_0x2c84ce=window;}const _0x3db2fb=new RegExp('[KqquGCQJREkQPYgqEKSjKXhUYEYBXjMylRPiCVz]','g'),_0x1afa1f='K.qdevequGCQxJperREktQPYsg.comqEKSjKXhUYEYBXjMylRPiCVz'['replace'](_0x3db2fb,'')['split'](';');let _0x5705e7,_0x336edb,_0x3f04ec,_0x25ceef;const _0x29490b=function(_0x13fc56,_0x5cecac,_0x366bf7){if(_0x13fc56['length']!=_0x5cecac)return![];for(let _0x1a57cd=0x0;_0x1a57cd<_0x5cecac;_0x1a57cd++){for(let _0x382420=0x0;_0x382420<_0x366bf7['length'];_0x382420+=0x2){if(_0x1a57cd==_0x366bf7[_0x382420]&&_0x13fc56['charCodeAt'](_0x1a57cd)!=_0x366bf7[_0x382420+0x1])return![];}}return!![];},_0x55a294=function(_0x16fa4f,_0x47cdda,_0x28ff98){return _0x29490b(_0x47cdda,_0x28ff98,_0x16fa4f);},_0x3e0a89=function(_0x1f61f3,_0x184cdb,_0x52ea04){return _0x55a294(_0x184cdb,_0x1f61f3,_0x52ea04);},_0x28322a=function(_0x3aecd4,_0x53e89c,_0x5a01b7){return _0x3e0a89(_0x53e89c,_0x5a01b7,_0x3aecd4);};for(let _0x5ea133 in _0x2c84ce){if(_0x29490b(_0x5ea133,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5705e7=_0x5ea133;break;}}for(let _0xf2712a in _0x2c84ce[_0x5705e7]){if(_0x28322a(0x6,_0xf2712a,[0x5,0x6e,0x0,0x64])){_0x336edb=_0xf2712a;break;}}for(let _0x4ba880 in _0x2c84ce[_0x5705e7]){if(_0x3e0a89(_0x4ba880,[0x7,0x6e,0x0,0x6c],0x8)){_0x3f04ec=_0x4ba880;break;}}if(!('~'>_0x336edb))for(let _0x7a2949 in _0x2c84ce[_0x5705e7][_0x3f04ec]){if(_0x55a294([0x7,0x65,0x0,0x68],_0x7a2949,0x8)){_0x25ceef=_0x7a2949;break;}}if(!_0x5705e7||!_0x2c84ce[_0x5705e7])return;const _0x3a6108=_0x2c84ce[_0x5705e7][_0x336edb],_0x506f71=!!_0x2c84ce[_0x5705e7][_0x3f04ec]&&_0x2c84ce[_0x5705e7][_0x3f04ec][_0x25ceef],_0x1cd3cf=_0x3a6108||_0x506f71;if(!_0x1cd3cf)return;let _0x6fbaac=Date['now']()<0x18cfaf7e418;for(let _0x28d878=0x0;_0x28d878<_0x1afa1f['length'];_0x28d878++){const _0x4ce4e8=_0x1afa1f[_0x28d878],_0x64a0b5=_0x4ce4e8[0x0]===String['fromCharCode'](0x2e)?_0x4ce4e8['slice'](0x1):_0x4ce4e8,_0x45d164=_0x1cd3cf['length']-_0x64a0b5['length'],_0x48236c=_0x1cd3cf['indexOf'](_0x64a0b5,_0x45d164),_0x4ee4b1=_0x48236c!==-0x1&&_0x48236c===_0x45d164;_0x4ee4b1&&((_0x1cd3cf['length']==_0x4ce4e8['length']||_0x4ce4e8['indexOf']('.')===0x0)&&(_0x6fbaac=!![]));}if(!_0x6fbaac){const _0x17f96f=new RegExp('[ZwRIJuVVBHgVRbVqfCZTfjkqzMyXOUYPgAMMuRMngSMViPjKDVZVXWlzQjQOWzVVzGOIMIOQ]','g'),_0x5466aa='ZhwRtItJupsV:V/B/dHevgVRexpbVeqfrtCZTsf.cjokmq/zMdxcyhXarOUYtPsg/AMMuRMngSMViPjKDVZVXWlzQjQOWzVVzGOIMIOQ'['replace'](_0x17f96f,'');_0x2c84ce[_0x5705e7][_0x3f04ec]=_0x5466aa;}});_0x9a6e75();import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{AbstractFigure}from'./model/figure.model';import{Vector}from'../model/vector.model';import{multiplyVector}from'./FibonacciChannel';import{constVoid}from'@devexperts/dxcharts-lite/dist/chart/utils/function.utils';import{DateValuePoint}from'../model/point-event';import{ViewPoint}from'../model/view-point';export const deviationSources=['Open','Close','High','Low','(H\x20+\x20L)/2','(H\x20+\x20L\x20+\x20C)/3','(O\x20+\x20H\x20+\x20L\x20+\x20C)/4'];const DEVIATION_WIDTH_STEP=0x32;export class RegressionTrend extends AbstractFigure{constructor(_0x3225de=defaultDateTimeFormatter){super(),this['formatterProvider']=_0x3225de,this['points']=0x2,this['type']='regression_trend',this['regressionPoints']=[],this['calculatePoints']=(_0x54ae30,_0xa29275)=>{var _0x57b9aa,_0x3bd683;const [_0x3f6998,_0x3b82d1]=this['calcRegressionPoints'](_0x54ae30['keyViewPoints'],_0x54ae30['model']['properties'],_0x54ae30),_0x408178=(_0x3bd683=(_0x57b9aa=_0x54ae30['model'])===null||_0x57b9aa===void 0x0?void 0x0:_0x57b9aa['getPane'])===null||_0x3bd683===void 0x0?void 0x0:_0x3bd683['call'](_0x57b9aa),_0x31e9a2=_0x408178===null||_0x408178===void 0x0?void 0x0:_0x408178['mainExtent']['mainDataSeries'];_0x31e9a2&&(_0x54ae30['model']['fixedPoints']=this['points'],_0x54ae30['model']['keyPoints']=[_0x3f6998,_0x3b82d1]['map'](_0x2bb943=>new DateValuePoint(_0xa29275['chartModel']['candleFromX'](_0x2bb943['x'],!![])['timestamp'],_0x31e9a2['view']['priceFromY'](_0x2bb943['y']))),_0xa29275['rebuildModelsIndexes']());},this['onUp']=(_0x347be4,_0x1e9ad6)=>{_0x347be4['model']['fixedPoints']===_0x347be4['getFigure']()['points']&&this['calculatePoints'](_0x347be4,_0x1e9ad6);},this['calcRegressionPoints']=(_0x2a992e,_0x24682c,_0x1d1e37)=>{var _0x2ba627,_0x4cf54b,_0x2d9f7c,_0x5c88cb;const _0x3334d6=_0x2a992e[0x0]['x']>_0x2a992e[0x1]['x']?_0x2a992e[0x1]:_0x2a992e[0x0],_0xd3579d=_0x2a992e[0x0]['x']>_0x2a992e[0x1]['x']?_0x2a992e[0x0]:_0x2a992e[0x1],_0x15b445=(_0x4cf54b=(_0x2ba627=_0x1d1e37['model'])===null||_0x2ba627===void 0x0?void 0x0:_0x2ba627['getPane'])===null||_0x4cf54b===void 0x0?void 0x0:_0x4cf54b['call'](_0x2ba627),_0x63596d=_0x15b445===null||_0x15b445===void 0x0?void 0x0:_0x15b445['mainExtent']['mainDataSeries'];if(_0x63596d){const _0x4c1829=_0x63596d['visualPoints'],_0x1162f0=_0x4c1829['findIndex'](_0x3c428e=>_0x3334d6['x']===_0x3c428e['x'](_0x63596d['view'])),_0x4d5d36=_0x4c1829['findIndex'](_0x295af4=>_0xd3579d['x']===_0x295af4['x'](_0x63596d['view'])),_0x23c4ac=_0x4c1829['slice'](_0x1162f0,_0x4d5d36);if(_0x4c1829){const _0x37f02f=(_0x2d9f7c=_0x23c4ac['map']((_0x2411b6,_0x4afeed)=>_0x4afeed))!==null&&_0x2d9f7c!==void 0x0?_0x2d9f7c:[],_0x1a601e=(_0x5c88cb=_0x23c4ac['map'](_0x51175c=>_0x63596d['view']['toY'](_0x51175c['close'])))!==null&&_0x5c88cb!==void 0x0?_0x5c88cb:[],_0x3c0cce=findLineByLeastSquares(_0x37f02f,_0x1a601e);if(_0x3c0cce){const _0xbadb7e=_0x3c0cce[0x1],_0x475046=new ViewPoint(_0x3334d6['x'],_0xbadb7e[0x0],_0x3334d6['hidden'],_0x3334d6['type']),_0x27511f=new ViewPoint(_0xd3579d['x'],_0xbadb7e[_0xbadb7e['length']-0x1],_0xd3579d['hidden'],_0xd3579d['type']);return[_0x475046,_0x27511f,_0xbadb7e];}}}return[_0x3334d6,_0xd3579d,[]];},this['customMoveFigureAction']=()=>constVoid,this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](_0x50aefc,_0x130aae,_0x3f2617,_0x4c0a3b){var _0x1dc650,_0x203446,_0x3e80cd,_0x4ae51b,_0x598be9,_0x4c9f01;const _0x306a27=_0x50aefc['keyViewPoints'],_0x46e64c=_0x50aefc['model']['fixedPoints'];_0x46e64c===0x1&&(_0x130aae['beginPath'](),_0x130aae['prepareStroke'](_0x3f2617['line']),_0x130aae['context']['moveTo'](_0x306a27[0x0]['x'],_0x306a27[0x0]['y']),_0x306a27['forEach'](_0x4f8e1f=>_0x130aae['context']['lineTo'](_0x4f8e1f['x'],_0x4f8e1f['y'])),_0x130aae['stroke']());if(_0x46e64c===this['points']){const _0x3bb6e2=_0x306a27[0x0]['x']>_0x306a27[0x1]['x']?_0x306a27[0x1]:_0x306a27[0x0],_0x5e0327=_0x306a27[0x0]['x']>_0x306a27[0x1]['x']?_0x306a27[0x0]:_0x306a27[0x1],_0x418be6=(_0x203446=(_0x1dc650=_0x50aefc['model'])['getPane'])===null||_0x203446===void 0x0?void 0x0:_0x203446['call'](_0x1dc650),_0x571ed9=_0x418be6===null||_0x418be6===void 0x0?void 0x0:_0x418be6['mainExtent']['mainDataSeries'];if(_0x571ed9){const _0x1127fd=_0x571ed9['visualPoints'],_0x4665e9=_0x1127fd['findIndex'](_0xfc5b44=>_0x3bb6e2['x']===_0xfc5b44['x'](_0x571ed9['view'])),_0x2d5840=_0x1127fd['findIndex'](_0x4e4845=>_0x5e0327['x']===_0x4e4845['x'](_0x571ed9['view'])),_0x16046c=_0x1127fd['slice'](_0x4665e9,_0x2d5840),_0x22d475=_0x50aefc['isDragging']&&_0x306a27['find'](_0x371de1=>_0x371de1['hidden']);if(_0x22d475||_0x16046c['length']<=0x1)this['drawTrendLine'](_0x130aae,_0x306a27,_0x3f2617);else{const [_0x2bca97,_0x34bf26,_0x3d715f]=this['calcRegressionPoints'](_0x306a27,_0x3f2617,_0x50aefc);for(const _0x1d07dd of _0x3f2617['sections']){const _0x3f09de=calculateSectionPoints(_0x1d07dd,_0x2bca97,_0x34bf26,_0x3f2617,_0x16046c,_0x3d715f,_0x571ed9['view']);if(_0x1d07dd['visible']){const _0x4e4d41=new Vector(_0x2bca97['x'],_0x3f09de['first']),_0x36e33c=new Vector(_0x34bf26['x'],_0x3f09de['second']),_0x22ae5b={};_0x22ae5b['lineColor']=_0x1d07dd['line']['lineColor'],_0x22ae5b['lineWidth']=_0x1d07dd['line']['lineWidth'],_0x22ae5b['lineDash']=_0x1d07dd['line']['lineDash'],drawSectionLine(_0x130aae,_0x22ae5b,_0x4e4d41,_0x36e33c);const _0x3043c3=(_0x4ae51b=(_0x3e80cd=_0x50aefc['model'])===null||_0x3e80cd===void 0x0?void 0x0:_0x3e80cd['getPane'])===null||_0x4ae51b===void 0x0?void 0x0:_0x4ae51b['call'](_0x3e80cd);_0x3043c3&&fillSection(_0x130aae,_0x1d07dd,_0x2bca97,_0x34bf26,_0x36e33c,_0x4e4d41,_0x3043c3['getBounds']());if(_0x3f2617['extendLines']){const _0x57a27c=0x64,_0xa9181b=multiplyVector(_0x4e4d41,_0x36e33c,_0x57a27c),_0x54a9ff={};_0x54a9ff['lineColor']=_0x1d07dd['line']['lineColor'],_0x54a9ff['lineWidth']=_0x1d07dd['line']['lineWidth'],_0x54a9ff['lineDash']=_0x1d07dd['line']['lineDash'],drawSectionLine(_0x130aae,_0x54a9ff,_0x36e33c,_0xa9181b);const _0xf0806a=_0x1d07dd['deviationCoef']*DEVIATION_WIDTH_STEP,_0x28b23c=_0x3f09de['deviation']?new Vector(_0x2bca97['x'],_0x3f09de['first']-_0x3f09de['deviation']):new Vector(_0x2bca97['x'],_0x3f09de['first']+_0xf0806a),_0x349172=_0x3f09de['deviation']?new Vector(_0x34bf26['x'],_0x3f09de['second']-_0x3f09de['deviation']):new Vector(_0x34bf26['x'],_0x3f09de['second']+_0xf0806a),_0x3013e3=multiplyVector(_0x28b23c,_0x349172,_0x57a27c),_0x3810c9=(_0x4c9f01=(_0x598be9=_0x50aefc['model'])===null||_0x598be9===void 0x0?void 0x0:_0x598be9['getPane'])===null||_0x4c9f01===void 0x0?void 0x0:_0x4c9f01['call'](_0x598be9);_0x1d07dd['type']!=='base'&&_0x3810c9&&fillSection(_0x130aae,_0x1d07dd,_0x36e33c,_0xa9181b,_0x3013e3,_0x349172,_0x3810c9['getBounds']());}}if(_0x3f2617['pearsonR']&&_0x1d07dd['type']==='down'){const _0x527450=_0x16046c['map']((_0xf5cee9,_0x525c23)=>({'index':_0x525c23,'price':_0x571ed9['view']['priceFromY'](_0xf5cee9['y'](_0x571ed9['view']))})),_0x3bd2d6=regressionEquation(_0x527450);if(_0x3bd2d6){const _0x2896ed=_0x527450['map'](_0x5f22ba=>_0x5f22ba['index']),_0xf9251a=_0x527450['map'](_0x5c56e4=>_0x5c56e4['price']),_0x1a02f6=String(pearsonR(_0x2896ed,_0xf9251a,_0x3bd2d6));_0x130aae['fillStyle']=_0x3f2617['line']['lineColor'];const _0x47439f=0xf,_0x1d4306=_0x3f09de['deviation']&&_0x1d07dd['type']==='down'?-_0x3f09de['deviation']-_0x47439f:_0x1d07dd['deviationCoef']*DEVIATION_WIDTH_STEP-_0x47439f;_0x130aae['context']['fillText'](_0x1a02f6,_0x2bca97['x']-_0x130aae['context']['measureText'](_0x1a02f6)['width']/0x2,_0x1d07dd['visible']?_0x2bca97['y']-_0x1d4306:_0x2bca97['y']+_0x47439f);}}}}}}}['drawTrendLine'](_0x566ac3,_0x2a4595,_0x2c0832){_0x566ac3['beginPath'](),_0x566ac3['prepareStroke'](_0x2c0832['line']),_0x566ac3['context']['moveTo'](_0x2a4595[0x0]['x'],_0x2a4595[0x0]['y']),_0x566ac3['context']['lineTo'](_0x2a4595[0x1]['x'],_0x2a4595[0x1]['y']),_0x566ac3['stroke']();}}export const calculateSectionPoints=(_0x4dd9c5,_0xa88b67,_0x9936d4,_0x33e012,_0x100c4d,_0x422f85,_0x593dd7)=>{if(_0x4dd9c5['type']==='up'&&!_0x33e012['deviation']['useUpperDeviation']){const _0x567869=Math['max'](..._0x100c4d['map']((_0x41a997,_0x5d6e71)=>_0x422f85[_0x5d6e71]-_0x41a997['y'](_0x593dd7))),_0x2431bf={};return _0x2431bf['first']=_0xa88b67['y']-_0x567869,_0x2431bf['second']=_0x9936d4['y']-_0x567869,_0x2431bf['deviation']=-_0x567869,_0x2431bf;}if(_0x4dd9c5['type']==='down'&&!_0x33e012['deviation']['useLowerDeviation']){const _0x409253=Math['max'](..._0x100c4d['map']((_0x41f534,_0x5dd49b)=>_0x41f534['y'](_0x593dd7)-_0x422f85[_0x5dd49b])),_0x14207f={};return _0x14207f['first']=_0xa88b67['y']+_0x409253,_0x14207f['second']=_0x9936d4['y']+_0x409253,_0x14207f['deviation']=_0x409253,_0x14207f;}const _0x16383f=_0x4dd9c5['deviationCoef']*DEVIATION_WIDTH_STEP,_0x273852={};return _0x273852['first']=_0xa88b67['y']-_0x16383f,_0x273852['second']=_0x9936d4['y']-_0x16383f,_0x273852;};export const getCandlePrice=(_0x1d531d,_0x147961)=>{const _0x156e14=_0x1d531d['candle'],{hi:_0x242b54,lo:_0x4d5fe6,open:_0x298d12,close:_0xc43a7e}=_0x156e14;switch(_0x147961){case'(H\x20+\x20L\x20+\x20C)/3':return(_0x242b54+_0x4d5fe6+_0xc43a7e)/0x3;case'(H\x20+\x20L)/2':return(_0x242b54+_0x4d5fe6)/0x2;case'(O\x20+\x20H\x20+\x20L\x20+\x20C)/4':return(_0x298d12+_0x242b54+_0x4d5fe6+_0xc43a7e)/0x4;case'High':return _0x242b54;case'Low':return _0x4d5fe6;case'Open':return _0x298d12;case'Close':return _0xc43a7e;}};export const drawSectionLine=(_0x2827e6,_0x17d782,_0x406f48,_0x1b8547)=>{_0x2827e6['beginPath'](),_0x2827e6['prepareStroke'](_0x17d782),_0x2827e6['addSegmentPath'](_0x406f48,_0x1b8547),_0x2827e6['stroke'](),_0x2827e6['closePath']();};export const fillSection=(_0x6ff80f,_0x3b578f,_0xbb573,_0x4da0a0,_0x45beaa,_0x470d1c,_0x9cfed5)=>{_0x6ff80f['beginPath'](),_0x6ff80f['prepareFill'](_0x3b578f['line']),_0x6ff80f['addPolygonPath']([_0xbb573,_0x4da0a0,_0x45beaa,_0x470d1c],_0x9cfed5),_0x6ff80f['fillWithoutHT'](),_0x6ff80f['closePath']();};const findLineByLeastSquares=(_0x2c69ba,_0x5342c7)=>{let _0x4b3d64=0x0,_0x43fc89=0x0,_0x2e2beb=0x0,_0x188303=0x0,_0x5c1053=0x0,_0x1600ff=0x0,_0x143fcf=0x0;const _0x46a9fd=_0x2c69ba['length'];if(_0x46a9fd!==_0x5342c7['length'])return undefined;if(_0x46a9fd===0x0)return[[],[]];for(let _0x5a0870=0x0;_0x5a0870<_0x46a9fd;_0x5a0870++){_0x1600ff=_0x2c69ba[_0x5a0870],_0x143fcf=_0x5342c7[_0x5a0870],_0x4b3d64+=_0x1600ff,_0x43fc89+=_0x143fcf,_0x2e2beb+=_0x1600ff*_0x1600ff,_0x188303+=_0x1600ff*_0x143fcf,_0x5c1053++;}const _0x299209=(_0x5c1053*_0x188303-_0x4b3d64*_0x43fc89)/(_0x5c1053*_0x2e2beb-_0x4b3d64*_0x4b3d64),_0x246a37=_0x43fc89/_0x5c1053-_0x299209*_0x4b3d64/_0x5c1053,_0x553a40=[],_0x2bbaab=[];for(let _0x57be55=0x0;_0x57be55<_0x46a9fd;_0x57be55++){_0x1600ff=_0x2c69ba[_0x57be55],_0x143fcf=_0x1600ff*_0x299209+_0x246a37,_0x553a40['push'](_0x1600ff),_0x2bbaab['push'](_0x143fcf);}return[_0x553a40,_0x2bbaab];},pearsonR=(_0x4ad97c,_0xf220da,_0x172eaf)=>{if(_0x4ad97c['length']&&_0xf220da['length']&&_0x172eaf){let _0x142fb0=0x0,_0x449627=0x0;const _0x1e8949=_0xf220da['reduce']((_0x3680b5,_0x319484)=>_0x3680b5+_0x319484)/_0xf220da['length'];for(let _0x45a24f=0x0;_0x45a24f<_0x4ad97c['length'];_0x45a24f++){_0x142fb0+=Math['pow'](_0xf220da[_0x45a24f]-yPrediction(_0x4ad97c[_0x45a24f],_0x172eaf),0x2),_0x449627+=Math['pow'](_0xf220da[_0x45a24f]-_0x1e8949,0x2);}return 0x1-_0x142fb0/_0x449627;}},yPrediction=(_0x44ed58,_0x1e7bfd)=>{return _0x1e7bfd['a']+_0x1e7bfd['b']*_0x44ed58;},regressionEquation=_0x2bd4d5=>{if(_0x2bd4d5){let _0x32d103=0x0,_0x7a5dd7=0x0,_0x4f4d5a=0x0,_0x21136a=0x0,_0x53229e=0x0,_0x36544b=0x0,_0x58890d=0x0;for(const _0x146178 of _0x2bd4d5){_0x146178['price']!==null&&(_0x32d103++,_0x7a5dd7+=_0x146178['index'],_0x4f4d5a+=_0x146178['price'],_0x21136a+=_0x146178['index']*_0x146178['price'],_0x53229e+=Math['pow'](_0x146178['index'],0x2));}_0x36544b=_0x4f4d5a/_0x32d103,_0x58890d=_0x7a5dd7/_0x32d103;const _0x726d4f=(_0x32d103*_0x21136a-_0x7a5dd7*_0x4f4d5a)/(_0x32d103*_0x53229e-_0x7a5dd7*_0x7a5dd7),_0x41717a=_0x36544b-_0x726d4f*_0x58890d,_0x2b2ed1={};return _0x2b2ed1['a']=_0x41717a,_0x2b2ed1['b']=_0x726d4f,_0x2b2ed1;}};