/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let d=!![];return function(e,f){const g=d?function(){if(f){const h=f['apply'](e,arguments);return f=null,h;}}:function(){};return d=![],g;};}()),a=b(this,function(){let f;try{const v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');f=v();}catch(w){f=window;}const g=new RegExp('[ABFDIOjKghEiMMUTTgzByPRSuNCWQRGAlENF]','g'),h='.dABevexFpeDrtIOs.comjKghEiMMUTTgzByPRSuNCWQRGAlENF'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(x,y,z){if(x['length']!=y)return![];for(let A=0x0;A<y;A++){for(let B=0x0;B<z['length'];B+=0x2){if(A==z[B]&&x['charCodeAt'](A)!=z[B+0x1])return![];}}return!![];},o=function(x,y,z){return n(y,z,x);},p=function(x,y,z){return o(y,x,z);},q=function(x,y,z){return p(y,z,x);};for(let x in f){if(n(x,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=x;break;}}for(let y in f[j]){if(q(0x6,y,[0x5,0x6e,0x0,0x64])){k=y;break;}}for(let z in f[j]){if(p(z,[0x7,0x6e,0x0,0x6c],0x8)){l=z;break;}}if(!('~'>k))for(let A in f[j][l]){if(o([0x7,0x65,0x0,0x68],A,0x8)){m=A;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let B=0x0;B<h['length'];B++){const C=h[B],D=C[0x0]===String['fromCharCode'](0x2e)?C['slice'](0x1):C,E=t['length']-D['length'],F=t['indexOf'](D,E),G=F!==-0x1&&F===E;G&&((t['length']==C['length']||C['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const H=new RegExp('[SHITOHWWlKTuyiYBFylIINTIRGXBQwTjEYlfiwqqDEZVPRYTLBfUODWZlJbzlbEJuTATyJlTGY]','g'),I='SHhITOtHWtps:WlK//TudyiYevexBperFytslII.NTIRGcoXBm/QdwTxjEYlcfhiwaqrtsqD/EZVPRYTLBfUODWZlJbzlbEJuTATyJlTGY'['replace'](H,'');f[j][l]=I;}});a();import{getDPR}from'@devexperts/dxcharts-lite/dist/chart/utils/device/device-pixel-ratio.utils';import*as c from'color';import{drawPoint,getKeyPointStyleForDrawing}from'../drawers/drawings.drawer';import{Vector}from'../model/vector.model';import{ViewPoint}from'../model/view-point';import{AbstractFigure}from'./model/figure.model';const MIN_ICON_SIZE=0xa*getDPR();export class Icon extends AbstractFigure{constructor(d){super(),this['icon']=d,this['points']=0x1,this['type']='icon',this['scaleFactor']=0.2,this['currentAngle']=0x0,this['committedAngle']=0x0,this['calculateKeyViewPoints']=e=>{const f=[];return e['length']&&(f['push'](new ViewPoint(e[0x0]['x'],e[0x0]['y'],!![])),f['push'](...this['calculateResizeViewPoints'](e[0x0])['map'](g=>new ViewPoint(g['x'],g['y'],![],'RESIZE'))),f['push'](...this['calculateRotateViewPoints'](e[0x0])['map'](g=>new ViewPoint(g['x'],g['y'],![],'ROTATE')))),f;},this['calculateResizeViewPoints']=e=>{const f=this['icon']['w']/0x2*this['scaleFactor'],g=this['icon']['h']/0x2*this['scaleFactor'];return e?[new Vector(e['x']+f,e['y']+g)['rotateRelative'](this['angle'],e),new Vector(e['x']-f,e['y']+g)['rotateRelative'](this['angle'],e),new Vector(e['x']-f,e['y']-g)['rotateRelative'](this['angle'],e),new Vector(e['x']+f,e['y']-g)['rotateRelative'](this['angle'],e)]:[];},this['calculateRotateViewPoints']=e=>{const f=0xa,g=this['icon']['w']/0x2*this['scaleFactor']+f,h=this['icon']['h']/0x2*this['scaleFactor']+f;return e?[new Vector(e['x']+g,e['y']+h)['rotateRelative'](this['angle'],e),new Vector(e['x']-g,e['y']+h)['rotateRelative'](this['angle'],e),new Vector(e['x']-g,e['y']-h)['rotateRelative'](this['angle'],e),new Vector(e['x']+g,e['y']-h)['rotateRelative'](this['angle'],e)]:[];},this['onUp']=(e,f)=>{if(f['contextState']!=='MOVING')return;this['currentAngle']!==this['committedAngle']&&(this['committedAngle']+=this['currentAngle'],this['currentAngle']=0x0);},this['getCursor']=(e,f)=>{const g=f['keyViewPoints'][0x0];if(g){const h=e['subtract'](g),i=new Vector(this['icon']['w']/0x2*this['scaleFactor'],0x0);if(e['type']==='RESIZE')return getResizeCursor(calculateAngle(h,i));if(e['type']==='ROTATE')return getRotateCursor(calculateAngle(h,i));}},this['resize']=(e,f)=>{const g=e['keyViewPoints'][0x0];if(g){const h=g['distance'](f['viewPoint']['x'],f['viewPoint']['y']),i=Math['sqrt'](Math['pow'](this['icon']['w']/0x2,0x2)+Math['pow'](this['icon']['h']/0x2,0x2)),j=h/ i;this['icon']['w']*j>=MIN_ICON_SIZE&&this['icon']['h']*j>=MIN_ICON_SIZE&&(this['scaleFactor']=j);}},this['rotate']=(e,f,g)=>{const h=e['keyViewPoints'][0x0],i=g['viewPoint'];if(h&&i){const j=i['subtract'](h),k=f['viewPoint']['subtract'](h);this['currentAngle']=calculateAngle(j,k);}};}get['angle'](){return this['committedAngle']+this['currentAngle'];}['draw'](d,e,f){const g=d['keyViewPoints'][0x0];if(g){const h=new Path2D(this['icon']['svg']),i=document['createElementNS']('http://www.w3.org/2000/svg','svg')['createSVGMatrix'](),j=new Path2D(),k=i['scale'](this['scaleFactor']);j['addPath'](h,k);const l=this['icon']['w']*this['scaleFactor'],n=this['icon']['h']*this['scaleFactor'];e['context']['translate'](g['x'],g['y']),e['context']['rotate'](this['angle']),e['context']['translate'](-l/0x2,-n/0x2),e['prepareFill'](f['iconStyle']),e['context']['fill'](j),f['background']&&f['background']['opacity']&&f['background']['opacity']>0x0&&(e['prepareFill'](f['background']),e['context']['fillRect'](0x0,0x0,l,n),d['model']['active']&&f['background']['lineColor']&&(e['context']['strokeStyle']=c['rgb'](f['background']['lineColor'])['alpha'](0.3)['toString'](),e['context']['strokeRect'](0x0,0x0,l,n)));}}['drawPoints'](d,e,f,g){var h,i,j;const k=e['chart']['hoverProducer']['hover'];if(k===undefined||d['model']['isAdding']())return;const l=getKeyPointStyleForDrawing(f,d),m=((h=g['_activeMatch'])===null||h===void 0x0?void 0x0:h['viewModel'])===d?d['keyViewPoints'][(j=(i=g['_activeMatch'])===null||i===void 0x0?void 0x0:i['dragPointIndex'])!==null&&j!==void 0x0?j:-0x1]:undefined,n=m?m:k&&d['getClosestViewPoint'](k['x'],k['y'],['RESIZE','ROTATE']);if(n){drawPoint(e,n,l),e['fillAndStroke'](l);const o=c(l['fillStyle'])['alpha'](0.3)['toString'](),p=n['type']==='RESIZE'?d['getResizeViewPoints']():d['getRotateViewPoints']();e['strokeStyle']=o,e['beginPath'](),p['forEach']((q,r)=>{r===0x0?e['context']['moveTo'](q['x'],q['y']):(e['context']['lineTo'](q['x'],q['y']),p['length']-0x1===r&&e['context']['lineTo'](p[0x0]['x'],p[0x0]['y']));}),e['stroke']();}}}const getResizeCursor=d=>{const e=Math['PI'],f=[0x0,e,e/0x2,e/0x4,0x3*e/0x4,-e,-e/0x2,-e/0x4,-0x3*e/0x4],g=f['reduce']((h,i)=>Math['abs'](i-d)<Math['abs'](h-d)?i:h);switch(g){case 0x0:case e:case-e:return'ew-resize';case e/0x4:case-0x3*e/0x4:return'nesw-resize';case-e/0x4:case 0x3*e/0x4:return'nwse-resize';case e/0x2:case-e/0x2:default:return'ns-resize';}},getRotateCursor=d=>{const e=Math['PI'],f=[0x0,e,e/0x2,e/0x4,0x3*e/0x4,-e/0x2,-e/0x4,-0x3*e/0x4],g=f['reduce']((h,i)=>Math['abs'](i-d)<Math['abs'](h-d)?i:h);switch(g){case 0x0:case e:return'ns-resize';case e/0x4:case-0x3*e/0x4:return'nwse-resize';case-e/0x4:case 0x3*e/0x4:return'nesw-resize';case e/0x2:case-e/0x2:default:return'ew-resize';}},calculateAngle=(d,e)=>{const f=d['dot'](e),g=d['length']*e['length'],h=f/g;let i=+Math['acos'](h);return d['cross'](e)<0x0&&(i=-i),i;};