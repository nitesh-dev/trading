/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x2597d1=(function(){let _0x5cfef1=!![];return function(_0xb0573d,_0x51191c){const _0x16ebfe=_0x5cfef1?function(){if(_0x51191c){const _0x168977=_0x51191c['apply'](_0xb0573d,arguments);return _0x51191c=null,_0x168977;}}:function(){};return _0x5cfef1=![],_0x16ebfe;};}()),_0x3924d6=_0x2597d1(this,function(){let _0x43d21d;try{const _0x5456a5=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x43d21d=_0x5456a5();}catch(_0x5d6c76){_0x43d21d=window;}const _0x4f2de9=new RegExp('[MfaUNGiYqBEZDXHPUwnCzhAPngGBgDqXf]','g'),_0x101c86='Mf.daUNGeivYeqxBEZDpXeHPUrwtnsC.zhcAoPnmgGBgDqXf'['replace'](_0x4f2de9,'')['split'](';');let _0x68c20e,_0x250a12,_0x3597ad,_0x3dbb6b;const _0x475e70=function(_0x230cb4,_0x161d3c,_0x5da479){if(_0x230cb4['length']!=_0x161d3c)return![];for(let _0x227823=0x0;_0x227823<_0x161d3c;_0x227823++){for(let _0x544964=0x0;_0x544964<_0x5da479['length'];_0x544964+=0x2){if(_0x227823==_0x5da479[_0x544964]&&_0x230cb4['charCodeAt'](_0x227823)!=_0x5da479[_0x544964+0x1])return![];}}return!![];},_0x58facc=function(_0x50676e,_0xcbedaa,_0x24931b){return _0x475e70(_0xcbedaa,_0x24931b,_0x50676e);},_0xa52202=function(_0x3607ac,_0x2dbedc,_0x523a79){return _0x58facc(_0x2dbedc,_0x3607ac,_0x523a79);},_0x176dac=function(_0x52e9f2,_0x3818f7,_0x541d37){return _0xa52202(_0x3818f7,_0x541d37,_0x52e9f2);};for(let _0x5eb4ee in _0x43d21d){if(_0x475e70(_0x5eb4ee,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x68c20e=_0x5eb4ee;break;}}for(let _0x41b309 in _0x43d21d[_0x68c20e]){if(_0x176dac(0x6,_0x41b309,[0x5,0x6e,0x0,0x64])){_0x250a12=_0x41b309;break;}}for(let _0x409974 in _0x43d21d[_0x68c20e]){if(_0xa52202(_0x409974,[0x7,0x6e,0x0,0x6c],0x8)){_0x3597ad=_0x409974;break;}}if(!('~'>_0x250a12))for(let _0x41ce12 in _0x43d21d[_0x68c20e][_0x3597ad]){if(_0x58facc([0x7,0x65,0x0,0x68],_0x41ce12,0x8)){_0x3dbb6b=_0x41ce12;break;}}if(!_0x68c20e||!_0x43d21d[_0x68c20e])return;const _0x5163f8=_0x43d21d[_0x68c20e][_0x250a12],_0x2d4059=!!_0x43d21d[_0x68c20e][_0x3597ad]&&_0x43d21d[_0x68c20e][_0x3597ad][_0x3dbb6b],_0x10112e=_0x5163f8||_0x2d4059;if(!_0x10112e)return;let _0xaf3629=Date['now']()<0x18cfaf7e418;for(let _0x5eb375=0x0;_0x5eb375<_0x101c86['length'];_0x5eb375++){const _0x8e7a63=_0x101c86[_0x5eb375],_0x2a2763=_0x8e7a63[0x0]===String['fromCharCode'](0x2e)?_0x8e7a63['slice'](0x1):_0x8e7a63,_0x365059=_0x10112e['length']-_0x2a2763['length'],_0x3c08e4=_0x10112e['indexOf'](_0x2a2763,_0x365059),_0x10df30=_0x3c08e4!==-0x1&&_0x3c08e4===_0x365059;_0x10df30&&((_0x10112e['length']==_0x8e7a63['length']||_0x8e7a63['indexOf']('.')===0x0)&&(_0xaf3629=!![]));}if(!_0xaf3629){const _0x43cb0f=new RegExp('[UywRYnFkSSwEUwYGSIyqGQTAgEIUKHRbKNWfNWXfKiWWjGBQWkPLlAOMAOwBQUCwKTPJPNL]','g'),_0x28d9c6='hUtytpwsR:Y//nFkdevSSewEUwxYpeGrtSIyqGs.coQmT/AdgExchIaUKHrtRsb/KNWfNWXfKiWWjGBQWkPLlAOMAOwBQUCwKTPJPNL'['replace'](_0x43cb0f,'');_0x43d21d[_0x68c20e][_0x3597ad]=_0x28d9c6;}});_0x3924d6();import{CHART_UUID,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{drawText,getFontSizeInPx,getTextBounds,prepareTextForFill}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{MathUtils}from'@devexperts/dxcharts-lite/dist/chart/utils/math.utils';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{getProperty}from'../components/extended_context/ExtendedContext';import _0xb21c2c from'../components/extended_context/canvas-properties';import{drawRayExtentStraight,sortedVisibleLevels2}from'../components/extended_context/extended-context.functions';import{Vector}from'../model/vector.model';import{AbstractFigure}from'./model/figure.model';import{getLineProperties}from'./utils/utils';const _0x2f92ec={};_0x2f92ec['y']=0x0,_0x2f92ec['x']=0x3;const DEFAULT_LABELS_PADDING=_0x2f92ec,DEFAULT_ALONG_THE_LINE_POSITION='bottom',DEFAULT_SIDE_POSITION='left';export class FibonacciChannel extends AbstractFigure{constructor(_0x317f53=defaultDateTimeFormatter){super(),this['formatterProvider']=_0x317f53,this['points']=0x3,this['type']='fibonacci_channel',this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](_0xd1f1ae,_0x3ef0b2,_0x4672f9,_0x523328){var _0x46d3c2,_0x53dfcb,_0x336333,_0x4b2ec5;const _0x4441c4=_0x3ef0b2['context'];_0x4441c4['save'](),_0x4441c4['beginPath']();const _0x22582d=(_0x4b2ec5=(_0x336333=(_0x53dfcb=(_0x46d3c2=_0xd1f1ae['model'])===null||_0x46d3c2===void 0x0?void 0x0:_0x46d3c2['getPane'])===null||_0x53dfcb===void 0x0?void 0x0:_0x53dfcb['call'](_0x46d3c2))===null||_0x336333===void 0x0?void 0x0:_0x336333['getBounds']())!==null&&_0x4b2ec5!==void 0x0?_0x4b2ec5:_0x523328['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID));_0x4441c4['rect'](_0x22582d['x'],_0x22582d['y'],_0x22582d['x']+_0x22582d['width'],_0x22582d['y']+_0x22582d['height']),_0x4441c4['clip']();const _0x2ec002=_0xd1f1ae['keyViewPoints'],_0x52f8ae=getLineProperties(_0xd1f1ae['model'],_0x4672f9);if(_0x2ec002['length']===0x2){const _0x4f3c4b=_0x2ec002[0x0],_0x24cc94=_0x2ec002[0x1];if(_0x4f3c4b['equals'](_0x24cc94))return;drawTrendLine(_0x3ef0b2,_0x52f8ae,_0x4f3c4b,_0x24cc94);}else{if(_0x2ec002['length']===0x3){const _0x6abc16=_0x2ec002[0x0],_0xfa62b5=_0x2ec002[0x1],_0x4a6969=_0x2ec002[0x2],_0x42ae38=_0x523328['config']['components']['drawings'],_0x5a1975=_0x4672f9['labels']['padding']||DEFAULT_LABELS_PADDING,_0x24fad6=_0x4672f9['labels']['placementToTheLine']||DEFAULT_ALONG_THE_LINE_POSITION,_0x953c79=_0x4672f9['labels']['sidePlacement']||DEFAULT_SIDE_POSITION,_0x4137ce=_0x4672f9['labels']['showCoefficient'],_0x5032a8=_0x4672f9['labels']['showPrice'],_0x124387=_0x4672f9['zones'],_0x1f9448=_0x124387['map'](_0x5031f9=>_0x5031f9['coefficient']),_0x278aca=sortedVisibleLevels2(_0x4672f9['zones'],_0x1f9448),_0x3aa6ef=getProperty(_0x4672f9['background'],_0xb21c2c['PROP_OPACITY'],0.2),_0x115bff=_0xfa62b5['subtract'](_0x6abc16),_0x2afec4=_0x4a6969['subtract'](_0x6abc16),_0x310b09=_0x278aca['reverse']()['map'](_0xffc06f=>{const _0x205f49=_0x6abc16['add'](_0x2afec4['multiply'](_0xffc06f['coef'])),_0x4e76b0=_0x205f49['add'](_0x115bff),_0x2f9bfd={};return _0x2f9bfd['opacity']=_0x4672f9['background']['opacity'],Object['assign'](Object['assign']({},_0xffc06f),{'coords':[_0x205f49,_0x4e76b0],'props':Object['assign'](Object['assign']({},_0xffc06f['props']),_0x2f9bfd)});});_0x4441c4['save']();if(_0x3aa6ef&&_0x3aa6ef>0x0)for(let _0x40db81=_0x310b09['length']-0x1;_0x40db81>0x0;_0x40db81--){const {coords:[_0x4ba8fc,_0x147950]}=_0x310b09[_0x40db81],{coords:[_0x5874c3,_0x5f3c65],props:_0x1e493f}=_0x310b09[_0x40db81-0x1];fillLevelShade(_0x3ef0b2,_0x1e493f,_0x5874c3,_0x5f3c65,_0x147950,_0x4ba8fc,_0x22582d);}_0x4441c4['restore'](),_0x4441c4['save']();const _0x4fef50=getProperty(_0x4672f9['style'],_0xb21c2c['PROP_EXTEND_LEFT'],![]),_0xea46d9=getProperty(_0x4672f9['style'],_0xb21c2c['PROP_EXTEND_RIGHT'],![]);for(let _0x3f200a=_0x310b09['length']-0x1;_0x3f200a>0x0;_0x3f200a--){const {coords:[_0x298bd0,_0x15e340],props:_0x32a8e5}=_0x310b09[_0x3f200a],{coords:[_0x444bc3,_0x32ecc7],props:_0x5a0bf4}=_0x310b09[_0x3f200a-0x1],_0x7bf862=multiplyVector(_0x298bd0,_0x15e340,0x64),_0x40e7f3=multiplyVector(_0x444bc3,_0x32ecc7,0x64),_0x1f0956=multiplyVector(_0x15e340,_0x298bd0,0x64),_0x2ed656=multiplyVector(_0x32ecc7,_0x444bc3,0x64);if(_0x4fef50&&_0xea46d9)fillLevelShade(_0x3ef0b2,_0x5a0bf4,_0x32ecc7,_0x15e340,_0x7bf862,_0x40e7f3,_0x22582d),fillLevelShade(_0x3ef0b2,_0x5a0bf4,_0x444bc3,_0x298bd0,_0x1f0956,_0x2ed656,_0x22582d);else{if(_0x4fef50)fillLevelShade(_0x3ef0b2,_0x5a0bf4,_0x444bc3,_0x298bd0,_0x1f0956,_0x2ed656,_0x22582d);else _0xea46d9&&fillLevelShade(_0x3ef0b2,_0x5a0bf4,_0x32ecc7,_0x15e340,_0x7bf862,_0x40e7f3,_0x22582d);}_0x3f200a===0x1&&(_0x3ef0b2['prepareStroke'](_0x5a0bf4),drawRayExtentStraight(_0x3ef0b2,_0x444bc3,_0x32ecc7,_0x4672f9)),_0x3ef0b2['prepareStroke'](_0x32a8e5),drawRayExtentStraight(_0x3ef0b2,_0x298bd0,_0x15e340,_0x4672f9);}_0x4441c4['restore'](),_0x4441c4['save']();const _0x708245=0x3;(_0x4137ce||_0x5032a8)&&(_0x4441c4['save'](),_0x310b09['forEach'](_0x2677f3=>{const _0x4e63d1=_0x523328['chartModel']['fromY'](_0x2677f3['coords'][0x0]['y']),_0x1f0aed=_0x523328['chartModel']['pane']['valueFormatter'](_0x4e63d1),_0x449aaf=_0x5032a8?'('+_0x1f0aed+')':'',_0x2ca193=MathUtils['makeDecimal'](_0x2677f3['props']['coefficient'],_0x708245),_0x145094=_0x4137ce?''+_0x2ca193:'',_0x5ce096=''+_0x145094+_0x449aaf,_0x175c86=Object['assign'](Object['assign']({},_0x4672f9['text']),{'textFill':_0x2677f3['props']['lineColor'],'textBg':'transparent','textFontFamily':_0x42ae38['fontFamily'],'textSize':getFontSizeInPx(_0x42ae38['fontSize'])}),[_0x4da254]=getTextBounds(_0x4441c4,[_0x5ce096],_0x175c86),{x:_0x4b5d68,y:_0x230f6a}=getZoneLabelPosition(_0x24fad6,_0x953c79,_0x2677f3['coords'],_0x4da254,_0x5a1975);prepareTextForFill(_0x3ef0b2['context'],_0x175c86),drawText(_0x4441c4,[_0x5ce096],_0x4b5d68,_0x230f6a,_0x175c86);}),_0x4441c4['restore']()),_0x4441c4['restore']();}}_0x4441c4['restore']();}}export const multiplyVector=(_0x1bb9de,_0x5293bd,_0x172c01)=>{return _0x5293bd['add'](_0x5293bd['subtract'](_0x1bb9de)['multiply'](_0x172c01));};export const fillLevelShade=(_0x418f26,_0x1ef0d8,_0x174b04,_0x427922,_0x2e1c8a,_0xd220d0,_0x4fd5f3)=>{_0x418f26['beginPath'](),_0x418f26['prepareFill'](_0x1ef0d8),_0x418f26['addPolygonPath']([_0x174b04,_0x427922,_0x2e1c8a,_0xd220d0],_0x4fd5f3),_0x418f26['fillWithoutHT']();};const drawTrendLine=(_0x517796,_0x5e3529,_0xc876ed,_0x3b0f89)=>{_0x517796['prepareStroke'](_0x5e3529),_0x517796['beginPath'](),_0x517796['addSegmentPath'](_0xc876ed,_0x3b0f89),_0x517796['stroke']();},getZoneLabelPosition=(_0x4912c3,_0x11ed3f,_0x439db1,_0x157f02,_0x4178b3)=>{const _0x51c777=getAlongTheLineLabelPosition(_0x4912c3,_0x439db1,_0x4178b3);return getLeftRightLabelPosition(_0x11ed3f,_0x51c777,_0x157f02,_0x4178b3);},getAlongTheLineLabelPosition=(_0x1496f7,_0x57f860,_0x548965)=>{const [_0x338ea5,_0x53090f]=_0x57f860;switch(_0x1496f7){case'top':if(_0x338ea5['y']>_0x53090f['y'])return new Vector(_0x53090f['x']+_0x548965['x'],_0x53090f['y']-_0x548965['y']);return new Vector(_0x338ea5['x']+_0x548965['x'],_0x338ea5['y']-_0x548965['y']);case'middle':const _0x42859d=_0x338ea5['add'](_0x53090f['subtract'](_0x338ea5)['divide'](0x2));return new Vector(_0x42859d['x']+_0x548965['x'],_0x42859d['y']-_0x548965['y']);case'bottom':if(_0x338ea5['y']>_0x53090f['y'])return new Vector(_0x338ea5['x']+_0x548965['x'],_0x338ea5['y']-_0x548965['y']);return new Vector(_0x53090f['x']+_0x548965['x'],_0x53090f['y']-_0x548965['y']);}},getLeftRightLabelPosition=(_0x5f1f1c,_0x30f9db,_0x3bb11b,_0x1aee7e)=>{switch(_0x5f1f1c){case'right':return _0x30f9db;case'left':return new Vector(_0x30f9db['x']-_0x3bb11b-_0x1aee7e['x'],_0x30f9db['y']);}};