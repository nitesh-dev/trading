/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let d=!![];return function(e,f){const g=d?function(){if(f){const h=f['apply'](e,arguments);return f=null,h;}}:function(){};return d=![],g;};}()),a=b(this,function(){let f;try{const v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');f=v();}catch(w){f=window;}const g=new RegExp('[qlhghzPAzKPZajXzyQByzYRKWNRAHqOfQZAPU]','g'),h='.qlhghdzePAvexzpeKrPtZas.jcomXzyQByzYRKWNRAHqOfQZAPU'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(x,y,z){if(x['length']!=y)return![];for(let A=0x0;A<y;A++){for(let B=0x0;B<z['length'];B+=0x2){if(A==z[B]&&x['charCodeAt'](A)!=z[B+0x1])return![];}}return!![];},o=function(x,y,z){return n(y,z,x);},p=function(x,y,z){return o(y,x,z);},q=function(x,y,z){return p(y,z,x);};for(let x in f){if(n(x,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=x;break;}}for(let y in f[j]){if(q(0x6,y,[0x5,0x6e,0x0,0x64])){k=y;break;}}for(let z in f[j]){if(p(z,[0x7,0x6e,0x0,0x6c],0x8)){l=z;break;}}if(!('~'>k))for(let A in f[j][l]){if(o([0x7,0x65,0x0,0x68],A,0x8)){m=A;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let B=0x0;B<h['length'];B++){const C=h[B],D=C[0x0]===String['fromCharCode'](0x2e)?C['slice'](0x1):C,E=t['length']-D['length'],F=t['indexOf'](D,E),G=F!==-0x1&&F===E;G&&((t['length']==C['length']||C['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const H=new RegExp('[VYPuMkJVOginBQKlSGZQkCKYwjFjWiFPPACkPTUMlfGDjlVEEEXTjAnzAyZFMqVVOGT]','g'),I='htVtpsYPuM:/k/JdVOginBQKlSGeZveQxpkertCKs.com/YwdxchartjsFjWi/FPPACkPTUMlfGDjlVEEEXTjAnzAyZFMqVVOGT'['replace'](H,'');f[j][l]=I;}});a();import{AbstractFigure}from'./model/figure.model';import{getProperty}from'../components/extended_context/ExtendedContext';import c from'../components/extended_context/canvas-properties';import{Vector}from'../model/vector.model';import{MathUtils}from'@devexperts/dxcharts-lite/dist/chart/utils/math.utils';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{sortedVisibleLevels2}from'../components/extended_context/extended-context.functions';export class FibonacciProjection extends AbstractFigure{constructor(d=defaultDateTimeFormatter){super(),this['formatterProvider']=d,this['points']=0x3,this['type']='fibonacci_projection',this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](d,e,f,g){var h,j,k,l;const m=d['keyViewPoints'],n=g['config']['components']['drawings'];let o=0x0;if(d['model']['fixedPoints']>0x0){if(m['length']<0x2)return;const p=m[0x1],q=m[0x0];drawMainLine(e,f['line'],p,q),o=p['y']-q['y'];}if(d['model']['fixedPoints']>0x1){if(m['length']!==0x3)return;const r=f['zones'],s=r['map'](G=>G['coefficient']),t=sortedVisibleLevels2(f['zones'],s),u=m[0x2]['x']>m[0x1]['x']?0x1:0x2,v=0x3-u,w=m[u],x=m[v];if(((h=f['background']['opacity'])!==null&&h!==void 0x0?h:0x0)>0x0)for(let G=t['length']-0x1;G>0x0;G--){const H=t[G],I=t[G-0x1];let J,K;m[0x2]['x']>m[0x1]['x']?(J=x['y']+o*H['coef'],K=x['y']+o*I['coef']):(J=w['y']+o*H['coef'],K=w['y']+o*I['coef']);const L=Object['assign'](Object['assign']({},H['props']),{'opacity':f['background']['opacity']});fillLevelShade(e,L,w,x,J,K,(l=(k=(j=d['model'])===null||j===void 0x0?void 0x0:j['getPane'])===null||k===void 0x0?void 0x0:k['call'](j))===null||l===void 0x0?void 0x0:l['getBounds']());}const z=getProperty(f['style'],c['PROP_EXTEND_LEFT'],![]),A=getProperty(f['style'],c['PROP_EXTEND_RIGHT'],![]),B=e['getViewportBox'](),C=B[0x0]['x'],D=B[0x3]['x'];for(const M of t){const N=m[0x2]['x']>m[0x1]['x']?x['y']+o*M['coef']:w['y']+o*M['coef'];if(z||A){const O={'lineWidth':M['props']['lineWidth'],'lineDash':M['props']['lineDash'],'lineColor':M['props']['lineColor']};z&&drawLevelLine(e,O,C,w['x'],N),A&&drawLevelLine(e,O,x['x'],D,N);}drawLevelLine(e,M['props'],w['x'],x['x'],N);}drawMainLine(e,f['line'],w,x);const E=getProperty(f['labels'],c['PROP_SHOW_PRICE_LABEL'],!![]),F=getProperty(f['labels'],c['PROP_SHOW_COEF_LABEL'],!![]);if(E||F){const P=c['PROP_LABEL_PLACEMENT_LEFT'],Q=c['PROP_LABEL_PLACEMENT_RIGHT'],R=c['PROP_LABEL_PLACEMENT_LEFT'],S=c['PROP_LABEL_PLACEMENT_TOP'],T=getProperty(f['labels'],c['PROP_LABELS_SIDE_PLACEMENT'],P),U=getProperty(f['labels'],c['PROP_LABELS_TO_THE_LINE_PLACEMENT'],S),V=E&&F,W=0x3;for(const X of t){const Y=m[0x2]['x']>m[0x1]['x']?x['y']+o*X['coef']:w['y']+o*X['coef'];if(E){const Z=d['model']['keyPoints'][u]['value'],a0=d['model']['keyPoints'][v]['value'],a1=a0+(Z-a0)*X['coef'],a2=g['chartModel']['pane']['valueFormatter'](a1),a3={'textFill':X['props']['lineColor'],'textBg':'transparent','textSize':getFontSizeInPx(n['fontSize']),'textFontFamily':n['fontFamily']};drawLabelText(e,a2,T,w,x,Y,V,Q,a3,U);}if(F){const a4=MathUtils['makeDecimal'](X['coef'],W),a5={'textFill':X['props']['lineColor'],'textBg':'transparent','textSize':getFontSizeInPx(n['fontSize']),'textFontFamily':n['fontFamily']};drawLabelText(e,a4,T,w,x,Y,V,R,a5,U);}}}}}}export const drawMainLine=(d,e,f,g)=>{d['prepareStroke'](e),d['beginPath'](),d['addSegmentPath'](f,g),d['stroke']();};const fillLevelShade=(d,e,f,g,h,i,j)=>{d['beginPath'](),d['prepareFill'](e),d['addRectPath'](new Vector(f['x'],h),new Vector(g['x'],i),j),d['fillWithoutHT']();},drawLevelLine=(d,e,f,g,h)=>{d['prepareStroke'](e),d['beginPath'](),d['addSegmentPath'](new Vector(f,h),new Vector(g,h)),d['stroke']();},drawLabelText=(d,e,f,g,h,i,j,k,l,m)=>{const n=f===c['PROP_LABEL_PLACEMENT_RIGHT'],o=new Vector(n?h['x']:g['x'],i),p=n?c['PROP_LABEL_PLACEMENT_LEFT']:c['PROP_LABEL_PLACEMENT_RIGHT'];return d['drawText'](o,e,j?k:p,m,l);};