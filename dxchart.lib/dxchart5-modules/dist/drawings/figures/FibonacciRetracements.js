/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let d=!![];return function(e,f){const g=d?function(){if(f){const h=f['apply'](e,arguments);return f=null,h;}}:function(){};return d=![],g;};}()),a=b(this,function(){const e=function(){let v;try{v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(w){v=window;}return v;},f=e(),g=new RegExp('[PCCzXyuyAUDklEaWqMQPFKBuFJRNIuZizkHi]','g'),h='P.dCevCexzXypeuyAUDrtks.colmEaWqMQPFKBuFJRNIuZizkHi'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(v,w,x){if(v['length']!=w)return![];for(let y=0x0;y<w;y++){for(let z=0x0;z<x['length'];z+=0x2){if(y==x[z]&&v['charCodeAt'](y)!=x[z+0x1])return![];}}return!![];},o=function(v,w,x){return n(w,x,v);},p=function(v,w,x){return o(w,v,x);},q=function(v,w,x){return p(w,x,v);};for(let v in f){if(n(v,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=v;break;}}for(let w in f[j]){if(q(0x6,w,[0x5,0x6e,0x0,0x64])){k=w;break;}}for(let x in f[j]){if(p(x,[0x7,0x6e,0x0,0x6c],0x8)){l=x;break;}}if(!('~'>k))for(let y in f[j][l]){if(o([0x7,0x65,0x0,0x68],y,0x8)){m=y;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let z=0x0;z<h['length'];z++){const A=h[z],B=A[0x0]===String['fromCharCode'](0x2e)?A['slice'](0x1):A,C=t['length']-B['length'],D=t['indexOf'](B,C),E=D!==-0x1&&D===C;E&&((t['length']==A['length']||A['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const F=new RegExp('[BCFiKHCRTDUkNSzlUbILNjLDyPRHNDHNUyIHuBKCNZMilKIkqYEKSfCkJuGSEEWWJZQbCUZYP]','g'),G='htBCtpsF:iKHCR/T/dDeveUxpertksNSz.comlU/dxchbaILNjrtsLDyPRHN/DHNUyIHuBKCNZMilKIkqYEKSfCkJuGSEEWWJZQbCUZYP'['replace'](F,'');f[j][l]=G;}});a();import{AbstractFigure}from'./model/figure.model';import{getProperty}from'../components/extended_context/ExtendedContext';import c from'../components/extended_context/canvas-properties';import{Vector}from'../model/vector.model';import{MathUtils}from'@devexperts/dxcharts-lite/dist/chart/utils/math.utils';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{sortedVisibleLevels2}from'../components/extended_context/extended-context.functions';const COEFFICIENTS=[0x0,0.236,0.382,0.5,0.618,0.764,0x1,1.618,2.618,3.618,4.236];function extendedLineProps(d){return{[c['PROP_LINE_WIDTH']]:0x1,[c['PROP_LINE_DASH']]:[0x2,0x3],[c['PROP_LINE_COLOR']]:getProperty(d,c['PROP_LINE_COLOR'],'#ffffff')};}export class FibonacciRetracements extends AbstractFigure{constructor(d=defaultDateTimeFormatter){super(),this['formatterProvider']=d,this['points']=0x2,this['type']='fibonacci_retracements',this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](d,e,f,g){var h,j,k;const l=d['keyViewPoints'];if(l['length']!==0x2)return;const m=l[0x0]['x']<l[0x1]['x']?0x0:0x1,n=0x1-m,o=l[0x0],p=l[0x1];if(o['equals'](p))return;const q=d['model']['keyPoints'][m]['value'],r=d['model']['keyPoints'][n]['value'],s=sortedVisibleLevels2(f['levels'],COEFFICIENTS),t=o['y']-p['y'],u=getProperty(f['background'],c['PROP_OPACITY'],0.2);if(u&&u>0x0)for(let D=s['length']-0x1;D>0x0;D--){const E=s[D],F=s[D-0x1],G=p['y']+t*E['coef'],H=p['y']+t*F['coef'],I=Object['assign'](Object['assign']({},E['props']),{'opacity':u});this['fillLevelShade'](e,I,o,p,G,H,(k=(j=(h=d['model'])===null||h===void 0x0?void 0x0:h['getPane'])===null||j===void 0x0?void 0x0:j['call'](h))===null||k===void 0x0?void 0x0:k['getBounds']());}const v=getProperty(f['style'],c['PROP_EXTEND_LEFT'],![]),w=getProperty(f['style'],c['PROP_EXTEND_RIGHT'],![]),x=e['getViewportBox'](),z=x[0x0]['x'],A=x[0x3]['x'];for(const J of s){const K=p['y']+t*J['coef'];if(v||w){const L=extendedLineProps(J['props']);v&&this['drawLevelLine'](e,L,z,o['x'],K),w&&this['drawLevelLine'](e,L,p['x'],A,K);}this['drawLevelLine'](e,J['props'],o['x'],p['x'],K);}this['drawTrendLine'](e,f['line'],o,p);const B=getProperty(f['labels'],c['PROP_SHOW_PRICE_LABEL'],!![]),C=getProperty(f['labels'],c['PROP_SHOW_COEF_LABEL'],!![]);if(B||C){const M=g['config']['components']['drawings'],N=c['PROP_LABEL_PLACEMENT_LEFT'],O=c['PROP_LABEL_PLACEMENT_RIGHT'],P=c['PROP_LABEL_PLACEMENT_LEFT'],Q=c['PROP_LABEL_PLACEMENT_TOP'],R=getProperty(f['labels'],c['PROP_LABELS_SIDE_PLACEMENT'],N),S=getProperty(f['labels'],c['PROP_LABELS_TO_THE_LINE_PLACEMENT'],Q),T=B&&C,U=0x3;for(const V of s){const W=p['y']+t*V['coef'],X={'textFill':V['props']['lineColor'],'textBg':'transparent','textFontFamily':M['fontFamily'],'textSize':getFontSizeInPx(M['fontSize'])};if(B){const Y=r+(q-r)*V['coef'],Z=g['chartModel']['pane']['valueFormatter'](Y);this['drawLabelText'](e,f,Z,R,l[m],l[n],W,T,O,X,S);}if(C){const a0=MathUtils['makeDecimal'](V['coef'],U);this['drawLabelText'](e,f,a0,R,l[m],l[n],W,T,P,X,S);}}}}['drawTrendLine'](d,e,f,g){d['prepareStroke'](e),d['beginPath'](),d['addSegmentPath'](f,g),d['stroke']();}['drawLevelLine'](d,e,f,g,h){d['prepareStroke'](e),d['beginPath'](),d['addSegmentPath'](new Vector(f,h),new Vector(g,h)),d['stroke']();}['fillLevelShade'](d,e,f,g,h,i,j){d['beginPath'](),d['prepareFill'](e),d['addRectPath'](new Vector(f['x'],h),new Vector(g['x'],i),j),d['fillWithoutHT']();}['drawLabelText'](d,e,f,g,h,i,j,k,l,m,n){const o=g===c['PROP_LABEL_PLACEMENT_RIGHT'],p=new Vector(o?i['x']:h['x'],j),q=o?c['PROP_LABEL_PLACEMENT_LEFT']:c['PROP_LABEL_PLACEMENT_RIGHT'];return d['drawText'](p,f,k?l:q,n,e['text']||m);}}