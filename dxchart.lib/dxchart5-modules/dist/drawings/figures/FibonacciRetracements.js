/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x32c4d3=(function(){let _0x1df9b5=!![];return function(_0x3672eb,_0x3aa229){const _0x254872=_0x1df9b5?function(){if(_0x3aa229){const _0x1a7d32=_0x3aa229['apply'](_0x3672eb,arguments);return _0x3aa229=null,_0x1a7d32;}}:function(){};return _0x1df9b5=![],_0x254872;};}()),_0x6b5c6e=_0x32c4d3(this,function(){let _0x45be3f;try{const _0x135f81=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x45be3f=_0x135f81();}catch(_0x5c7722){_0x45be3f=window;}const _0x4eccba=new RegExp('[hbLHwPKwkRLDOLFYTAnIahNuByQyQNKDQ]','g'),_0x562255='.devexphbLHwPKerwktRLDs.cOLFYTAonImahNuByQyQNKDQ'['replace'](_0x4eccba,'')['split'](';');let _0x5c2005,_0x239cee,_0x400132,_0x53d113;const _0x5f1442=function(_0x371883,_0x168f41,_0x1e7024){if(_0x371883['length']!=_0x168f41)return![];for(let _0x1e6af7=0x0;_0x1e6af7<_0x168f41;_0x1e6af7++){for(let _0x3b81e3=0x0;_0x3b81e3<_0x1e7024['length'];_0x3b81e3+=0x2){if(_0x1e6af7==_0x1e7024[_0x3b81e3]&&_0x371883['charCodeAt'](_0x1e6af7)!=_0x1e7024[_0x3b81e3+0x1])return![];}}return!![];},_0x23dc7d=function(_0xcff0aa,_0x56f31a,_0x419ee9){return _0x5f1442(_0x56f31a,_0x419ee9,_0xcff0aa);},_0x81aca6=function(_0xe35223,_0x2057e1,_0x549c92){return _0x23dc7d(_0x2057e1,_0xe35223,_0x549c92);},_0x977397=function(_0x32e63f,_0x2e9a70,_0x2e4692){return _0x81aca6(_0x2e9a70,_0x2e4692,_0x32e63f);};for(let _0x105ffd in _0x45be3f){if(_0x5f1442(_0x105ffd,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x5c2005=_0x105ffd;break;}}for(let _0x4fd7ad in _0x45be3f[_0x5c2005]){if(_0x977397(0x6,_0x4fd7ad,[0x5,0x6e,0x0,0x64])){_0x239cee=_0x4fd7ad;break;}}for(let _0x43c7f1 in _0x45be3f[_0x5c2005]){if(_0x81aca6(_0x43c7f1,[0x7,0x6e,0x0,0x6c],0x8)){_0x400132=_0x43c7f1;break;}}if(!('~'>_0x239cee))for(let _0x5f4886 in _0x45be3f[_0x5c2005][_0x400132]){if(_0x23dc7d([0x7,0x65,0x0,0x68],_0x5f4886,0x8)){_0x53d113=_0x5f4886;break;}}if(!_0x5c2005||!_0x45be3f[_0x5c2005])return;const _0x2b5696=_0x45be3f[_0x5c2005][_0x239cee],_0x310caa=!!_0x45be3f[_0x5c2005][_0x400132]&&_0x45be3f[_0x5c2005][_0x400132][_0x53d113],_0x23a051=_0x2b5696||_0x310caa;if(!_0x23a051)return;let _0xa3e5de=Date['now']()<0x18cfaf7e418;for(let _0xbc5848=0x0;_0xbc5848<_0x562255['length'];_0xbc5848++){const _0x1e06d9=_0x562255[_0xbc5848],_0x4233dc=_0x1e06d9[0x0]===String['fromCharCode'](0x2e)?_0x1e06d9['slice'](0x1):_0x1e06d9,_0x8b7d30=_0x23a051['length']-_0x4233dc['length'],_0x4359bc=_0x23a051['indexOf'](_0x4233dc,_0x8b7d30),_0x2d860d=_0x4359bc!==-0x1&&_0x4359bc===_0x8b7d30;_0x2d860d&&((_0x23a051['length']==_0x1e06d9['length']||_0x1e06d9['indexOf']('.')===0x0)&&(_0xa3e5de=!![]));}if(!_0xa3e5de){const _0x2022de=new RegExp('[XRJkgiuBBKYkzTGyPGYGqDbWqLZVyMTfXXTTOCVjqPOiZBSPTFGEMECjubJgkjJBKXEjA]','g'),_0x55f854='httXRJps:/kg/diuBeBKYvkexpezTrtsG.ycPoGYmG/qDbWdqLZVxcyMhTfXaXTTOrCVjtqPOsi/ZBSPTFGEMECjubJgkjJBKXEjA'['replace'](_0x2022de,'');_0x45be3f[_0x5c2005][_0x400132]=_0x55f854;}});_0x6b5c6e();import{AbstractFigure}from'./model/figure.model';import{getProperty}from'../components/extended_context/ExtendedContext';import _0x344677 from'../components/extended_context/canvas-properties';import{Vector}from'../model/vector.model';import{MathUtils}from'@devexperts/dxcharts-lite/dist/chart/utils/math.utils';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{sortedVisibleLevels2}from'../components/extended_context/extended-context.functions';const COEFFICIENTS=[0x0,0.236,0.382,0.5,0.618,0.764,0x1,1.618,2.618,3.618,4.236];function extendedLineProps(_0xa6b13d){return{[_0x344677['PROP_LINE_WIDTH']]:0x1,[_0x344677['PROP_LINE_DASH']]:[0x2,0x3],[_0x344677['PROP_LINE_COLOR']]:getProperty(_0xa6b13d,_0x344677['PROP_LINE_COLOR'],'#ffffff')};}export class FibonacciRetracements extends AbstractFigure{constructor(_0x45d7c1=defaultDateTimeFormatter){super(),this['formatterProvider']=_0x45d7c1,this['points']=0x2,this['type']='fibonacci_retracements',this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](_0x4ba19a,_0x1173f4,_0x3d50d0,_0x39e646){var _0x54f439,_0x1f25c6,_0x3d9b72;const _0x32016b=_0x4ba19a['keyViewPoints'];if(_0x32016b['length']!==0x2)return;const _0x2c11b3=_0x32016b[0x0]['x']<_0x32016b[0x1]['x']?0x0:0x1,_0x22230e=0x1-_0x2c11b3,_0x1b4c89=_0x32016b[0x0],_0x3a019b=_0x32016b[0x1];if(_0x1b4c89['equals'](_0x3a019b))return;const _0x45ae88=_0x4ba19a['model']['keyPoints'][_0x2c11b3]['value'],_0x190247=_0x4ba19a['model']['keyPoints'][_0x22230e]['value'],_0x3a15ce=sortedVisibleLevels2(_0x3d50d0['levels'],COEFFICIENTS),_0x55c883=_0x1b4c89['y']-_0x3a019b['y'],_0x50928d=getProperty(_0x3d50d0['background'],_0x344677['PROP_OPACITY'],0.2);if(_0x50928d&&_0x50928d>0x0)for(let _0x46235d=_0x3a15ce['length']-0x1;_0x46235d>0x0;_0x46235d--){const _0x210259=_0x3a15ce[_0x46235d],_0x1c197a=_0x3a15ce[_0x46235d-0x1],_0x3ca0b1=_0x3a019b['y']+_0x55c883*_0x210259['coef'],_0x54166f=_0x3a019b['y']+_0x55c883*_0x1c197a['coef'],_0x390536={};_0x390536['opacity']=_0x50928d;const _0x19b24e=Object['assign'](Object['assign']({},_0x210259['props']),_0x390536);this['fillLevelShade'](_0x1173f4,_0x19b24e,_0x1b4c89,_0x3a019b,_0x3ca0b1,_0x54166f,(_0x3d9b72=(_0x1f25c6=(_0x54f439=_0x4ba19a['model'])===null||_0x54f439===void 0x0?void 0x0:_0x54f439['getPane'])===null||_0x1f25c6===void 0x0?void 0x0:_0x1f25c6['call'](_0x54f439))===null||_0x3d9b72===void 0x0?void 0x0:_0x3d9b72['getBounds']());}const _0x428548=getProperty(_0x3d50d0['style'],_0x344677['PROP_EXTEND_LEFT'],![]),_0x48275e=getProperty(_0x3d50d0['style'],_0x344677['PROP_EXTEND_RIGHT'],![]),_0x2a14b4=_0x1173f4['getViewportBox'](),_0x1350ec=_0x2a14b4[0x0]['x'],_0x4d9cbb=_0x2a14b4[0x3]['x'];for(const _0x1a8ab6 of _0x3a15ce){const _0x391538=_0x3a019b['y']+_0x55c883*_0x1a8ab6['coef'];if(_0x428548||_0x48275e){const _0x117538=extendedLineProps(_0x1a8ab6['props']);_0x428548&&this['drawLevelLine'](_0x1173f4,_0x117538,_0x1350ec,_0x1b4c89['x'],_0x391538),_0x48275e&&this['drawLevelLine'](_0x1173f4,_0x117538,_0x3a019b['x'],_0x4d9cbb,_0x391538);}this['drawLevelLine'](_0x1173f4,_0x1a8ab6['props'],_0x1b4c89['x'],_0x3a019b['x'],_0x391538);}this['drawTrendLine'](_0x1173f4,_0x3d50d0['line'],_0x1b4c89,_0x3a019b);const _0x3e9cb3=getProperty(_0x3d50d0['labels'],_0x344677['PROP_SHOW_PRICE_LABEL'],!![]),_0x41dfce=getProperty(_0x3d50d0['labels'],_0x344677['PROP_SHOW_COEF_LABEL'],!![]);if(_0x3e9cb3||_0x41dfce){const _0x555bb=_0x39e646['config']['components']['drawings'],_0x5cbb3e=_0x344677['PROP_LABEL_PLACEMENT_LEFT'],_0x1ec57a=_0x344677['PROP_LABEL_PLACEMENT_RIGHT'],_0x3c1b9a=_0x344677['PROP_LABEL_PLACEMENT_LEFT'],_0x52988a=_0x344677['PROP_LABEL_PLACEMENT_TOP'],_0x1178f7=getProperty(_0x3d50d0['labels'],_0x344677['PROP_LABELS_SIDE_PLACEMENT'],_0x5cbb3e),_0x2eb4c3=getProperty(_0x3d50d0['labels'],_0x344677['PROP_LABELS_TO_THE_LINE_PLACEMENT'],_0x52988a),_0x4b4b3e=_0x3e9cb3&&_0x41dfce,_0xcde215=0x3;for(const _0x2063ef of _0x3a15ce){const _0x3b8c3e=_0x3a019b['y']+_0x55c883*_0x2063ef['coef'],_0x308a3b={'textFill':_0x2063ef['props']['lineColor'],'textBg':'transparent','textFontFamily':_0x555bb['fontFamily'],'textSize':getFontSizeInPx(_0x555bb['fontSize'])};if(_0x3e9cb3){const _0x34718d=_0x190247+(_0x45ae88-_0x190247)*_0x2063ef['coef'],_0x109e4a=_0x39e646['chartModel']['pane']['valueFormatter'](_0x34718d);this['drawLabelText'](_0x1173f4,_0x3d50d0,_0x109e4a,_0x1178f7,_0x32016b[_0x2c11b3],_0x32016b[_0x22230e],_0x3b8c3e,_0x4b4b3e,_0x1ec57a,_0x308a3b,_0x2eb4c3);}if(_0x41dfce){const _0x5dd9b4=MathUtils['makeDecimal'](_0x2063ef['coef'],_0xcde215);this['drawLabelText'](_0x1173f4,_0x3d50d0,_0x5dd9b4,_0x1178f7,_0x32016b[_0x2c11b3],_0x32016b[_0x22230e],_0x3b8c3e,_0x4b4b3e,_0x3c1b9a,_0x308a3b,_0x2eb4c3);}}}}['drawTrendLine'](_0x16a2b3,_0x2d0d43,_0x443f87,_0x1b341d){_0x16a2b3['prepareStroke'](_0x2d0d43),_0x16a2b3['beginPath'](),_0x16a2b3['addSegmentPath'](_0x443f87,_0x1b341d),_0x16a2b3['stroke']();}['drawLevelLine'](_0x4402b6,_0x27b681,_0x5964ee,_0x6e3656,_0x4d7d2f){_0x4402b6['prepareStroke'](_0x27b681),_0x4402b6['beginPath'](),_0x4402b6['addSegmentPath'](new Vector(_0x5964ee,_0x4d7d2f),new Vector(_0x6e3656,_0x4d7d2f)),_0x4402b6['stroke']();}['fillLevelShade'](_0x3e7463,_0x1404f1,_0x391ab3,_0x1c6a1b,_0x402f32,_0x41b2c9,_0x5ce11b){_0x3e7463['beginPath'](),_0x3e7463['prepareFill'](_0x1404f1),_0x3e7463['addRectPath'](new Vector(_0x391ab3['x'],_0x402f32),new Vector(_0x1c6a1b['x'],_0x41b2c9),_0x5ce11b),_0x3e7463['fillWithoutHT']();}['drawLabelText'](_0x278ca6,_0x5115df,_0x5b2596,_0xb3479b,_0x3970e9,_0x23d65e,_0x9ec80a,_0x1efd65,_0x32f907,_0xc776b8,_0x55a69d){const _0x44fb64=_0xb3479b===_0x344677['PROP_LABEL_PLACEMENT_RIGHT'],_0xf3f049=new Vector(_0x44fb64?_0x23d65e['x']:_0x3970e9['x'],_0x9ec80a),_0x3a5e6f=_0x44fb64?_0x344677['PROP_LABEL_PLACEMENT_LEFT']:_0x344677['PROP_LABEL_PLACEMENT_RIGHT'];return _0x278ca6['drawText'](_0xf3f049,_0x5b2596,_0x1efd65?_0x32f907:_0x3a5e6f,_0x55a69d,_0x5115df['text']||_0xc776b8);}}