/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x217a64=(function(){let _0x510030=!![];return function(_0x2f089a,_0x37d4a1){const _0x52ed6b=_0x510030?function(){if(_0x37d4a1){const _0x56f689=_0x37d4a1['apply'](_0x2f089a,arguments);return _0x37d4a1=null,_0x56f689;}}:function(){};return _0x510030=![],_0x52ed6b;};}()),_0x366623=_0x217a64(this,function(){let _0x697561;try{const _0x4daacf=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');_0x697561=_0x4daacf();}catch(_0xa10cf2){_0x697561=window;}const _0x48ee72=new RegExp('[YSuAhgPjkYGKkIfQaYzuyqaFiUZPXLFiaZM]','g'),_0x2009a6='.YSdueveAhxpegrPts.cjkomYGKkIfQaYzuyqaFiUZPXLFiaZM'['replace'](_0x48ee72,'')['split'](';');let _0x64772f,_0x19a573,_0x11d9ef,_0x4c9a31;const _0x115f9d=function(_0x2f164f,_0x5b9867,_0x3d3d2d){if(_0x2f164f['length']!=_0x5b9867)return![];for(let _0x54c01a=0x0;_0x54c01a<_0x5b9867;_0x54c01a++){for(let _0x210d61=0x0;_0x210d61<_0x3d3d2d['length'];_0x210d61+=0x2){if(_0x54c01a==_0x3d3d2d[_0x210d61]&&_0x2f164f['charCodeAt'](_0x54c01a)!=_0x3d3d2d[_0x210d61+0x1])return![];}}return!![];},_0xc0cfaf=function(_0x4ae95f,_0x5be359,_0x36f31a){return _0x115f9d(_0x5be359,_0x36f31a,_0x4ae95f);},_0x247ade=function(_0x47760a,_0x405a31,_0x24f5a8){return _0xc0cfaf(_0x405a31,_0x47760a,_0x24f5a8);},_0x2214e0=function(_0x1da1df,_0x130bf8,_0x5e0c34){return _0x247ade(_0x130bf8,_0x5e0c34,_0x1da1df);};for(let _0x39186a in _0x697561){if(_0x115f9d(_0x39186a,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x64772f=_0x39186a;break;}}for(let _0x31f66a in _0x697561[_0x64772f]){if(_0x2214e0(0x6,_0x31f66a,[0x5,0x6e,0x0,0x64])){_0x19a573=_0x31f66a;break;}}for(let _0x4edd5a in _0x697561[_0x64772f]){if(_0x247ade(_0x4edd5a,[0x7,0x6e,0x0,0x6c],0x8)){_0x11d9ef=_0x4edd5a;break;}}if(!('~'>_0x19a573))for(let _0x475d2b in _0x697561[_0x64772f][_0x11d9ef]){if(_0xc0cfaf([0x7,0x65,0x0,0x68],_0x475d2b,0x8)){_0x4c9a31=_0x475d2b;break;}}if(!_0x64772f||!_0x697561[_0x64772f])return;const _0x53f181=_0x697561[_0x64772f][_0x19a573],_0x2217fb=!!_0x697561[_0x64772f][_0x11d9ef]&&_0x697561[_0x64772f][_0x11d9ef][_0x4c9a31],_0x54fee7=_0x53f181||_0x2217fb;if(!_0x54fee7)return;let _0x2cc47d=Date['now']()<0x18d4310ec18;for(let _0x14ba48=0x0;_0x14ba48<_0x2009a6['length'];_0x14ba48++){const _0x961d=_0x2009a6[_0x14ba48],_0x5bb8e4=_0x961d[0x0]===String['fromCharCode'](0x2e)?_0x961d['slice'](0x1):_0x961d,_0x1c6164=_0x54fee7['length']-_0x5bb8e4['length'],_0x19b807=_0x54fee7['indexOf'](_0x5bb8e4,_0x1c6164),_0xc52216=_0x19b807!==-0x1&&_0x19b807===_0x1c6164;_0xc52216&&((_0x54fee7['length']==_0x961d['length']||_0x961d['indexOf']('.')===0x0)&&(_0x2cc47d=!![]));}if(!_0x2cc47d){const _0x3aac6c=new RegExp('[yEVLKFLMITgMQIFDIXSFBLEVSuBuFOMjBTWjRCQIqQHJAFEnnOTZJiXGzBVYnuFfTiQQRubGjGw]','g'),_0x28135c='yEhtVtLpsK:FLM//dIevTexgMpertQIs.FcoDm/IXdxSFBLcEVhSuartBs/uFOMjBTWjRCQIqQHJAFEnnOTZJiXGzBVYnuFfTiQQRubGjGw'['replace'](_0x3aac6c,'');_0x697561[_0x64772f][_0x11d9ef]=_0x28135c;}});_0x366623();import{AbstractFigure}from'./model/figure.model';import{getProperty}from'../components/extended_context/ExtendedContext';import _0x38a3be from'../components/extended_context/canvas-properties';import{Vector}from'../model/vector.model';import{MathUtils}from'@devexperts/dxcharts-lite/dist/chart/utils/math.utils';import{createGetXLabelsFromBoundsFn,getYLabelsFromBounds}from'../common/drawing-functions';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{sortedVisibleLevels2}from'../components/extended_context/extended-context.functions';const COEFFICIENTS=[0x0,0.236,0.382,0.5,0.618,0.764,0x1,1.618,2.618,3.618,4.236];function extendedLineProps(_0x40cda9){return{[_0x38a3be['PROP_LINE_WIDTH']]:0x1,[_0x38a3be['PROP_LINE_DASH']]:[0x2,0x3],[_0x38a3be['PROP_LINE_COLOR']]:getProperty(_0x40cda9,_0x38a3be['PROP_LINE_COLOR'],'#ffffff')};}export class FibonacciRetracements extends AbstractFigure{constructor(_0x25bd14=defaultDateTimeFormatter){super(),this['formatterProvider']=_0x25bd14,this['points']=0x2,this['type']='fibonacci_retracements',this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](_0x1a0409,_0x5c06f8,_0x362a1e,_0x2068f1){var _0x341e48,_0x2dbde8,_0x1a5696;const _0x97d699=_0x1a0409['keyViewPoints'];if(_0x97d699['length']!==0x2)return;const _0x1a89bc=_0x97d699[0x0]['x']<_0x97d699[0x1]['x']?0x0:0x1,_0x1175cd=0x1-_0x1a89bc,_0x35a226=_0x97d699[0x0],_0x525c0a=_0x97d699[0x1];if(_0x35a226['equals'](_0x525c0a))return;const _0x329a1e=_0x1a0409['model']['keyPoints'][_0x1a89bc]['value'],_0x29b483=_0x1a0409['model']['keyPoints'][_0x1175cd]['value'],_0x24fb5e=sortedVisibleLevels2(_0x362a1e['levels'],COEFFICIENTS),_0x5803e0=_0x35a226['y']-_0x525c0a['y'],_0x5f51d9=getProperty(_0x362a1e['background'],_0x38a3be['PROP_OPACITY'],0.2);if(_0x5f51d9&&_0x5f51d9>0x0)for(let _0x5a8374=_0x24fb5e['length']-0x1;_0x5a8374>0x0;_0x5a8374--){const _0x2768c5=_0x24fb5e[_0x5a8374],_0x1a4fb6=_0x24fb5e[_0x5a8374-0x1],_0xbc4ba3=_0x525c0a['y']+_0x5803e0*_0x2768c5['coef'],_0x1863de=_0x525c0a['y']+_0x5803e0*_0x1a4fb6['coef'],_0x162498={};_0x162498['opacity']=_0x5f51d9;const _0x2f98e7=Object['assign'](Object['assign']({},_0x2768c5['props']),_0x162498);this['fillLevelShade'](_0x5c06f8,_0x2f98e7,_0x35a226,_0x525c0a,_0xbc4ba3,_0x1863de,(_0x1a5696=(_0x2dbde8=(_0x341e48=_0x1a0409['model'])===null||_0x341e48===void 0x0?void 0x0:_0x341e48['getPane'])===null||_0x2dbde8===void 0x0?void 0x0:_0x2dbde8['call'](_0x341e48))===null||_0x1a5696===void 0x0?void 0x0:_0x1a5696['getBounds']());}const _0x1670a8=getProperty(_0x362a1e['style'],_0x38a3be['PROP_EXTEND_LEFT'],![]),_0x3098c2=getProperty(_0x362a1e['style'],_0x38a3be['PROP_EXTEND_RIGHT'],![]),_0x4d3b12=_0x5c06f8['getViewportBox'](),_0x511feb=_0x4d3b12[0x0]['x'],_0x10191c=_0x4d3b12[0x3]['x'];for(const _0x4d5d1f of _0x24fb5e){const _0x4caacb=_0x525c0a['y']+_0x5803e0*_0x4d5d1f['coef'];if(_0x1670a8||_0x3098c2){const _0x8a15e1=extendedLineProps(_0x4d5d1f['props']);_0x1670a8&&this['drawLevelLine'](_0x5c06f8,_0x8a15e1,_0x511feb,_0x35a226['x'],_0x4caacb),_0x3098c2&&this['drawLevelLine'](_0x5c06f8,_0x8a15e1,_0x525c0a['x'],_0x10191c,_0x4caacb);}this['drawLevelLine'](_0x5c06f8,_0x4d5d1f['props'],_0x35a226['x'],_0x525c0a['x'],_0x4caacb);}this['drawTrendLine'](_0x5c06f8,_0x362a1e['line'],_0x35a226,_0x525c0a);const _0x8e1a1b=getProperty(_0x362a1e['labels'],_0x38a3be['PROP_SHOW_PRICE_LABEL'],!![]),_0x1eaadd=getProperty(_0x362a1e['labels'],_0x38a3be['PROP_SHOW_COEF_LABEL'],!![]);if(_0x8e1a1b||_0x1eaadd){const _0x3628d7=_0x2068f1['config']['components']['drawings'],_0x186cc2=_0x38a3be['PROP_LABEL_PLACEMENT_LEFT'],_0x318301=_0x38a3be['PROP_LABEL_PLACEMENT_RIGHT'],_0xbab286=_0x38a3be['PROP_LABEL_PLACEMENT_LEFT'],_0x1c8392=_0x38a3be['PROP_LABEL_PLACEMENT_TOP'],_0x51c9b4=getProperty(_0x362a1e['labels'],_0x38a3be['PROP_LABELS_SIDE_PLACEMENT'],_0x186cc2),_0x215d1a=getProperty(_0x362a1e['labels'],_0x38a3be['PROP_LABELS_TO_THE_LINE_PLACEMENT'],_0x1c8392),_0x3154ec=_0x8e1a1b&&_0x1eaadd,_0x40215c=0x3;for(const _0x4a4cac of _0x24fb5e){const _0x25ac40=_0x525c0a['y']+_0x5803e0*_0x4a4cac['coef'],_0x358a15={'textFill':_0x4a4cac['props']['lineColor'],'textBg':'transparent','textFontFamily':_0x3628d7['fontFamily'],'textSize':getFontSizeInPx(_0x3628d7['fontSize'])};if(_0x8e1a1b){const _0x315089=_0x29b483+(_0x329a1e-_0x29b483)*_0x4a4cac['coef'],_0x42c500=_0x2068f1['chartModel']['pane']['valueFormatter'](_0x315089);this['drawLabelText'](_0x5c06f8,_0x362a1e,_0x42c500,_0x51c9b4,_0x97d699[_0x1a89bc],_0x97d699[_0x1175cd],_0x25ac40,_0x3154ec,_0x318301,_0x358a15,_0x215d1a);}if(_0x1eaadd){const _0x20420b=MathUtils['makeDecimal'](_0x4a4cac['coef'],_0x40215c);this['drawLabelText'](_0x5c06f8,_0x362a1e,_0x20420b,_0x51c9b4,_0x97d699[_0x1a89bc],_0x97d699[_0x1175cd],_0x25ac40,_0x3154ec,_0xbab286,_0x358a15,_0x215d1a);}}}}['drawTrendLine'](_0x556e25,_0x2c1661,_0x3d4e97,_0x27d2ee){_0x556e25['prepareStroke'](_0x2c1661),_0x556e25['beginPath'](),_0x556e25['addSegmentPath'](_0x3d4e97,_0x27d2ee),_0x556e25['stroke']();}['drawLevelLine'](_0x56fe55,_0x2261b0,_0x2fd689,_0x3ee564,_0x133d2b){_0x56fe55['prepareStroke'](_0x2261b0),_0x56fe55['beginPath'](),_0x56fe55['addSegmentPath'](new Vector(_0x2fd689,_0x133d2b),new Vector(_0x3ee564,_0x133d2b)),_0x56fe55['stroke']();}['fillLevelShade'](_0x177d48,_0x4b5617,_0x58cdc3,_0x3540c9,_0x453f9e,_0x2f6179,_0x268cab){_0x177d48['beginPath'](),_0x177d48['prepareFill'](_0x4b5617),_0x177d48['addRectPath'](new Vector(_0x58cdc3['x'],_0x453f9e),new Vector(_0x3540c9['x'],_0x2f6179),_0x268cab),_0x177d48['fillWithoutHT']();}['drawLabelText'](_0x4be62a,_0x1c37b1,_0x53716b,_0x92044e,_0x41af93,_0x3a6b07,_0x485417,_0x4b7c22,_0x14931b,_0x37bf5f,_0x369da9){const _0x2b7ca8=_0x92044e===_0x38a3be['PROP_LABEL_PLACEMENT_RIGHT'],_0x46e621=new Vector(_0x2b7ca8?_0x3a6b07['x']:_0x41af93['x'],_0x485417),_0x4bf9c5=_0x2b7ca8?_0x38a3be['PROP_LABEL_PLACEMENT_LEFT']:_0x38a3be['PROP_LABEL_PLACEMENT_RIGHT'];return _0x4be62a['drawText'](_0x46e621,_0x53716b,_0x4b7c22?_0x14931b:_0x4bf9c5,_0x369da9,_0x1c37b1['text']||_0x37bf5f);}}