/** Copyright ©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let e=!![];return function(f,g){const h=e?function(){if(g){const i=g['apply'](f,arguments);return g=null,i;}}:function(){};return e=![],h;};}()),a=b(this,function(){let f;try{const v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');f=v();}catch(w){f=window;}const g=new RegExp('[zGRSyTSHBXZkEywPPKXBzAnnXnADXSO]','g'),h='.zGRdeSyvexpeTSHrBtXs.ZckomEywPPKXBzAnnXnADXSO'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(x,y,z){if(x['length']!=y)return![];for(let A=0x0;A<y;A++){for(let B=0x0;B<z['length'];B+=0x2){if(A==z[B]&&x['charCodeAt'](A)!=z[B+0x1])return![];}}return!![];},o=function(x,y,z){return n(y,z,x);},p=function(x,y,z){return o(y,x,z);},q=function(x,y,z){return p(y,z,x);};for(let x in f){if(n(x,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=x;break;}}for(let y in f[j]){if(q(0x6,y,[0x5,0x6e,0x0,0x64])){k=y;break;}}for(let z in f[j]){if(p(z,[0x7,0x6e,0x0,0x6c],0x8)){l=z;break;}}if(!('~'>k))for(let A in f[j][l]){if(o([0x7,0x65,0x0,0x68],A,0x8)){m=A;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let B=0x0;B<h['length'];B++){const C=h[B],D=C[0x0]===String['fromCharCode'](0x2e)?C['slice'](0x1):C,E=t['length']-D['length'],F=t['indexOf'](D,E),G=F!==-0x1&&F===E;G&&((t['length']==C['length']||C['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const H=new RegExp('[JUCyFbkQuRKiwAKWyFLJqQfqJJuOGJFTJSgLwuAnCqzbGPunZqkDUnnuTTuDPUYYAFCSJk]','g'),I='htJtUpsC:y//dFebvkQeuRxpKiewrAKWyFtsLJq.QfqJJuOGJcFoTm/JSdgLxchawurAtsnC/qzbGPunZqkDUnnuTTuDPUYYAFCSJk'['replace'](H,'');f[j][l]=I;}});a();import c from'../../components/extended_context/canvas-properties';import{getProperty}from'../../components/extended_context/ExtendedContext';import{Vector}from'../../model/vector.model';import{differenceInDays,formatDuration,intervalToDuration}from'date-fns';import*as d from'color';import{calculateTextWidth}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-font-measure-tool.utils';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';export function measureBox(e,f,g,h,i,j,k,l){var m,n,o,p;const q=i['measureBox'],r=g['config']['components']['drawings'],s=getProperty(i,c['PROPERTY_BLOCK_TYPE_TEXT'],{'textFill':g['config']['colors']['drawingsTheme']['textColor'],'textBg':g['config']['colors']['drawingsTheme']['textBg'],'textStyle':{},'backgroundOffsetWidth':0x0,'backgroundOffsetHeight':0x0,'availableBackgroundColors':[]}),t=Object['assign'](Object['assign']({},s),{'textSize':getFontSizeInPx(r['fontSize']),'textFontFamily':r['fontFamily'],'textFill':d['rgb']((m=g['config']['colors']['drawingsTheme']['textColor'])!==null&&m!==void 0x0?m:'')['toString'](),'textBg':d['rgb']((n=g['config']['colors']['drawingsTheme']['textBg'])!==null&&n!==void 0x0?n:'')['toString']()}),u=getProperty(q,c['PROP_SHOW_PRICE_CHANGE_DISTANCE'],![]),v=getProperty(q,c['PROP_SHOW_PRICE_CHANGE_ABS'],!![]),w=getProperty(q,c['PROP_SHOW_PRICE_CHANGE_PERCENT'],!![]),x=getProperty(q,c['PROP_SHOW_BARS_BOX'],![]),y=getProperty(q,c['PROP_SHOW_TIME_DIFF_BOX'],![]),z=getProperty(q,c['PROP_SHOW_DISTANCE_BOX'],![]),A=getProperty(q,c['PROP_SHOW_ANGLE_BOX'],![]),B=getProperty(q,c['PROP_POSITION_BOX'],c['PROP_POSITION_MIDDLE_BOX']),[C,D]=[j[0x0],j[0x1]],E=x||y||z||A,F=v||w||E;if(F&&e['model']['keyPoints']['length']===j['length']){const G=i['labels']?getProperty(i['labels'],c['PROP_PRICE_LABEL_PLACEMENT'],c['PROP_LABEL_PLACEMENT_RIGHT']):c['PROP_LABEL_PLACEMENT_RIGHT'],H=k?getProperty(k,c['PROP_PRICE_LABEL_PLACEMENT'],G):G,I=C['x']<=D['x'],J=C['y']>=D['y'],[K,L]=I?[0x0,0x1]:[0x1,0x0],M=g['chartModel']['candleFromX'](C['x'],!![]),N=g['chartModel']['candleFromX'](D['x'],!![]),O=x?''+(((o=N['idx'])!==null&&o!==void 0x0?o:0x0)-((p=M['idx'])!==null&&p!==void 0x0?p:0x0)):'',P=y?getDateDiff(M['timestamp'],N['timestamp'],I):'',Q=z?getDistanceDiff(C,D):'',R=A?getMeasuredAngle(C,D,I,J):'',S=e['model']['keyPoints'],T=S[K],U=S[L],V=C['y']>=D['y']&&H===c['PROP_POSITION_RIGHT_BOX']?Math['abs'](U['value']-T['value']):-Math['abs'](U['value']-T['value']),W=h['scale']['inverseY'],X=W?-V:V,Y=Math['round'](X/T['value']*0x2710)/0x64,Z=Math['round'](X*0x64),a0=X<0x0?c['PROP_TOP_PLACEMENT_BOX']:c['PROP_BOTTOM_PLACEMENT_BOX'],a1=k?getProperty(k,'yPlacement',a0):a0,a2=getFirstLineOfMB(v,X,w,Y,u,Z),a3=getSecondLineOfMB(O,P,Q),a4=getThirdLineOfMB(R),a5=[l==='date'?null:a2,a3,a4]['filter'](Boolean)['join']('\x0d\x0a'),a6=t['textSize']+'\x20'+t['textFontFamily'],a7=Math['max'](...[a2,a3,a4]['map'](ae=>calculateTextWidth(ae,f['context'],a6))),a8=new Vector(a7/0x2+t['backgroundOffsetWidth'],0x0),a9=C['add'](D)['divide'](0x2),aa=C['add'](D)['divide'](0x2)['subtract'](a8),ab={[c['PROP_POSITION_CENTER_BOX']]:aa,[c['PROP_POSITION_MIDDLE_BOX']]:a9,[c['PROP_POSITION_LEFT_BOX']]:C,[c['PROP_POSITION_RIGHT_BOX']]:D},ac=k?getProperty(k,'yValue',ab[B]['y']):ab[B]['y'],ad=new Vector(ab[B]['x'],ac);e['addTextBlock'](f['drawText'](ad,a5,H,a1,Object['assign']({},t),undefined,{'left':c['PROP_POSITION_LEFT_BOX'],'top':c['PROP_TOP_PLACEMENT_BOX'],'center':c['PROP_POSITION_CENTER_BOX'],'middle':c['PROP_POSITION_MIDDLE_BOX']},!![]),0x0);}}const getFirstLineOfMB=(e,f,g,h,i,j)=>{const k='('+h+'\x20%)',l=''+j,m=''+f['toFixed'](0x2);return(e?m:'')+'\x20'+(g?k:'')+'\x20'+(i?l:'');};function getSecondLineOfMB(e,f,g){let h='';const i=Boolean(e),j=Boolean(f),k=Boolean(g);i&&(parseInt(e,0xa)===0x1?h=h['concat'](e+'\x20bar'):h=h['concat'](e+'\x20bars'));i&&j?h=h['concat']('\x20('+f+')'):h=h['concat'](f);if((i||j)&&k)h=h['concat'](',\x20distance:\x20'+g+'\x20px');else g&&(h=h['concat']('distance:\x20'+g+'\x20px'));return h;}function getThirdLineOfMB(e){return Boolean(e)?e['concat']('°'):'';}function getDateDiff(e,f,g){const h=Object['assign'](Object['assign']({},intervalToDuration({'start':f,'end':e})),{'days':Math['abs'](differenceInDays(f,e))}),i=formatDuration(h,{'format':['days','hours','minutes']});return g?i:'-'+i;}function getDistanceDiff(e,f){const g=Math['floor'](e['distance'](f['x'],f['y']));return''+g;}function getMeasuredAngle(e,f,g,h){const i=f['subtract'](e),j=i['angle'];let k;if(g&&h)k=-j;else!g&&h?k=0x2*Math['PI']-j:k=-j;let l=Math['round'](Vector['toDeg'](k));return l===0x0&&(l=Math['abs'](l)),''+l;}