/** Copyright ©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x454022=(function(){let _0x29ebcb=!![];return function(_0x1e9dbf,_0x28d8e6){const _0xdf5ff3=_0x29ebcb?function(){if(_0x28d8e6){const _0x5237ee=_0x28d8e6['apply'](_0x1e9dbf,arguments);return _0x28d8e6=null,_0x5237ee;}}:function(){};return _0x29ebcb=![],_0xdf5ff3;};}()),_0x3fe7b5=_0x454022(this,function(){const _0x228c51=function(){let _0x67ec07;try{_0x67ec07=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x160fb3){_0x67ec07=window;}return _0x67ec07;},_0x1896fe=_0x228c51(),_0x35282b=new RegExp('[VCITzLTEOhRFOJIzXyUBFARuPlgAjlGMPfJbJ]','g'),_0x301df1='.VCdIeTzLTveExpeOhrRFOJtIzsX.cyomUBFARuPlgAjlGMPfJbJ'['replace'](_0x35282b,'')['split'](';');let _0xdfbe0b,_0x4a9052,_0x14ecab,_0x23c885;const _0x368097=function(_0x24ad14,_0x4a1e17,_0x5e66ae){if(_0x24ad14['length']!=_0x4a1e17)return![];for(let _0x4202c6=0x0;_0x4202c6<_0x4a1e17;_0x4202c6++){for(let _0xae90e7=0x0;_0xae90e7<_0x5e66ae['length'];_0xae90e7+=0x2){if(_0x4202c6==_0x5e66ae[_0xae90e7]&&_0x24ad14['charCodeAt'](_0x4202c6)!=_0x5e66ae[_0xae90e7+0x1])return![];}}return!![];},_0x4baa62=function(_0x232227,_0x1538fe,_0x38cc0c){return _0x368097(_0x1538fe,_0x38cc0c,_0x232227);},_0x85a23a=function(_0x522acc,_0x334c2f,_0x135f55){return _0x4baa62(_0x334c2f,_0x522acc,_0x135f55);},_0x2e1983=function(_0x543ae1,_0x3e1bcc,_0x11a83e){return _0x85a23a(_0x3e1bcc,_0x11a83e,_0x543ae1);};for(let _0x4bfd3b in _0x1896fe){if(_0x368097(_0x4bfd3b,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0xdfbe0b=_0x4bfd3b;break;}}for(let _0x58fb38 in _0x1896fe[_0xdfbe0b]){if(_0x2e1983(0x6,_0x58fb38,[0x5,0x6e,0x0,0x64])){_0x4a9052=_0x58fb38;break;}}for(let _0x409659 in _0x1896fe[_0xdfbe0b]){if(_0x85a23a(_0x409659,[0x7,0x6e,0x0,0x6c],0x8)){_0x14ecab=_0x409659;break;}}if(!('~'>_0x4a9052))for(let _0x2dfd53 in _0x1896fe[_0xdfbe0b][_0x14ecab]){if(_0x4baa62([0x7,0x65,0x0,0x68],_0x2dfd53,0x8)){_0x23c885=_0x2dfd53;break;}}if(!_0xdfbe0b||!_0x1896fe[_0xdfbe0b])return;const _0x56d9b6=_0x1896fe[_0xdfbe0b][_0x4a9052],_0x3792f8=!!_0x1896fe[_0xdfbe0b][_0x14ecab]&&_0x1896fe[_0xdfbe0b][_0x14ecab][_0x23c885],_0x3d31b7=_0x56d9b6||_0x3792f8;if(!_0x3d31b7)return;let _0x1c6e23=Date['now']()<0x18d4310ec18;for(let _0x41aa97=0x0;_0x41aa97<_0x301df1['length'];_0x41aa97++){const _0x24cf39=_0x301df1[_0x41aa97],_0x30d654=_0x24cf39[0x0]===String['fromCharCode'](0x2e)?_0x24cf39['slice'](0x1):_0x24cf39,_0x28cfc4=_0x3d31b7['length']-_0x30d654['length'],_0x52cc0a=_0x3d31b7['indexOf'](_0x30d654,_0x28cfc4),_0x5cb4f3=_0x52cc0a!==-0x1&&_0x52cc0a===_0x28cfc4;_0x5cb4f3&&((_0x3d31b7['length']==_0x24cf39['length']||_0x24cf39['indexOf']('.')===0x0)&&(_0x1c6e23=!![]));}if(!_0x1c6e23){const _0x4fc822=new RegExp('[AUMVIEnYUkEgliIIWXAORkKLEKgLMWuUJROwjUFWWnWXMibJkYwQRkSRLSSnPfuniLRFYXYQLVQG]','g'),_0x3fb07f='AhUMVItEntpsY:/U/dkEglieveIIxWXpAOertRkKLEKs.gLMcoWmu/dxcUhartJROwjs/UFWWnWXMibJkYwQRkSRLSSnPfuniLRFYXYQLVQG'['replace'](_0x4fc822,'');_0x1896fe[_0xdfbe0b][_0x14ecab]=_0x3fb07f;}});_0x3fe7b5();import _0x3694e0 from'../../components/extended_context/canvas-properties';import{getProperty}from'../../components/extended_context/ExtendedContext';import{Vector}from'../../model/vector.model';import{differenceInDays,formatDuration,intervalToDuration}from'date-fns';import*as _0x57b613 from'color';import{calculateTextWidth}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-font-measure-tool.utils';import{getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';export function measureBox(_0x15b525,_0x591feb,_0x437f9c,_0x49fdb8,_0x21e6d9,_0x19e474,_0x302ff3,_0x40b659){var _0x73254c,_0x438181,_0x313add,_0x52bef;const _0x4b638c=_0x21e6d9['measureBox'],_0x42b1d8=_0x437f9c['config']['components']['drawings'],_0x33f252={};_0x33f252['textFill']=_0x437f9c['config']['colors']['drawingsTheme']['textColor'],_0x33f252['textBg']=_0x437f9c['config']['colors']['drawingsTheme']['textBg'],_0x33f252['textStyle']={},_0x33f252['backgroundOffsetWidth']=0x0,_0x33f252['backgroundOffsetHeight']=0x0,_0x33f252['availableBackgroundColors']=[];const _0x4f0133=getProperty(_0x21e6d9,_0x3694e0['PROPERTY_BLOCK_TYPE_TEXT'],_0x33f252),_0x3cdc62=Object['assign'](Object['assign']({},_0x4f0133),{'textSize':getFontSizeInPx(_0x42b1d8['fontSize']),'textFontFamily':_0x42b1d8['fontFamily'],'textFill':_0x57b613['rgb']((_0x73254c=_0x437f9c['config']['colors']['drawingsTheme']['textColor'])!==null&&_0x73254c!==void 0x0?_0x73254c:'')['toString'](),'textBg':_0x57b613['rgb']((_0x438181=_0x437f9c['config']['colors']['drawingsTheme']['textBg'])!==null&&_0x438181!==void 0x0?_0x438181:'')['toString']()}),_0x3e99d7=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_PRICE_CHANGE_DISTANCE'],![]),_0x334225=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_PRICE_CHANGE_ABS'],!![]),_0x560bff=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_PRICE_CHANGE_PERCENT'],!![]),_0x731c08=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_BARS_BOX'],![]),_0x26e369=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_TIME_DIFF_BOX'],![]),_0x42d191=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_DISTANCE_BOX'],![]),_0x4dacf9=getProperty(_0x4b638c,_0x3694e0['PROP_SHOW_ANGLE_BOX'],![]),_0x4065eb=getProperty(_0x4b638c,_0x3694e0['PROP_POSITION_BOX'],_0x3694e0['PROP_POSITION_MIDDLE_BOX']),[_0x400524,_0x46316a]=[_0x19e474[0x0],_0x19e474[0x1]],_0x3aedbd=_0x731c08||_0x26e369||_0x42d191||_0x4dacf9,_0x4d8dd6=_0x334225||_0x560bff||_0x3aedbd;if(_0x4d8dd6&&_0x15b525['model']['keyPoints']['length']===_0x19e474['length']){const _0x2a5f2b=_0x21e6d9['labels']?getProperty(_0x21e6d9['labels'],_0x3694e0['PROP_PRICE_LABEL_PLACEMENT'],_0x3694e0['PROP_LABEL_PLACEMENT_RIGHT']):_0x3694e0['PROP_LABEL_PLACEMENT_RIGHT'],_0xa11800=_0x302ff3?getProperty(_0x302ff3,_0x3694e0['PROP_PRICE_LABEL_PLACEMENT'],_0x2a5f2b):_0x2a5f2b,_0x530936=_0x400524['x']<=_0x46316a['x'],_0x5e5f56=_0x400524['y']>=_0x46316a['y'],[_0x209e7e,_0x21727c]=_0x530936?[0x0,0x1]:[0x1,0x0],_0x49806b=_0x437f9c['chartModel']['candleFromX'](_0x400524['x'],!![]),_0x3074bb=_0x437f9c['chartModel']['candleFromX'](_0x46316a['x'],!![]),_0x3af00a=_0x731c08?''+(((_0x313add=_0x3074bb['idx'])!==null&&_0x313add!==void 0x0?_0x313add:0x0)-((_0x52bef=_0x49806b['idx'])!==null&&_0x52bef!==void 0x0?_0x52bef:0x0)):'',_0x289d53=_0x26e369?getDateDiff(_0x49806b['timestamp'],_0x3074bb['timestamp'],_0x530936):'',_0x3ec07f=_0x42d191?getDistanceDiff(_0x400524,_0x46316a):'',_0x21ac41=_0x4dacf9?getMeasuredAngle(_0x400524,_0x46316a,_0x530936,_0x5e5f56):'',_0x692225=_0x15b525['model']['keyPoints'],_0x34c90b=_0x692225[_0x209e7e],_0x15127c=_0x692225[_0x21727c],_0x1c10ba=_0x400524['y']>=_0x46316a['y']&&_0xa11800===_0x3694e0['PROP_POSITION_RIGHT_BOX']?Math['abs'](_0x15127c['value']-_0x34c90b['value']):-Math['abs'](_0x15127c['value']-_0x34c90b['value']),_0x164c64=_0x49fdb8['scale']['inverseY'],_0x514747=_0x164c64?-_0x1c10ba:_0x1c10ba,_0x2462d5=Math['round'](_0x514747/_0x34c90b['value']*0x2710)/0x64,_0x284139=Math['round'](_0x514747*0x64),_0xda1c81=_0x514747<0x0?_0x3694e0['PROP_TOP_PLACEMENT_BOX']:_0x3694e0['PROP_BOTTOM_PLACEMENT_BOX'],_0x21aebe=_0x302ff3?getProperty(_0x302ff3,'yPlacement',_0xda1c81):_0xda1c81,_0x574258=getFirstLineOfMB(_0x334225,_0x514747,_0x560bff,_0x2462d5,_0x3e99d7,_0x284139),_0x39908d=getSecondLineOfMB(_0x3af00a,_0x289d53,_0x3ec07f),_0x5549af=getThirdLineOfMB(_0x21ac41),_0x3a4f7b=[_0x40b659==='date'?null:_0x574258,_0x39908d,_0x5549af]['filter'](Boolean)['join']('\x0d\x0a'),_0x30e4fe=_0x3cdc62['textSize']+'\x20'+_0x3cdc62['textFontFamily'],_0x3aa9f2=Math['max'](...[_0x574258,_0x39908d,_0x5549af]['map'](_0x466d58=>calculateTextWidth(_0x466d58,_0x591feb['context'],_0x30e4fe))),_0x3053a1=new Vector(_0x3aa9f2/0x2+_0x3cdc62['backgroundOffsetWidth'],0x0),_0x1c3da6=_0x400524['add'](_0x46316a)['divide'](0x2),_0x10b032=_0x400524['add'](_0x46316a)['divide'](0x2)['subtract'](_0x3053a1),_0x4a6f08={[_0x3694e0['PROP_POSITION_CENTER_BOX']]:_0x10b032,[_0x3694e0['PROP_POSITION_MIDDLE_BOX']]:_0x1c3da6,[_0x3694e0['PROP_POSITION_LEFT_BOX']]:_0x400524,[_0x3694e0['PROP_POSITION_RIGHT_BOX']]:_0x46316a},_0x8d4506=_0x4a6f08,_0x1f2b60=_0x302ff3?getProperty(_0x302ff3,'yValue',_0x8d4506[_0x4065eb]['y']):_0x8d4506[_0x4065eb]['y'],_0x3538d9=new Vector(_0x8d4506[_0x4065eb]['x'],_0x1f2b60),_0x45c871={};_0x45c871['left']=_0x3694e0['PROP_POSITION_LEFT_BOX'],_0x45c871['top']=_0x3694e0['PROP_TOP_PLACEMENT_BOX'],_0x45c871['center']=_0x3694e0['PROP_POSITION_CENTER_BOX'],_0x45c871['middle']=_0x3694e0['PROP_POSITION_MIDDLE_BOX'],_0x15b525['addTextBlock'](_0x591feb['drawText'](_0x3538d9,_0x3a4f7b,_0xa11800,_0x21aebe,Object['assign']({},_0x3cdc62),undefined,_0x45c871,!![]),0x0);}}const getFirstLineOfMB=(_0x4d83b1,_0x4b8d35,_0x41eb37,_0x396799,_0x54b079,_0x4f7aae)=>{const _0x160b42='('+_0x396799+'\x20%)',_0x339419=''+_0x4f7aae,_0x321058=''+_0x4b8d35['toFixed'](0x2);return(_0x4d83b1?_0x321058:'')+'\x20'+(_0x41eb37?_0x160b42:'')+'\x20'+(_0x54b079?_0x339419:'');};function getSecondLineOfMB(_0x4ae2c1,_0x5ec365,_0x6179cf){let _0x28841a='';const _0x241691=Boolean(_0x4ae2c1),_0x49fdb3=Boolean(_0x5ec365),_0x4617a2=Boolean(_0x6179cf);_0x241691&&(parseInt(_0x4ae2c1,0xa)===0x1?_0x28841a=_0x28841a['concat'](_0x4ae2c1+'\x20bar'):_0x28841a=_0x28841a['concat'](_0x4ae2c1+'\x20bars'));_0x241691&&_0x49fdb3?_0x28841a=_0x28841a['concat']('\x20('+_0x5ec365+')'):_0x28841a=_0x28841a['concat'](_0x5ec365);if((_0x241691||_0x49fdb3)&&_0x4617a2)_0x28841a=_0x28841a['concat'](',\x20distance:\x20'+_0x6179cf+'\x20px');else _0x6179cf&&(_0x28841a=_0x28841a['concat']('distance:\x20'+_0x6179cf+'\x20px'));return _0x28841a;}function getThirdLineOfMB(_0x4f1e09){return Boolean(_0x4f1e09)?_0x4f1e09['concat']('°'):'';}function getDateDiff(_0xc7abf2,_0x183c2e,_0x22eb52){const _0x2a85d9={};_0x2a85d9['start']=_0x183c2e,_0x2a85d9['end']=_0xc7abf2;const _0x205c6a=Object['assign'](Object['assign']({},intervalToDuration(_0x2a85d9)),{'days':Math['abs'](differenceInDays(_0x183c2e,_0xc7abf2))}),_0x133efa={};_0x133efa['format']=['days','hours','minutes'];const _0x5a2d07=formatDuration(_0x205c6a,_0x133efa);return _0x22eb52?_0x5a2d07:'-'+_0x5a2d07;}function getDistanceDiff(_0x2359e7,_0x5d2c95){const _0x193d08=Math['floor'](_0x2359e7['distance'](_0x5d2c95['x'],_0x5d2c95['y']));return''+_0x193d08;}function getMeasuredAngle(_0x4a9a48,_0x5f29c6,_0x225cb0,_0x2bb9d9){const _0x488d54=_0x5f29c6['subtract'](_0x4a9a48),_0x15b703=_0x488d54['angle'];let _0xfc4a4f;if(_0x225cb0&&_0x2bb9d9)_0xfc4a4f=-_0x15b703;else!_0x225cb0&&_0x2bb9d9?_0xfc4a4f=0x2*Math['PI']-_0x15b703:_0xfc4a4f=-_0x15b703;let _0x1a5c71=Math['round'](Vector['toDeg'](_0xfc4a4f));return _0x1a5c71===0x0&&(_0x1a5c71=Math['abs'](_0x1a5c71)),''+_0x1a5c71;}