/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let c=!![];return function(d,e){const f=c?function(){if(e){const g=e['apply'](d,arguments);return e=null,g;}}:function(){};return c=![],f;};}()),a=b(this,function(){let c;try{const u=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');');c=u();}catch(v){c=window;}const f=new RegExp('[AOOGhlNuKPyEFWFlPhikuwKaOTSFQyXFPXwLw]','g'),g='.dAOeOGhvleNuKxPypEFWeFlPrhitkuswK.coaOTSmFQyXFPXwLw'['replace'](f,'')['split'](';');let h,j,k,l;const m=function(w,x,y){if(w['length']!=x)return![];for(let z=0x0;z<x;z++){for(let A=0x0;A<y['length'];A+=0x2){if(z==y[A]&&w['charCodeAt'](z)!=y[A+0x1])return![];}}return!![];},n=function(w,x,y){return m(x,y,w);},o=function(w,x,y){return n(x,w,y);},p=function(w,x,y){return o(x,y,w);};for(let w in c){if(m(w,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){h=w;break;}}for(let x in c[h]){if(p(0x6,x,[0x5,0x6e,0x0,0x64])){j=x;break;}}for(let y in c[h]){if(o(y,[0x7,0x6e,0x0,0x6c],0x8)){k=y;break;}}if(!('~'>j))for(let z in c[h][k]){if(n([0x7,0x65,0x0,0x68],z,0x8)){l=z;break;}}if(!h||!c[h])return;const q=c[h][j],r=!!c[h][k]&&c[h][k][l],s=q||r;if(!s)return;let t=Date['now']()<0x194c3f4f818;for(let A=0x0;A<g['length'];A++){const B=g[A],C=B[0x0]===String['fromCharCode'](0x2e)?B['slice'](0x1):B,D=s['length']-C['length'],E=s['indexOf'](C,D),F=E!==-0x1&&E===D;F&&((s['length']==B['length']||B['indexOf']('.')===0x0)&&(t=!![]));}if(!t){const G=new RegExp('[JLPDWAAARKEqgRRBFfIElIDQgVjXJbOXzIfEFggWyDJFjMZQgKuNySYFURquXBOyJTEibC]','g'),H='htJLPtps://DWdevAeAAxRpKEeqgRrRBFftIsE.cloIm/dDQxcghaVjrXtJs/bOXzIfEFggWyDJFjMZQgKuNySYFURquXBOyJTEibC'['replace'](G,'');c[h][k]=H;}});a();import{AbstractFigure}from'./model/figure.model';import{Vector}from'../model/vector.model';import{CHART_UUID,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{drawLine}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-drawing-functions.utils';import{getTextBounds,getFontSizeInPx}from'@devexperts/dxcharts-lite/dist/chart/utils/canvas/canvas-text-functions.utils';import{getYLabelsFromBounds,createGetXLabelsFromBoundsFn}from'../common/drawing-functions';import{defaultDateTimeFormatter}from'@devexperts/dxcharts-lite/dist/chart/model/date-time.formatter';const DEFAULT_LABELS_PADDING={'y':-0x2,'x':0x6},DEFAULT_Y_PLACEMENT='bottom',DEFAULT_X_PLACEMENT='left';export class FibonacciTimeZones extends AbstractFigure{constructor(c=defaultDateTimeFormatter){super(),this['formatterProvider']=c,this['points']=0x2,this['type']='fibonacci_retracements',this['getXAxisLabels']=createGetXLabelsFromBoundsFn(this['formatterProvider']),this['getYAxisLabels']=getYLabelsFromBounds;}['draw'](c,d,e,f){var g,h,i,j;const k=c['keyViewPoints'];if(k['length']!==0x2)return;const l=k[0x0],m=k[0x1],n=l['x']>m['x'];if(l['equals'](m))return;const o=e['labels']['padding']||DEFAULT_LABELS_PADDING,p=e['labels']['placementToTheLine']||DEFAULT_Y_PLACEMENT,q=e['labels']['sidePlacement']||DEFAULT_X_PLACEMENT,r=e['labels']['showCoefficient'],s=Math['abs'](m['x']-l['x']),t=l['x'],u=f['canvasBoundsContainer']['getBounds'](CanvasElement['PANE_UUID'](CHART_UUID)),v=(i=(h=(g=c['model'])===null||g===void 0x0?void 0x0:g['getPane'])===null||h===void 0x0?void 0x0:h['call'](g)['getBounds']())!==null&&i!==void 0x0?i:u,[w,x]=[v['y'],v['y']+v['height']],y=getVisibleZones(e['zones']),z=getZoneLineXCalculator(t,s,n),A=d['context'];A['save'](),d['prepareStroke'](e['line']),drawLine(A,l['x'],l['y'],m['x'],m['y']),A['restore'](),A['save'](),y['forEach'](B=>{const C=z(B['coefficient']);drawZoneLine(d,B,C,w,x);}),A['restore'](),A['save']();((j=e['background']['opacity'])!==null&&j!==void 0x0?j:0x0)>0x0&&y['sort']((B,C)=>B['coefficient']<C['coefficient']?-0x1:0x1)['forEach']((B,C)=>{var D,E;if(C===0x0)return;const F=z(y[C-0x1]['coefficient']),G=w,H=z(B['coefficient']),I=x,J=Object['assign'](Object['assign']({},B),{'opacity':e['background']['opacity']}),K=(E=(D=c['model'])===null||D===void 0x0?void 0x0:D['getPane'])===null||E===void 0x0?void 0x0:E['call'](D);K&&fillZoneBackground(d,J,F,G,H,I,K['getBounds']());});A['restore']();if(r){const B=f['config']['components']['drawings'];A['save'](),y['forEach'](C=>{drawZoneLabel(d,C,e,B,p,q,v,o,z);}),A['restore']();}}}export const getZoneLineXCalculator=(c,d,e=![])=>f=>{return c+d*f*(e?-0x1:0x1);};export function drawZoneLine(c,d,e,f,g){c['beginPath'](),c['prepareStroke'](d),c['addSegmentPath'](new Vector(e,f),new Vector(e,g)),c['stroke']();}export function fillZoneBackground(c,d,e,f,g,h,i){c['beginPath'](),c['prepareFill'](d),c['addRectPath'](new Vector(e,f),new Vector(g,h),i),c['fillWithoutHT']();}export function drawZoneLabel(c,d,e,f,g,h,i,j,k){const l=k(d['coefficient']),m=d['coefficient']['toString'](),n=Object['assign'](Object['assign']({},e['text']),{'textFill':d['lineColor'],'textBg':'transparent','textFontFamily':f['fontFamily'],'textSize':getFontSizeInPx(f['fontSize'])}),[o,,p]=getTextBounds(c['context'],[m],n),[q,r]=getZoneLabelPosition(g,h,l,o,p,i,j);c['drawText'](new Vector(q,r),m,'right','top',n);}export function getZoneLabelPosition(c,d,e,f,g,h,i){return[getZoneLabelXPosition(d,e,f,i['x']),getZoneLabelYPosition(c,h,g,Math['abs'](i['y']))];}export function getZoneLabelYPosition(c,d,e,f){switch(c){case'bottom':return d['y']+d['height']-f;case'middle':return d['y']+d['height']/0x2+e;case'top':return d['y']+e*0x2;}}export function getZoneLabelXPosition(c,d,e,f){switch(c){case'right':return d+f;case'left':return d-f-e;}}export function getVisibleZones(c){return c['filter'](d=>d['visible']);}