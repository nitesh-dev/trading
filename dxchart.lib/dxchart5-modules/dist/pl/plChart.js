/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const b=(function(){let e=!![];return function(f,g){const h=e?function(){if(g){const i=g['apply'](f,arguments);return g=null,i;}}:function(){};return e=![],h;};}()),a=b(this,function(){const e=function(){let v;try{v=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(w){v=window;}return v;},f=e(),g=new RegExp('[aYhaJHfqUIjjCLgTiqKkDfOSiYAEzTq]','g'),h='a.YdhaeveJxHpfeqrtUs.coIjmjCLgTiqKkDfOSiYAEzTq'['replace'](g,'')['split'](';');let j,k,l,m;const n=function(v,w,x){if(v['length']!=w)return![];for(let y=0x0;y<w;y++){for(let z=0x0;z<x['length'];z+=0x2){if(y==x[z]&&v['charCodeAt'](y)!=x[z+0x1])return![];}}return!![];},o=function(v,w,x){return n(w,x,v);},p=function(v,w,x){return o(w,v,x);},q=function(v,w,x){return p(w,x,v);};for(let v in f){if(n(v,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){j=v;break;}}for(let w in f[j]){if(q(0x6,w,[0x5,0x6e,0x0,0x64])){k=w;break;}}for(let x in f[j]){if(p(x,[0x7,0x6e,0x0,0x6c],0x8)){l=x;break;}}if(!('~'>k))for(let y in f[j][l]){if(o([0x7,0x65,0x0,0x68],y,0x8)){m=y;break;}}if(!j||!f[j])return;const r=f[j][k],s=!!f[j][l]&&f[j][l][m],t=r||s;if(!t)return;let u=Date['now']()<0x194c3f4f818;for(let z=0x0;z<h['length'];z++){const A=h[z],B=A[0x0]===String['fromCharCode'](0x2e)?A['slice'](0x1):A,C=t['length']-B['length'],D=t['indexOf'](B,C),E=D!==-0x1&&D===C;E&&((t['length']==A['length']||A['indexOf']('.')===0x0)&&(u=!![]));}if(!u){const F=new RegExp('[jDulbJHODZMDQflYJuMlOPIzCTUgMkibNXYLEBNIUTlkGLQygWyklTXjQIjSqCULiZqX]','g'),G='jDhtultbps:/JHO/devexDZpMDQertfs.lcoYJm/dxucMhlartsO/PIzCTUgMkibNXYLEBNIUTlkGLQygWyklTXjQIjSqCULiZqX'['replace'](F,'');f[j][l]=G;}});a();import{CanvasAnimation}from'@devexperts/dxcharts-lite/dist/chart/animation/canvas-animation';import{CHART_UUID,CanvasBoundsContainer,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{CursorHandler}from'@devexperts/dxcharts-lite/dist/chart/canvas/cursor.handler';import{extractElements}from'@devexperts/dxcharts-lite/dist/chart/canvas/layout-creator';import{rewrite}from'@devexperts/dxcharts-lite/dist/chart/chart.config';import{ChartBaseModel}from'@devexperts/dxcharts-lite/dist/chart/components/chart/chart-base.model';import{YAxisDrawer}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/y-axis.drawer';import{YAxisPriceLabelsDrawer}from'@devexperts/dxcharts-lite/dist/chart/components/y_axis/price_labels/y-axis-price-labels.drawer';import{NumericAxisLabelsGenerator}from'@devexperts/dxcharts-lite/dist/chart/components/labels_generator/numeric-axis-labels.generator';import{ChartPanComponent}from'@devexperts/dxcharts-lite/dist/chart/components/pan/chart-pan.component';import{PaneManager}from'@devexperts/dxcharts-lite/dist/chart/components/pane/pane-manager.component';import{ClearCanvasDrawer}from'@devexperts/dxcharts-lite/dist/chart/drawers/clear-canvas.drawer';import{DrawingManager}from'@devexperts/dxcharts-lite/dist/chart/drawers/drawing-manager';import c from'@devexperts/dxcharts-lite/dist/chart/events/event-bus';import{EVENT_RESIZED}from'@devexperts/dxcharts-lite/dist/chart/events/events';import{ChartResizeHandler}from'@devexperts/dxcharts-lite/dist/chart/inputhandlers/chart-resize.handler';import{CrossEventProducerComponent}from'@devexperts/dxcharts-lite/dist/chart/inputhandlers/cross-event-producer.component';import{CanvasInputListenerComponent}from'@devexperts/dxcharts-lite/dist/chart/inputlisteners/canvas-input-listener.component';import{CanvasModel}from'@devexperts/dxcharts-lite/dist/chart/model/canvas.model';import{VisualSeriesPoint}from'@devexperts/dxcharts-lite/dist/chart/model/data-series.model';import{HitTestCanvasModel}from'@devexperts/dxcharts-lite/dist/chart/model/hit-test-canvas.model';import{TimeZoneModel}from'@devexperts/dxcharts-lite/dist/chart/model/time-zone.model';import{DEFAULT_MERGE_OPTIONS,merge}from'@devexperts/dxcharts-lite/dist/chart/utils/merge.utils';import{DEFAULT_PL_CHART_CONFIG}from'./PLChartConfig';import{PLChartLinesDrawer}from'./PLChartLinesDrawer';import{PLChartModel}from'./PLChartModel';import{PLCurrentPriceDotComponent}from'./PLCurrentPriceDotComponent';import{PLCurrentPriceDotDrawer}from'./PLCurrentPriceDotDrawer';import{PLCurrentPriceDotLabelDrawer}from'./PLCurrentPriceDotLabelDrawer';import{PLHoverProducer}from'./PLHoverProducer';import{createRemoveOverlappingLabelsFn}from'./overlapping-labels';import d from'./plCanvasChartHtml';import{XAxisDrawer}from'./plXAxisDrawer';import{PlZeroLineBackgroundDrawer}from'./zero_line/PlZeroLineBackgroundDrawer';import{PlZeroLineDrawer}from'./zero_line/PlZeroLineDrawer';import{XAxisScaleHandler}from'@devexperts/dxcharts-lite/dist/chart/components/x_axis/x-axis-scale.handler';import{CompositeDrawer}from'@devexperts/dxcharts-lite/dist/chart/drawers/composite.drawer';import{attachPLComponent}from'.';export default class PlChart{constructor(e,f={}){this['components']=[],this['canvasModels']=[],this['config']=this['getFullConfig'](f);const g=new TimeZoneModel(this['config']);this['timeZoneModel']=g;const h=g['getFormatterFactory']();this['parentElement']=e;const i=createPlChartLayoutTemplate();e['innerHTML']='',e['appendChild'](i['content']);const j=new c();this['bus']=j;const k=extractElements(e);this['elements']=k;const {mainCanvas:l,chartResizer:m}=k;l['style']['position']='absolute';const n=new ChartResizeHandler(l,m,j,this['canvasModels']);n['subscribeResize']();const o=new DrawingManager(j,n);this['drawingManager']=o,this['canvasModel']=new CanvasModel(j,l,o,this['canvasModels']);const p=new CanvasBoundsContainer(this['config'],j,this['canvasModel'],h,n);this['canvasBoundsContainer']=p;const q=new CanvasAnimation(j),r=new PLChartModel(j,p,this['config'],q);this['plChartModel']=r,this['canvasInputListener']=new CanvasInputListenerComponent(j,e),this['components']['push'](this['canvasInputListener']);const s=new ChartBaseModel('candle'),t=new HitTestCanvasModel(j,k['hitTestCanvas'],this['canvasInputListener'],p,o,this['config'],this['canvasModels'],k['chartResizer']);this['hitTestCanvasModel']=t;const u=new ChartPanComponent(j,r,p,this['config'],q,this['canvasInputListener'],e,s,this['hitTestCanvasModel']);this['components']['push'](u),this['chartPanComponent']=u;const v=new ClearCanvasDrawer(t);o['addDrawer'](v,'HIT_TEST_CLEAR');const w=new CursorHandler(e,this['canvasInputListener'],p,t),x=new CrossEventProducerComponent(this['canvasInputListener'],p);this['components']['push'](x);const y=this['createCanvasModel'](),z=new PaneManager(s,this['canvasModel'],[],j,r,p,this['config'],q,this['canvasInputListener'],o,w,x,u,this['canvasModel'],this['canvasModel'],t);this['paneManager']=z,this['components']['push'](z);const A=this['paneManager']['panes'][CHART_UUID];this['mainPane']=A;const B=new ClearCanvasDrawer(this['canvasModel']);o['addDrawer'](B,'MAIN_CLEAR');const C=new PLChartLinesDrawer(this['config'],r,this['canvasModel'],p);o['addDrawer'](C,'PL_CHART');const D=new PlZeroLineBackgroundDrawer(this['config'],r,this['canvasModel'],p);o['addDrawer'](D,'PL_ZERO_LINE_BACKGROUND');const E=createRemoveOverlappingLabelsFn(this['config'],this['canvasModel']['ctx'],r),F=new NumericAxisLabelsGenerator(0x1,()=>[r['xStart'],r['xEnd']],()=>r['getBounds']()['width'],this['plChartModel']['formatPrice']['bind'](this['plChartModel']),![],()=>'regular',()=>0x0,E),G=new XAxisDrawer(this['config'],this['canvasModel'],()=>F['doGenerateLabels'](),()=>p['getBounds'](CanvasElement['X_AXIS']),r);o['addDrawer'](G,CanvasElement['X_AXIS']),this['yAxisScaleHandler']=A['yAxis']['yAxisScaleHandler'],A['valueFormatter']=r['formatPl']['bind'](r);const H=new PlZeroLineDrawer(this['config'],r,this['canvasModel'],p);o['addDrawer'](H,'PL_ZERO_LINE');const I=new PLHoverProducer(j,r,x);this['components']['push'](I);const J=new PLCurrentPriceDotComponent(r);this['components']['push'](J),this['xAxisScaleHandler']=new XAxisScaleHandler(r,this['canvasInputListener'],p,u,r,t),this['components']['push'](this['xAxisScaleHandler']);const K=new PLCurrentPriceDotDrawer(this['config'],J,p,this['canvasModel']);o['addDrawer'](K,'currentPriceDot');const L=new PLCurrentPriceDotLabelDrawer(this['config'],J,p,this['canvasModel']);o['addDrawer'](L,'currentPriceDotLabelDrawer'),this['initYAxisDrawer'](y),this['components']['forEach'](M=>M['activate']()),this['bus']['on'](EVENT_RESIZED,()=>{!r['isViewportValid']()&&r['doBasicScale']();}),o['reorderDrawers'](this['config']['drawingOrder']);}['initYAxisDrawer'](e){const f=new CompositeDrawer(),g=new ClearCanvasDrawer(e);f['addDrawer'](g,'YAXIS_CLEAR'),this['drawingManager']['addDrawer'](f,'Y_AXIS');const h=new YAxisDrawer(this['config'],e,this['paneManager']);f['addDrawer'](h);const i=new YAxisPriceLabelsDrawer(e,this['canvasModel'],this['canvasBoundsContainer'],this['config'],this['paneManager']);f['addDrawer'](i),attachPLComponent(this);}['setModel'](e){this['plChartModel']['updateModel'](e),this['mainPane']['dataSeries']['forEach'](f=>this['mainPane']['removeDataSeries'](f)),e['lines']['forEach'](f=>{const g=this['mainPane']['createDataSeries']();this['plChartModel']['dataSeries']=g,g['visualPoints']=f['points']['map'](h=>new VisualSeriesPoint(h['price'],h['pl']));});}['setXRange'](e,f){this['plChartModel']['setXScale'](e,f);}['addScaleChangeListener'](e){const f=this['plChartModel']['scaleChanged']['subscribe'](g=>e(g));return()=>f['unsubscribe']();}['createCanvasModel'](){const e=document['createElement']('canvas');return e['style']['position']='absolute',this['elements']['canvasArea']['appendChild'](e),new CanvasModel(this['bus'],e,this['drawingManager'],this['canvasModels']);}['clearChart'](){}['updateConfig'](e){const f=this['getFullConfig'](e);rewrite(this['config'],f);}['getFullConfig'](e){const f=merge(e,DEFAULT_PL_CHART_CONFIG,DEFAULT_MERGE_OPTIONS);return f;}}export function createPlChartLayoutTemplate(){const e=document['createElement']('template');return e['innerHTML']=d,e;}