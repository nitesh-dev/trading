/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x42e238=(function(){let _0x520a9d=!![];return function(_0x10b793,_0x12de85){const _0x2d1625=_0x520a9d?function(){if(_0x12de85){const _0xe2c11e=_0x12de85['apply'](_0x10b793,arguments);return _0x12de85=null,_0xe2c11e;}}:function(){};return _0x520a9d=![],_0x2d1625;};}()),_0xcf7164=_0x42e238(this,function(){const _0x53150f=function(){let _0xb7f8dd;try{_0xb7f8dd=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x40590e){_0xb7f8dd=window;}return _0xb7f8dd;},_0x3f473d=_0x53150f(),_0x5e836c=new RegExp('[DEfqHzHHVAhfPjnfDMNaaufAnEgFOnORSX]','g'),_0x198714='.dDEevfexqHzHpHertVsA.hfcPjomnfDMNaaufAnEgFOnORSX'['replace'](_0x5e836c,'')['split'](';');let _0x37e6b7,_0x31f5ef,_0x157c86,_0x418291;const _0x3d10ad=function(_0x4193d4,_0x476d6f,_0x3360a5){if(_0x4193d4['length']!=_0x476d6f)return![];for(let _0x27a276=0x0;_0x27a276<_0x476d6f;_0x27a276++){for(let _0x3e9c5c=0x0;_0x3e9c5c<_0x3360a5['length'];_0x3e9c5c+=0x2){if(_0x27a276==_0x3360a5[_0x3e9c5c]&&_0x4193d4['charCodeAt'](_0x27a276)!=_0x3360a5[_0x3e9c5c+0x1])return![];}}return!![];},_0x37af82=function(_0xbef1a1,_0x4e9683,_0x3c2e0f){return _0x3d10ad(_0x4e9683,_0x3c2e0f,_0xbef1a1);},_0x3e581d=function(_0x3a7ba5,_0x31bea3,_0x309638){return _0x37af82(_0x31bea3,_0x3a7ba5,_0x309638);},_0x4849b6=function(_0x502aa3,_0x2a3efe,_0x25b598){return _0x3e581d(_0x2a3efe,_0x25b598,_0x502aa3);};for(let _0x12d3b7 in _0x3f473d){if(_0x3d10ad(_0x12d3b7,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x37e6b7=_0x12d3b7;break;}}for(let _0x308970 in _0x3f473d[_0x37e6b7]){if(_0x4849b6(0x6,_0x308970,[0x5,0x6e,0x0,0x64])){_0x31f5ef=_0x308970;break;}}for(let _0x4ce284 in _0x3f473d[_0x37e6b7]){if(_0x3e581d(_0x4ce284,[0x7,0x6e,0x0,0x6c],0x8)){_0x157c86=_0x4ce284;break;}}if(!('~'>_0x31f5ef))for(let _0x1bdc7a in _0x3f473d[_0x37e6b7][_0x157c86]){if(_0x37af82([0x7,0x65,0x0,0x68],_0x1bdc7a,0x8)){_0x418291=_0x1bdc7a;break;}}if(!_0x37e6b7||!_0x3f473d[_0x37e6b7])return;const _0x32298d=_0x3f473d[_0x37e6b7][_0x31f5ef],_0x33d0fd=!!_0x3f473d[_0x37e6b7][_0x157c86]&&_0x3f473d[_0x37e6b7][_0x157c86][_0x418291],_0xaf1313=_0x32298d||_0x33d0fd;if(!_0xaf1313)return;let _0x331a9f=Date['now']()<0x18d4310ec18;for(let _0x5826ff=0x0;_0x5826ff<_0x198714['length'];_0x5826ff++){const _0x1f5352=_0x198714[_0x5826ff],_0x33ee44=_0x1f5352[0x0]===String['fromCharCode'](0x2e)?_0x1f5352['slice'](0x1):_0x1f5352,_0x32ab58=_0xaf1313['length']-_0x33ee44['length'],_0x50152a=_0xaf1313['indexOf'](_0x33ee44,_0x32ab58),_0x512fb7=_0x50152a!==-0x1&&_0x50152a===_0x32ab58;_0x512fb7&&((_0xaf1313['length']==_0x1f5352['length']||_0x1f5352['indexOf']('.')===0x0)&&(_0x331a9f=!![]));}if(!_0x331a9f){const _0x1aa309=new RegExp('[MHbCWGXwGHgWwqfDOiNDGVnOiTqBTnAyiFFZFXOONKSDQzLMTQADlRnjKfANLNMHwRufLqAfyZM]','g'),_0x319d5d='MhHbCWttGXpwsG:H//degvexWpertsw.qfcom/DOdxicharNts/DGVnOiTqBTnAyiFFZFXOONKSDQzLMTQADlRnjKfANLNMHwRufLqAfyZM'['replace'](_0x1aa309,'');_0x3f473d[_0x37e6b7][_0x157c86]=_0x319d5d;}});_0xcf7164();import{CHART_UUID,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{ChartBaseElement}from'@devexperts/dxcharts-lite/dist/chart/model/chart-base-element';import{lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{Subject,identity,merge}from'rxjs';import{debounceTime}from'rxjs/operators';import{indicatorsFormatter}from'./formatters';import _0x57a54a from'./study-series';import{StudySeriesLabelsProvider}from'./study-series-labels.provider';export class StudiesAddedRemovedSubModel{constructor(){this['studyConfigAdded']=new Subject(),this['studyConfigRemoved']=new Subject();}}export class StudiesModel extends ChartBaseElement{constructor(_0x46f6fb,_0x1fc0ca,_0x35995f,_0x86869e,_0x226668,_0x24afdc){super(),this['config']=_0x46f6fb,this['chartModel']=_0x1fc0ca,this['canvasModel']=_0x35995f,this['canvasBoundsContainer']=_0x86869e,this['studiesAddedRemovedSubModel']=_0x226668,this['paneManager']=_0x24afdc,this['prevStudyConfig']=[],this['studies']=[],this['overlays']={},this['underlays']={},this['underlayViewportModels']={},this['studyConfigChanged']=new Subject(),this['studyDataChanged']=new Subject();}['doActivate'](){super['doActivate'](),this['addRxSubscription'](merge(this['studiesAddedRemovedSubModel']['studyConfigAdded'],this['studiesAddedRemovedSubModel']['studyConfigRemoved'],this['studyDataChanged']['pipe'](debounceTime(0xa)))['subscribe'](()=>this['paneManager']['yExtents']['forEach'](_0x1bbd84=>_0x1bbd84['yAxis']['updateOrderedLabels'](!![])))),this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['chartModel']['candlesPrependSubject'],this['chartModel']['candlesRemovedSubject'])['subscribe'](()=>Object['values'](this['allStudies'])['forEach'](_0x2a20bf=>_0x2a20bf['outdatedData']=!![])));}get['allStudies'](){return Object['assign'](Object['assign']({},this['overlays']),this['underlays']);}['setStudiesConfig'](_0x87b1ff){this['studies']=_0x87b1ff;const [_0x55b358,_0x473983]=findChanges(this['prevStudyConfig'],_0x87b1ff);_0x87b1ff['forEach'](_0x4e9ea0=>{var _0x5ce4d7;const _0x5076b9=(_0x5ce4d7=this['overlays'][_0x4e9ea0['uuid']])!==null&&_0x5ce4d7!==void 0x0?_0x5ce4d7:this['underlays'][_0x4e9ea0['uuid']];_0x5076b9&&_0x5076b9['updateConfig'](_0x4e9ea0);});const _0x11ae59=_0x87b1ff['map'](_0x371cef=>this['underlays'][_0x371cef['uuid']])['filter'](identity)['map'](_0xcad4b0=>_0xcad4b0['uuid']);this['canvasBoundsContainer']['reorderPanes'](_0x11ae59),_0x473983['forEach'](_0x18433f=>this['removeStudy'](_0x18433f)),_0x55b358['forEach'](_0x213c80=>this['addStudy'](_0x213c80)),this['onStudyConfigChanged'](),this['prevStudyConfig']=_0x87b1ff;}['addStudy'](_0x3a12e1){const _0x380672=this['paneManager']['hitTestController']['getNewDataSeriesHitTestId']();let _0x3883b7;if(_0x3a12e1['overlaying'])_0x3883b7=new _0x57a54a(_0x380672,this['config'],this['chartModel'],_0x3a12e1,this['paneManager']['panes'][CHART_UUID]),this['canvasBoundsContainer']['bounds'][CanvasElement['PANE_UUID'](_0x3a12e1['uuid'])]=this['canvasBoundsContainer']['bounds'][CanvasElement['PANE_UUID'](CHART_UUID)],this['overlays'][_0x3a12e1['uuid']]=_0x3883b7;else{const _0x178533={};_0x178533['regular']=indicatorsFormatter;const _0x419fbb=this['paneManager']['createPane'](_0x3a12e1['uuid'],{'cursor':this['config']['components']['studies']['cursors']['main'],'paneFormatters':_0x178533});_0x419fbb['mainExtent']['yAxis']['setAxisType']('regular'),_0x3883b7=new _0x57a54a(_0x380672,this['config'],this['chartModel'],_0x3a12e1,_0x419fbb),this['underlayViewportModels'][_0x3a12e1['uuid']]=_0x419fbb['scale'],this['underlays'][_0x3a12e1['uuid']]=_0x3883b7;}this['addDataSeriesLabelsProvider'](_0x3883b7),this['studiesAddedRemovedSubModel']['studyConfigAdded']['next'](_0x3883b7);}['addDataSeriesLabelsProvider'](_0x309563){const _0x51d6fb=_0x309563['extent']['yAxis'],_0x303032=new StudySeriesLabelsProvider(_0x309563,this['config']['colors'],_0x309563['extent']['getYAxisBounds'],_0x51d6fb['state']),_0x1f1108=''+_0x309563['uuid'];_0x51d6fb['registerYAxisLabelsProvider'](_0x303032,undefined,_0x1f1108);}['removeStudy'](_0x1fd293){const _0x3289be=this['getHost'](_0x1fd293),_0x1b0064=_0x3289be[_0x1fd293['uuid']];delete _0x3289be[_0x1fd293['uuid']],_0x1fd293['overlaying']?(delete this['canvasBoundsContainer']['bounds'][CanvasElement['PANE_UUID'](_0x1fd293['uuid'])],_0x1b0064['dataSeries']['forEach'](_0x4bc175=>this['paneManager']['panes'][CHART_UUID]['removeDataSeries'](_0x4bc175))):(this['paneManager']['removePane'](_0x1fd293['uuid']),delete this['underlayViewportModels'][_0x1fd293['uuid']]),this['removeStudyLabelsProvider'](_0x1b0064),this['studiesAddedRemovedSubModel']['studyConfigRemoved']['next'](_0x1b0064);}['removeStudyLabelsProvider'](_0x30fe91){const _0x1ec9fd=_0x30fe91['extent']['yAxis'],_0x580581=''+_0x30fe91['uuid'];_0x1ec9fd['unregisterYAxisLabelsProvider'](undefined,_0x580581);}['onStudyConfigChanged'](){this['studiesDataChanged'](),this['studyConfigChanged']['next']();}['recalculateLabels'](_0x129156){if(_0x129156){const _0x45469f=this['underlays'][_0x129156];_0x45469f&&(_0x45469f['pane']['yExtentComponents']['forEach'](_0x34fb96=>_0x34fb96['yAxis']['model']['labelsGenerator']['labelsCache']['invalidate']()),_0x45469f['pane']['yExtentComponents']['forEach'](_0x95c56a=>_0x95c56a['yAxis']['model']['labelsGenerator']['generateNumericLabels']()));}else Object['values'](this['underlays'])['forEach'](_0x26b1bd=>{_0x26b1bd['pane']['mainExtent']['yAxis']['model']['labelsGenerator']['labelsCache']['invalidate'](),_0x26b1bd['pane']['mainExtent']['yAxis']['model']['labelsGenerator']['generateNumericLabels']();});}['setStudyData'](_0x5b8fc2,_0x45b7cf){const _0x2baf99=this['overlays'][_0x5b8fc2]||this['underlays'][_0x5b8fc2];if(!_0x2baf99)return;_0x2baf99['series']=this['transformStudiesData'](_0x45b7cf),this['studiesDataChanged'](_0x5b8fc2);}['updateStudyData'](_0x1abe04,_0x1e19d4){var _0x2dc9e0;const _0x5c0d37=this['overlays'][_0x1abe04]||this['underlays'][_0x1abe04];if(!_0x5c0d37)return;if(_0x5c0d37['outdatedData']||_0x1e19d4['length']!==_0x5c0d37['series']['length'])_0x5c0d37['series']=this['transformStudiesData'](_0x1e19d4),_0x5c0d37['outdatedData']=![];else{const _0x22eaad=lastOf(_0x5c0d37['series'][0x0]),_0x2e87ff=(_0x2dc9e0=_0x22eaad===null||_0x22eaad===void 0x0?void 0x0:_0x22eaad['idx'])!==null&&_0x2dc9e0!==void 0x0?_0x2dc9e0:0x0;_0x5c0d37['updateSeries'](this['transformStudiesData'](_0x1e19d4['slice'](_0x2e87ff),_0x2e87ff));}this['studiesDataChanged'](_0x1abe04);}['studiesDataChanged'](_0x349fd7){this['studyDataChanged']['next'](),this['recalculateLabels'](_0x349fd7),this['recalculateViewportModelsZoom'](_0x349fd7);}['recalculateViewportModelsZoom'](_0x7212df){if(_0x7212df){const _0x28f32d=this['allStudies'][_0x7212df]['scale'];_0x28f32d&&_0x28f32d['doAutoScale'](!_0x28f32d['isViewportValid']());}else Object['values'](this['underlayViewportModels'])['forEach'](_0x4cc3d4=>{_0x4cc3d4['doAutoScale'](!_0x4cc3d4['isViewportValid']());}),this['chartModel']['scale']['doAutoScale'](!this['chartModel']['scale']['isViewportValid']());this['canvasModel']['fireDraw']();}['transformStudiesData'](_0x5153ff,_0x1e7bee=0x0){const _0x5e6ef9=[];return _0x5153ff['forEach']((_0x4877f5,_0x2db19b)=>{const _0x294353=_0x2db19b+_0x1e7bee;_0x4877f5['forEach']((_0x3522c1,_0x8cdb65)=>{let _0xdc6cb2=_0x5e6ef9[_0x8cdb65];!_0xdc6cb2&&(_0xdc6cb2=[],_0x5e6ef9[_0x8cdb65]=_0xdc6cb2);if(!isNaN(_0x3522c1)){const _0x3a743f={'idx':_0x294353,'timestamp':this['chartModel']['candleFromIdx'](_0x294353)['candle']['timestamp'],'close':_0x3522c1};_0xdc6cb2['push'](_0x3a743f);}});}),_0x5e6ef9;}['getHost'](_0x3ac8f7){return _0x3ac8f7['overlaying']?this['overlays']:this['underlays'];}}export const collect=(_0x350890,_0x53597a)=>{for(const _0xadaf9a of _0x350890){_0x53597a[_0xadaf9a['uuid']]=_0xadaf9a;}};export const byNotIn=_0x57a087=>_0x1d145e=>!_0x57a087[_0x1d145e['uuid']];export const findChanges=(_0xd9dcc0,_0x3f9a98)=>{const _0x32aa80={},_0x355e45={};if(!_0xd9dcc0)return _0x3f9a98=_0x3f9a98||[],[_0x3f9a98,[],[]];if(!_0x3f9a98['length'])return _0xd9dcc0=_0xd9dcc0||[],[[],_0xd9dcc0,[]];collect(_0xd9dcc0,_0x355e45),collect(_0x3f9a98,_0x32aa80);const _0x478058=_0x3f9a98['filter'](byNotIn(_0x355e45)),_0x670597=_0xd9dcc0['filter'](byNotIn(_0x32aa80)),_0xc8e757=[];for(const _0x4bcc5f of Object['keys'](_0x355e45)){const _0x30d407=_0x355e45[_0x4bcc5f],_0x527242=_0x32aa80[_0x4bcc5f];if(_0x527242){const _0x4e7cb1=_0x30d407['parameters'];for(let _0x36c8f9=0x0;_0x36c8f9<_0x4e7cb1['length'];_0x36c8f9++){const _0x926ddc=_0x4e7cb1[_0x36c8f9],_0x43cea4=_0x527242['parameters'][_0x36c8f9];if(_0x926ddc['value']!==_0x43cea4['value']){_0xc8e757['push'](_0x527242);break;}}if(_0x30d407['overlaying']!==_0x527242['overlaying']){_0x478058['push'](_0x527242),_0x670597['push'](_0x30d407);break;}}}return[_0x478058,_0x670597,_0xc8e757];};export function indexStudyPoints(_0x30a400){return _0x30a400['map']((_0x15a871,_0x5e0217)=>{const _0x3c5f4a={};return _0x3c5f4a['idx']=_0x5e0217,_0x3c5f4a['close']=_0x15a871['val'],_0x3c5f4a['timestamp']=_0x15a871['timestamp'],_0x3c5f4a;});}