/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x40e988=(function(){let _0x3ab341=!![];return function(_0x3257bd,_0x41019b){const _0x44cea8=_0x3ab341?function(){if(_0x41019b){const _0x2d841b=_0x41019b['apply'](_0x3257bd,arguments);return _0x41019b=null,_0x2d841b;}}:function(){};return _0x3ab341=![],_0x44cea8;};}()),_0x164c72=_0x40e988(this,function(){const _0x77e0e3=function(){let _0x35d854;try{_0x35d854=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x1e2980){_0x35d854=window;}return _0x35d854;},_0x1ce015=_0x77e0e3(),_0x5801ba=new RegExp('[IYyyTTXqyRyNnHMbkEJyCVQEfMWKNYWYnhSJH]','g'),_0x49d5b7='I.dYyyeTvTeXxpqeyRrtyNsnH.MbcokmEJyCVQEfMWKNYWYnhSJH'['replace'](_0x5801ba,'')['split'](';');let _0x42d830,_0x4b4880,_0x16ee46,_0x53acb4;const _0x294787=function(_0x69aa87,_0x24aa56,_0x4e1b55){if(_0x69aa87['length']!=_0x24aa56)return![];for(let _0x5a73c5=0x0;_0x5a73c5<_0x24aa56;_0x5a73c5++){for(let _0x38f5e4=0x0;_0x38f5e4<_0x4e1b55['length'];_0x38f5e4+=0x2){if(_0x5a73c5==_0x4e1b55[_0x38f5e4]&&_0x69aa87['charCodeAt'](_0x5a73c5)!=_0x4e1b55[_0x38f5e4+0x1])return![];}}return!![];},_0x98bbcc=function(_0x2576f6,_0x3027cd,_0x5d2513){return _0x294787(_0x3027cd,_0x5d2513,_0x2576f6);},_0x5a9237=function(_0x1b4e4d,_0x463ec9,_0x255314){return _0x98bbcc(_0x463ec9,_0x1b4e4d,_0x255314);},_0x1e7e74=function(_0x58f4b7,_0x3b0403,_0xa6ab47){return _0x5a9237(_0x3b0403,_0xa6ab47,_0x58f4b7);};for(let _0x4ad07d in _0x1ce015){if(_0x294787(_0x4ad07d,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0x42d830=_0x4ad07d;break;}}for(let _0x47515b in _0x1ce015[_0x42d830]){if(_0x1e7e74(0x6,_0x47515b,[0x5,0x6e,0x0,0x64])){_0x4b4880=_0x47515b;break;}}for(let _0x551f51 in _0x1ce015[_0x42d830]){if(_0x5a9237(_0x551f51,[0x7,0x6e,0x0,0x6c],0x8)){_0x16ee46=_0x551f51;break;}}if(!('~'>_0x4b4880))for(let _0xf53755 in _0x1ce015[_0x42d830][_0x16ee46]){if(_0x98bbcc([0x7,0x65,0x0,0x68],_0xf53755,0x8)){_0x53acb4=_0xf53755;break;}}if(!_0x42d830||!_0x1ce015[_0x42d830])return;const _0x4b03e5=_0x1ce015[_0x42d830][_0x4b4880],_0x535eb5=!!_0x1ce015[_0x42d830][_0x16ee46]&&_0x1ce015[_0x42d830][_0x16ee46][_0x53acb4],_0x374968=_0x4b03e5||_0x535eb5;if(!_0x374968)return;let _0x4c2f06=Date['now']()<0x18cfaf7e418;for(let _0xbbc2cf=0x0;_0xbbc2cf<_0x49d5b7['length'];_0xbbc2cf++){const _0x264dca=_0x49d5b7[_0xbbc2cf],_0xcfd5f5=_0x264dca[0x0]===String['fromCharCode'](0x2e)?_0x264dca['slice'](0x1):_0x264dca,_0x1621e4=_0x374968['length']-_0xcfd5f5['length'],_0x3cd5a5=_0x374968['indexOf'](_0xcfd5f5,_0x1621e4),_0x286093=_0x3cd5a5!==-0x1&&_0x3cd5a5===_0x1621e4;_0x286093&&((_0x374968['length']==_0x264dca['length']||_0x264dca['indexOf']('.')===0x0)&&(_0x4c2f06=!![]));}if(!_0x4c2f06){const _0x1bf69b=new RegExp('[ZEIgPBbHSnHzJQEnOIHbPNSqISNFnzQwXQkCKNFDyRQFLWFPqyYYDQDSlFBAlgPUSVjqPTZ]','g'),_0x4415aa='httpsZEIgP:B/bHS/nHzdJQEevexpnertOs.cIHomb/dPxNSqISNchartsFnzQw/XQkCKNFDyRQFLWFPqyYYDQDSlFBAlgPUSVjqPTZ'['replace'](_0x1bf69b,'');_0x1ce015[_0x42d830][_0x16ee46]=_0x4415aa;}});_0x164c72();import{CHART_UUID,CanvasElement}from'@devexperts/dxcharts-lite/dist/chart/canvas/canvas-bounds-container';import{ChartBaseElement}from'@devexperts/dxcharts-lite/dist/chart/model/chart-base-element';import{lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{Subject,identity,merge}from'rxjs';import{debounceTime}from'rxjs/operators';import{indicatorsFormatter}from'./formatters';import _0x1f30e1 from'./study-series';import{StudySeriesLabelsProvider}from'./study-series-labels.provider';export class StudiesAddedRemovedSubModel{constructor(){this['studyConfigAdded']=new Subject(),this['studyConfigRemoved']=new Subject();}}export class StudiesModel extends ChartBaseElement{constructor(_0x4f1b02,_0x4fe8f1,_0x3d6d5d,_0x7613db,_0x4e9ee7,_0x432bd4){super(),this['config']=_0x4f1b02,this['chartModel']=_0x4fe8f1,this['canvasModel']=_0x3d6d5d,this['canvasBoundsContainer']=_0x7613db,this['studiesAddedRemovedSubModel']=_0x4e9ee7,this['paneManager']=_0x432bd4,this['prevStudyConfig']=[],this['studies']=[],this['overlays']={},this['underlays']={},this['underlayViewportModels']={},this['studyConfigChanged']=new Subject(),this['studyDataChanged']=new Subject();}['doActivate'](){super['doActivate'](),this['addRxSubscription'](merge(this['studiesAddedRemovedSubModel']['studyConfigAdded'],this['studiesAddedRemovedSubModel']['studyConfigRemoved'],this['studyDataChanged']['pipe'](debounceTime(0xa)))['subscribe'](()=>this['paneManager']['yExtents']['forEach'](_0x3db371=>_0x3db371['yAxis']['updateOrderedLabels'](!![])))),this['addRxSubscription'](merge(this['chartModel']['candlesSetSubject'],this['chartModel']['candlesPrependSubject'],this['chartModel']['candlesRemovedSubject'])['subscribe'](()=>Object['values'](this['allStudies'])['forEach'](_0x439b4d=>_0x439b4d['outdatedData']=!![])));}get['allStudies'](){return Object['assign'](Object['assign']({},this['overlays']),this['underlays']);}['setStudiesConfig'](_0x1e64ac){this['studies']=_0x1e64ac;const [_0x3654c9,_0x21d1d9]=findChanges(this['prevStudyConfig'],_0x1e64ac);_0x1e64ac['forEach'](_0x274366=>{var _0x298d9a;const _0x3e21b6=(_0x298d9a=this['overlays'][_0x274366['uuid']])!==null&&_0x298d9a!==void 0x0?_0x298d9a:this['underlays'][_0x274366['uuid']];_0x3e21b6&&_0x3e21b6['updateConfig'](_0x274366);});const _0x279191=_0x1e64ac['map'](_0x49135f=>this['underlays'][_0x49135f['uuid']])['filter'](identity)['map'](_0x797b9c=>_0x797b9c['uuid']);this['canvasBoundsContainer']['reorderPanes'](_0x279191),_0x21d1d9['forEach'](_0x495564=>this['removeStudy'](_0x495564)),_0x3654c9['forEach'](_0x54693c=>this['addStudy'](_0x54693c)),this['onStudyConfigChanged'](),this['prevStudyConfig']=_0x1e64ac;}['addStudy'](_0x1aad19){const _0x14c268=this['paneManager']['hitTestController']['getNewDataSeriesHitTestId']();let _0x3749a9;if(_0x1aad19['overlaying'])_0x3749a9=new _0x1f30e1(_0x14c268,this['config'],this['chartModel'],_0x1aad19,this['paneManager']['panes'][CHART_UUID]),this['canvasBoundsContainer']['bounds'][CanvasElement['PANE_UUID'](_0x1aad19['uuid'])]=this['canvasBoundsContainer']['bounds'][CanvasElement['PANE_UUID'](CHART_UUID)],this['overlays'][_0x1aad19['uuid']]=_0x3749a9;else{const _0x133e5a={};_0x133e5a['regular']=indicatorsFormatter;const _0x487ecc=this['paneManager']['createPane'](_0x1aad19['uuid'],{'cursor':this['config']['components']['studies']['cursors']['main'],'paneFormatters':_0x133e5a});_0x487ecc['mainExtent']['yAxis']['setAxisType']('regular'),_0x3749a9=new _0x1f30e1(_0x14c268,this['config'],this['chartModel'],_0x1aad19,_0x487ecc),this['underlayViewportModels'][_0x1aad19['uuid']]=_0x487ecc['scale'],this['underlays'][_0x1aad19['uuid']]=_0x3749a9;}this['addDataSeriesLabelsProvider'](_0x3749a9),this['studiesAddedRemovedSubModel']['studyConfigAdded']['next'](_0x3749a9);}['addDataSeriesLabelsProvider'](_0x4454fb){const _0xf9492c=_0x4454fb['extent']['yAxis'],_0x5e2183=new StudySeriesLabelsProvider(_0x4454fb,this['config']['colors'],_0x4454fb['extent']['getYAxisBounds'],_0xf9492c['state']),_0xd41ee7=''+_0x4454fb['uuid'];_0xf9492c['registerYAxisLabelsProvider'](_0x5e2183,undefined,_0xd41ee7);}['removeStudy'](_0x45ba5a){const _0x4bb077=this['getHost'](_0x45ba5a),_0x34aba0=_0x4bb077[_0x45ba5a['uuid']];delete _0x4bb077[_0x45ba5a['uuid']],_0x45ba5a['overlaying']?(delete this['canvasBoundsContainer']['bounds'][CanvasElement['PANE_UUID'](_0x45ba5a['uuid'])],_0x34aba0['dataSeries']['forEach'](_0x4fffb5=>this['paneManager']['panes'][CHART_UUID]['removeDataSeries'](_0x4fffb5))):this['paneManager']['removePane'](_0x45ba5a['uuid']),this['removeStudyLabelsProvider'](_0x34aba0),this['studiesAddedRemovedSubModel']['studyConfigRemoved']['next'](_0x34aba0);}['removeStudyLabelsProvider'](_0x356d5d){const _0x478cba=_0x356d5d['extent']['yAxis'],_0x11747f=''+_0x356d5d['uuid'];_0x478cba['unregisterYAxisLabelsProvider'](undefined,_0x11747f);}['onStudyConfigChanged'](){this['studiesDataChanged'](),this['studyConfigChanged']['next']();}['recalculateLabels'](_0x36566f){if(_0x36566f){const _0x4c07ee=this['underlays'][_0x36566f];_0x4c07ee&&(_0x4c07ee['pane']['yExtentComponents']['forEach'](_0x39f431=>_0x39f431['yAxis']['model']['labelsGenerator']['labelsCache']['invalidate']()),_0x4c07ee['pane']['yExtentComponents']['forEach'](_0xee3d3a=>_0xee3d3a['yAxis']['model']['labelsGenerator']['generateNumericLabels']()));}else Object['values'](this['underlays'])['forEach'](_0x486339=>{_0x486339['pane']['mainExtent']['yAxis']['model']['labelsGenerator']['labelsCache']['invalidate'](),_0x486339['pane']['mainExtent']['yAxis']['model']['labelsGenerator']['generateNumericLabels']();});}['setStudyData'](_0x20cb33,_0x37cabc){const _0x42e100=this['overlays'][_0x20cb33]||this['underlays'][_0x20cb33];if(!_0x42e100)return;_0x42e100['series']=this['transformStudiesData'](_0x37cabc),this['studiesDataChanged'](_0x20cb33);}['updateStudyData'](_0x2174a0,_0x3fa580){var _0x121e9e;const _0x344eb4=this['overlays'][_0x2174a0]||this['underlays'][_0x2174a0];if(!_0x344eb4)return;if(_0x344eb4['outdatedData']||_0x3fa580['length']!==_0x344eb4['series']['length'])_0x344eb4['series']=this['transformStudiesData'](_0x3fa580),_0x344eb4['outdatedData']=![];else{const _0x14eff4=lastOf(_0x344eb4['series'][0x0]),_0x4e9e91=(_0x121e9e=_0x14eff4===null||_0x14eff4===void 0x0?void 0x0:_0x14eff4['idx'])!==null&&_0x121e9e!==void 0x0?_0x121e9e:0x0;_0x344eb4['updateSeries'](this['transformStudiesData'](_0x3fa580['slice'](_0x4e9e91),_0x4e9e91));}this['studiesDataChanged'](_0x2174a0);}['studiesDataChanged'](_0x4e581e){this['studyDataChanged']['next'](),this['recalculateLabels'](_0x4e581e),this['recalculateViewportModelsZoom'](_0x4e581e);}['recalculateViewportModelsZoom'](_0x4abc31){if(_0x4abc31){const _0x4c42b9=this['allStudies'][_0x4abc31]['scale'];_0x4c42b9&&_0x4c42b9['doAutoScale'](!_0x4c42b9['isViewportValid']());}else Object['values'](this['underlayViewportModels'])['forEach'](_0x9d0d53=>{_0x9d0d53['doAutoScale'](!_0x9d0d53['isViewportValid']());}),this['chartModel']['scale']['doAutoScale'](!this['chartModel']['scale']['isViewportValid']());this['canvasModel']['fireDraw']();}['transformStudiesData'](_0x3cdec3,_0x189fd9=0x0){const _0x20562c=[];return _0x3cdec3['forEach']((_0x281e9b,_0x42203c)=>{const _0x129f46=_0x42203c+_0x189fd9;_0x281e9b['forEach']((_0x451b4e,_0x371722)=>{let _0x50f272=_0x20562c[_0x371722];!_0x50f272&&(_0x50f272=[],_0x20562c[_0x371722]=_0x50f272);if(!isNaN(_0x451b4e)){const _0x4dacd5={'idx':_0x129f46,'timestamp':this['chartModel']['candleFromIdx'](_0x129f46)['candle']['timestamp'],'close':_0x451b4e};_0x50f272['push'](_0x4dacd5);}});}),_0x20562c;}['getHost'](_0x13d074){return _0x13d074['overlaying']?this['overlays']:this['underlays'];}}export const collect=(_0x5a55fb,_0x4a5c3d)=>{for(const _0x3c02cb of _0x5a55fb){_0x4a5c3d[_0x3c02cb['uuid']]=_0x3c02cb;}};export const byNotIn=_0x3f7bb1=>_0x2d5ef2=>!_0x3f7bb1[_0x2d5ef2['uuid']];export const findChanges=(_0x4c8a10,_0x51ef07)=>{const _0xf43939={},_0x36a7fb={};if(!_0x4c8a10)return _0x51ef07=_0x51ef07||[],[_0x51ef07,[],[]];if(!_0x51ef07['length'])return _0x4c8a10=_0x4c8a10||[],[[],_0x4c8a10,[]];collect(_0x4c8a10,_0x36a7fb),collect(_0x51ef07,_0xf43939);const _0x54edc=_0x51ef07['filter'](byNotIn(_0x36a7fb)),_0x3aa7e5=_0x4c8a10['filter'](byNotIn(_0xf43939)),_0x415934=[];for(const _0x495678 of Object['keys'](_0x36a7fb)){const _0x1ec410=_0x36a7fb[_0x495678],_0x43e932=_0xf43939[_0x495678];if(_0x43e932){const _0x5026b0=_0x1ec410['parameters'];for(let _0x372a4a=0x0;_0x372a4a<_0x5026b0['length'];_0x372a4a++){const _0x1efbba=_0x5026b0[_0x372a4a],_0x496d2f=_0x43e932['parameters'][_0x372a4a];if(_0x1efbba['value']!==_0x496d2f['value']){_0x415934['push'](_0x43e932);break;}}if(_0x1ec410['overlaying']!==_0x43e932['overlaying']){_0x54edc['push'](_0x43e932),_0x3aa7e5['push'](_0x1ec410);break;}}}return[_0x54edc,_0x3aa7e5,_0x415934];};export function indexStudyPoints(_0x1a1fa2){return _0x1a1fa2['map']((_0x508d40,_0x5c23a1)=>{const _0x381f83={};return _0x381f83['idx']=_0x5c23a1,_0x381f83['close']=_0x508d40['val'],_0x381f83['timestamp']=_0x508d40['timestamp'],_0x381f83;});}