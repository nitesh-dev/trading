/** Copyright Â©2023 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
const _0x2d73f6=(function(){let _0x17e591=!![];return function(_0x17ec1d,_0x1eea29){const _0x190f20=_0x17e591?function(){if(_0x1eea29){const _0x2530d6=_0x1eea29['apply'](_0x17ec1d,arguments);return _0x1eea29=null,_0x2530d6;}}:function(){};return _0x17e591=![],_0x190f20;};}()),_0x1b3504=_0x2d73f6(this,function(){const _0x5da1e1=function(){let _0x5ae651;try{_0x5ae651=Function('return\x20(function()\x20'+'{}.constructor(\x22return\x20this\x22)(\x20)'+');')();}catch(_0x3a3978){_0x5ae651=window;}return _0x5ae651;},_0x33ba06=_0x5da1e1(),_0x20557c=new RegExp('[uuyEAHRZSwuLuYGgAOiPqbyLuUaWOlUGXglLBWWVVG]','g'),_0x3b5e55='u.devuyexpEAertHsR.ZcSomwuLuYGgAOiPqbyLuUaWOlUGXglLBWWVVG'['replace'](_0x20557c,'')['split'](';');let _0xd54beb,_0x45312e,_0x4a9adf,_0x20f986;const _0x55e77c=function(_0x2f7f3d,_0x387df1,_0x1d391d){if(_0x2f7f3d['length']!=_0x387df1)return![];for(let _0x1035e8=0x0;_0x1035e8<_0x387df1;_0x1035e8++){for(let _0x3c0e27=0x0;_0x3c0e27<_0x1d391d['length'];_0x3c0e27+=0x2){if(_0x1035e8==_0x1d391d[_0x3c0e27]&&_0x2f7f3d['charCodeAt'](_0x1035e8)!=_0x1d391d[_0x3c0e27+0x1])return![];}}return!![];},_0x30ebed=function(_0x255cc3,_0x583f54,_0x4cf3b6){return _0x55e77c(_0x583f54,_0x4cf3b6,_0x255cc3);},_0x4742ed=function(_0x5845c8,_0x23ce6b,_0x47bd9c){return _0x30ebed(_0x23ce6b,_0x5845c8,_0x47bd9c);},_0x3d1101=function(_0x32e71e,_0x29870c,_0x2dfbd0){return _0x4742ed(_0x29870c,_0x2dfbd0,_0x32e71e);};for(let _0x39c20f in _0x33ba06){if(_0x55e77c(_0x39c20f,0x8,[0x7,0x74,0x5,0x65,0x3,0x75,0x0,0x64])){_0xd54beb=_0x39c20f;break;}}for(let _0x99b778 in _0x33ba06[_0xd54beb]){if(_0x3d1101(0x6,_0x99b778,[0x5,0x6e,0x0,0x64])){_0x45312e=_0x99b778;break;}}for(let _0x33ff8d in _0x33ba06[_0xd54beb]){if(_0x4742ed(_0x33ff8d,[0x7,0x6e,0x0,0x6c],0x8)){_0x4a9adf=_0x33ff8d;break;}}if(!('~'>_0x45312e))for(let _0x143fe8 in _0x33ba06[_0xd54beb][_0x4a9adf]){if(_0x30ebed([0x7,0x65,0x0,0x68],_0x143fe8,0x8)){_0x20f986=_0x143fe8;break;}}if(!_0xd54beb||!_0x33ba06[_0xd54beb])return;const _0xe57078=_0x33ba06[_0xd54beb][_0x45312e],_0x5bd441=!!_0x33ba06[_0xd54beb][_0x4a9adf]&&_0x33ba06[_0xd54beb][_0x4a9adf][_0x20f986],_0x47538e=_0xe57078||_0x5bd441;if(!_0x47538e)return;let _0x41fe80=Date['now']()<0x18cfaf7e418;for(let _0x1a5a3d=0x0;_0x1a5a3d<_0x3b5e55['length'];_0x1a5a3d++){const _0x27e433=_0x3b5e55[_0x1a5a3d],_0x49413d=_0x27e433[0x0]===String['fromCharCode'](0x2e)?_0x27e433['slice'](0x1):_0x27e433,_0x3fef0d=_0x47538e['length']-_0x49413d['length'],_0x2a7220=_0x47538e['indexOf'](_0x49413d,_0x3fef0d),_0x40faf7=_0x2a7220!==-0x1&&_0x2a7220===_0x3fef0d;_0x40faf7&&((_0x47538e['length']==_0x27e433['length']||_0x27e433['indexOf']('.')===0x0)&&(_0x41fe80=!![]));}if(!_0x41fe80){const _0x64a530=new RegExp('[IWlwfLHOPMKnNuQwfXlCQjFnNAEVQTFyKbCJFIGzJWGQWYFBFQREZkzwDbiGXwfXnKWJTQWkLNKD]','g'),_0xecc477='hIWlttpwsf:LH/OPM/devKnNeuQwxfpXlCerQts.cojFmn/NAdExchVarQTFyts/KbCJFIGzJWGQWYFBFQREZkzwDbiGXwfXnKWJTQWkLNKD'['replace'](_0x64a530,'');_0x33ba06[_0xd54beb][_0x4a9adf]=_0xecc477;}});_0x1b3504();import{BASIC_CANDLE_WIDTH}from'@devexperts/dxcharts-lite/dist/chart/model/candle.model';import{ChartBaseElement}from'@devexperts/dxcharts-lite/dist/chart/model/chart-base-element';import{firstOf,lastOf}from'@devexperts/dxcharts-lite/dist/chart/utils/array.utils';import{filter,map,pairwise}from'rxjs/operators';import{EQUIVOLUME,resolveColorForEquivolume,resolveColorForLastCandle}from'./EquivolumeConfig';import{EquivolumeDrawer}from'./EquivolumeDrawer';export class EquivolumeComponent extends ChartBaseElement{constructor(_0x131844,_0x15545e,_0x37fcdd,_0x573a17,_0x5ac9e6,_0x1e6355,_0x3e2379,_0x57f0f6){super(),this['eventBus']=_0x131844,this['chartComponent']=_0x15545e,this['xAxis']=_0x37fcdd,this['yAxis']=_0x573a17,this['volumes']=_0x5ac9e6,this['config']=_0x1e6355,this['paneManager']=_0x3e2379,this['avgMainSeriesVolume']=0x1,this['cornerVolumes']=[0x0,0x0],this['calculateEquivolumeWidth']=_0x5e9a45=>{var _0xd087d,_0x559d04,_0x5ab627,_0x43d0a0,_0x3f3e94,_0x2f9a19,_0x7af9c5,_0x5c8df1;if(this['config']['components']['chart']['type']==='equivolume'){const _0x1078f6=this['chartComponent']['chartModel']['mainCandleSeries']['dataPoints'];return(firstOf(this['cornerVolumes'])!==((_0xd087d=firstOf(_0x1078f6))===null||_0xd087d===void 0x0?void 0x0:_0xd087d['volume'])||lastOf(this['cornerVolumes'])!==((_0x559d04=lastOf(_0x1078f6))===null||_0x559d04===void 0x0?void 0x0:_0x559d04['volume']))&&(this['cornerVolumes'][0x0]=(_0x43d0a0=(_0x5ab627=firstOf(_0x1078f6))===null||_0x5ab627===void 0x0?void 0x0:_0x5ab627['volume'])!==null&&_0x43d0a0!==void 0x0?_0x43d0a0:0x0,this['cornerVolumes'][0x1]=(_0x2f9a19=(_0x3f3e94=lastOf(_0x1078f6))===null||_0x3f3e94===void 0x0?void 0x0:_0x3f3e94['volume'])!==null&&_0x2f9a19!==void 0x0?_0x2f9a19:0x0,this['updateAvgMainSeriesVolume']()),((_0x5c8df1=this['chartComponent']['chartModel']['mainCandleSeries']['dataPoints'][(_0x7af9c5=_0x5e9a45['idx'])!==null&&_0x7af9c5!==void 0x0?_0x7af9c5:0x0]['volume'])!==null&&_0x5c8df1!==void 0x0?_0x5c8df1:_0x5e9a45['volume'])/this['avgMainSeriesVolume']||0x1;}else return BASIC_CANDLE_WIDTH;},_0x15545e['registerDataSeriesTypeDrawer'](EQUIVOLUME,new EquivolumeDrawer(this['config']['components']['chart'])),_0x15545e['barTypeValues']['forEach'](_0x58bff2=>this['chartComponent']['registerCandlesWidthCalculator'](_0x58bff2,this['calculateEquivolumeWidth'])),this['volumes']['registerVolumeColorResolver'](EQUIVOLUME,resolveColorForEquivolume),_0x57f0f6===null||_0x57f0f6===void 0x0?void 0x0:_0x57f0f6['registerCandleMagnetPointsResolver'](EQUIVOLUME,equivolumePriceResolver),this['yAxis']['registerLabelColorResolver'](EQUIVOLUME,resolveColorForLastCandle),this['addRxSubscription'](this['chartComponent']['observeCandlesPrepended']()['pipe'](filter(({prependedCandles:_0x4ba0b2})=>_0x4ba0b2['length']!==0x0),map(({prependedCandles:_0x57f8c0})=>{return this['chartComponent']['chartModel']['mainCandleSeries']['visualPoints']['slice'](0x0,_0x57f8c0['length']);}))['subscribe'](()=>{this['config']['components']['chart']['type']==='equivolume'&&this['xAxis']['xAxisLabelsGenerator']['generateLabels']();}));}['updateAvgMainSeriesVolume'](){this['avgMainSeriesVolume']=this['chartComponent']['chartModel']['mainCandleSeries']['dataPoints']['reduce']((_0x578874,_0x4e7b89)=>_0x578874+_0x4e7b89['volume'],0x0)/this['chartComponent']['chartModel']['mainCandleSeries']['dataPoints']['length'];}['doActivate'](){super['doActivate'](),this['addRxSubscription'](this['chartComponent']['observeChartTypeChanged']()['pipe'](pairwise())['subscribe'](([_0x2c3a13,_0x571589])=>{(_0x2c3a13==='equivolume'||_0x571589==='equivolume')&&(this['chartComponent']['chartModel']['doPreviousTimeFrameScale'](),Object['values'](this['paneManager']['panes'])['forEach'](_0x21a972=>_0x21a972['dataSeries']['forEach'](_0x5b49e4=>{_0x5b49e4['recalculateVisualPoints'](),_0x5b49e4['recalculateDataViewportIndexes']();})),this['xAxis']['xAxisLabelsGenerator']['generateLabels']());}));}['setShowClosePrice'](_0x26d07a){this['config']['components']['chart']['equivolume']['showClosePrice']=_0x26d07a,this['eventBus']['fireDraw']([this['chartComponent']['canvasModel']['canvasId']]);}}const equivolumePriceResolver=_0x514888=>[_0x514888['close'],_0x514888['high'],_0x514888['low']];