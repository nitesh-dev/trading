/** Copyright Â©2024 Devexperts LLC.
All rights reserved. Any unauthorized use will constitute an infringement of copyright.
In case of any questions regarding types of use, please contact legal@devexperts.com.
This notice must remain intact.
**/
import{isSuccess}from'@dx-private/dxchart5-react/dist/utils/adt/remote-data.adt';import{toSubscriptionKey}from'./dx-feed-candle-data-provider';export const DEFAULT_LAZY_LOADING_CONFIG={'enabled':!![],'firstChunkSize':0x3e8,'nextChunkSize':0xc8,'startLoadDistance':0x0};export const createCandleAdapter=(a,b)=>{const c=new Map(),d=(i,j,k,l,m)=>{a['subscribeLastCandleUpdates'](i,j,m)['subscribe'](n=>l([n])),c['set'](k,[i,j,m]);},e=new Map(),f=(i,j,k)=>{const l=toSubscriptionKey(i,j,k);return new Promise(m=>{const n=e['get'](l);n?m(g(n,k)):a['subscribeHistoryData'](i,j,k)['subscribe'](o=>{var p;isSuccess(o)&&(e['set'](l,o['value']['data']),m(g((p=e['get'](l))!==null&&p!==void 0x0?p:[],k!==null&&k!==void 0x0?k:{})));});});},g=(i,j={})=>{const k=Math['min'](i['length'],b['firstChunkSize']);if(!b['enabled'])return j['toTime']?[]:i;const l=j['fromTime'],m=j['toTime'];if(!m&&!l)return i['slice'](-k);if(m){const n=i['findIndex'](p=>p['time']===m);let o=Math['max'](n-b['nextChunkSize'],0x0);return l&&(o=i['findIndex'](p=>l<p['time'])),i['slice'](o,n);}else{if(l){const p=i['findIndex'](r=>l<r['time']),q=Math['max'](Math['min'](p,i['length']-k),0x0);return i['slice'](q);}}return i;},h=i=>{const j=c['get'](i);j!==undefined&&a['unsubscribeData'](...j);};return{'subscribeCandles':d,'requestHistoryData':f,'unsubscribeCandles':h};};